const __vite__fileDeps=["assets/chunks/raw-CcGKjn8q-DFOt-i8n.Bw407ngt.js","assets/chunks/basedecoder-Qm25PwVp-CHo5Pomv.CXiqZbVR.js","assets/chunks/lzw-BOMhmEDy-Dboc93VO.P5nsTiIb.js","assets/chunks/jpeg-DNfUpLwy-Fjan-04T.BxqdrV3-.js","assets/chunks/deflate-Be2Arps5-hDqMz3RA.CZq5SbJs.js","assets/chunks/pako.esm-C3kYPGGQ-BMki8cQY.CkDq0qTE.js","assets/chunks/packbits-DaUD6MLm-Bu1PoTGa.CJbViLSe.js","assets/chunks/lerc-C9VL9kri-cIdbW0sg.fJvNmKzg.js","assets/chunks/framework.CXycA2KK.js","assets/chunks/eo-dash.DpEsFCu4.js","assets/chunks/commonjsHelpers-DaMA6jEr.DwXtFsJ3.js","assets/chunks/DynamicWebComponent-BrHVTesn.D5v3V8G2.js","assets/chunks/webimage-D2c098k3-DLj1LQxB.7ggil7aE.js","assets/chunks/decoder-kAoyGIq9-BBR5CgzS.DDHdXxCM.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var ax=Object.defineProperty;var lx=(i,t,e)=>t in i?ax(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var ac=(i,t,e)=>(lx(i,typeof t!="symbol"?t+"":t,e),e),nf=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var bs=(i,t,e)=>(nf(i,t,"read from private field"),e?e.call(i):t.get(i)),lc=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},Ha=(i,t,e,n)=>(nf(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);import{a3 as jn}from"./framework.CXycA2KK.js";import{_ as hx,V as Es,t as cx,O as ux,a0 as dx,a1 as gx,g as fx,P as px}from"./eo-dash.DpEsFCu4.js";import{o as Os,l as mx}from"./commonjsHelpers-DaMA6jEr.DwXtFsJ3.js";import _x from"./DynamicWebComponent-BrHVTesn.D5v3V8G2.js";var Um={exports:{}},ml={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */ml.exports;var sf;function yx(){return sf||(sf=1,function(i,t){(function(e){var n=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,r=typeof Os=="object"&&Os;(r.global===r||r.window===r||r.self===r)&&(e=r);var o,a=2147483647,l=36,h=1,c=26,u=38,g=700,f=72,p=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-h,T=Math.floor,R=String.fromCharCode,C;function P(L){throw new RangeError(E[L])}function N(L,k){for(var W=L.length,K=[];W--;)K[W]=k(L[W]);return K}function U(L,k){var W=L.split("@"),K="";W.length>1&&(K=W[0]+"@",L=W[1]),L=L.replace(w,".");var G=L.split("."),H=N(G,k).join(".");return K+H}function j(L){for(var k=[],W=0,K=L.length,G,H;W<K;)G=L.charCodeAt(W++),G>=55296&&G<=56319&&W<K?(H=L.charCodeAt(W++),(H&64512)==56320?k.push(((G&1023)<<10)+(H&1023)+65536):(k.push(G),W--)):k.push(G);return k}function B(L){return N(L,function(k){var W="";return k>65535&&(k-=65536,W+=R(k>>>10&1023|55296),k=56320|k&1023),W+=R(k),W}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function m(L,k){return L+22+75*(L<26)-((k!=0)<<5)}function y(L,k,W){var K=0;for(L=W?T(L/g):L>>1,L+=T(L/k);L>S*c>>1;K+=l)L=T(L/S);return T(K+(S+1)*L/(L+u))}function b(L){var k=[],W=L.length,K,G=0,H=p,Q=f,nt,xt,dt,Tt,Et,kt,Yt,ue,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&P("not-basic"),k.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<W;){for(Tt=G,Et=1,kt=l;dt>=W&&P("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/Et))&&P("overflow"),G+=Yt*Et,ue=kt<=Q?h:kt>=Q+c?c:kt-Q,!(Yt<ue);kt+=l)Ht=l-ue,Et>T(a/Ht)&&P("overflow"),Et*=Ht;K=k.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&P("overflow"),H+=T(G/K),G%=K,k.splice(G++,0,H)}return B(k)}function M(L){var k,W,K,G,H,Q,nt,xt,dt,Tt,Et,kt=[],Yt,ue,Ht,Ke;for(L=j(L),Yt=L.length,k=p,W=0,H=f,Q=0;Q<Yt;++Q)Et=L[Q],Et<128&&kt.push(R(Et));for(K=G=kt.length,G&&kt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)Et=L[Q],Et>=k&&Et<nt&&(nt=Et);for(ue=K+1,nt-k>T((a-W)/ue)&&P("overflow"),W+=(nt-k)*ue,k=nt,Q=0;Q<Yt;++Q)if(Et=L[Q],Et<k&&++W>a&&P("overflow"),Et==k){for(xt=W,dt=l;Tt=dt<=H?h:dt>=H+c?c:dt-H,!(xt<Tt);dt+=l)Ke=xt-Tt,Ht=l-Tt,kt.push(R(m(Tt+Ke%Ht,0))),xt=T(Ke/Ht);kt.push(R(m(xt,0))),H=y(W,ue,K==G),W=0,++K}++W,++k}return kt.join("")}function I(L){return U(L,function(k){return x.test(k)?b(k.slice(4).toLowerCase()):k})}function A(L){return U(L,function(k){return v.test(k)?"xn--"+M(k):k})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:I},n&&s)if(i.exports==n)s.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(Os)}(ml,ml.exports)),ml.exports}var rf={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var of;function xx(){return of||(of=1,function(i){(function(t,e){i.exports?i.exports=e():t.IPv6=e(t)})(Os,function(t){var e=t&&t.IPv6;function n(r){var o=r.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&a[c]!=="";c++);if(c<h)for(a.splice(c,1,"0000");a.length<h;)a.splice(c,0,"0000");for(var u,g=0;g<h;g++){u=a[g].split("");for(var f=0;f<3&&u[0]==="0"&&u.length>1;f++)u.splice(0,1);a[g]=u.join("")}var p=-1,_=0,x=0,v=-1,w=!1;for(g=0;g<h;g++)w?a[g]==="0"?x+=1:(w=!1,x>_&&(p=v,_=x)):a[g]==="0"&&(w=!0,v=g,x=1);x>_&&(p=v,_=x),_>1&&a.splice(p,_,""),l=a.length;var E="";for(a[0]===""&&(E=":"),g=0;g<l&&(E+=a[g],g!==l-1);g++)E+=":";return a[l-1]===""&&(E+=":"),E}function s(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:s}})}(rf)),rf.exports}var af={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var lf;function vx(){return lf||(lf=1,function(i){(function(t,e){i.exports?i.exports=e():t.SecondLevelDomains=e(t)})(Os,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var o=s.lastIndexOf(".",r-1);if(o<=0||o>=r-1)return!1;var a=n.list[s.slice(r+1)];return a?a.indexOf(" "+s.slice(o+1,r)+" ")>=0:!1},is:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var o=s.lastIndexOf(".",r-1);if(o>=0)return!1;var a=n.list[s.slice(r+1)];return a?a.indexOf(" "+s.slice(0,r)+" ")>=0:!1},get:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return null;var o=s.lastIndexOf(".",r-1);if(o<=0||o>=r-1)return null;var a=n.list[s.slice(r+1)];return!a||a.indexOf(" "+s.slice(o+1,r)+" ")<0?null:s.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(af)),af.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(i){(function(t,e){i.exports?i.exports=e(yx(),xx(),vx()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(Os,function(t,e,n,s){var r=s&&s.URI;function o(d,m){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,m):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),m!==void 0?this.absoluteTo(m):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function c(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function g(d){return u(d)==="Array"}function f(d,m){var y={},b,M;if(u(m)==="RegExp")y=null;else if(g(m))for(b=0,M=m.length;b<M;b++)y[m[b]]=!0;else y[m]=!0;for(b=0,M=d.length;b<M;b++){var I=y&&y[d[b]]!==void 0||!y&&m.test(d[b]);I&&(d.splice(b,1),M--,b--)}return d}function p(d,m){var y,b;if(g(m)){for(y=0,b=m.length;y<b;y++)if(!p(d,m[y]))return!1;return!0}var M=u(m);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(m))return!0}else if(d[y]===m)return!0;return!1}function _(d,m){if(!g(d)||!g(m)||d.length!==m.length)return!1;d.sort(),m.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==m[y])return!1;return!0}function x(d){var m=/^\/+|\/+$/g;return d.replace(m,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var m=d.nodeName.toLowerCase();if(!(m==="input"&&d.type!=="image"))return o.domAttributes[m]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,m){var y=o.encode(d+"");return m===void 0&&(m=o.escapeQuerySpace),m?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,m){d+="",m===void 0&&(m=o.escapeQuerySpace);try{return o.decode(m?d.replace(/\+/g,"%20"):d)}catch{return d}};var E={encode:"encode",decode:"decode"},S,T=function(d,m){return function(y){try{return o[m](y+"").replace(o.characters[d][m].expression,function(b){return o.characters[d][m].map[b]})}catch{return y}}};for(S in E)o[S+"PathSegment"]=T("pathname",E[S]),o[S+"UrnPathSegment"]=T("urnpath",E[S]);var R=function(d,m,y){return function(b){var M;y?M=function(k){return o[m](o[y](k))}:M=o[m];for(var I=(b+"").split(d),A=0,L=I.length;A<L;A++)I[A]=M(I[A]);return I.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,m){var y;return m||(m={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(m.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(m.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(m.protocol=null,d=d.substring(2),d=o.parseAuthority(d,m)):(y=d.indexOf(":"),y>-1&&(m.protocol=d.substring(0,y)||null,m.protocol&&!m.protocol.match(o.protocol_expression)?m.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,m)):(d=d.substring(y+1),m.urn=!0))),m.path=d,m},o.parseHost=function(d,m){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),m.hostname=d.substring(1,b)||null,m.port=d.substring(b+2,y)||null,m.port==="/"&&(m.port=null);else{var I=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",I+1);L!==-1&&(A===-1||L<A)?(m.hostname=d.substring(0,y)||null,m.port=null):(M=d.substring(0,y).split(":"),m.hostname=M[0]||null,m.port=M[1]||null)}return m.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),m.preventInvalidHostname&&o.ensureValidHostname(m.hostname,m.protocol),m.port&&o.ensureValidPort(m.port),d.substring(y)||"/"},o.parseAuthority=function(d,m){return d=o.parseUserinfo(d,m),o.parseHost(d,m)},o.parseUserinfo=function(d,m){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),I=d.lastIndexOf("@",M>-1?M:d.length-1),A;return I>-1&&(M===-1||I<M)?(A=d.substring(0,I).split(":"),m.username=A[0]?o.decode(A[0]):null,A.shift(),m.password=A[0]?o.decode(A.join(":")):null,d=y.substring(I+1)):(m.username=null,m.password=null),d},o.parseQuery=function(d,m){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,I,A,L,k=0;k<M;k++)I=b[k].split("="),A=o.decodeQuery(I.shift(),m),L=I.length?o.decodeQuery(I.join("="),m):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var m="",y=!1;return d.protocol&&(m+=d.protocol+":"),!d.urn&&(m||d.hostname)&&(m+="//",y=!0),m+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(m+="/"),m+=d.path),typeof d.query=="string"&&d.query&&(m+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(m+="#"+d.fragment),m},o.buildHost=function(d){var m="";if(d.hostname)o.ip6_expression.test(d.hostname)?m+="["+d.hostname+"]":m+=d.hostname;else return"";return d.port&&(m+=":"+d.port),m},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var m="";return d.username&&(m+=o.encode(d.username)),d.password&&(m+=":"+o.encode(d.password)),m&&(m+="@"),m},o.buildQuery=function(d,m,y){var b="",M,I,A,L;for(I in d)if(I!=="__proto__"&&h.call(d,I))if(g(d[I]))for(M={},A=0,L=d[I].length;A<L;A++)d[I][A]!==void 0&&M[d[I][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(I,d[I][A],y),m!==!0&&(M[d[I][A]+""]=!0));else d[I]!==void 0&&(b+="&"+o.buildQueryParameter(I,d[I],y));return b.substring(1)},o.buildQueryParameter=function(d,m,y){return o.encodeQuery(d,y)+(m!==null?"="+o.encodeQuery(m,y):"")},o.addQuery=function(d,m,y){if(typeof m=="object")for(var b in m)h.call(m,b)&&o.addQuery(d,b,m[b]);else if(typeof m=="string"){if(d[m]===void 0){d[m]=y;return}else typeof d[m]=="string"&&(d[m]=[d[m]]);g(y)||(y=[y]),d[m]=(d[m]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,m,y){if(typeof m=="object")for(var b in m)h.call(m,b)&&o.setQuery(d,b,m[b]);else if(typeof m=="string")d[m]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,m,y){var b,M,I;if(g(m))for(b=0,M=m.length;b<M;b++)d[m[b]]=void 0;else if(u(m)==="RegExp")for(I in d)m.test(I)&&(d[I]=void 0);else if(typeof m=="object")for(I in m)h.call(m,I)&&o.removeQuery(d,I,m[I]);else if(typeof m=="string")y!==void 0?u(y)==="RegExp"?!g(d[m])&&y.test(d[m])?d[m]=void 0:d[m]=f(d[m],y):d[m]===String(y)&&(!g(y)||y.length===1)?d[m]=void 0:g(d[m])&&(d[m]=f(d[m],y)):d[m]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,m,y,b){switch(u(m)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&m.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var I in m)if(h.call(m,I)&&!o.hasQuery(d,I,m[I]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(y)){case"Undefined":return m in d;case"Boolean":var A=!!(g(d[m])?d[m].length:d[m]);return y===A;case"Function":return!!y(d[m],m,d);case"Array":if(!g(d[m]))return!1;var L=b?p:_;return L(d[m],y);case"RegExp":return g(d[m])?b?p(d[m],y):!1:!!(d[m]&&d[m].match(y));case"Number":y=String(y);case"String":return g(d[m])?b?p(d[m],y):!1:d[m]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],m=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var I=M.segment(),A=0;A<I.length;A++)typeof I[A]=="string"&&m.push(I[A]),I[A]&&y++}if(!m.length||!y)return new o("");var L=new o("").segment(m);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,m){var y=Math.min(d.length,m.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==m.charAt(b)){b--;break}return b<1?d.charAt(0)===m.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||m.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,m,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,I=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var k=b.exec(d);if(!k)break;var W=k.index;if(y.ignoreHtml){var K=d.slice(Math.max(W-3,0),W);if(K&&L.test(K))continue}for(var G=W+d.slice(W).search(M),H=d.slice(W,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(I,""):H=H.replace(I,""),!(H.length<=k[0].length)&&!(y.ignore&&y.ignore.test(H))){G=W+H.length;var dt=m(H,W,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,W)+dt+d.slice(G),b.lastIndex=W+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,m){var y=!!d,b=!!m,M=!1;if(b&&(M=p(o.hostProtocols,m)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+m);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var m=Number(d);if(!(a(m)&&m>0&&m<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var m={URI:this.noConflict()};return s.URITemplate&&typeof s.URITemplate.noConflict=="function"&&(m.URITemplate=s.URITemplate.noConflict()),s.IPv6&&typeof s.IPv6.noConflict=="function"&&(m.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&typeof s.SecondLevelDomains.noConflict=="function"&&(m.SecondLevelDomains=s.SecondLevelDomains.noConflict()),m}else s.URI===this&&(s.URI=r);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(m,y){return m===void 0?this._parts[d]||"":(this._parts[d]=m||null,this.build(!y),this)}}function P(d,m){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===m&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=P("query","?"),l.fragment=P("fragment","#"),l.search=function(d,m){var y=this.query(d,m);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,m){var y=this.fragment(d,m);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,m){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!m),this},l.path=l.pathname,l.href=function(d,m){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var I=o.getDomAttribute(d);d=d[I]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!m),this},l.is=function(d){var m=!1,y=!1,b=!1,M=!1,I=!1,A=!1,L=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),m=y||b,M=!m,I=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return M;case"sld":return I;case"ip":return m;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var N=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,m){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return N.call(this,d,m)},l.scheme=l.protocol,l.port=function(d,m){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,m))},l.hostname=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,m)},l.origin=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!m),this}},l.host=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.authority=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.userinfo=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!m),this},l.resource=function(d,m){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!m),this)},l.subdomain=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),I=new RegExp("^"+c(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(I,d),this.build(!m),this}},l.domain=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(m=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(m).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!m),this}},l.tld=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(m=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return m!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!m),this}},l.directory=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,I=this._parts.path.substring(0,M),A=new RegExp("^"+c(I));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!m),this}},l.filename=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var I=new RegExp(c(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(I,d),M?this.normalizePath(m):this.build(!m),this}},l.suffix=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,I;return b===-1?"":(M=y.substring(b+1),I=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(I):I)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(c(A)+"$"):L=new RegExp(c("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!m),this}},l.segment=function(d,m,y){var b=this._parts.urn?":":"/",M=this.path(),I=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=m,m=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(I&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),m===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(g(m)){A=[];for(var L=0,k=m.length;L<k;L++)!m[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(m[L])))}else(m||typeof m=="string")&&(m=x(m),A[A.length-1]===""?A[A.length-1]=m:A.push(m));else m?A[d]=x(m):A.splice(d,1);return I&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,m,y){var b,M,I;if(typeof d!="number"&&(y=m,m=d,d=void 0),m===void 0){if(b=this.segment(d,m,y),!g(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,I=b.length;M<I;M++)b[M]=o.decode(b[M]);return b}if(!g(m))m=typeof m=="string"||m instanceof String?o.encode(m):m;else for(M=0,I=m.length;M<I;M++)m[M]=o.encode(m[M]);return this.segment(d,m,y)};var B=l.query;return l.query=function(d,m){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this):B.call(this,d,m)},l.setQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=m!==void 0?m:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.addQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,m===void 0?null:m),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.removeQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,m),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.hasQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,m,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var m=this._parts.path;if(!m)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;m=o.recodePath(m);var y,b="",M,I;for(m.charAt(0)!=="/"&&(y=!0,m="/"+m),(m.slice(-3)==="/.."||m.slice(-2)==="/.")&&(m+="/"),m=m.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=m.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=m.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){m=m.substring(3);continue}I=m.substring(0,M).lastIndexOf("/"),I===-1&&(I=M),m=m.substring(0,I)+m.substring(M+3)}return y&&this.is("relative")&&(m=b+m.substring(1)),this._parts.path=m,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,m=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=m}return this},l.unicode=function(){var d=o.encode,m=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=m}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var m="";if(d._parts.protocol&&(m+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(m+=t.toUnicode(d._parts.hostname),d._parts.port&&(m+=":"+d._parts.port)):m+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(m+="/"),m+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),I=M.length;b<I;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}m+="?"+y.substring(1)}return m+=o.decodeQuery(d.hash(),!0),m},l.absoluteTo=function(d){var m=this.clone(),y=["protocol","username","password","hostname","port"],b,M,I;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),m._parts.protocol||(m._parts.protocol=d._parts.protocol,this._parts.hostname))return m;for(M=0;I=y[M];M++)m._parts[I]=d._parts[I];return m._parts.path?(m._parts.path.substring(-2)===".."&&(m._parts.path+="/"),m.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),m._parts.path=(b?b+"/":"")+m._parts.path,m.normalizePath())):(m._parts.path=d._parts.path,m._parts.query||(m._parts.query=d._parts.query)),m.build(),m},l.relativeTo=function(d){var m=this.clone().normalize(),y,b,M,I,A;if(m._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=m._parts,b=d._parts,I=m.path(),A=d.path(),I.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return m.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return m.build();if(I===A)return y.path="",m.build();if(M=o.commonPath(I,A),!M)return m.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",m.build()},l.equals=function(d){var m=this.clone(),y=new o(d),b={},M={},I={},A,L,k;if(m.normalize(),y.normalize(),m.toString()===y.toString())return!0;if(A=m.query(),L=y.query(),m.query(""),y.query(""),m.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(k in b)if(h.call(b,k)){if(g(b[k])){if(!_(b[k],M[k]))return!1}else if(b[k]!==M[k])return!1;I[k]=!0}for(k in M)if(h.call(M,k)&&!I[k])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(Um);var wx=Um.exports;const $c=mx(wx),hf=["http","https"];function bx(i){return typeof i=="string"&&i.startsWith("/vsi")&&!i.startsWith("/vsicurl/")}function Ml(i,t,e=!0){return Ex(i,t,!1,e)}function Ex(i,t=null,e=!1,n=!0){typeof i=="string"&&i.startsWith("/vsicurl/")&&(i=i.replace(/^\/vsicurl\//,""));let s=$c(i);if(t&&s.is("relative")&&!bx(i)){let r=$c(t),o=r.path();!o.endsWith("/")&&!o.endsWith(".json")&&r.path(o+"/"),s=s.absoluteTo(r)}return s.normalize(),e&&(s.query(""),s.fragment("")),n?s.toString():s}var Sx={exports:{}};(function(i,t){(function(e,n){i.exports=n()})(Os,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(u,g){return u.indexOf(g)===-1?u.length:u.indexOf(g)}function s(u){var g=u.replace(/^v/,"").replace(/\+.*$/,""),f=n(g,"-"),p=g.substring(0,f).split(".");return p.push(g.substring(f+1)),p}function r(u){return isNaN(Number(u))?u:Number(u)}function o(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!e.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function a(u,g){[u,g].forEach(o);for(var f=s(u),p=s(g),_=0;_<Math.max(f.length-1,p.length-1);_++){var x=parseInt(f[_]||0,10),v=parseInt(p[_]||0,10);if(x>v)return 1;if(v>x)return-1}var w=f[f.length-1],E=p[p.length-1];if(w&&E){var S=w.split(".").map(r),T=E.split(".").map(r);for(_=0;_<Math.max(S.length,T.length);_++){if(S[_]===void 0||typeof T[_]=="string"&&typeof S[_]=="number")return-1;if(T[_]===void 0||typeof S[_]=="string"&&typeof T[_]=="number"||S[_]>T[_])return 1;if(T[_]>S[_])return-1}}else if(w||E)return w?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(u){return typeof u=="string"&&e.test(u)},a.compare=function(u,g,f){c(f);var p=a(u,g);return h[f].indexOf(p)>-1},a})})(Sx);const Te={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Ir={itemAndCollection:{"cube:":Te.datacube,"eo:":Te.eo,"file:":Te.file,"label:":Te.label,"pc:":Te.pointcloud,"processing:":Te.processing,"proj:":Te.projection,"raster:":Te.raster,"sar:":Te.sar,"sat:":Te.sat,"sci:":Te.scientific,"view:":Te.view,version:Te.version,deprecated:Te.version,published:Te.timestamps,expires:Te.timestamps,unpublished:Te.timestamps},catalog:{},collection:{item_assets:Te["item-assets"]},item:{}};Ir.collection=Object.assign(Ir.collection,Ir.itemAndCollection);Ir.item=Object.assign(Ir.item,Ir.itemAndCollection);function ya(i){let t=i.length>=6,e=i[0],n=i[t?3:2],s=i[1],r=i[t?4:3],o={west:e,east:n,south:s,north:r};return t&&(o.base=i[2],o.height=i[5]),o}function hc(i){let{west:t,east:e,south:n,north:s}=ya(i);return[[[t,s],[t,n],[e,n],[e,s],[t,s]]]}function Tx(i){if(!In(i))return null;let t=ya(i),e=[];if(Bm(i)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function Mx(i){if(In(i)?i=[i]:Array.isArray(i)&&(i=i.filter(n=>In(n))),!Array.isArray(i)||i.length===0)return null;let t=i.reduce((n,s)=>{if(Bm(s)){let{west:r,east:o,south:a,north:l}=ya(s);n.push(hc([-180,a,o,l])),n.push(hc([r,a,180,l]))}else n.push(hc(s));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function In(i){if(!Array.isArray(i)||![4,6].includes(i.length)||i.some(r=>typeof r!="number"))return!1;let{west:t,east:e,south:n,north:s}=ya(i);return n<=s&&t>=-180&&t<=180&&n>=-90&&e<=180&&e>=-180&&s<=90}function Bm(i){if(!In(i))return!1;let{west:t,east:e}=ya(i);return t>e}function ri(i){return typeof i=="string"&&i.length>0}function ti(i){return typeof i=="object"&&i===Object(i)&&!Array.isArray(i)}function Wm(...i){if(i=i.filter(t=>Array.isArray(t)),i.length>1){let t=Math.max(...i.map(n=>n.length)),e=[];for(let n=0;n<t;n++)e.push(Object.assign({},...i.map(s=>s[n])));return e}else if(i.length===1)return i[0];return[]}function Rx(i){switch(i){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return i.startsWith("u")?0:null}function Cx(i){switch(i){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class uh{constructor(t,e={},n=[]){if(!ti(t))throw new Error("Given data is not an object");if(t instanceof uh){for(let s of n)this[s]=t[s];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let s in t)typeof this[s]>"u"&&(s in e?this[s]=e[s](t[s],this):this[s]=t[s])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return Tx(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let s=Array.isArray(n)?[]:{};for(let r in n)s[r]=n[r].toJSON();n=s}t[e]=n}),t}}const Ix="application/geo+json",Px=["application/json",Ix,"text/json"],cf=["image/gif","image/jpeg","image/apng","image/png","image/webp"],qm=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],Xm=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(qm);function Du(i,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof i>"u"?!0:typeof i!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(i.toLowerCase()))}function Ax(i,t=!1){return Du(i,Px,t)}class Zm extends uh{constructor(t,e=null,n={},s=[]){super(t,n,["_context"].concat(s)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?Ml(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string"||!t&&typeof this.type>"u")return!1;let e=new $c(this.href),n=e.protocol().toLowerCase(),s=e.suffix().toLowerCase();return ri(n)&&!hf.includes(n)?!1:ri(this.type)&&cf.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ri(s)&&(s==="jpg"||cf.includes("image/"+s)))}isType(t){return ri(this.type)&&Du(this.type,t)}isGeoTIFF(){return this.isType(Xm)}isCOG(){return this.isType(qm)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ri(t)&&hf.includes(t)}}class Gu extends Zm{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>ti(n)?new Gu(n,e):n):[]}}class Lx extends uh{constructor(t,e=null,n={},s=[]){if(super(t,Object.assign({links:Gu.fromLinks},n),["_url"].concat(s)),!this._url&&(this._url=e,!this._url)){let r=this.getSelfLink();r&&(this._url=r.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>Ax(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>ti(t)&&ri(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Vo extends Zm{constructor(t,e=null,n=null){super(t,n,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return Wm(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let n in e){let s=parseInt(n,10),r=e[s];ti(r)&&ri(r.common_name)&&r.common_name in t&&(t[r.common_name]={index:s,band:r})}return Object.values(t).every(n=>n!==null)?t:null}findBand(t,e="name",n=null){Array.isArray(t)||(t=[t]),ti(n)||(n=this.getBands());let s=n.findIndex(r=>ti(r)&&t.includes(r[e]));return s>=0?{index:s,band:n[s]}:null}getBand(t){return ti(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(t&&(ti(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),n(e))||ti(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),n(e))))return e;let s=this.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),n(e)))return e;let r=this.getMetadata("file:values");if(Array.isArray(r)&&(r.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),n(e)))return e;let o=ti(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=Rx(o),e.maximum=Cx(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")e=n;else{let s=this.getMetadata("classification:classes");Array.isArray(s)&&(e=s.filter(r=>!!r.nodata).map(r=>r.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!ri(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(ti(t))for(let s in t)n[s]=new Vo(t[s],s,e);return n}}class dh extends Lx{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),t&&(n=n.filter(s=>s.canBrowserDisplayImage())),e&&n.length>1){let s=r=>Array.isArray(r.roles)&&r.roles.includes(e)||r.getKey()===e;n=n.filter(s).concat(n.filter(r=>!s(r)))}return n}getDefaultGeoTIFF(t=!0,e=!1){var n;return(n=this.rankGeoTIFFs(t,e)[0])==null?void 0:n.asset}rankGeoTIFFs(t=!0,e=!1,n=null,s=null){ti(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let r=[],o=this.getAssetsByTypes(Xm);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(n);for(let l of o){let h=0;if(a.length>0){let c=a.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof s=="function"&&(h+=s(l)),r.push({asset:l,score:h})}return r.sort((l,h)=>h.score-l.score),r}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let s of n){let r=s.getBands();if(r.length!==1)continue;let o=s.findBand(e,"common_name",r);o&&(t[o.band.common_name]=s)}return Object.values(t).every(s=>s!==null)?t:null}getAsset(t){return ti(this.assets)&&this.assets[t]||null}getAssets(){return ti(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>Du(e.type,t))}equals(t){return this===t?!0:!(t instanceof dh)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}}class Ox extends dh{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}function So(i){if(ri(i)&&i.length>=10)try{let t=i.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(e=>parseInt(e,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function Fx(i,t){return new Date(i.valueOf()+(t-i)/2)}class uf extends Ox{constructor(t,e=null){const n={assets:Vo.fromAssets,item_assets:Vo.fromAssets};super(t,e,n)}toGeoJSON(){let t=Mx(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&In(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&In(t[0])?t:t.length>1?t.filter((e,n)=>n>0&&In(e)):[]}getRawBoundingBoxes(){var e,n;let t=(n=(e=this.extent)==null?void 0:e.spatial)==null?void 0:n.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var e,n;let t=(n=(e=this.extent)==null?void 0:e.temporal)==null?void 0:n.interval;return Array.isArray(t)&&t.length>0?t.filter(s=>Array.isArray(s)&&(ri(s[0])||ri(s[1]))).map(s=>s.map(r=>So(r))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),n=[t,e].filter(s=>Array.isArray(s));return n.length>=2?Wm(...n):n.length===1?n[0]:[]}}class Nx extends dh{constructor(t,e=null){super(t,e,{assets:Vo.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return In(this.bbox)?this.bbox:null}getBoundingBoxes(){return In(this.bbox)?[this.bbox]:[]}getDateTime(){let t=So(this.properties.datetime);if(!t){let e=So(this.properties.start_datetime),n=So(this.properties.end_datetime);return e&&n?Fx(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return ri(this.properties.start_datetime)||ri(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ri(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>So(n)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}function kx(i){const t=[];return i.forEach(e=>{if(e.rel==="item"&&"latlng"in e){const[n,s]=e.latlng.split(",").map(r=>Number(r));t.push({type:"Feature",geometry:{type:"Point",coordinates:[s,n]}})}}),{type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:t}}var Ls,is;class Dx{constructor(t){lc(this,Ls,void 0);lc(this,is,void 0);ac(this,"selectedItem",null);ac(this,"createLayersJson",async(t=null)=>{let e,n,s=[{type:"Tile",properties:{id:"OSM"},source:{type:"OSM"}}];if(bs(this,is)||(n=await(await fetch(bs(this,Ls))).json(),Ha(this,is,new uf(n))),n&&n.endpointtype==="GeoDB"){const r=kx(n.links);return s.unshift({type:"Vector",properties:{id:n.id},source:{type:"Vector",url:"data:,"+encodeURIComponent(JSON.stringify(r)),format:"GeoJSON"},style:{"circle-radius":5,"circle-fill-color":"#00417077","circle-stroke-color":"#004170","fill-color":"#00417077","stroke-color":"#004170"}}),s}else if(t instanceof Date?(e=this.getItems().sort((r,o)=>{const a=Math.abs(new Date(r.datetime)-t),l=Math.abs(new Date(o.datetime)-t);return a-l})[0],this.selectedItem=e):e=t,n=await(await fetch(e?Ml(e.href,bs(this,Ls)):bs(this,Ls))).json(),e){const r=new Nx(n);return this.selectedItem=r,s.unshift(this.buildJson(r)),s}else{Ha(this,is,new uf(n));const r=this.getItems();return this.selectedItem=r[r.length-1],s=await this.createLayersJson(this.selectedItem),s}});Ha(this,Ls,t)}buildJson(t){let e;return t.links.find(n=>n.rel==="wms"||n.rel==="wmts"||n.rel==="xyz")?e={type:"STAC",displayWebMapLink:!0,displayFootprint:!1,data:t,properties:{id:t.id}}:e={type:"Vector",source:{type:"Vector",url:"data:,"+encodeURIComponent(JSON.stringify(t.geometry)),format:"GeoJSON"},properties:{id:t.id}},e}getItems(){var t;return((t=bs(this,is))==null?void 0:t.links).filter(e=>e.rel==="item").sort((e,n)=>e.datetime<n.datetime?-1:1)}getDates(){var t;return((t=bs(this,is))==null?void 0:t.links).filter(e=>e.rel==="item").sort((e,n)=>e.datetime<n.datetime?-1:1).map(e=>new Date(e.datetime))}}Ls=new WeakMap,is=new WeakMap;var Gx=Object.defineProperty,jx=(i,t,e)=>t in i?Gx(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,ju=(i,t,e)=>(jx(i,typeof t!="symbol"?t+"":t,e),e);class gn{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const zu={PROPERTYCHANGE:"propertychange"};class Uu{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function zx(i,t,e){let n,s;e=e||on;let r=0,o=i.length,a=!1;for(;r<o;)n=r+(o-r>>1),s=+e(i[n],t),s<0?r=n+1:(o=n,a=!s);return a?r:~r}function on(i,t){return i>t?1:i<t?-1:0}function Ux(i,t){return i<t?1:i>t?-1:0}function gh(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let s=1;s<n;++s){const r=i[s];if(r===t)return s;if(r<t)return e(t,i[s-1],r)>0?s-1:s}return n-1}if(e>0){for(let s=1;s<n;++s)if(i[s]<t)return s-1;return n-1}if(e<0){for(let s=1;s<n;++s)if(i[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return n-1}function Bx(i,t,e){for(;t<e;){const n=i[t];i[t]=i[e],i[e]=n,++t,--e}}function Ot(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let s=0;s<n;s++)i[i.length]=e[s]}function $s(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function Wx(i,t,e){const n=t||on;return i.every(function(s,r){if(r===0)return!0;const o=n(i[r-1],s);return!(o>0||e&&o===0)})}function qx(){return!0}function Yo(){}function $m(i){let t=!1,e,n,s;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==s||!$s(r,n))&&(t=!0,s=this,n=r,e=i.apply(this,arguments)),e}}function Vm(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Kr(i){for(const t in i)delete i[t]}function Fn(i){let t;for(t in i)return!1;return!t}class xa extends Uu{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=e?new gn(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,Yo);delete o[n]}return l}disposeInternal(){this.listeners_&&Kr(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Yo,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}const Lt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function le(i,t,e,n,s){if(n&&n!==i&&(e=e.bind(n)),s){const o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}const r={target:i,type:t,listener:e};return i.addEventListener(t,e),r}function Ho(i,t,e,n){return le(i,t,e,n,!0)}function ve(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Kr(i))}class va extends xa{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Lt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=le(this,t[r],e);return s}return le(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=Ho(this,t[r],e)}else n=Ho(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Xx(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}va.prototype.on;va.prototype.once;va.prototype.un;function Xx(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)ve(i[t]);else ve(i)}function ct(){throw new Error("Unimplemented abstract method.")}let Zx=0;function st(i){return i.ol_uid||(i.ol_uid=String(++Zx))}class df extends gn{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Vs extends va{constructor(t){super(),this.on,this.once,this.un,st(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new df(n,t,e)),n=zu.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new df(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const s=this.values_||(this.values_={});if(n)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],Fn(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}function At(i,t){if(!i)throw new Error(t)}class Ee extends Vs{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Ee(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ve(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=le(t,Lt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?$x(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function $x(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(At(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}const Bu=new Array(6);function pe(){return[1,0,0,1,0,0]}function Vc(i){return fh(i,1,0,0,1,0,0)}function Qr(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],o=i[4],a=i[5],l=t[0],h=t[1],c=t[2],u=t[3],g=t[4],f=t[5];return i[0]=e*l+s*h,i[1]=n*l+r*h,i[2]=e*c+s*u,i[3]=n*c+r*u,i[4]=e*g+s*f+o,i[5]=n*g+r*f+a,i}function fh(i,t,e,n,s,r,o){return i[0]=t,i[1]=e,i[2]=n,i[3]=s,i[4]=r,i[5]=o,i}function Vx(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function ae(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function Yx(i,t){const e=Math.cos(t),n=Math.sin(t);return Qr(i,fh(Bu,e,n,-n,e,0,0))}function Fo(i,t,e){return Qr(i,fh(Bu,t,0,0,e,0,0))}function Wu(i,t,e){return Qr(i,fh(Bu,1,0,0,1,t,e))}function hi(i,t,e,n,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return i[0]=n*h,i[1]=s*l,i[2]=-n*l,i[3]=s*h,i[4]=o*n*h-a*n*l+t,i[5]=o*s*l+a*s*h+e,i}function ph(i,t){const e=Hx(t);At(e!==0,"Transformation matrix cannot be inverted");const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-s/e,i[2]=-r/e,i[3]=n/e,i[4]=(r*l-o*a)/e,i[5]=-(n*l-s*a)/e,i}function Hx(i){return i[0]*i[3]-i[1]*i[2]}const gf=[1e6,1e6,1e6,1e6,2,2];function qu(i){return"matrix("+i.map((t,e)=>Math.round(t*gf[e])/gf[e]).join(", ")+")"}const Me={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Dr(i){const t=ze();for(let e=0,n=i.length;e<n;++e)No(t,i[e]);return t}function Kx(i,t,e){const n=Math.min.apply(null,i),s=Math.min.apply(null,t),r=Math.max.apply(null,i),o=Math.max.apply(null,t);return Bi(n,s,r,o,e)}function Ii(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function Qx(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function Ys(i,t,e){let n,s;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,n*n+s*s}function xi(i,t){return Xu(i,t[0],t[1])}function Ze(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Xu(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Yc(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],o=t[0],a=t[1];let l=Me.UNKNOWN;return o<e?l=l|Me.LEFT:o>s&&(l=l|Me.RIGHT),a<n?l=l|Me.BELOW:a>r&&(l=l|Me.ABOVE),l===Me.UNKNOWN&&(l=Me.INTERSECTING),l}function ze(){return[1/0,1/0,-1/0,-1/0]}function Bi(i,t,e,n,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=n,s):[i,t,e,n]}function wa(i){return Bi(1/0,1/0,-1/0,-1/0,i)}function Zu(i,t){const e=i[0],n=i[1];return Bi(e,n,e,n,t)}function $u(i,t,e,n,s){const r=wa(s);return Hm(r,i,t,e,n)}function Nn(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function Jx(i,t,e){return Math.abs(i[0]-t[0])<e&&Math.abs(i[2]-t[2])<e&&Math.abs(i[1]-t[1])<e&&Math.abs(i[3]-t[3])<e}function Ym(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function No(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function Hm(i,t,e,n,s){for(;e<n;e+=s)tv(i,t[e],t[e+1]);return i}function tv(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Km(i,t){let e;return e=t(ba(i)),e||(e=t(mh(i)),e)||(e=t(Ea(i)),e)||(e=t(zn(i)),e)?e:!1}function Ko(i){let t=0;return Un(i)||(t=yt(i)*Vt(i)),t}function ba(i){return[i[0],i[1]]}function mh(i){return[i[2],i[1]]}function Ce(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function ev(i,t){let e;if(t==="bottom-left")e=ba(i);else if(t==="bottom-right")e=mh(i);else if(t==="top-left")e=zn(i);else if(t==="top-right")e=Ea(i);else throw new Error("Invalid corner");return e}function Vu(i,t,e,n,s){const[r,o,a,l,h,c,u,g]=Hc(i,t,e,n);return Bi(Math.min(r,a,h,u),Math.min(o,l,c,g),Math.max(r,a,h,u),Math.max(o,l,c,g),s)}function Hc(i,t,e,n){const s=t*n[0]/2,r=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=s*o,h=s*a,c=r*o,u=r*a,g=i[0],f=i[1];return[g-l+u,f-h-c,g-l-u,f-h+c,g+l-u,f+h+c,g+l+u,f+h-c,g-l+u,f-h-c]}function Vt(i){return i[3]-i[1]}function we(i,t,e){const n=e||ze();return Qt(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):wa(n),n}function zn(i){return[i[0],i[3]]}function Ea(i){return[i[2],i[3]]}function yt(i){return i[2]-i[0]}function Qt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Un(i){return i[2]<i[0]||i[3]<i[1]}function iv(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Qm(i,t){const e=(i[2]-i[0])/2*(t-1),n=(i[3]-i[1])/2*(t-1);i[0]-=e,i[2]+=e,i[1]-=n,i[3]+=n}function nv(i,t,e){let n=!1;const s=Yc(i,t),r=Yc(i,e);if(s===Me.INTERSECTING||r===Me.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],g=e[0],f=e[1],p=(f-u)/(g-c);let _,x;r&Me.ABOVE&&!(s&Me.ABOVE)&&(_=g-(f-h)/p,n=_>=o&&_<=l),!n&&r&Me.RIGHT&&!(s&Me.RIGHT)&&(x=f-(g-l)*p,n=x>=a&&x<=h),!n&&r&Me.BELOW&&!(s&Me.BELOW)&&(_=g-(f-a)/p,n=_>=o&&_<=l),!n&&r&Me.LEFT&&!(s&Me.LEFT)&&(x=f-(g-o)*p,n=x>=a&&x<=h)}return n}function Gr(i,t,e,n){if(Un(i))return wa(e);let s=[];if(n>1){const a=i[2]-i[0],l=i[3]-i[1];for(let h=0;h<n;++h)s.push(i[0]+a*h/n,i[1],i[2],i[1]+l*h/n,i[2]-a*h/n,i[3],i[0],i[3]-l*h/n)}else s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];t(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return Kx(r,o,e)}function Yu(i,t){const e=t.getExtent(),n=Ce(i);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const s=yt(e),r=Math.floor((n[0]-e[0])/s)*s;i[0]-=r,i[2]-=r}return i}function sv(i,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[e[0],i[1],e[2],i[3]]];Yu(i,t);const n=yt(e);if(yt(i)>n)return[[e[0],i[1],e[2],i[3]]];if(i[0]<e[0])return[[i[0]+n,i[1],e[2],i[3]],[e[0],i[1],i[2],i[3]]];if(i[2]>e[2])return[[i[0],i[1],e[2],i[3]],[e[0],i[1],i[2]-n,i[3]]]}return[i]}const rv={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function ff(i){return rv[i]}const Qo={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let jr=class{constructor(i){this.code_=i.code,this.units_=i.units,this.extent_=i.extent!==void 0?i.extent:null,this.worldExtent_=i.worldExtent!==void 0?i.worldExtent:null,this.axisOrientation_=i.axisOrientation!==void 0?i.axisOrientation:"enu",this.global_=i.global!==void 0?i.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=i.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=i.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Qo[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(i){this.global_=i,this.canWrapX_=!!(i&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(i){this.defaultTileGrid_=i}setExtent(i){this.extent_=i,this.canWrapX_=!!(this.global_&&i)}setWorldExtent(i){this.worldExtent_=i}setGetPointResolution(i){this.getPointResolutionFunc_=i}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Sa=6378137,vr=Math.PI*Sa,ov=[-vr,-vr,vr,vr],av=[-180,-85,180,85],Ka=Sa*Math.log(Math.tan(Math.PI/2));class ir extends jr{constructor(t){super({code:t,units:"m",extent:ov,global:!0,worldExtent:av,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Sa)}})}}const pf=[new ir("EPSG:3857"),new ir("EPSG:102100"),new ir("EPSG:102113"),new ir("EPSG:900913"),new ir("http://www.opengis.net/def/crs/EPSG/0/3857"),new ir("http://www.opengis.net/gml/srs/epsg.xml#3857")];function lv(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let s=0;s<n;s+=e){t[s]=vr*i[s]/180;let r=Sa*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));r>Ka?r=Ka:r<-Ka&&(r=-Ka),t[s+1]=r}return t}function hv(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let s=0;s<n;s+=e)t[s]=180*i[s]/vr,t[s+1]=360*Math.atan(Math.exp(i[s+1]/Sa))/Math.PI-90;return t}const cv=6378137,mf=[-180,-90,180,90],uv=Math.PI*cv/180;class Ss extends jr{constructor(t,e){super({code:t,units:"degrees",extent:mf,axisOrientation:e,global:!0,metersPerUnit:uv,worldExtent:mf})}}const _f=[new Ss("CRS:84"),new Ss("EPSG:4326","neu"),new Ss("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ss("urn:ogc:def:crs:OGC:2:84"),new Ss("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ss("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ss("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Kc={};function dv(i){return Kc[i]||Kc[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function gv(i,t){Kc[i]=t}let Pr={};function zr(i,t,e){const n=i.getCode(),s=t.getCode();n in Pr||(Pr[n]={}),Pr[n][s]=e}function Jm(i,t){let e;return i in Pr&&t in Pr[i]&&(e=Pr[i][t]),e}function wt(i,t,e){return Math.min(Math.max(i,t),e)}function t0(i,t,e,n,s,r){const o=s-e,a=r-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=s,n=r):l>0&&(e+=o*l,n+=a*l)}return Fs(i,t,e,n)}function Fs(i,t,e,n){const s=e-i,r=n-t;return s*s+r*r}function fv(i){const t=i.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(i[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(i[a][n]);l>r&&(r=l,s=a)}if(r===0)return null;const o=i[s];i[s]=i[n],i[n]=o;for(let a=n+1;a<t;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<t+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let s=n-1;s>=0;s--)i[s][t]-=i[s][n]*e[n]}return e}function ko(i){return i*Math.PI/180}function an(i,t){const e=i%t;return e*t<0?e+t:e}function mi(i,t,e){return i+e*(t-i)}function Ta(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Rl(i,t){return Math.round(Ta(i,t))}function wr(i,t){return Math.floor(Ta(i,t))}function ns(i,t){return Math.ceil(Ta(i,t))}function Rs(i,t,e){const n=e!==void 0?i.toFixed(e):""+i;let s=n.indexOf(".");return s=s===-1?n.length:s,s>t?n:new Array(1+t-s).join("0")+n}function Hu(i,t){const e=(""+i).split("."),n=(""+t).split(".");for(let s=0;s<Math.max(e.length,n.length);s++){const r=parseInt(e[s]||"0",10),o=parseInt(n[s]||"0",10);if(r>o)return 1;if(o>r)return-1}return 0}function e0(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function yf(i,t,e){const n=an(t+180,360)-180,s=Math.abs(3600*n),r=e||0;let o=Math.floor(s/3600),a=Math.floor((s-o*3600)/60),l=Ta(s-o*3600-a*60,r);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let h=o+"°";return(a!==0||l!==0)&&(h+=" "+Rs(a,2)+"′"),l!==0&&(h+=" "+Rs(l,2,r)+"″"),n!==0&&(h+=" "+i.charAt(n<0?1:0)),h}function Cl(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function pv(i,t){const e=Math.cos(t),n=Math.sin(t),s=i[0]*e-i[1]*n,r=i[1]*e+i[0]*n;return i[0]=s,i[1]=r,i}function mv(i,t){return i[0]*=t,i[1]*=t,i}function i0(i,t){if(t.canWrapX()){const e=yt(t.getExtent()),n=n0(i,t,e);n&&(i[0]-=n*e)}return i}function n0(i,t,e){const n=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||yt(n),s=Math.floor((i[0]-n[0])/e)),s}const _v=63710088e-1;function xf(i,t,e){e=e||_v;const n=ko(i[1]),s=ko(t[1]),r=(s-n)/2,o=ko(t[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function yv(...i){console.warn(...i)}function Il(...i){console.error(...i)}let Qc=!0;function xv(i){Qc=!(i===void 0||i)}function Ku(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function s0(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function r0(i){gv(i.getCode(),i),zr(i,i,Ku)}function vv(i){i.forEach(r0)}function tt(i){return typeof i=="string"?dv(i):i||null}function vf(i,t,e,n){i=tt(i);let s;const r=i.getPointResolutionFunc();if(r){if(s=r(t,e),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(s=s*o/Qo[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")s=t;else{const a=Hs(i,tt("EPSG:4326"));if(a===s0&&o!=="degrees")s=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=xf(h.slice(0,2),h.slice(2,4)),u=xf(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=n?Qo[n]:i.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Jc(i){vv(i),i.forEach(function(t){i.forEach(function(e){t!==e&&zr(t,e,Ku)})})}function wv(i,t,e,n){i.forEach(function(s){t.forEach(function(r){zr(s,r,e),zr(r,s,n)})})}function Qu(i,t){return i?typeof i=="string"?tt(i):i:tt(t)}function wf(i){return function(t,e,n){const s=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(s);for(let r=0;r<s;r+=n){const o=i(t.slice(r,r+n)),a=o.length;for(let l=0,h=n;l<h;++l)e[r+l]=l>=a?t[r+l]:o[l]}return e}}function bv(i,t,e,n){const s=tt(i),r=tt(t);zr(s,r,wf(e)),zr(r,s,wf(n))}function bf(i,t){const e=_h(i,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=an(n+180,360)-180),e}function Ae(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Hs(i,t)===Ku)&&e}function Hs(i,t){const e=i.getCode(),n=t.getCode();let s=Jm(e,n);return s||(s=s0),s}function hn(i,t){const e=tt(i),n=tt(t);return Hs(e,n)}function _h(i,t,e){return hn(t,e)(i,void 0,i.length)}function Ju(i,t,e,n){const s=hn(t,e);return Gr(i,s,void 0,n)}let Ev=null;function Sv(){return Ev}function tu(i,t){return i}function $n(i,t){return Qc&&!Cl(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Qc=!1,yv("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function yh(i,t){return i}function Gi(i,t){return i}function Ef(i,t,e){return function(n){let s,r;if(i.canWrapX()){const o=i.getExtent(),a=yt(o);n=n.slice(0),r=n0(n,i,a),r&&(n[0]=n[0]-r*a),n[0]=wt(n[0],o[0],o[2]),n[1]=wt(n[1],o[1],o[3]),s=e(n)}else s=e(n);return r&&t.canWrapX()&&(s[0]+=r*yt(t.getExtent())),s}}function Tv(){Jc(pf),Jc(_f),wv(_f,pf,lv,hv)}Tv();function hs(i,t,e,n,s,r){r=r||[];let o=0;for(let a=t;a<e;a+=n){const l=i[a],h=i[a+1];r[o++]=s[0]*l+s[2]*h+s[4],r[o++]=s[1]*l+s[3]*h+s[5]}return r&&r.length!=o&&(r.length=o),r}function o0(i,t,e,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let g=t;g<e;g+=n){const f=i[g]-h,p=i[g+1]-c;o[u++]=h+f*a-p*l,o[u++]=c+f*l+p*a;for(let _=g+2;_<g+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function Mv(i,t,e,n,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const g=i[u]-l,f=i[u+1]-h;a[c++]=l+s*g,a[c++]=h+r*f;for(let p=u+2;p<u+n;++p)a[c++]=i[p]}return a&&a.length!=c&&(a.length=c),a}function Rv(i,t,e,n,s,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+s,o[a++]=i[l+1]+r;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Sf=pe();class td extends Vs{constructor(){super(),this.extent_=ze(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=$m((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ct()}closestPointXY(t,e,n,s){return ct()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&wa(e),this.extentRevision_=this.getRevision()}return iv(this.extent_,t)}rotate(t,e){ct()}scale(t,e,n){ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ct()}getType(){return ct()}applyTransform(t){ct()}intersectsExtent(t){return ct()}translate(t,e){ct()}transform(t,e){const n=tt(t),s=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Vt(h)/Vt(l);return hi(Sf,h[0],h[3],c,-c,0,0,0),hs(r,0,r.length,a,Sf,o),hn(n,e)(r,o,a)}:hn(n,e);return this.applyTransform(s),this}}class Cv extends td{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return $u(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=eu(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ct()}setLayout(t,e,n){let s;if(t)s=eu(t);else{for(let r=0;r<n;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=Ks(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();o0(n,0,n.length,s,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Ce(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();Mv(s,0,s.length,r,t,e,n,s),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Rv(n,0,n.length,s,t,e,n),this.changed()}}}function Ks(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function eu(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Iv(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const s=i.getStride();return hs(n,0,n.length,s,t,e)}const kn=Cv;function Pv(i,t,e,n){for(let s=0,r=e.length;s<r;++s)i[t++]=e[s];return t}function Ma(i,t,e,n){for(let s=0,r=e.length;s<r;++s){const o=e[s];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function Ra(i,t,e,n,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Ma(i,t,e[o],n);s[r++]=l,t=l}return s.length=r,s}function a0(i,t,e,n,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Ra(i,t,e[o],n,s[r]);l.length===0&&(l[0]=t),s[r++]=l,t=l[l.length-1]}return s.length=r,s}class Pl extends td{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ve),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(le(t[e],Lt.CHANGE,this.changed,this))}clone(){const t=new Pl(cc(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<Ys(this.getExtent(),t,e))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(t,e,n,s);return s}containsXY(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(t,e))return!0;return!1}computeExtent(t){wa(t);const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)Ym(t,e[n].getExtent());return t}getGeometries(){return cc(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let s=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(s=!0)}return s?new Pl(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Ce(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(cc(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cc(i){return i.map(t=>t.clone())}const je=Pl;function Tf(i,t,e,n,s,r,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const g=((s-a)*h+(r-l)*c)/(h*h+c*c);if(g>1)u=e;else if(g>0){for(let f=0;f<n;++f)o[f]=mi(i[t+f],i[e+f],g);o.length=n;return}else u=t}for(let g=0;g<n;++g)o[g]=i[u+g];o.length=n}function ed(i,t,e,n,s){let r=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=Fs(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function id(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=ed(i,t,a,n,s),t=a}return s}function Av(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=id(i,t,a,n,s),t=a[a.length-1]}return s}function nd(i,t,e,n,s,r,o,a,l,h,c){if(t==e)return h;let u,g;if(s===0){if(g=Fs(o,a,i[t],i[t+1]),g<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,g}return h}c=c||[NaN,NaN];let f=t+n;for(;f<e;)if(Tf(i,f-n,f,n,o,a,c),g=Fs(o,a,c[0],c[1]),g<h){for(h=g,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(g)-Math.sqrt(h))/s|0,1);if(r&&(Tf(i,e-n,t,n,o,a,c),g=Fs(o,a,c[0],c[1]),g<h)){for(h=g,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function sd(i,t,e,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,g=e.length;u<g;++u){const f=e[u];h=nd(i,t,f,n,s,r,o,a,l,h,c),t=f}return h}function Lv(i,t,e,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,g=e.length;u<g;++u){const f=e[u];h=sd(i,t,f,n,s,r,o,a,l,h,c),t=f[f.length-1]}return h}function xh(i,t,e,n,s,r,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)r[o++]=i[t],r[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),g=h.pop();let f=0;const p=i[g],_=i[g+1],x=i[u],v=i[u+1];for(let w=g+n;w<u;w+=n){const E=i[w],S=i[w+1],T=t0(E,S,p,_,x,v);T>f&&(c=w,f=T)}f>s&&(l[(c-t)/n]=1,g+n<c&&h.push(g,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[t+u*n],r[o++]=i[t+u*n+1]);return o}function l0(i,t,e,n,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=xh(i,t,c,n,s,r,o),a.push(o),t=c}return o}function Ms(i,t){return t*Math.round(i/t)}function Ov(i,t,e,n,s,r,o){if(t==e)return o;let a=Ms(i[t],s),l=Ms(i[t+1],s);t+=n,r[o++]=a,r[o++]=l;let h,c;do if(h=Ms(i[t],s),c=Ms(i[t+1],s),t+=n,t==e)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=Ms(i[t],s),g=Ms(i[t+1],s);if(t+=n,u==h&&g==c)continue;const f=h-a,p=c-l,_=u-a,x=g-l;if(f*x==p*_&&(f<0&&_<f||f==_||f>0&&_>f)&&(p<0&&x<p||p==x||p>0&&x>p)){h=u,c=g;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=g}return r[o++]=h,r[o++]=c,o}function rd(i,t,e,n,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Ov(i,t,c,n,s,r,o),a.push(o),t=c}return o}function Fv(i,t,e,n,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=rd(i,t,c,n,s,r,o,u),a.push(u),t=c[c.length-1]}return o}function Rn(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<e;o+=n)s[r++]=i.slice(o,o+n);return s.length=r,s}function Jo(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=Rn(i,t,l,n,s[r]),t=l}return s.length=r,s}function iu(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=l.length===1&&l[0]===t?[]:Jo(i,t,l,n,s[r]),t=l[l.length-1]}return s.length=r,s}function h0(i,t,e,n){let s=0,r=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];s+=o*a-r*l,r=a,o=l}return s/2}function c0(i,t,e,n){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=h0(i,t,a,n),t=a}return s}function Nv(i,t,e,n){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=c0(i,t,a,n),t=a[a.length-1]}return s}class ds extends kn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new ds(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,s){return s<Ys(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ed(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),nd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,s))}getArea(){return h0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=xh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ds(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ma(this.flatCoordinates,0,t,this.stride),this.changed()}}function u0(i,t,e,n,s){let r;for(t+=n;t<e;t+=n)if(r=s(i.slice(t-n,t),i.slice(t,t+n)),r)return r;return!1}function Al(i,t,e,n,s,r,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=s;else if(h!==0){let c=i[t],u=i[t+1],g=0;const f=[0];for(let x=t+n;x<e;x+=n){const v=i[x],w=i[x+1];g+=Math.sqrt((v-c)*(v-c)+(w-u)*(w-u)),f.push(g),c=v,u=w}const p=s*g,_=zx(f,p);_<0?(l=(p-f[-_-2])/(f[-_-1]-f[-_-2]),a=t+(-_-2)*n):a=t+_*n}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?i[a+c]:mi(i[a+c],i[a+n+c],l);return r}function nu(i,t,e,n,s,r){if(e==t)return null;let o;if(s<i[t+n-1])return r?(o=i.slice(t,t+n),o[n-1]=s,o):null;if(i[e-1]<s)return r?(o=i.slice(e-n,e),o[n-1]=s,o):null;if(s==i[t+n-1])return i.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const g=a+l>>1;s<i[(g+1)*n-1]?l=g:a=g+1}const h=i[a*n-1];if(s==h)return i.slice((a-1)*n,(a-1)*n+n);const c=i[(a+1)*n-1],u=(s-h)/(c-h);o=[];for(let g=0;g<n-1;++g)o.push(mi(i[(a-1)*n+g],i[a*n+g],u));return o.push(s),o}function kv(i,t,e,n,s,r,o){if(o)return nu(i,t,e[e.length-1],n,s,r);let a;if(s<i[n-1])return r?(a=i.slice(0,n),a[n-1]=s,a):null;if(i[i.length-1]<s)return r?(a=i.slice(i.length-n),a[n-1]=s,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(s<i[t+n-1])return null;if(s<=i[c-1])return nu(i,t,c,n,s,!1);t=c}}return null}function Dv(i,t,e,n,s){return!Km(s,function(r){return!Cs(i,t,e,n,r[0],r[1])})}function Cs(i,t,e,n,s,r){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function od(i,t,e,n,s,r){if(e.length===0||!Cs(i,t,e[0],n,s,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Cs(i,e[o-1],e[o],n,s,r))return!1;return!0}function Gv(i,t,e,n,s,r){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(od(i,t,l,n,s,r))return!0;t=l[l.length-1]}return!1}function vh(i,t,e,n,s){const r=Hm(ze(),i,t,e,n);return Qt(s,r)?Ze(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:u0(i,t,e,n,function(o,a){return nv(s,o,a)}):!1}function jv(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){if(vh(i,t,e[r],n,s))return!0;t=e[r]}return!1}function d0(i,t,e,n,s){return!!(vh(i,t,e,n,s)||Cs(i,t,e,n,s[0],s[1])||Cs(i,t,e,n,s[0],s[3])||Cs(i,t,e,n,s[2],s[1])||Cs(i,t,e,n,s[2],s[3]))}function g0(i,t,e,n,s){if(!d0(i,t,e[0],n,s))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(Dv(i,e[r-1],e[r],n,s)&&!vh(i,e[r-1],e[r],n,s))return!1;return!0}function zv(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(g0(i,t,a,n,s))return!0;t=a[a.length-1]}return!1}function f0(i,t,e,n){let s=i[t],r=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class ye extends kn{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Ot(this.flatCoordinates,t),this.changed()}clone(){const t=new ye(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Ys(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ed(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),nd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,s))}forEachSegment(t){return u0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,nu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Al(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return f0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=xh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ye(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return vh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ma(this.flatCoordinates,0,t,this.stride),this.changed()}}class ci extends kn{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const s=t,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];Ot(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(t){Ot(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ci(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Ys(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(id(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,s))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,kv(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Jo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new ye(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,s=[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new ye(t.slice(r,l),n);s.push(h),r=l}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=Al(e,n,l,r,.5);Ot(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=l0(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new ci(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return jv(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ra(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}let Re=class p0 extends kn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new p0(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const r=this.flatCoordinates,o=Fs(t,e,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Zu(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Xu(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Pv(this.flatCoordinates,0,t,this.stride),this.changed()}};class Zi extends kn{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Ot(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Zi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<Ys(this.getExtent(),t,e))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Fs(t,e,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)n[c]=r[a+c];n.length=o}}return s}getCoordinates(){return Rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Re(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,s=[];for(let r=0,o=t.length;r<o;r+=n){const a=new Re(t.slice(r,r+n),e);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let s=0,r=e.length;s<r;s+=n){const o=e[s],a=e[s+1];if(Xu(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ma(this.flatCoordinates,0,t,this.stride),this.changed()}}function ad(i,t,e,n,s,r,o){let a,l,h,c,u,g,f;const p=s[r+1],_=[];for(let w=0,E=e.length;w<E;++w){const S=e[w];for(c=i[S-n],g=i[S-n+1],a=t;a<S;a+=n)u=i[a],f=i[a+1],(p<=g&&f<=p||g<=p&&p<=f)&&(h=(p-g)/(f-g)*(u-c)+c,_.push(h)),c=u,g=f}let x=NaN,v=-1/0;for(_.sort(on),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const w=Math.abs(u-c);w>v&&(h=(c+u)/2,od(i,t,e,n,h,p)&&(x=h,v=w)),c=u}return isNaN(x)&&(x=s[r]),o?(o.push(x,p,v),o):[x,p,v]}function m0(i,t,e,n,s){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=ad(i,t,l,n,s,2*o,r),t=l[l.length-1]}return r}function Uv(i,t,e,n){for(;t<e-n;){for(let s=0;s<n;++s){const r=i[t+s];i[t+s]=i[e-n+s],i[e-n+s]=r}t+=n,e-=n}}function wh(i,t,e,n){let s=0,r=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function ld(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=wh(i,t,a,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=a}return!0}function _0(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(!ld(i,t,a,n,s))return!1;a.length&&(t=a[a.length-1])}return!0}function Ll(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=wh(i,t,a,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&Uv(i,t,a,n),t=a}return t}function su(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r)t=Ll(i,t,e[r],n,s);return t}function y0(i,t){const e=[];let n=0,s=0,r;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=wh(i,n,l,2);if(r===void 0&&(r=h),h===r)e.push(t.slice(s,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=o+1,n=l}return e}class Ue extends kn{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Ot(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ue(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Ys(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(id(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sd(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return od(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return c0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ll(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Jo(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ce(this.getExtent());this.flatInteriorPoint_=ad(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Re(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ds(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ds(e.slice(r,l),t);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;ld(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ll(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=rd(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Ue(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return g0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ra(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Mf(i){if(Un(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],s=i[3],r=[t,e,t,s,n,s,n,e,t,e];return new Ue(r,"XY",[r.length])}function x0(i,t,e,n){const s=[];let r=ze();for(let o=0,a=e.length;o<a;++o){const l=e[o];r=$u(i,t,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}class Pi extends kn{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const s=t,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,u=h.getEnds();for(let g=0,f=u.length;g<f;++g)u[g]+=c;Ot(r,h.getFlatCoordinates()),o.push(u)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,n=o}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Ot(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const n=new Pi(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,s){return s<Ys(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Av(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Lv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return Gv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Nv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),su(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,iu(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=x0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=m0(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Zi(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;_0(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=su(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Fv(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Pi(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(e!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=e;return new Ue(this.flatCoordinates.slice(e,s),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,g=l.length;u<g;++u)l[u]-=r;const c=new Ue(e.slice(r,h),t,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return zv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=a0(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Rf=pe();class Ge{constructor(t,e,n,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Zu(this.flatCoordinates_):$u(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Ce(this.getExtent());this.flatInteriorPoints_=ad(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=y0(this.flatCoordinates_,this.ends_),e=x0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=m0(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Al(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const o=n[s],a=Al(t,e,o,2,.5);Ot(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=tt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const s=Vt(n)/Vt(e);hi(Rf,n[0],n[3],s,-s,0,0,0),hs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Rf,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Ge(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=$m((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=xh(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=l0(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,s);break;case"Polygon":s=[],n.length=rd(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,s);break}return s&&(this.simplifiedGeometry_=new Ge(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Ge.prototype.getFlatCoordinates=Ge.prototype.getOrientedFlatCoordinates;class Bv{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Ee,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?tt(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=tt(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return ct()}readFeature(t,e){return ct()}readFeatures(t,e){return ct()}readGeometry(t,e){return ct()}readProjection(t){return ct()}writeFeature(t,e){return ct()}writeFeatures(t,e){return ct()}writeGeometry(t,e){return ct()}}const Ca=Bv;function re(i,t,e){const n=e?tt(e.featureProjection):null,s=e?tt(e.dataProjection):null;let r=i;if(n&&s&&!Ae(n,s)){t&&(r=i.clone());const o=t?n:s,a=t?s:n;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(hn(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===i&&(r=i.clone()),r.applyTransform(a)}return r}function hd(i,t){const e=t?tt(t.featureProjection):null,n=t?tt(t.dataProjection):null;return e&&n&&!Ae(e,n)?Ju(i,n,e):i}const Wv={Point:Re,LineString:ye,Polygon:Ue,MultiPoint:Zi,MultiLineString:ci,MultiPolygon:Pi};function qv(i,t,e){return Array.isArray(t[0])?(_0(i,0,t,e)||(i=i.slice(),su(i,0,t,e)),i):(ld(i,0,t,e)||(i=i.slice(),Ll(i,0,t,e)),i)}function v0(i,t){var e;const n=i.geometry;if(!n)return[];if(Array.isArray(n))return n.map(o=>v0({...i,geometry:o})).flat();const s=n.type==="MultiPolygon"?"Polygon":n.type;if(s==="GeometryCollection"||s==="Circle")throw new Error("Unsupported geometry type: "+s);const r=n.layout.length;return re(new Ge(s,s==="Polygon"?qv(n.flatCoordinates,n.ends,r):n.flatCoordinates,(e=n.ends)==null?void 0:e.flat(),r,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function cd(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>cd(s,t));return new je(n)}const e=Wv[i.type];return re(new e(i.flatCoordinates,i.layout,i.ends),!1,t)}class ud extends Ca{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Qa(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Qa(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ct()}readFeaturesFromObject(t,e){return ct()}readGeometry(t,e){return this.readGeometryFromObject(Qa(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ct()}readProjection(t){return this.readProjectionFromObject(Qa(t))}readProjectionFromObject(t){return ct()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ct()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ct()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ct()}}function Qa(i){return typeof i=="string"?JSON.parse(i)||null:i!==null?i:null}const Xv={Point:Yv,LineString:Hv,Polygon:tw,MultiPoint:Qv,MultiLineString:Kv,MultiPolygon:Jv},Zv={Point:ew,LineString:iw,Polygon:nw,MultiPoint:rw,MultiLineString:sw,MultiPolygon:ow};class $v extends ud{constructor(t){t=t||{},super(),this.geometryName_=t.geometryName}readFeatureFromObject(t,e,n){const s=t,r=Cf(s.geometry,e),o=new Ee;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(r),s.attributes){o.setProperties(s.attributes,!0);const a=s.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(t,e){if(e=e||{},t.features){const n=t,s=[],r=n.features;for(let o=0,a=r.length;o<a;++o)s.push(this.readFeatureFromObject(r[o],e,t.objectIdFieldName));return s}return[this.readFeatureFromObject(t,e)]}readGeometryFromObject(t,e){return Cf(t,e)}readProjectionFromObject(t){if(t.spatialReference&&t.spatialReference.wkid!==void 0){const e=t.spatialReference.wkid;return tt("EPSG:"+e)}return null}writeGeometryObject(t,e){return If(t,this.adaptOptions(e))}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={};if(!t.hasProperties())return n.attributes={},n;const s=t.getProperties(),r=t.getGeometry();if(r){n.geometry=If(r,e);const o=e&&(e.dataProjection||e.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(tt(o).getCode().split(":").pop())}),delete s[t.getGeometryName()]}return Fn(s)?n.attributes={}:n.attributes=s,n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let s=0,r=t.length;s<r;++s)n.push(this.writeFeatureObject(t[s],e));return{features:n}}}function Cf(i,t){if(!i)return null;let e;if(typeof i.x=="number"&&typeof i.y=="number")e="Point";else if(i.points)e="MultiPoint";else if(i.paths)i.paths.length===1?e="LineString":e="MultiLineString";else if(i.rings){const s=i,r=Jr(s),o=Vv(s.rings,r);o.length===1?(e="Polygon",i=Object.assign({},i,{rings:o[0]})):(e="MultiPolygon",i=Object.assign({},i,{rings:o}))}const n=Xv[e];return re(n(i),!1,t)}function Vv(i,t){const e=[],n=[],s=[];let r,o;for(r=0,o=i.length;r<o;++r)e.length=0,Ma(e,0,i[r],t.length),wh(e,0,e.length,t.length)?n.push([i[r]]):s.push(i[r]);for(;s.length;){const a=s.shift();let l=!1;for(r=n.length-1;r>=0;r--){const h=n[r][0];if(Ze(new ds(h).getExtent(),new ds(a).getExtent())){n[r].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function Yv(i){let t;return i.m!==void 0&&i.z!==void 0?t=new Re([i.x,i.y,i.z,i.m],"XYZM"):i.z!==void 0?t=new Re([i.x,i.y,i.z],"XYZ"):i.m!==void 0?t=new Re([i.x,i.y,i.m],"XYM"):t=new Re([i.x,i.y]),t}function Hv(i){const t=Jr(i);return new ye(i.paths[0],t)}function Kv(i){const t=Jr(i);return new ci(i.paths,t)}function Jr(i){let t="XY";return i.hasZ===!0&&i.hasM===!0?t="XYZM":i.hasZ===!0?t="XYZ":i.hasM===!0&&(t="XYM"),t}function Qv(i){const t=Jr(i);return new Zi(i.points,t)}function Jv(i){const t=Jr(i);return new Pi(i.rings,t)}function tw(i){const t=Jr(i);return new Ue(i.rings,t)}function ew(i,t){const e=i.getCoordinates();let n;const s=i.getLayout();if(s==="XYZ")n={x:e[0],y:e[1],z:e[2]};else if(s==="XYM")n={x:e[0],y:e[1],m:e[2]};else if(s==="XYZM")n={x:e[0],y:e[1],z:e[2],m:e[3]};else if(s==="XY")n={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return n}function Ia(i){const t=i.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function iw(i,t){const e=Ia(i);return{hasZ:e.hasZ,hasM:e.hasM,paths:[i.getCoordinates()]}}function nw(i,t){const e=Ia(i);return{hasZ:e.hasZ,hasM:e.hasM,rings:i.getCoordinates(!1)}}function sw(i,t){const e=Ia(i);return{hasZ:e.hasZ,hasM:e.hasM,paths:i.getCoordinates()}}function rw(i,t){const e=Ia(i);return{hasZ:e.hasZ,hasM:e.hasM,points:i.getCoordinates()}}function ow(i,t){const e=Ia(i),n=i.getCoordinates(!1),s=[];for(let r=0;r<n.length;r++)for(let o=n[r].length-1;o>=0;o--)s.push(n[r][o]);return{hasZ:e.hasZ,hasM:e.hasM,rings:s}}function If(i,t){const e=Zv[i.getType()];return e(re(i,!0,t),t)}const aw=$v;class lw extends ud{constructor(t){t=t||{},super(),this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=tt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const s=dd(n.geometry);if(this.featureClass===Ge)return v0({geometry:s,id:n.id,properties:n.properties},e);const r=new Ee;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&r.setGeometryName(n.geometry_name),r.setGeometry(cd(s,e)),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(t,e){const n=t;let s=null;if(n.type==="FeatureCollection"){const r=t;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&s.push(h)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return hw(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=tt(e.properties.name);else if(e.type==="EPSG")n=tt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(n.id=s),!t.hasProperties())return n;const r=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=ru(o,e),delete r[t.getGeometryName()]),Fn(r)||(n.properties=r),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let s=0,r=t.length;s<r;++s)n.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return ru(t,this.adaptOptions(e))}}function dd(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=uw(i);break}case"LineString":{e=dw(i);break}case"Polygon":{e=mw(i);break}case"MultiPoint":{e=fw(i);break}case"MultiLineString":{e=gw(i);break}case"MultiPolygon":{e=pw(i);break}case"GeometryCollection":{e=cw(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function hw(i,t){const e=dd(i);return cd(e,t)}function cw(i,t){return i.geometries.map(function(e){return dd(e)})}function uw(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:Ks(t.length)}}function dw(i){var t;const e=i.coordinates,n=e.flat();return{type:"LineString",flatCoordinates:n,ends:[n.length],layout:Ks(((t=e[0])==null?void 0:t.length)||2)}}function gw(i){var t,e;const n=i.coordinates,s=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length)||2,r=[],o=Ra(r,0,n,s);return{type:"MultiLineString",flatCoordinates:r,ends:o,layout:Ks(s)}}function fw(i){var t;const e=i.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Ks(((t=e[0])==null?void 0:t.length)||2)}}function pw(i){var t,e;const n=i.coordinates,s=[],r=((e=(t=n[0])==null?void 0:t[0])==null?void 0:e[0].length)||2,o=a0(s,0,n,r);return{type:"MultiPolygon",flatCoordinates:s,ends:o,layout:Ks(r)}}function mw(i){var t,e;const n=i.coordinates,s=[],r=(e=(t=n[0])==null?void 0:t[0])==null?void 0:e.length,o=Ra(s,0,n,r);return{type:"Polygon",flatCoordinates:s,ends:o,layout:Ks(r)}}function ru(i,t){i=re(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=bw(i);break}case"LineString":{n=yw(i);break}case"Polygon":{n=Ew(i,t);break}case"MultiPoint":{n=vw(i);break}case"MultiLineString":{n=xw(i);break}case"MultiPolygon":{n=ww(i,t);break}case"GeometryCollection":{n=_w(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function _w(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(e){return ru(e,t)})}}function yw(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function xw(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function vw(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function ww(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function bw(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function Ew(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}const w0=lw,js="http://www.w3.org/2001/XMLSchema-instance";function mt(i,t){return to().createElementNS(i,t)}function Ye(i,t){return b0(i,t,[]).join("")}function b0(i,t,e){if(i.nodeType==Node.CDATA_SECTION_NODE||i.nodeType==Node.TEXT_NODE)t?e.push(String(i.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(i.nodeValue);else{let n;for(n=i.firstChild;n;n=n.nextSibling)b0(n,t,e)}return e}function Ri(i){return"documentElement"in i}function Sw(i,t,e){return i.getAttributeNS(t,e)||""}function Ci(i){return new DOMParser().parseFromString(i,"application/xml")}function Ol(i,t){return function(e,n){const s=i.call(t!==void 0?t:this,e,n);if(s!==void 0){const r=n[n.length-1];Ot(r,s)}}}function ot(i,t){return function(e,n){const s=i.call(t!==void 0?t:this,e,n);s!==void 0&&n[n.length-1].push(s)}}function ht(i,t){return function(e,n){const s=i.call(t!==void 0?t:this,e,n);s!==void 0&&(n[n.length-1]=s)}}function Kt(i,t,e){return function(n,s){const r=i.call(e!==void 0?e:this,n,s);if(r!==void 0){const o=s[s.length-1],a=t!==void 0?t:n.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(r)}}}function O(i,t,e){return function(n,s){const r=i.call(e!==void 0?e:this,n,s);if(r!==void 0){const o=s[s.length-1],a=t!==void 0?t:n.localName;o[a]=r}}}function F(i,t){return function(e,n,s){i.call(t!==void 0?t:this,e,n,s),s[s.length-1].node.appendChild(e)}}function E0(i,t){let e,n;return function(s,r,o){if(e===void 0){e={};const a={};a[s.localName]=i,e[s.namespaceURI]=a,n=ce(s.localName)}S0(e,n,r,o)}}function ce(i,t){return function(e,n,s){const r=n[n.length-1].node;let o=i;o===void 0&&(o=s);const a=t!==void 0?t:r.namespaceURI;return mt(a,o)}}const Ie=ce();function ui(i,t){const e=t.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=i[t[s]];return n}function X(i,t,e){e=e!==void 0?e:{};let n,s;for(n=0,s=i.length;n<s;++n)e[i[n]]=t;return e}function li(i,t,e,n){let s;for(s=t.firstElementChild;s;s=s.nextElementSibling){const r=i[s.namespaceURI];if(r!==void 0){const o=r[s.localName];o!==void 0&&o.call(n,s,e)}}}function Z(i,t,e,n,s){return n.push(i),li(t,e,n,s),n.pop()}function S0(i,t,e,n,s,r){const o=(s!==void 0?s:e).length;let a,l;for(let h=0;h<o;++h)a=e[h],a!==void 0&&(l=t.call(r!==void 0?r:this,a,n,s!==void 0?s[h]:void 0),l!==void 0&&i[l.namespaceURI][l.localName].call(r,l,a,n))}function pt(i,t,e,n,s,r,o){return s.push(i),S0(t,e,n,s,r,o),s.pop()}let uc;function Tw(){return uc===void 0&&typeof XMLSerializer<"u"&&(uc=new XMLSerializer),uc}let dc;function to(){return dc===void 0&&typeof document<"u"&&(dc=document.implementation.createDocument("","",null)),dc}class Pa extends Ca{constructor(){super(),this.xmlSerializer_=Tw()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const n=Ci(t);return this.readFeatureFromDocument(n,e)}return Ri(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const n=this.readFeaturesFromDocument(t,e);return n.length>0?n[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const n=Ci(t);return this.readFeaturesFromDocument(n,e)}return Ri(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const n=[];for(let s=t.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&Ot(n,this.readFeaturesFromNode(s,e));return n}readFeaturesFromNode(t,e){return ct()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const n=Ci(t);return this.readGeometryFromDocument(n,e)}return Ri(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=Ci(t);return this.readProjectionFromDocument(e)}return Ri(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const n=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const n=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const n=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(t,e){return null}}const Pn="http://www.opengis.net/gml",Mw=/^\s*$/;class rt extends Pa{constructor(t){super(),t=t||{},this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:ot(this.readFeaturesInternal),featureMembers:ht(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(t,e){const n=t.localName;let s=null;if(n=="FeatureCollection")s=Z([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const r=e[0];let o=r.featureType,a=r.featureNS;const l="p",h="p0";if(!o&&t.childNodes){o=[],a={};for(let g=0,f=t.childNodes.length;g<f;++g){const p=t.childNodes[g];if(p.nodeType===1){const _=p.nodeName.split(":").pop();if(!o.includes(_)){let x="",v=0;const w=p.namespaceURI;for(const E in a){if(a[E]===w){x=E;break}++v}x||(x=l+v,a[x]=w),o.push(x+":"+_)}}}n!="featureMember"&&(r.featureType=o,r.featureNS=a)}if(typeof a=="string"){const g=a;a={},a[h]=g}const c={},u=Array.isArray(o)?o:[o];for(const g in a){const f={};for(let p=0,_=u.length;p<_;++p)(u[p].includes(":")?u[p].split(":")[0]:h)===g&&(f[u[p].split(":").pop()]=n=="featureMembers"?ot(this.readFeatureElement,this):ht(this.readFeatureElement,this));c[a[g]]=f}n=="featureMember"||n=="member"?s=Z(void 0,c,t,e):s=Z([],c,t,e)}return s===null&&(s=[]),s}readGeometryOrExtent(t,e){const n=e[0];return n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension"),Z(null,this.GEOMETRY_PARSERS,t,e,this)}readExtentElement(t,e){const n=e[0],s=this.readGeometryOrExtent(t,e);return s?hd(s,n):void 0}readGeometryElement(t,e){const n=e[0],s=this.readGeometryOrExtent(t,e);return s?re(s,!1,n):void 0}readFeatureElementInternal(t,e,n){let s;const r={};for(let l=t.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Ye(l,!1),Mw.test(h)&&(h=void 0)):(n&&(h=c==="boundedBy"?this.readExtentElement(l,e):this.readGeometryElement(l,e)),h?c!=="boundedBy"&&(s=c):h=this.readFeatureElementInternal(l,e,!1));const u=l.attributes.length;if(u>0&&!(h instanceof td)){h={_content_:h};for(let g=0;g<u;g++){const f=l.attributes[g].name;h[f]=l.attributes[g].value}}r[c]?(r[c]instanceof Array||(r[c]=[r[c]]),r[c].push(h)):r[c]=h}if(!n)return r;const o=new Ee(r);s&&o.setGeometryName(s);const a=t.getAttribute("fid")||Sw(t,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(t,e){return this.readFeatureElementInternal(t,e,!0)}readPoint(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new Re(n,"XYZ")}readMultiPoint(t,e){const n=Z([],this.MULTIPOINT_PARSERS,t,e,this);if(n)return new Zi(n)}readMultiLineString(t,e){const n=Z([],this.MULTILINESTRING_PARSERS,t,e,this);if(n)return new ci(n)}readMultiPolygon(t,e){const n=Z([],this.MULTIPOLYGON_PARSERS,t,e,this);if(n)return new Pi(n)}pointMemberParser(t,e){li(this.POINTMEMBER_PARSERS,t,e,this)}lineStringMemberParser(t,e){li(this.LINESTRINGMEMBER_PARSERS,t,e,this)}polygonMemberParser(t,e){li(this.POLYGONMEMBER_PARSERS,t,e,this)}readLineString(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ye(n,"XYZ")}readFlatLinearRing(t,e){const n=Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);if(n)return n}readLinearRing(t,e){const n=this.readFlatCoordinatesFromNode(t,e);if(n)return new ds(n,"XYZ")}readPolygon(t,e){const n=Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(n&&n[0]){const s=n[0],r=[s.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(s,n[o]),r.push(s.length);return new Ue(s,"XYZ",r)}}readFlatCoordinatesFromNode(t,e){return Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}readGeometryFromNode(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null}readFeaturesFromNode(t,e){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[n])||[]}readProjectionFromNode(t){return tt(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))}}rt.prototype.namespace=Pn;rt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};rt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};rt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};rt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:ot(rt.prototype.pointMemberParser),pointMembers:ot(rt.prototype.pointMemberParser)}};rt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:ot(rt.prototype.lineStringMemberParser),lineStringMembers:ot(rt.prototype.lineStringMemberParser)}};rt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:ot(rt.prototype.polygonMemberParser),polygonMembers:ot(rt.prototype.polygonMemberParser)}};rt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:ot(rt.prototype.readFlatCoordinatesFromNode)}};rt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(rt.prototype.readLineString)}};rt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(rt.prototype.readPolygon)}};rt.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(rt.prototype.readFlatLinearRing)}};function gs(i){const t=Ye(i,!1);return Ns(t)}function Ns(i){const t=/^\s*(true|1)|(false|0)\s*$/.exec(i);if(t)return t[1]!==void 0||!1}function bh(i){const t=Ye(i,!1),e=Date.parse(t);return isNaN(e)?void 0:e/1e3}function Pt(i){const t=Ye(i,!1);return Sn(t)}function Sn(i){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(i);if(t)return parseFloat(t[1])}function ge(i){const t=Ye(i,!1);return Cn(t)}function Cn(i){const t=/^\s*(\d+)\s*$/.exec(i);if(t)return parseInt(t[1],10)}function $(i){return Ye(i,!1).trim()}function Ur(i,t){ft(i,t?"1":"0")}function Rw(i,t){i.appendChild(to().createCDATASection(t))}function Cw(i,t){const e=new Date(t*1e3),n=e.getUTCFullYear()+"-"+Rs(e.getUTCMonth()+1,2)+"-"+Rs(e.getUTCDate(),2)+"T"+Rs(e.getUTCHours(),2)+":"+Rs(e.getUTCMinutes(),2)+":"+Rs(e.getUTCSeconds(),2)+"Z";i.appendChild(to().createTextNode(n))}function ii(i,t){const e=t.toPrecision();i.appendChild(to().createTextNode(e))}function Fl(i,t){const e=t.toString();i.appendChild(to().createTextNode(e))}function ft(i,t){i.appendChild(to().createTextNode(t))}const Iw=Pn+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Pw={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class It extends rt{constructor(t){t=t||{},super(t),this.FEATURE_COLLECTION_PARSERS[Pn].featureMember=ot(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:Iw}readFlatCoordinates(t,e){const n=Ye(t,!1).replace(/^\s*|\s*$/g,""),s=e[0].srsName;let r="enu";if(s){const l=tt(s);l&&(r=l.getAxisOrientation())}const o=n.trim().split(/\s+/),a=[];for(let l=0,h=o.length;l<h;l++){const c=o[l].split(/,+/),u=parseFloat(c[0]),g=parseFloat(c[1]),f=c.length===3?parseFloat(c[2]):0;r.substr(0,2)==="en"?a.push(u,g,f):a.push(g,u,f)}return a}readBox(t,e){const n=Z([null],this.BOX_PARSERS_,t,e,this);return Bi(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}outerBoundaryIsParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const s=e[e.length-1];s[0]=n}}GEOMETRY_NODE_FACTORY_(t,e,n){const s=e[e.length-1],r=s.multiSurface,o=s.surface,a=s.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&r===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),mt("http://www.opengis.net/gml",n)}writeFeatureElement(t,e,n){const s=e.getId();s&&t.setAttribute("fid",s);const r=n[n.length-1],o=r.featureNS,a=e.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const g in u){const f=u[g];f!==null&&(l.push(g),h.push(f),g==a||typeof f.getSimplifiedGeometry=="function"?g in r.serializers[o]||(r.serializers[o][g]=F(this.writeGeometryElement,this)):g in r.serializers[o]||(r.serializers[o][g]=F(ft)))}}const c=Object.assign({},r);c.node=t,pt(c,r.serializers,ce(void 0,o),h,n,l)}writeCurveOrLineString(t,e,n){const s=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&s&&t.setAttribute("srsName",s),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const r=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(r),this.writeCoordinates_(r,e,n)}else if(t.nodeName==="Curve"){const r=mt(t.namespaceURI,"segments");t.appendChild(r),this.writeCurveSegments_(r,e,n)}}writeLineStringOrCurveMember(t,e,n){const s=this.GEOMETRY_NODE_FACTORY_(e,n);s&&(t.appendChild(s),this.writeCurveOrLineString(s,e,n))}writeMultiCurveOrLineString(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(t,e,n){const s=n[n.length-1],r=Object.assign({},s);r.node=t;let o;Array.isArray(e)?o=hd(e,s):o=re(e,!0,s),pt(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(t){const e=mt(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e}writeCoordinates_(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=e.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,r)}ft(t,h.join(" "))}writeCurveSegments_(t,e,n){const s=mt(t.namespaceURI,"LineStringSegment");t.appendChild(s),this.writeCurveOrLineString(s,e,n)}writeSurfaceOrPolygon(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}RING_NODE_FACTORY_(t,e,n){const s=e[e.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),mt(r.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(t,e,n){const s=mt(t.namespaceURI,"PolygonPatch");t.appendChild(s),this.writeSurfaceOrPolygon(s,e,n)}writeRing(t,e,n){const s=mt(t.namespaceURI,"LinearRing");t.appendChild(s),this.writeLinearRing(s,e,n)}getCoords_(t,e,n){let s="enu";e&&(s=tt(e).getAxisOrientation());let r=s.substr(0,2)==="en"?t[0]+","+t[1]:t[1]+","+t[0];if(n){const o=t[2]||0;r+=","+o}return r}writePoint(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;o&&t.setAttribute("srsName",o);const a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);const l=e.getCoordinates(),h=this.getCoords_(l,o,r);ft(a,h)}writeMultiPoint(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;o&&t.setAttribute("srsName",o);const a=e.getPoints();pt({node:t,hasZ:r,srsName:o},this.POINTMEMBER_SERIALIZERS,ce("pointMember"),a,n,void 0,this)}writePointMember(t,e,n){const s=mt(t.namespaceURI,"Point");t.appendChild(s),this.writePoint(s,e,n)}writeLinearRing(t,e,n){const s=n[n.length-1].srsName;s&&t.setAttribute("srsName",s);const r=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(r),this.writeCoordinates_(r,e,n)}writeMultiSurfaceOrPolygon(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(t,e,n){const s=this.GEOMETRY_NODE_FACTORY_(e,n);s&&(t.appendChild(s),this.writeSurfaceOrPolygon(s,e,n))}writeEnvelope(t,e,n){const s=n[n.length-1].srsName;s&&t.setAttribute("srsName",s);const r=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ie,o,n,r,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const s=e[e.length-1].node;return mt("http://www.opengis.net/gml",Pw[s.nodeName])}}It.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:ht(It.prototype.readFlatCoordinates)}};It.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:It.prototype.innerBoundaryIsParser,outerBoundaryIs:It.prototype.outerBoundaryIsParser}};It.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ot(It.prototype.readFlatCoordinates)}};It.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(rt.prototype.readPoint),MultiPoint:ht(rt.prototype.readMultiPoint),LineString:ht(rt.prototype.readLineString),MultiLineString:ht(rt.prototype.readMultiLineString),LinearRing:ht(rt.prototype.readLinearRing),Polygon:ht(rt.prototype.readPolygon),MultiPolygon:ht(rt.prototype.readMultiPolygon),Box:ht(It.prototype.readBox)}};It.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(It.prototype.writeCurveOrLineString),MultiCurve:F(It.prototype.writeMultiCurveOrLineString),Point:F(It.prototype.writePoint),MultiPoint:F(It.prototype.writeMultiPoint),LineString:F(It.prototype.writeCurveOrLineString),MultiLineString:F(It.prototype.writeMultiCurveOrLineString),LinearRing:F(It.prototype.writeLinearRing),Polygon:F(It.prototype.writeSurfaceOrPolygon),MultiPolygon:F(It.prototype.writeMultiSurfaceOrPolygon),Surface:F(It.prototype.writeSurfaceOrPolygon),MultiSurface:F(It.prototype.writeMultiSurfaceOrPolygon),Envelope:F(It.prototype.writeEnvelope)}};It.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(It.prototype.writeLineStringOrCurveMember),curveMember:F(It.prototype.writeLineStringOrCurveMember)}};It.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:F(It.prototype.writeRing),innerBoundaryIs:F(It.prototype.writeRing)}};It.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(It.prototype.writePointMember)}};It.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(It.prototype.writeSurfaceOrPolygonMember),polygonMember:F(It.prototype.writeSurfaceOrPolygonMember)}};It.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(ft),upperCorner:F(ft)}};const Aw=Pn+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Lw={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class at extends rt{constructor(t){t=t||{},super(t),this.surface_=t.surface!==void 0?t.surface:!1,this.curve_=t.curve!==void 0?t.curve:!1,this.multiCurve_=t.multiCurve!==void 0?t.multiCurve:!0,this.multiSurface_=t.multiSurface!==void 0?t.multiSurface:!0,this.schemaLocation=t.schemaLocation?t.schemaLocation:Aw,this.hasZ=t.hasZ!==void 0?t.hasZ:!1}readMultiCurve(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this);if(n)return new ci(n)}readFlatCurveRing(t,e){const n=Z([],this.MULTICURVE_PARSERS,t,e,this),s=[];for(let r=0,o=n.length;r<o;++r)Ot(s,n[r].getFlatCoordinates());return s}readMultiSurface(t,e){const n=Z([],this.MULTISURFACE_PARSERS,t,e,this);if(n)return new Pi(n)}curveMemberParser(t,e){li(this.CURVEMEMBER_PARSERS,t,e,this)}surfaceMemberParser(t,e){li(this.SURFACEMEMBER_PARSERS,t,e,this)}readPatch(t,e){return Z([null],this.PATCHES_PARSERS,t,e,this)}readSegment(t,e){return Z([],this.SEGMENTS_PARSERS,t,e,this)}readPolygonPatch(t,e){return Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)}readLineStringSegment(t,e){return Z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}interiorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)}exteriorParser(t,e){const n=Z(void 0,this.RING_PARSERS,t,e,this);if(n){const s=e[e.length-1];s[0]=n}}readSurface(t,e){const n=Z([null],this.SURFACE_PARSERS,t,e,this);if(n&&n[0]){const s=n[0],r=[s.length];let o,a;for(o=1,a=n.length;o<a;++o)Ot(s,n[o]),r.push(s.length);return new Ue(s,"XYZ",r)}}readCurve(t,e){const n=Z([null],this.CURVE_PARSERS,t,e,this);if(n)return new ye(n,"XYZ")}readEnvelope(t,e){const n=Z([null],this.ENVELOPE_PARSERS,t,e,this);return Bi(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(t,e){let n=Ye(t,!1);const s=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,r=[];let o;for(;o=s.exec(n);)r.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const a=e[0].srsName;let l="enu";if(a&&(l=tt(a).getAxisOrientation()),l==="neu"){let c,u;for(c=0,u=r.length;c<u;c+=3){const g=r[c],f=r[c+1];r[c]=f,r[c+1]=g}}const h=r.length;if(h==2&&r.push(0),h!==0)return r}readFlatPosList(t,e){const n=Ye(t,!1).replace(/^\s*|\s*$/g,""),s=e[0],r=s.srsName,o=s.srsDimension;let a="enu";r&&(a=tt(r).getAxisOrientation());const l=n.split(/\s+/);let h=2;t.getAttribute("srsDimension")?h=Cn(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=Cn(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=Cn(t.parentNode.getAttribute("srsDimension")):o&&(h=Cn(o));let c,u,g;const f=[];for(let p=0,_=l.length;p<_;p+=h)c=parseFloat(l[p]),u=parseFloat(l[p+1]),g=h===3?parseFloat(l[p+2]):0,a.substr(0,2)==="en"?f.push(c,u,g):f.push(u,c,g);return f}writePos_(t,e,n){const s=n[n.length-1],r=s.hasZ,o=r?"3":"2";t.setAttribute("srsDimension",o);const a=s.srsName;let l="enu";a&&(l=tt(a).getAxisOrientation());const h=e.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],r){const u=h[2]||0;c+=" "+u}ft(t,c)}getCoords_(t,e,n){let s="enu";e&&(s=tt(e).getAxisOrientation());let r=s.substr(0,2)==="en"?t[0]+" "+t[1]:t[1]+" "+t[0];if(n){const o=t[2]||0;r+=" "+o}return r}writePosList_(t,e,n){const s=n[n.length-1],r=s.hasZ,o=r?"3":"2";t.setAttribute("srsDimension",o);const a=s.srsName,l=e.getCoordinates(),h=l.length,c=new Array(h);let u;for(let g=0;g<h;++g)u=l[g],c[g]=this.getCoords_(u,a,r);ft(t,c.join(" "))}writePoint(t,e,n){const s=n[n.length-1].srsName;s&&t.setAttribute("srsName",s);const r=mt(t.namespaceURI,"pos");t.appendChild(r),this.writePos_(r,e,n)}writeEnvelope(t,e,n){const s=n[n.length-1].srsName;s&&t.setAttribute("srsName",s);const r=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];pt({node:t},this.ENVELOPE_SERIALIZERS,Ie,o,n,r,this)}writeLinearRing(t,e,n){const s=n[n.length-1].srsName;s&&t.setAttribute("srsName",s);const r=mt(t.namespaceURI,"posList");t.appendChild(r),this.writePosList_(r,e,n)}RING_NODE_FACTORY_(t,e,n){const s=e[e.length-1],r=s.node,o=s.exteriorWritten;return o===void 0&&(s.exteriorWritten=!0),mt(r.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();pt({node:t,hasZ:r,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(t.nodeName==="Surface"){const a=mt(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,n)}}writeCurveOrLineString(t,e,n){const s=n[n.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&s&&t.setAttribute("srsName",s),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const r=mt(t.namespaceURI,"posList");t.appendChild(r),this.writePosList_(r,e,n)}else if(t.nodeName==="Curve"){const r=mt(t.namespaceURI,"segments");t.appendChild(r),this.writeCurveSegments_(r,e,n)}}writeMultiSurfaceOrPolygon(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();pt({node:t,hasZ:r,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(t,e,n){const s=n[n.length-1],r=s.srsName,o=s.hasZ;r&&t.setAttribute("srsName",r);const a=e.getPoints();pt({node:t,hasZ:o,srsName:r},this.POINTMEMBER_SERIALIZERS,ce("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(t,e,n){const s=n[n.length-1],r=s.hasZ,o=s.srsName,a=s.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();pt({node:t,hasZ:r,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(t,e,n){const s=mt(t.namespaceURI,"LinearRing");t.appendChild(s),this.writeLinearRing(s,e,n)}writeSurfaceOrPolygonMember(t,e,n){const s=this.GEOMETRY_NODE_FACTORY_(e,n);s&&(t.appendChild(s),this.writeSurfaceOrPolygon(s,e,n))}writePointMember(t,e,n){const s=mt(t.namespaceURI,"Point");t.appendChild(s),this.writePoint(s,e,n)}writeLineStringOrCurveMember(t,e,n){const s=this.GEOMETRY_NODE_FACTORY_(e,n);s&&(t.appendChild(s),this.writeCurveOrLineString(s,e,n))}writeSurfacePatches_(t,e,n){const s=mt(t.namespaceURI,"PolygonPatch");t.appendChild(s),this.writeSurfaceOrPolygon(s,e,n)}writeCurveSegments_(t,e,n){const s=mt(t.namespaceURI,"LineStringSegment");t.appendChild(s),this.writeCurveOrLineString(s,e,n)}writeGeometryElement(t,e,n){const s=n[n.length-1],r=Object.assign({},s);r.node=t;let o;Array.isArray(e)?o=hd(e,s):o=re(e,!0,s),pt(r,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(t,e,n){const s=e.getId();s&&t.setAttribute("fid",s);const r=n[n.length-1],o=r.featureNS,a=e.getGeometryName();r.serializers||(r.serializers={},r.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const g in u){const f=u[g];f!==null&&(l.push(g),h.push(f),g==a||typeof f.getSimplifiedGeometry=="function"?g in r.serializers[o]||(r.serializers[o][g]=F(this.writeGeometryElement,this)):g in r.serializers[o]||(r.serializers[o][g]=F(ft)))}}const c=Object.assign({},r);c.node=t,pt(c,r.serializers,ce(void 0,o),h,n,l)}writeFeatureMembers_(t,e,n){const s=n[n.length-1],r=s.featureType,o=s.featureNS,a={};a[o]={},a[o][r]=F(this.writeFeatureElement,this);const l=Object.assign({},s);l.node=t,pt(l,a,ce(r,o),e,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,n){const s=e[e.length-1].node;return mt(this.namespace,Lw[s.nodeName])}GEOMETRY_NODE_FACTORY_(t,e,n){const s=e[e.length-1],r=s.multiSurface,o=s.surface,a=s.curve,l=s.multiCurve;return Array.isArray(t)?n="Envelope":(n=t.getType(),n==="MultiPolygon"&&r===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),mt(this.namespace,n)}writeGeometryNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"geom"),s={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(s,e),this.writeGeometryElement(n,t,[s]),n}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(this.namespace,"featureMembers");n.setAttributeNS(js,"xsi:schemaLocation",this.schemaLocation);const s={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(s,e),this.writeFeatureMembers_(n,t,[s]),n}}at.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:ht(at.prototype.readFlatPos),posList:ht(at.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};at.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:at.prototype.interiorParser,exterior:at.prototype.exteriorParser}};at.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ht(rt.prototype.readPoint),MultiPoint:ht(rt.prototype.readMultiPoint),LineString:ht(rt.prototype.readLineString),MultiLineString:ht(rt.prototype.readMultiLineString),LinearRing:ht(rt.prototype.readLinearRing),Polygon:ht(rt.prototype.readPolygon),MultiPolygon:ht(rt.prototype.readMultiPolygon),Surface:ht(at.prototype.readSurface),MultiSurface:ht(at.prototype.readMultiSurface),Curve:ht(at.prototype.readCurve),MultiCurve:ht(at.prototype.readMultiCurve),Envelope:ht(at.prototype.readEnvelope)}};at.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:ot(at.prototype.curveMemberParser),curveMembers:ot(at.prototype.curveMemberParser)}};at.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:ot(at.prototype.surfaceMemberParser),surfaceMembers:ot(at.prototype.surfaceMemberParser)}};at.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:ot(rt.prototype.readLineString),Curve:ot(at.prototype.readCurve)}};at.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:ot(rt.prototype.readPolygon),Surface:ot(at.prototype.readSurface)}};at.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:ht(at.prototype.readPatch)}};at.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:ht(at.prototype.readSegment)}};at.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:ot(at.prototype.readFlatPosList),upperCorner:ot(at.prototype.readFlatPosList)}};at.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:ht(at.prototype.readPolygonPatch)}};at.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Ol(at.prototype.readLineStringSegment)}};rt.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ht(rt.prototype.readFlatLinearRing),Ring:ht(at.prototype.readFlatCurveRing)}};at.prototype.writeFeatures;at.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:F(at.prototype.writeRing),interior:F(at.prototype.writeRing)}};at.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:F(ft),upperCorner:F(ft)}};at.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:F(at.prototype.writeSurfaceOrPolygonMember),polygonMember:F(at.prototype.writeSurfaceOrPolygonMember)}};at.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:F(at.prototype.writePointMember)}};at.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:F(at.prototype.writeLineStringOrCurveMember),curveMember:F(at.prototype.writeLineStringOrCurveMember)}};at.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:F(at.prototype.writeCurveOrLineString),MultiCurve:F(at.prototype.writeMultiCurveOrLineString),Point:F(at.prototype.writePoint),MultiPoint:F(at.prototype.writeMultiPoint),LineString:F(at.prototype.writeCurveOrLineString),MultiLineString:F(at.prototype.writeMultiCurveOrLineString),LinearRing:F(at.prototype.writeLinearRing),Polygon:F(at.prototype.writeSurfaceOrPolygon),MultiPolygon:F(at.prototype.writeMultiSurfaceOrPolygon),Surface:F(at.prototype.writeSurfaceOrPolygon),MultiSurface:F(at.prototype.writeMultiSurfaceOrPolygon),Envelope:F(at.prototype.writeEnvelope)}};const Rt=at,gd=Rt;gd.prototype.writeFeatures;gd.prototype.writeFeaturesNode;const Ow=gd,ne=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Fw="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Nw={rte:T0,trk:M0,wpt:R0},kw=X(ne,{rte:ot(T0),trk:ot(M0),wpt:ot(R0)}),Dw=X(ne,{text:O($,"linkText"),type:O($,"linkType")}),Gw=X(ne,{name:O($),email:ub,link:Aa}),jw=X(ne,{name:O($),desc:O($),author:O(lb),copyright:O(hb),link:Aa,time:O(bh),keywords:O($),bounds:cb,extensions:Eh}),zw=X(ne,{year:O(ge),license:O($)}),Uw=X(ne,{rte:F(pb),trk:F(mb),wpt:F(yb)});class Bw extends Pa{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,n=t.length;e<n;++e){const s=t[e];if(this.readExtensions_){const r=s.get("extensionsNode_")||null;this.readExtensions_(s,r)}s.set("extensionsNode_",void 0)}}readMetadata(t){return t?typeof t=="string"?this.readMetadataFromDocument(Ci(t)):Ri(t)?this.readMetadataFromDocument(t):this.readMetadataFromNode(t):null}readMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(e);if(n)return n}return null}readMetadataFromNode(t){if(!ne.includes(t.namespaceURI))return null;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(ne.includes(e.namespaceURI)&&e.localName==="metadata")return Z({},jw,e,[]);return null}readFeatureFromNode(t,e){if(!ne.includes(t.namespaceURI))return null;const n=Nw[t.localName];if(!n)return null;const s=n(t,[this.getReadOptions(t,e)]);return s?(this.handleReadExtensions_([s]),s):null}readFeaturesFromNode(t,e){if(!ne.includes(t.namespaceURI))return[];if(t.localName=="gpx"){const n=Z([],kw,t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",js),n.setAttributeNS(js,"xsi:schemaLocation",Fw),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),pt({node:n},Uw,ab,t,[e]),n}}const Ww=X(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:Aa,number:O(ge),extensions:Eh,type:O($),rtept:db}),qw=X(ne,{ele:O(Pt),time:O(bh)}),Xw=X(ne,{name:O($),cmt:O($),desc:O($),src:O($),link:Aa,number:O(ge),type:O($),extensions:Eh,trkseg:fb}),Zw=X(ne,{trkpt:gb}),$w=X(ne,{ele:O(Pt),time:O(bh)}),Vw=X(ne,{ele:O(Pt),time:O(bh),magvar:O(Pt),geoidheight:O(Pt),name:O($),cmt:O($),desc:O($),src:O($),link:Aa,sym:O($),type:O($),fix:O($),sat:O(ge),hdop:O(Pt),vdop:O(Pt),pdop:O(Pt),ageofdgpsdata:O(Pt),dgpsid:O(ge),extensions:Eh}),Yw=["text","type"],Hw=X(ne,{text:F(ft),type:F(ft)}),Kw=X(ne,["name","cmt","desc","src","link","number","type","rtept"]),Qw=X(ne,{name:F(ft),cmt:F(ft),desc:F(ft),src:F(ft),link:F(md),number:F(Fl),type:F(ft),rtept:E0(F(_d))}),Jw=X(ne,["ele","time"]),tb=X(ne,["name","cmt","desc","src","link","number","type","trkseg"]),eb=X(ne,{name:F(ft),cmt:F(ft),desc:F(ft),src:F(ft),link:F(md),number:F(Fl),type:F(ft),trkseg:E0(F(_b))}),ib=ce("trkpt"),nb=X(ne,{trkpt:F(_d)}),sb=X(ne,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),rb=X(ne,{ele:F(ii),time:F(Cw),magvar:F(ii),geoidheight:F(ii),name:F(ft),cmt:F(ft),desc:F(ft),src:F(ft),link:F(md),sym:F(ft),type:F(ft),fix:F(ft),sat:F(Fl),hdop:F(ii),vdop:F(ii),pdop:F(ii),ageofdgpsdata:F(ii),dgpsid:F(Fl)}),ob={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function ab(i,t,e){const n=i.getGeometry();if(n){const s=ob[n.getType()];if(s){const r=t[t.length-1].node;return mt(r.namespaceURI,s)}}}function fd(i,t,e,n){return i.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in n?(i.push(n.ele),delete n.ele,t.hasZ=!0):i.push(0),"time"in n?(i.push(n.time),delete n.time,t.hasM=!0):i.push(0),i}function pd(i,t,e){let n="XY",s=2;if(i.hasZ&&i.hasM?(n="XYZM",s=4):i.hasZ?(n="XYZ",s=3):i.hasM&&(n="XYM",s=3),s!==4){for(let r=0,o=t.length/4;r<o;r++)t[r*s]=t[r*4],t[r*s+1]=t[r*4+1],i.hasZ&&(t[r*s+2]=t[r*4+2]),i.hasM&&(t[r*s+2]=t[r*4+3]);if(t.length=t.length/4*s,e)for(let r=0,o=e.length;r<o;r++)e[r]=e[r]/4*s}return n}function lb(i,t){const e=Z({},Gw,i,t);if(e)return e}function hb(i,t){const e=Z({},zw,i,t);if(e){const n=i.getAttribute("author");return n!==null&&(e.author=n),e}}function cb(i,t){const e=t[t.length-1],n=i.getAttribute("minlat"),s=i.getAttribute("minlon"),r=i.getAttribute("maxlat"),o=i.getAttribute("maxlon");s!==null&&n!==null&&o!==null&&r!==null&&(e.bounds=[[parseFloat(s),parseFloat(n)],[parseFloat(o),parseFloat(r)]])}function ub(i,t){const e=t[t.length-1],n=i.getAttribute("id"),s=i.getAttribute("domain");n!==null&&s!==null&&(e.email=`${n}@${s}`)}function Aa(i,t){const e=t[t.length-1],n=i.getAttribute("href");n!==null&&(e.link=n),li(Dw,i,t)}function Eh(i,t){const e=t[t.length-1];e.extensionsNode_=i}function db(i,t){const e=Z({},qw,i,t);if(e){const n=t[t.length-1],s=n.flatCoordinates,r=n.layoutOptions;fd(s,r,i,e)}}function gb(i,t){const e=Z({},$w,i,t);if(e){const n=t[t.length-1],s=n.flatCoordinates,r=n.layoutOptions;fd(s,r,i,e)}}function fb(i,t){const e=t[t.length-1];li(Zw,i,t);const n=e.flatCoordinates;e.ends.push(n.length)}function T0(i,t){const e=t[0],n=Z({flatCoordinates:[],layoutOptions:{}},Ww,i,t);if(!n)return;const s=n.flatCoordinates;delete n.flatCoordinates;const r=n.layoutOptions;delete n.layoutOptions;const o=pd(r,s),a=new ye(s,o);re(a,!1,e);const l=new Ee(a);return l.setProperties(n,!0),l}function M0(i,t){const e=t[0],n=Z({flatCoordinates:[],ends:[],layoutOptions:{}},Xw,i,t);if(!n)return;const s=n.flatCoordinates;delete n.flatCoordinates;const r=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=pd(o,s,r),l=new ci(s,a,r);re(l,!1,e);const h=new Ee(l);return h.setProperties(n,!0),h}function R0(i,t){const e=t[0],n=Z({},Vw,i,t);if(!n)return;const s={},r=fd([],s,i,n),o=pd(s,r),a=new Re(r,o);re(a,!1,e);const l=new Ee(a);return l.setProperties(n,!0),l}function md(i,t,e){i.setAttribute("href",t);const n=e[e.length-1].properties,s=[n.linkText,n.linkType];pt({node:i},Hw,Ie,s,e,Yw)}function _d(i,t,e){const n=e[e.length-1],s=n.node.namespaceURI,r=n.properties;switch(i.setAttributeNS(null,"lat",String(t[1])),i.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":t[3]!==0&&(r.time=t[3]);case"XYZ":t[2]!==0&&(r.ele=t[2]);break;case"XYM":t[2]!==0&&(r.time=t[2]);break}const o=i.nodeName=="rtept"?Jw[s]:sb[s],a=ui(r,o);pt({node:i,properties:r},rb,Ie,a,e,o)}function pb(i,t,e){const n=e[0],s=t.getProperties(),r={node:i};r.properties=s;const o=t.getGeometry();if(o.getType()=="LineString"){const c=re(o,!0,n);r.geometryLayout=c.getLayout(),s.rtept=c.getCoordinates()}const a=e[e.length-1].node,l=Kw[a.namespaceURI],h=ui(s,l);pt(r,Qw,Ie,h,e,l)}function mb(i,t,e){const n=e[0],s=t.getProperties(),r={node:i};r.properties=s;const o=t.getGeometry();if(o.getType()=="MultiLineString"){const c=re(o,!0,n);s.trkseg=c.getLineStrings()}const a=e[e.length-1].node,l=tb[a.namespaceURI],h=ui(s,l);pt(r,eb,Ie,h,e,l)}function _b(i,t,e){const n={node:i};n.geometryLayout=t.getLayout(),n.properties={},pt(n,nb,ib,t.getCoordinates(),e)}function yb(i,t,e){const n=e[0],s=e[e.length-1];s.properties=t.getProperties();const r=t.getGeometry();if(r.getType()=="Point"){const o=re(r,!0,n);s.geometryLayout=o.getLayout(),_d(i,o.getCoordinates(),e)}}const xb=Bw;class yd extends Ca{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Ja(t),this.adaptOptions(e))}readFeatureFromText(t,e){return ct()}readFeatures(t,e){return this.readFeaturesFromText(Ja(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return ct()}readGeometry(t,e){return this.readGeometryFromText(Ja(t),this.adaptOptions(e))}readGeometryFromText(t,e){return ct()}readProjection(t){return this.readProjectionFromText(Ja(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return ct()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return ct()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return ct()}}function Ja(i){return typeof i=="string"?i:""}const vb=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,wb=/^H.([A-Z]{3}).*?:(.*)/,bb=/^HFDTE(\d{2})(\d{2})(\d{2})/,Eb=/\r\n|\r|\n/;class Sb extends yd{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.altitudeMode_=t.altitudeMode?t.altitudeMode:"none"}readFeatureFromText(t,e){const n=this.altitudeMode_,s=t.split(Eb),r={},o=[];let a=2e3,l=0,h=1,c=-1,u,g;for(u=0,g=s.length;u<g;++u){const x=s[u];let v;if(x.charAt(0)=="B"){if(v=vb.exec(x),v){const w=parseInt(v[1],10),E=parseInt(v[2],10),S=parseInt(v[3],10);let T=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(T=-T);let R=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(R=-R),o.push(R,T),n!="none"){let P;n=="gps"?P=parseInt(v[11],10):n=="barometric"?P=parseInt(v[12],10):P=0,o.push(P)}let C=Date.UTC(a,l,h,w,E,S);C<c&&(C=Date.UTC(a,l,h+1,w,E,S)),o.push(C/1e3),c=C}}else x.charAt(0)=="H"&&(v=bb.exec(x),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,a=2e3+parseInt(v[3],10)):(v=wb.exec(x),v&&(r[v[1]]=v[2].trim())))}if(o.length===0)return null;const f=n=="none"?"XYM":"XYZM",p=new ye(o,f),_=new Ee(re(p,!1,e));return _.setProperties(r,!0),_}readFeaturesFromText(t,e){const n=this.readFeatureFromText(t,e);return n?[n]:[]}}const Tb=Sb,_e={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},zs={};zs[_e.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};zs[_e.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};zs[_e.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};zs.none={none:{supports:[],formats:[],qualities:[]}};const Mb=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Pf=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Rb=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Cb(i){let t=i.getComplianceLevelSupportedFeatures();return t===void 0&&(t=zs[_e.VERSION1].level0),{url:i.imageInfo["@id"]===void 0?void 0:i.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,i.imageInfo.formats===void 0?[]:i.imageInfo.formats],qualities:[...t.qualities,i.imageInfo.qualities===void 0?[]:i.imageInfo.qualities],resolutions:i.imageInfo.scale_factors,tileSize:i.imageInfo.tile_width!==void 0?i.imageInfo.tile_height!==void 0?[i.imageInfo.tile_width,i.imageInfo.tile_height]:[i.imageInfo.tile_width,i.imageInfo.tile_width]:i.imageInfo.tile_height!=null?[i.imageInfo.tile_height,i.imageInfo.tile_height]:void 0}}function Ib(i){const t=i.getComplianceLevelSupportedFeatures(),e=Array.isArray(i.imageInfo.profile)&&i.imageInfo.profile.length>1,n=e&&i.imageInfo.profile[1].supports?i.imageInfo.profile[1].supports:[],s=e&&i.imageInfo.profile[1].formats?i.imageInfo.profile[1].formats:[],r=e&&i.imageInfo.profile[1].qualities?i.imageInfo.profile[1].qualities:[];return{url:i.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:i.imageInfo.sizes===void 0?void 0:i.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:i.imageInfo.tiles===void 0?void 0:[i.imageInfo.tiles.map(function(o){return o.width})[0],i.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:i.imageInfo.tiles===void 0?void 0:i.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...t.supports,...n],formats:[...t.formats,...s],qualities:[...t.qualities,...r]}}function Pb(i){const t=i.getComplianceLevelSupportedFeatures(),e=i.imageInfo.extraFormats===void 0?t.formats:[...t.formats,...i.imageInfo.extraFormats],n=i.imageInfo.preferredFormats!==void 0&&Array.isArray(i.imageInfo.preferredFormats)&&i.imageInfo.preferredFormats.length>0?i.imageInfo.preferredFormats.filter(function(s){return["jpg","png","gif"].includes(s)}).reduce(function(s,r){return s===void 0&&e.includes(r)?r:s},void 0):void 0;return{url:i.imageInfo.id,sizes:i.imageInfo.sizes===void 0?void 0:i.imageInfo.sizes.map(function(s){return[s.width,s.height]}),tileSize:i.imageInfo.tiles===void 0?void 0:[i.imageInfo.tiles.map(function(s){return s.width})[0],i.imageInfo.tiles.map(function(s){return s.height})[0]],resolutions:i.imageInfo.tiles===void 0?void 0:i.imageInfo.tiles.map(function(s){return s.scaleFactors})[0],supports:i.imageInfo.extraFeatures===void 0?t.supports:[...t.supports,...i.imageInfo.extraFeatures],formats:e,qualities:i.imageInfo.extraQualities===void 0?t.qualities:[...t.qualities,...i.imageInfo.extraQualities],preferredFormat:n}}const Sh={};Sh[_e.VERSION1]=Cb;Sh[_e.VERSION2]=Ib;Sh[_e.VERSION3]=Pb;class Ab{constructor(t){this.setImageInfo(t)}setImageInfo(t){typeof t=="string"?this.imageInfo=JSON.parse(t):this.imageInfo=t}getImageApiVersion(){if(this.imageInfo===void 0)return;let t=this.imageInfo["@context"]||"ol-no-context";typeof t=="string"&&(t=[t]);for(let e=0;e<t.length;e++)switch(t[e]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return _e.VERSION1;case"http://iiif.io/api/image/2/context.json":return _e.VERSION2;case"http://iiif.io/api/image/3/context.json":return _e.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(_e.VERSION1)&&this.imageInfo.identifier)return _e.VERSION1;break}At(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(t){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(t===void 0&&(t=this.getImageApiVersion()),t){case _e.VERSION1:if(Mb.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION3:if(Rb.test(this.imageInfo.profile))return this.imageInfo.profile;break;case _e.VERSION2:if(typeof this.imageInfo.profile=="string"&&Pf.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Pf.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(t){const e=this.getComplianceLevelEntryFromProfile(t);if(e===void 0)return;const n=e.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const t=this.getImageApiVersion(),e=this.getComplianceLevelFromProfile(t);return e===void 0?zs.none.none:zs[t][e]}getTileSourceOptions(t){const e=t||{},n=this.getImageApiVersion();if(n===void 0)return;const s=n===void 0?void 0:Sh[n](this);if(s!==void 0)return{url:s.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:s.sizes,format:e.format!==void 0&&s.formats.includes(e.format)?e.format:s.preferredFormat!==void 0?s.preferredFormat:"jpg",supports:s.supports,quality:e.quality&&s.qualities.includes(e.quality)?e.quality:s.qualities.includes("native")?"native":"default",resolutions:Array.isArray(s.resolutions)?s.resolutions.sort(function(r,o){return o-r}):void 0,tileSize:s.tileSize}}}const Lb=Ab,et={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},ta={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Le={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Le.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Le.max=Le.whitepoint[2].D65;Le.rgb=function(i,t){t=t||Le.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],s=i[2]/t[2],r,o,a;return r=e*3.240969941904521+n*-1.537383177570093+s*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+s*.041555057407175,a=e*.055630079696993+n*-.20397695888897+s*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[r*255,o*255,a*255]};ta.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,s=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var r=e*.41239079926595+n*.35758433938387+s*.18048078840183,o=e*.21263900587151+n*.71516867876775+s*.072192315360733,a=e*.019330818715591+n*.11919477979462+s*.95053215224966;return t=t||Le.whitepoint[2].E,[r*t[0],o*t[1],a*t[2]]};const xd={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,s,r,o,a,l,h,c,u,g,f,p,_;if(r=i[0],o=i[1],a=i[2],r===0)return[0,0,0];var x=.0011070564598794539;return t=t||"D65",e=e||2,u=Le.whitepoint[e][t][0],g=Le.whitepoint[e][t][1],f=Le.whitepoint[e][t][2],p=4*u/(u+15*g+3*f),_=9*g/(u+15*g+3*f),n=o/(13*r)+p||0,s=a/(13*r)+_||0,h=r>8?g*Math.pow((r+16)/116,3):g*r*x,l=h*9*n/(4*s)||0,c=h*(12-3*n-20*s)/(4*s)||0,[l,h,c]}};Le.luv=function(i,t,e){var n,s,r,o,a,l,h,c,u,g,f,p,_,x=.008856451679035631,v=903.2962962962961;t=t||"D65",e=e||2,u=Le.whitepoint[e][t][0],g=Le.whitepoint[e][t][1],f=Le.whitepoint[e][t][2],p=4*u/(u+15*g+3*f),_=9*g/(u+15*g+3*f),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,s=9*h/(l+15*h+3*c)||0;var w=h/g;return r=w<=x?v*w:116*Math.pow(w,1/3)-16,o=13*r*(n-p),a=13*r*(s-_),[r,o,a]};var C0={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],n=i[2],s,r,o;return o=n/360*2*Math.PI,s=e*Math.cos(o),r=e*Math.sin(o),[t,s,r]},xyz:function(i){return xd.xyz(C0.luv(i))}};xd.lchuv=function(i){var t=i[0],e=i[1],n=i[2],s=Math.sqrt(e*e+n*n),r=Math.atan2(n,e),o=r*360/2/Math.PI;return o<0&&(o+=360),[t,s,o]};Le.lchuv=function(i){return xd.lchuv(Le.luv(i))};var ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eo(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ob={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const Af=eo(Ob);var Lf={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Fb(i){var t,e,n,s=[],r=1,o;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Af[i])s=Af[i].slice(),o="rgb";else if(i==="transparent")r=0,o="rgb",s=[0,0,0];else if(i[0]==="#"){var a=i.slice(1),l=a.length,h=l<=4;r=1,h?(s=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(r=parseInt(a[3]+a[3],16)/255)):(s=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(r=parseInt(a[6]+a[7],16)/255)),s[0]||(s[0]=0),s[1]||(s[1]=0),s[2]||(s[2]=0),o="rgb"}else if(n=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var c=n[1];o=c.replace(/a$/,"");var u=o==="cmyk"?4:o==="gray"?1:3;s=n[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=s.shift()),s=s.map(function(g,f){if(g[g.length-1]==="%")return g=parseFloat(g)/100,f===3?g:o==="rgb"?g*255:o[0]==="h"||o[0]==="l"&&!f?g*100:o==="lab"?g*125:o==="lch"?f<2?g*150:g*360:o[0]==="o"&&!f?g:o==="oklab"?g*.4:o==="oklch"?f<2?g*.4:g*360:g;if(o[f]==="h"||f===2&&o[o.length-1]==="h"){if(Lf[g]!==void 0)return Lf[g];if(g.endsWith("deg"))return parseFloat(g);if(g.endsWith("turn"))return parseFloat(g)*360;if(g.endsWith("grad"))return parseFloat(g)*360/400;if(g.endsWith("rad"))return parseFloat(g)*180/Math.PI}return g==="none"?0:parseFloat(g)}),r=s.length>u?s.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(s=i.match(/([0-9]+)/g).map(function(g){return parseFloat(g)}),o=((e=(t=i.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:o,values:s,alpha:r}}const gc={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,s,r,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(r=n<.5?n*(1+e):n+e-n*e,s=2*n-r,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?s+(r-s)*6*o:2*o<1?r:3*o<2?s+(r-s)*(2/3-o)*6:s,a[h++]=l*255;return a}};ta.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,s=Math.min(t,e,n),r=Math.max(t,e,n),o=r-s,a,l,h;return r===s?a=0:t===r?a=(e-n)/o:e===r?a=2+(n-t)/o:n===r&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(s+r)/2,r===s?l=0:h<=.5?l=o/(r+s):l=o/(2-r-s),[a,l*100,h*100]};function Nb(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Fb(i);if(!e.space)return[];const n=e.space[0]==="h"?gc.min:ta.min,s=e.space[0]==="h"?gc.max:ta.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),s[2]),e.space[0]==="h"&&(t=gc.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function kb(i){return typeof i=="string"?i:wd(i)}const Db=1024,mo={};let fc=0;function Gb(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Of(i){const t=Le.lchuv(ta.xyz(i));return t[3]=i[3],t}function jb(i){const t=Le.rgb(C0.xyz(i));return t[3]=i[3],t}function vd(i){if(mo.hasOwnProperty(i))return mo[i];if(fc>=Db){let e=0;for(const n in mo)e++&3||(delete mo[n],--fc)}const t=Nb(i);if(t.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+i+'" as color');return I0(t),mo[i]=t,++fc,t}function Wi(i){return Array.isArray(i)?i:vd(i)}function I0(i){return i[0]=wt(i[0]+.5|0,0,255),i[1]=wt(i[1]+.5|0,0,255),i[2]=wt(i[2]+.5|0,0,255),i[3]=wt(i[3],0,1),i}function wd(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+s+")"}function zb(i){try{return vd(i),!0}catch{return!1}}const fs=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";fs.includes("firefox");const Ub=fs.includes("safari")&&!fs.includes("chrom"),Bb=Ub&&(fs.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(fs));fs.includes("webkit")&&fs.includes("edge");fs.includes("macintosh");const P0=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,bd=typeof Image<"u"&&Image.prototype.decode,Wb=typeof createImageBitmap=="function";(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function Jt(i,t,e,n){let s;return e&&e.length?s=e.shift():P0?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",n)}let pc;function ou(){return pc||(pc=Jt(1,1)),pc}function Us(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}class Th extends xa{constructor(t,e,n,s){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof s=="function"?et.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(Lt.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==et.IDLE&&this.loader){this.state=et.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Vm(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=et.LOADED}).catch(n=>{this.state=et.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function qb(i,t,e){const n=i;let s=!0,r=!1,o=!1;const a=[Ho(n,Lt.LOAD,function(){o=!0,r||t()})];return n.src&&bd?(r=!0,n.decode().then(function(){s&&t()}).catch(function(l){s&&(o?t():e())})):a.push(Ho(n,Lt.ERROR,e)),function(){s=!1,a.forEach(ve)}}function Xb(i,t){return new Promise((e,n)=>{function s(){o(),e(i)}function r(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",s),i.removeEventListener("error",r)}i.addEventListener("load",s),i.addEventListener("error",r),t&&(i.src=t)})}function A0(i,t){return t&&(i.src=t),i.src&&bd?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):n(s))):Xb(i)}function _s(i,t){return t&&(i.src=t),i.src&&bd&&Wb?i.decode().then(()=>createImageBitmap(i)).catch(e=>{if(i.complete&&i.width)return i;throw e}):A0(i)}class Zb{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const s=mc(t,e,n);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,n){const s=mc(t,e,n);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,n,s,r){const o=mc(t,e,n),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===et.IDLE&&s.load(),s.getImageState()===et.LOADING?s.ready().then(()=>{this.patternCache_[o]=ou().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=ou().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function mc(i,t,e){const n=e?Wi(e):"null";return t+":"+i+":"+n}const ss=new Zb;let _o=null;class $b extends xa{constructor(t,e,n,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.imageState_=s===void 0?et.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===et.LOADED){_o||(_o=Jt(1,1,void 0,{willReadFrequently:!0})),_o.drawImage(this.image_,0,0);try{_o.getImageData(0,0,1,1),this.tainted_=!1}catch{_o=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Lt.CHANGE)}handleImageError_(){this.imageState_=et.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=et.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Jt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===et.IDLE){this.image_||this.initializeImage_(),this.imageState_=et.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&A0(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==et.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const s=n.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=kb(this.color_),s.fillRect(0,0,n.width/t,n.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===et.LOADED||this.imageState_===et.ERROR?t():this.addEventListener(Lt.CHANGE,function e(){(this.imageState_===et.LOADED||this.imageState_===et.ERROR)&&(this.removeEventListener(Lt.CHANGE,e),t())})})),this.ready_}}function Ed(i,t,e,n,s,r){let o=t===void 0?void 0:ss.get(t,e,s);return o||(o=new $b(i,i instanceof HTMLImageElement?i.src||void 0:t,e,n,s),ss.set(t,e,s,o,r)),r&&o&&!ss.getPattern(t,e,s)&&ss.set(t,e,s,o,r),o}class qi{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new qi({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Ed(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===et.IDLE&&e.load(),e.getImageState()===et.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function L0(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function se(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}class Mh{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=se(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Mh({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ct()}getImage(t){return ct()}getHitDetectionImage(){return ct()}getPixelRatio(t){return 1}getImageState(){return ct()}getImageSize(){return ct()}getOrigin(){return ct()}getSize(){return ct()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=se(t)}listenImageChange(t){ct()}load(){ct()}unlistenImageChange(t){ct()}ready(){return Promise.resolve()}}function Ff(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class Sd extends Mh{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;At(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||st(o)),At(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),At(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=et.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?et.LOADED:et.IDLE:l=et.LOADING:l=et.LOADED),this.color_=t.color!==void 0?Wi(t.color):null,this.iconImage_=Ed(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(Ff(f[0],f[1],t.width,t.height))};this.listenImageChange(g);return}}h!==void 0&&this.setScale(Ff(h,c,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Sd({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==et.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Lt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Lt.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Rh=Sd;class Td{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Td({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const cn=Td;function nn(i){return i?Array.isArray(i)?wd(i):typeof i=="object"&&"src"in i?Vb(i):i:null}function Vb(i){if(!i.offset||!i.size)return ss.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=ss.getPattern(t,void 0,i.color);if(e)return e;const n=ss.get(i.src,"anonymous",null);if(n.getImageState()!==et.LOADED)return null;const s=Jt(i.size[0],i.size[1]);return s.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Ed(s.canvas,t,void 0,et.LOADED,i.color,!0),ss.getPattern(t,void 0,i.color)}const Yb=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Nf=["style","variant","weight","size","lineHeight","family"],O0=function(i){const t=i.match(Yb);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,s=Nf.length;n<s;++n){const r=t[n+1];r!==void 0&&(e[Nf[n]]=r)}return e.families=e.family.split(/,\s?/),e},F0="10px sans-serif",ni="#000",Br="round",An=[],Ln=0,Wr="round",ea=10,ia="#000",na="center",Nl="middle",Is=[0,0,0,0],sa=1,Vn=new Vs;let gr=null,au;const lu={},Hb=function(){const i="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10";let s,r;function o(l,h,c){let u=!0;for(let g=0;g<e;++g){const f=t[g];if(r=kl(l+" "+h+" "+i+f,n),c!=f){const p=kl(l+" "+h+" "+i+c+","+f,n);u=u&&p!=r}}return!!u}function a(){let l=!0;const h=Vn.getKeys();for(let c=0,u=h.length;c<u;++c){const g=h[c];Vn.get(g)<100&&(o.apply(this,g.split(`
`))?(Kr(lu),gr=null,au=void 0,Vn.set(g,100)):(Vn.set(g,Vn.get(g)+1,!0),l=!1))}l&&(clearInterval(s),s=void 0)}return function(l){const h=O0(l);if(!h)return;const c=h.families;for(let u=0,g=c.length;u<g;++u){const f=c[u],p=h.style+`
`+h.weight+`
`+f;Vn.get(p)===void 0&&(Vn.set(p,100,!0),o(h.style,h.weight,f)||(Vn.set(p,0,!0),s===void 0&&(s=setInterval(a,32))))}}}(),Kb=function(){let i;return function(t){let e=lu[t];if(e==null){if(P0){const n=O0(t),s=N0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);lu[t]=e}return e}}();function N0(i,t){return gr||(gr=Jt(1,1)),i!=au&&(gr.font=i,au=gr.font),gr.measureText(t)}function kl(i,t){return N0(i,t).width}function kf(i,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((s,r)=>Math.max(s,kl(i,r)),0);return e[t]=n,n}function Qb(i,t){const e=[],n=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l;continue}const g=t[h+1]||i.font,f=kl(g,u);e.push(f),o+=f;const p=Kb(g);n.push(p),l=Math.max(l,p)}return{width:r,height:a,widths:e,heights:n,lineWidths:s}}function Jb(i,t,e,n,s,r,o,a,l,h,c){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),tE(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,s,r,o,a,0,0,o,a)):i.drawImage(n,s,r,o,a,l,h,o*c[0],a*c[1]),i.restore()}function tE(i,t){const e=i.contextInstructions;for(let n=0,s=e.length;n<s;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Ch extends Mh{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?et.LOADING:et.LOADED,this.imageState_===et.LOADING&&this.ready().then(()=>this.imageState_=et.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ch({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,s=Jt(n.size*t,n.size*t);this.draw_(n,s,t),e=s.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const S=s;s=r,r=S}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),g=u/l;if(t==="miter"&&g<=n)return g*e;const f=e/2/g,p=e/2*(c/u),_=Math.sqrt((s+f)*(s+f)+p*p)-s;if(this.radius2_===void 0||t==="bevel")return _*2;const x=s*Math.sin(a),v=Math.sqrt(s*s-x*x),w=r-v,E=Math.sqrt(x*x+w*w)/x;if(E<=n){const S=E*e/2-r-s;return 2*Math.max(_,S)}return _*2}createRenderOptions(){let t=Br,e=Wr,n=0,s=null,r=0,o,a=0;this.stroke_&&(o=nn(this.stroke_.getColor()??ia),a=this.stroke_.getWidth()??sa,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Wr,t=this.stroke_.getLineCap()??Br,n=this.stroke_.getMiterLimit()??ea);const l=this.calculateLineJoinSize_(e,a,n),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=ni),e.fillStyle=nn(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=Wi(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(e=Jt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2===0?n:s;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=ni,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ih extends Ch{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Ih({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class Ph{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Df,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Ph({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Df,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function eE(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(At(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let _c=null;function iE(i,t){if(!_c){const e=new qi({color:"rgba(255,255,255,0.4)"}),n=new cn({color:"#3399CC",width:1.25});_c=[new Ph({image:new Ih({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return _c}function Df(i){return i.getGeometry()}const Ve=Ph,nE="#333";class Bs{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=se(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new qi({color:nE}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Bs({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=se(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Bn=["http://www.google.com/kml/ext/2.2"],lt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],sE="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",Gf={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},rE=X(lt,{ExtendedData:H0,Region:K0,MultiGeometry:O($0,"geometry"),LineString:O(X0,"geometry"),LinearRing:O(Z0,"geometry"),Point:O(V0,"geometry"),Polygon:O(Y0,"geometry"),Style:O(Cd),StyleMap:BE,address:O($),description:O($),name:O($),open:O(gs),phoneNumber:O($),styleUrl:O(z0),visibility:O(gs)},X(Bn,{MultiTrack:O(IE,"geometry"),Track:O(q0,"geometry")})),oE=X(lt,{ExtendedData:H0,Region:K0,Link:tS,address:O($),description:O($),name:O($),open:O(gs),phoneNumber:O($),visibility:O(gs)}),aE=X(lt,{href:O(j0)}),lE=X(lt,{Altitude:O(Pt),Longitude:O(Pt),Latitude:O(Pt),Tilt:O(Pt),AltitudeMode:O($),Heading:O(Pt),Roll:O(Pt)}),k0=X(lt,{LatLonAltBox:$E,Lod:YE}),hE=X(lt,["Document","Placemark"]),cE=X(lt,{Document:F(lS),Placemark:F(t_)});let Ar,_l=null,hu,Do,Go,jo,Dl,cu=null,Md,uu=null,du,Ps=null,jf=null,gu=null;function Gl(i){return 32/Math.min(i[0],i[1])}function uE(){Ar=[255,255,255,1],_l=new qi({color:Ar}),hu=[20,2],Do="pixels",Go="pixels",jo=[64,64],Dl="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",cu=new Rh({anchor:hu,anchorOrigin:"bottom-left",anchorXUnits:Do,anchorYUnits:Go,crossOrigin:"anonymous",rotation:0,scale:Gl(jo),size:jo,src:Dl}),Md="NO_IMAGE",uu=new cn({color:Ar,width:1}),du=new cn({color:[51,51,51,1],width:2}),Ps=new Bs({font:"bold 16px Helvetica",fill:_l,stroke:du,scale:.8}),jf=new Ve({fill:_l,image:cu,text:Ps,stroke:uu,zIndex:0}),gu=[jf]}let tl;function dE(i){return i}class gE extends Pa{constructor(t){super(),t=t||{},gu||uE(),this.dataProjection=tt("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:gu,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:dE,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const n=X(lt,{Document:Ol(this.readDocumentOrFolder_,this),Folder:Ol(this.readDocumentOrFolder_,this),Placemark:ot(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),s=Z([],n,t,e,this);if(s)return s}readPlacemark_(t,e){const n=Z({geometry:null},rE,t,e,this);if(!n)return;const s=new Ee,r=t.getAttribute("id");r!==null&&s.setId(r);const o=e[0],a=n.geometry;if(a&&re(a,!1,o),s.setGeometry(a),delete n.geometry,this.extractStyles_){const l=n.Style,h=n.styleUrl,c=pE(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);s.setStyle(c)}return delete n.Style,s.setProperties(n,!0),s}readSharedStyle_(t,e){const n=t.getAttribute("id");if(n!==null){const s=Cd.call(this,t,e);if(s){let r,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?r=new URL("#"+n,o).href:r="#"+n,this.sharedStyles_[r]=s}}}readSharedStyleMap_(t,e){const n=t.getAttribute("id");if(n===null)return;const s=B0.call(this,t,e);if(!s)return;let r,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?r=new URL("#"+n,o).href:r="#"+n,this.sharedStyles_[r]=s}readFeatureFromNode(t,e){return lt.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!lt.includes(t.namespaceURI))return[];let n;const s=t.localName;if(s=="Document"||s=="Folder")return n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),n||[];if(s=="Placemark"){const r=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return r?[r]:[]}if(s=="kml"){n=[];for(let r=t.firstElementChild;r;r=r.nextElementSibling){const o=this.readFeaturesFromNode(r,e);o&&Ot(n,o)}return n}return[]}readName(t){if(t){if(typeof t=="string"){const e=Ci(t);return this.readNameFromDocument(e)}return Ri(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const n=this.readNameFromNode(e);if(n)return n}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(lt.includes(e.namespaceURI)&&e.localName=="name")return $(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const n=e.localName;if(lt.includes(e.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){const s=this.readNameFromNode(e);if(s)return s}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const n=Ci(t);Ot(e,this.readNetworkLinksFromDocument(n))}else Ri(t)?Ot(e,this.readNetworkLinksFromDocument(t)):Ot(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readNetworkLinksFromNode(n));return e}readNetworkLinksFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="NetworkLink"){const s=Z({},oE,n,[]);e.push(s)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;lt.includes(n.namespaceURI)&&(s=="Document"||s=="Folder"||s=="kml")&&Ot(e,this.readNetworkLinksFromNode(n))}return e}readRegion(t){const e=[];if(typeof t=="string"){const n=Ci(t);Ot(e,this.readRegionFromDocument(n))}else Ri(t)?Ot(e,this.readRegionFromDocument(t)):Ot(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Ot(e,this.readRegionFromNode(n));return e}readRegionFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName=="Region"){const s=Z({},k0,n,[]);e.push(s)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;lt.includes(n.namespaceURI)&&(s=="Document"||s=="Folder"||s=="kml")&&Ot(e,this.readRegionFromNode(n))}return e}readCamera(t){const e=[];if(typeof t=="string"){const n=Ci(t);Ot(e,this.readCameraFromDocument(n))}else Ri(t)?Ot(e,this.readCameraFromDocument(t)):Ot(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&Ot(e,this.readCameraFromNode(n));return e}readCameraFromNode(t){const e=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling)if(lt.includes(n.namespaceURI)&&n.localName==="Camera"){const s=Z({},lE,n,[]);e.push(s)}for(let n=t.firstElementChild;n;n=n.nextElementSibling){const s=n.localName;lt.includes(n.namespaceURI)&&(s==="Document"||s==="Folder"||s==="Placemark"||s==="kml")&&Ot(e,this.readCameraFromNode(n))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=mt(lt[4],"kml"),s="http://www.w3.org/2000/xmlns/";n.setAttributeNS(s,"xmlns:gx",Bn[0]),n.setAttributeNS(s,"xmlns:xsi",js),n.setAttributeNS(js,"xsi:schemaLocation",sE);const r={node:n},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);const a=hE[n.namespaceURI],l=ui(o,a);return pt(r,cE,Ie,l,[e],a,this),n}}function fE(i,t){const e=[0,0];let n="start";const s=i.getImage();if(s){const o=s.getSize();if(o&&o.length==2){const a=s.getScaleArray(),l=s.getAnchor();e[0]=a[0]*(o[0]-l[0]),e[1]=a[1]*(o[1]/2-l[1]),n="left"}}let r=i.getText();return r?(r=r.clone(),r.setFont(r.getFont()||Ps.getFont()),r.setScale(r.getScale()||Ps.getScale()),r.setFill(r.getFill()||Ps.getFill()),r.setStroke(r.getStroke()||du)):r=Ps.clone(),r.setText(t),r.setOffsetX(e[0]),r.setOffsetY(e[1]),r.setTextAlign(n),new Ve({image:s,text:r})}function pE(i,t,e,n,s){return function(r,o){let a=s,l="",h=[];if(a){const u=r.getGeometry();if(u)if(u instanceof je)h=u.getGeometriesArrayRecursive().filter(function(g){const f=g.getType();return f==="Point"||f==="MultiPoint"}),a=h.length>0;else{const g=u.getType();a=g==="Point"||g==="MultiPoint"}}a&&(l=r.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(tl||(tl=document.createElement("textarea")),tl.innerHTML=l,l=tl.value));let c=e;if(i?c=i:t&&(c=D0(t,e,n)),a){const u=fE(c[0],l);if(h.length>0){u.setGeometry(new je(h));const g=new Ve({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,g].concat(c.slice(1))}return u}return c}}function D0(i,t,e){return Array.isArray(i)?i:typeof i=="string"?D0(e[i],t,e):t}function Ah(i){const t=Ye(i,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const n=e[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function G0(i){let t=Ye(i,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let s;for(;s=n.exec(t);){const r=parseFloat(s[1]),o=parseFloat(s[2]),a=s[3]?parseFloat(s[3]):0;e.push(r,o,a),t=t.substr(s[0].length)}if(t==="")return e}function j0(i){const t=Ye(i,!1).trim();let e=i.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function z0(i){const t=Ye(i,!1).trim().replace(/^(?!.*#)/,"#");let e=i.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function mE(i){const t=i.getAttribute("xunits"),e=i.getAttribute("yunits");let n;return t!=="insetPixels"?e!=="insetPixels"?n="bottom-left":n="top-left":e!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(i.getAttribute("x")),xunits:Gf[t],y:parseFloat(i.getAttribute("y")),yunits:Gf[e],origin:n}}function U0(i){return Pt(i)}const _E=X(lt,{Pair:UE});function B0(i,t){return Z(void 0,_E,i,t,this)}const yE=X(lt,{Icon:O(LE),color:O(Ah),heading:O(Pt),hotSpot:O(mE),scale:O(U0)});function xE(i,t){const e=Z({},yE,i,t);if(!e)return;const n=t[t.length-1],s="Icon"in e?e.Icon:{},r=!("Icon"in e)||Object.keys(s).length>0;let o;const a=s.href;a?o=a:r&&(o=Dl);let l,h,c,u="bottom-left";const g=e.hotSpot;g?(l=[g.x,g.y],h=g.xunits,c=g.yunits,u=g.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=hu,h=Do,c=Go):o.includes("arrow-reverse")?(l=[54,42],h=Do,c=Go):o.includes("paddle")&&(l=[32,1],h=Do,c=Go));let f;const p=s.x,_=s.y;p!==void 0&&_!==void 0&&(f=[p,_]);let x;const v=s.w,w=s.h;v!==void 0&&w!==void 0&&(x=[v,w]);let E;const S=e.heading;S!==void 0&&(E=ko(S));const T=e.scale,R=e.color;if(r){o==Dl&&(x=jo);const C=new Rh({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:f,offsetOrigin:"bottom-left",rotation:E,scale:T,size:x,src:this.iconUrlFunction_(o),color:R}),P=C.getScaleArray()[0],N=C.getSize();if(N===null){const U=C.getImageState();if(U===et.IDLE||U===et.LOADING){const j=function(){const B=C.getImageState();if(!(B===et.IDLE||B===et.LOADING)){const d=C.getSize();if(d&&d.length==2){const m=Gl(d);C.setScale(P*m)}C.unlistenImageChange(j)}};C.listenImageChange(j),U===et.IDLE&&C.load()}}else if(N.length==2){const U=Gl(N);C.setScale(P*U)}n.imageStyle=C}else n.imageStyle=Md}const vE=X(lt,{color:O(Ah),scale:O(U0)});function wE(i,t){const e=Z({},vE,i,t);if(!e)return;const n=t[t.length-1],s=new Bs({fill:new qi({color:"color"in e?e.color:Ar}),scale:e.scale});n.textStyle=s}const bE=X(lt,{color:O(Ah),width:O(Pt)});function EE(i,t){const e=Z({},bE,i,t);if(!e)return;const n=t[t.length-1],s=new cn({color:"color"in e?e.color:Ar,width:"width"in e?e.width:1});n.strokeStyle=s}const SE=X(lt,{color:O(Ah),fill:O(gs),outline:O(gs)});function TE(i,t){const e=Z({},SE,i,t);if(!e)return;const n=t[t.length-1],s=new qi({color:"color"in e?e.color:Ar});n.fillStyle=s;const r=e.fill;r!==void 0&&(n.fill=r);const o=e.outline;o!==void 0&&(n.outline=o)}const ME=X(lt,{coordinates:ht(G0)});function W0(i,t){return Z(null,ME,i,t)}function RE(i,t){const e=t[t.length-1].coordinates,n=Ye(i,!1),s=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(s){const r=parseFloat(s[1]),o=parseFloat(s[2]),a=parseFloat(s[3]);e.push([r,o,a])}else e.push([])}const CE=X(Bn,{Track:ot(q0)});function IE(i,t){const e=Z([],CE,i,t);if(e)return new ci(e)}const PE=X(lt,{when:eS},X(Bn,{coord:RE}));function q0(i,t){const e=Z({coordinates:[],whens:[]},PE,i,t);if(!e)return;const n=[],s=e.coordinates,r=e.whens;for(let o=0,a=Math.min(s.length,r.length);o<a;++o)s[o].length==3&&n.push(s[o][0],s[o][1],s[o][2],r[o]);return new ye(n,"XYZM")}const AE=X(lt,{href:O(j0)},X(Bn,{x:O(Pt),y:O(Pt),w:O(Pt),h:O(Pt)}));function LE(i,t){return Z({},AE,i,t)||null}const OE=X(lt,{coordinates:ht(G0)});function Rd(i,t){return Z(null,OE,i,t)}const Lh=X(lt,{extrude:O(gs),tessellate:O(gs),altitudeMode:O($)});function X0(i,t){const e=Z({},Lh,i,t),n=Rd(i,t);if(n){const s=new ye(n,"XYZ");return s.setProperties(e,!0),s}}function Z0(i,t){const e=Z({},Lh,i,t),n=Rd(i,t);if(n){const s=new Ue(n,"XYZ",[n.length]);return s.setProperties(e,!0),s}}const FE=X(lt,{LineString:ot(X0),LinearRing:ot(Z0),MultiGeometry:ot($0),Point:ot(V0),Polygon:ot(Y0)});function $0(i,t){const e=Z([],FE,i,t);if(!e)return null;if(e.length===0)return new je(e);let n,s=!0;const r=e[0].getType();let o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=r){s=!1;break}if(s){let a,l;if(r=="Point"){const h=e[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=e.length;c<u;++c)o=e[c],Ot(l,o.getFlatCoordinates());n=new Zi(l,a),yc(n,e)}else if(r=="LineString")n=new ci(e),yc(n,e);else if(r=="Polygon")n=new Pi(e),yc(n,e);else if(r=="GeometryCollection")n=new je(e);else throw new Error("Unknown geometry type found")}else n=new je(e);return n}function V0(i,t){const e=Z({},Lh,i,t),n=Rd(i,t);if(n){const s=new Re(n,"XYZ");return s.setProperties(e,!0),s}}const NE=X(lt,{innerBoundaryIs:KE,outerBoundaryIs:JE});function Y0(i,t){const e=Z({},Lh,i,t),n=Z([null],NE,i,t);if(n&&n[0]){const s=n[0],r=[s.length];for(let a=1,l=n.length;a<l;++a)Ot(s,n[a]),r.push(s.length);const o=new Ue(s,"XYZ",r);return o.setProperties(e,!0),o}}const kE=X(lt,{IconStyle:xE,LabelStyle:wE,LineStyle:EE,PolyStyle:TE});function Cd(i,t){const e=Z({},kE,i,t,this);if(!e)return null;let n="fillStyle"in e?e.fillStyle:_l;const s=e.fill;s!==void 0&&!s&&(n=null);let r;"imageStyle"in e?e.imageStyle!=Md&&(r=e.imageStyle):r=cu;const o="textStyle"in e?e.textStyle:Ps,a="strokeStyle"in e?e.strokeStyle:uu,l=e.outline;return l!==void 0&&!l?[new Ve({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const g=c;return new je(g.getGeometriesArrayRecursive().filter(function(f){const p=f.getType();return p!=="Polygon"&&p!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:n,image:r,stroke:a,text:o,zIndex:void 0}),new Ve({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const g=c;return new je(g.getGeometriesArrayRecursive().filter(function(f){const p=f.getType();return p==="Polygon"||p==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:n,stroke:null,zIndex:void 0})]:[new Ve({fill:n,image:r,stroke:a,text:o,zIndex:void 0})]}function yc(i,t){const e=t.length,n=new Array(t.length),s=new Array(t.length),r=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<e;++h){const c=t[h];n[h]=c.get("extrude"),s[h]=c.get("tessellate"),r[h]=c.get("altitudeMode"),o=o||n[h]!==void 0,a=a||s[h]!==void 0,l=l||r[h]}o&&i.set("extrude",n),a&&i.set("tessellate",s),l&&i.set("altitudeMode",r)}const DE=X(lt,{displayName:O($),value:O($)});function GE(i,t){const e=i.getAttribute("name");li(DE,i,t);const n=t[t.length-1];e&&n.displayName?n[e]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:e!==null?n[e]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}const jE=X(lt,{Data:GE,SchemaData:qE});function H0(i,t){li(jE,i,t)}function K0(i,t){li(k0,i,t)}const zE=X(lt,{Style:O(Cd),key:O($),styleUrl:O(z0)});function UE(i,t){const e=Z({},zE,i,t,this);if(!e)return;const n=e.key;if(n&&n=="normal"){const s=e.styleUrl;s&&(t[t.length-1]=s);const r=e.Style;r&&(t[t.length-1]=r)}}function BE(i,t){const e=B0.call(this,i,t);if(!e)return;const n=t[t.length-1];if(Array.isArray(e))n.Style=e;else if(typeof e=="string")n.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const WE=X(lt,{SimpleData:XE});function qE(i,t){li(WE,i,t)}function XE(i,t){const e=i.getAttribute("name");if(e!==null){const n=$(i),s=t[t.length-1];s[e]=n}}const ZE=X(lt,{altitudeMode:O($),minAltitude:O(Pt),maxAltitude:O(Pt),north:O(Pt),south:O(Pt),east:O(Pt),west:O(Pt)});function $E(i,t){const e=Z({},ZE,i,t);if(!e)return;const n=t[t.length-1],s=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];n.extent=s,n.altitudeMode=e.altitudeMode,n.minAltitude=parseFloat(e.minAltitude),n.maxAltitude=parseFloat(e.maxAltitude)}const VE=X(lt,{minLodPixels:O(Pt),maxLodPixels:O(Pt),minFadeExtent:O(Pt),maxFadeExtent:O(Pt)});function YE(i,t){const e=Z({},VE,i,t);if(!e)return;const n=t[t.length-1];n.minLodPixels=parseFloat(e.minLodPixels),n.maxLodPixels=parseFloat(e.maxLodPixels),n.minFadeExtent=parseFloat(e.minFadeExtent),n.maxFadeExtent=parseFloat(e.maxFadeExtent)}const HE=X(lt,{LinearRing:ot(W0)});function KE(i,t){const e=Z([],HE,i,t);e.length>0&&t[t.length-1].push(...e)}const QE=X(lt,{LinearRing:ht(W0)});function JE(i,t){const e=Z(void 0,QE,i,t);if(e){const n=t[t.length-1];n[0]=e}}function tS(i,t){li(aE,i,t)}function eS(i,t){const e=t[t.length-1].whens,n=Ye(i,!1),s=Date.parse(n);e.push(isNaN(s)?0:s)}function Oh(i,t){const e=Wi(t),n=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let s=0;s<4;++s){const r=Math.floor(n[s]).toString(16);n[s]=r.length==1?"0"+r:r}ft(i,n.join(""))}function iS(i,t,e){const n=e[e.length-1],s=n.layout,r=n.stride;let o;if(s=="XY"||s=="XYM")o=2;else if(s=="XYZ"||s=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=r;h<a;h+=r){l+=" "+t[h];for(let c=1;c<o;++c)l+=","+t[h+c]}}ft(i,l)}const yl=X(lt,{Data:F(nS),value:F(rS),displayName:F(sS)});function nS(i,t,e){i.setAttribute("name",t.name);const n={node:i},s=t.value;typeof s=="object"?(s!==null&&s.displayName&&pt(n,yl,Ie,[s.displayName],e,["displayName"]),s!==null&&s.value&&pt(n,yl,Ie,[s.value],e,["value"])):pt(n,yl,Ie,[s],e,["value"])}function sS(i,t){Rw(i,t)}function rS(i,t){ft(i,t)}const oS=X(lt,{Placemark:F(t_)}),aS=function(i,t,e){const n=t[t.length-1].node;return mt(n.namespaceURI,"Placemark")};function lS(i,t,e){pt({node:i},oS,aS,t,e,void 0,this)}const hS=ce("Data");function cS(i,t,e){const n={node:i},s=t.names,r=t.values,o=s.length;for(let a=0;a<o;a++)pt(n,yl,hS,[{name:s[a],value:r[a]}],e)}const zf=X(lt,["href"],X(Bn,["x","y","w","h"])),Uf=X(lt,{href:F(ft)},X(Bn,{x:F(ii),y:F(ii),w:F(ii),h:F(ii)})),uS=function(i,t,e){return mt(Bn[0],"gx:"+e)};function dS(i,t,e){const n={node:i},s=e[e.length-1].node;let r=zf[s.namespaceURI],o=ui(t,r);pt(n,Uf,Ie,o,e,r),r=zf[Bn[0]],o=ui(t,r),pt(n,Uf,uS,o,e,r)}const gS=X(lt,["scale","heading","Icon","color","hotSpot"]),fS=X(lt,{Icon:F(dS),color:F(Oh),heading:F(ii),hotSpot:F(US),scale:F(i_)});function pS(i,t,e){const n={node:i},s={},r=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:r};if(o){l.w=o[0],l.h=o[1];const x=t.getAnchor(),v=t.getOrigin();if(v&&a&&v[0]!==0&&v[1]!==o[1]&&(l.x=v[0],l.y=a[1]-(v[1]+o[1])),x&&(x[0]!==o[0]/2||x[1]!==o[1]/2)){const w={x:x[0],xunits:"pixels",y:o[1]-x[1],yunits:"pixels"};s.hotSpot=w}}s.Icon=l;let h=t.getScaleArray()[0],c=o;if(c===null&&(c=jo),c.length==2){const x=Gl(c);h=h/x}h!==1&&(s.scale=h);const u=t.getRotation();u!==0&&(s.heading=u);const g=t.getColor();g&&(s.color=g);const f=e[e.length-1].node,p=gS[f.namespaceURI],_=ui(s,p);pt(n,fS,Ie,_,e,p)}const mS=X(lt,["color","scale"]),_S=X(lt,{color:F(Oh),scale:F(i_)});function yS(i,t,e){const n={node:i},s={},r=t.getFill();r&&(s.color=r.getColor());const o=t.getScale();o&&o!==1&&(s.scale=o);const a=e[e.length-1].node,l=mS[a.namespaceURI],h=ui(s,l);pt(n,_S,Ie,h,e,l)}const xS=X(lt,["color","width"]),vS=X(lt,{color:F(Oh),width:F(ii)});function wS(i,t,e){const n={node:i},s={color:t.getColor(),width:Number(t.getWidth())||1},r=e[e.length-1].node,o=xS[r.namespaceURI],a=ui(s,o);pt(n,vS,Ie,a,e,o)}const bS={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Q0=function(i,t,e){if(i){const n=t[t.length-1].node;return mt(n.namespaceURI,bS[i.getType()])}},ES=ce("Point"),SS=ce("LineString"),TS=ce("LinearRing"),MS=ce("Polygon"),RS=X(lt,{LineString:F(Lr),Point:F(Lr),Polygon:F(e_),GeometryCollection:F(J0)});function J0(i,t,e){const n={node:i},s=t.getType();let r=[],o;if(s==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")r=r.concat(a.getPoints());else if(l==="MultiLineString")r=r.concat(a.getLineStrings());else if(l==="MultiPolygon")r=r.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")r.push(a);else throw new Error("Unknown geometry type")}),o=Q0;else if(s==="MultiPoint")r=t.getPoints(),o=ES;else if(s==="MultiLineString")r=t.getLineStrings(),o=SS;else if(s==="MultiPolygon")r=t.getPolygons(),o=MS;else throw new Error("Unknown geometry type");pt(n,RS,o,r,e)}const CS=X(lt,{LinearRing:F(Lr)});function Bf(i,t,e){pt({node:i},CS,TS,[t],e)}const xc=X(lt,{ExtendedData:F(cS),MultiGeometry:F(J0),LineString:F(Lr),LinearRing:F(Lr),Point:F(Lr),Polygon:F(e_),Style:F(zS),address:F(ft),description:F(ft),name:F(ft),open:F(Ur),phoneNumber:F(ft),styleUrl:F(ft),visibility:F(Ur)}),IS=X(lt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),PS=ce("ExtendedData");function t_(i,t,e){const n={node:i};t.getId()&&i.setAttribute("id",t.getId());const s=t.getProperties(),r={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};r[t.getGeometryName()]=1;const o=Object.keys(s||{}).sort().filter(function(f){return!r[f]}),a=t.getStyleFunction();if(a){const f=a(t,0);if(f){const p=Array.isArray(f)?f:[f];let _=p;if(t.getGeometry()&&(_=p.filter(function(x){const v=x.getGeometryFunction()(t);if(v){const w=v.getType();return w==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(E){const S=E.getType();return S==="Point"||S==="MultiPoint"}).length:w==="Point"||w==="MultiPoint"}})),this.writeStyles_){let x=p,v=p;t.getGeometry()&&(x=p.filter(function(w){const E=w.getGeometryFunction()(t);if(E){const S=E.getType();return S==="GeometryCollection"?E.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="LineString"||R==="MultiLineString"}).length:S==="LineString"||S==="MultiLineString"}}),v=p.filter(function(w){const E=w.getGeometryFunction()(t);if(E){const S=E.getType();return S==="GeometryCollection"?E.getGeometriesArrayRecursive().filter(function(T){const R=T.getType();return R==="Polygon"||R==="MultiPolygon"}).length:S==="Polygon"||S==="MultiPolygon"}})),s.Style={pointStyles:_,lineStyles:x,polyStyles:v}}if(_.length&&s.name===void 0){const x=_[0].getText();x&&(s.name=x.getText())}}}const l=e[e.length-1].node,h=IS[l.namespaceURI],c=ui(s,h);if(pt(n,xc,Ie,c,e,h),o.length>0){const f=ui(s,o);pt(n,xc,PS,[{names:o,values:f}],e)}const u=e[0];let g=t.getGeometry();g&&(g=re(g,!0,u)),pt(n,xc,Q0,[g],e)}const AS=X(lt,["extrude","tessellate","altitudeMode","coordinates"]),LS=X(lt,{extrude:F(Ur),tessellate:F(Ur),altitudeMode:F(ft),coordinates:F(iS)});function Lr(i,t,e){const n=t.getFlatCoordinates(),s={node:i};s.layout=t.getLayout(),s.stride=t.getStride();const r=t.getProperties();r.coordinates=n;const o=e[e.length-1].node,a=AS[o.namespaceURI],l=ui(r,a);pt(s,LS,Ie,l,e,a)}const OS=X(lt,["color","fill","outline"]),Wf=X(lt,{outerBoundaryIs:F(Bf),innerBoundaryIs:F(Bf)}),FS=ce("innerBoundaryIs"),NS=ce("outerBoundaryIs");function e_(i,t,e){const n=t.getLinearRings(),s=n.shift(),r={node:i};pt(r,Wf,FS,n,e),pt(r,Wf,NS,[s],e)}const kS=X(lt,{color:F(Oh),fill:F(Ur),outline:F(Ur)});function DS(i,t,e){const n={node:i},s=t.getFill(),r=t.getStroke(),o={color:s?s.getColor():void 0,fill:s?void 0:!1,outline:r?void 0:!1},a=e[e.length-1].node,l=OS[a.namespaceURI],h=ui(o,l);pt(n,kS,Ie,h,e,l)}function i_(i,t){ii(i,Math.round(t*1e6)/1e6)}const GS=X(lt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),jS=X(lt,{IconStyle:F(pS),LabelStyle:F(yS),LineStyle:F(wS),PolyStyle:F(DS)});function zS(i,t,e){const n={node:i},s={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(s.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(s.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(s.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!s.LineStyle&&(s.LineStyle=l),s.PolyStyle=t.polyStyles[0]}const r=e[e.length-1].node,o=GS[r.namespaceURI],a=ui(s,o);pt(n,jS,Ie,a,e,o)}function US(i,t){i.setAttribute("x",String(t.x)),i.setAttribute("y",String(t.y)),i.setAttribute("xunits",t.xunits),i.setAttribute("yunits",t.yunits)}const BS=gE;var Id={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Id.read=function(i,t,e,n,s){var r,o,a=s*8-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=e?s-1:0,g=e?-1:1,f=i[t+u];for(u+=g,r=f&(1<<-c)-1,f>>=-c,c+=a;c>0;r=r*256+i[t+u],u+=g,c-=8);for(o=r&(1<<-c)-1,r>>=-c,c+=n;c>0;o=o*256+i[t+u],u+=g,c-=8);if(r===0)r=1-h;else{if(r===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),r=r-h}return(f?-1:1)*o*Math.pow(2,r-n)};Id.write=function(i,t,e,n,s,r){var o,a,l,h=r*8-s-1,c=(1<<h)-1,u=c>>1,g=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:r-1,p=n?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?t+=g/l:t+=g*Math.pow(2,1-u),t*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,s),o=o+u):(a=t*Math.pow(2,u-1)*Math.pow(2,s),o=0));s>=8;i[e+f]=a&255,f+=p,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;i[e+f]=o&255,f+=p,o/=256,h-=8);i[e+f-p]|=_*128};var WS=jt,el=Id;function jt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0;jt.Fixed64=1;jt.Bytes=2;jt.Fixed32=5;var fu=65536*65536,qf=1/fu,qS=12,n_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");jt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),s=n>>3,r=this.pos;this.type=n&7,i(s,t,this),this.pos===r&&this.skip(n)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=il(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Zf(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=il(this.buf,this.pos)+il(this.buf,this.pos+4)*fu;return this.pos+=8,i},readSFixed64:function(){var i=il(this.buf,this.pos)+Zf(this.buf,this.pos+4)*fu;return this.pos+=8,i},readFloat:function(){var i=el.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=el.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t=this.buf,e,n;return n=t[this.pos++],e=n&127,n<128||(n=t[this.pos++],e|=(n&127)<<7,n<128)||(n=t[this.pos++],e|=(n&127)<<14,n<128)||(n=t[this.pos++],e|=(n&127)<<21,n<128)?e:(n=t[this.pos],e|=(n&15)<<28,XS(e,i,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2===1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=qS&&n_?o2(this.buf,t,i):r2(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==jt.Bytes)return i.push(this.readVarint(t));var e=xn(this);for(i=i||[];this.pos<e;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==jt.Bytes)return i.push(this.readSVarint());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==jt.Bytes)return i.push(this.readBoolean());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==jt.Bytes)return i.push(this.readFloat());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==jt.Bytes)return i.push(this.readDouble());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed32());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed32());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed64());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed64());var t=xn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=i&7;if(t===jt.Varint)for(;this.buf[this.pos++]>127;);else if(t===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jt.Fixed32)this.pos+=4;else if(t===jt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),nr(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),nr(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),nr(this.buf,i&-1,this.pos),nr(this.buf,Math.floor(i*qf),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),nr(this.buf,i&-1,this.pos),nr(this.buf,Math.floor(i*qf),this.pos+4),this.pos+=8},writeVarint:function(i){if(i=+i||0,i>268435455||i<0){$S(i,this);return}this.realloc(4),this.buf[this.pos++]=i&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=(i>>>=7)&127|(i>127?128:0),!(i<=127)&&(this.buf[this.pos++]=i>>>7&127)))},writeSVarint:function(i){this.writeVarint(i<0?-i*2-1:i*2)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(i.length*4),this.pos++;var t=this.pos;this.pos=a2(this.buf,i,this.pos);var e=this.pos-t;e>=128&&Xf(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(i){this.realloc(4),el.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),el.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=i[e]},writeRawMessage:function(i,t){this.pos++;var e=this.pos;i(t,this);var n=this.pos-e;n>=128&&Xf(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,t,e){this.writeTag(i,jt.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,HS,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,KS,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,t2,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,QS,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,JS,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,e2,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,i2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,n2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,s2,t)},writeBytesField:function(i,t){this.writeTag(i,jt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,jt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,jt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,jt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,jt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,jt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,jt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,jt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,jt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,jt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};function XS(i,t,e){var n=e.buf,s,r;if(r=n[e.pos++],s=(r&112)>>4,r<128||(r=n[e.pos++],s|=(r&127)<<3,r<128)||(r=n[e.pos++],s|=(r&127)<<10,r<128)||(r=n[e.pos++],s|=(r&127)<<17,r<128)||(r=n[e.pos++],s|=(r&127)<<24,r<128)||(r=n[e.pos++],s|=(r&1)<<31,r<128))return ZS(i,s,t);throw new Error("Expected varint not more than 10 bytes")}function xn(i){return i.type===jt.Bytes?i.readVarint()+i.pos:i.pos+1}function ZS(i,t,e){return e?t*4294967296+(i>>>0):(t>>>0)*4294967296+(i>>>0)}function $S(i,t){var e,n;if(i>=0?(e=i%4294967296|0,n=i/4294967296|0):(e=~(-i%4294967296),n=~(-i/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),VS(e,n,t),YS(n,t)}function VS(i,t,e){e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos]=i&127}function YS(i,t){var e=(i&7)<<4;t.buf[t.pos++]|=e|((i>>>=3)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127)))))}function Xf(i,t,e){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(n);for(var s=e.pos-1;s>=i;s--)e.buf[s+n]=e.buf[s]}function HS(i,t){for(var e=0;e<i.length;e++)t.writeVarint(i[e])}function KS(i,t){for(var e=0;e<i.length;e++)t.writeSVarint(i[e])}function QS(i,t){for(var e=0;e<i.length;e++)t.writeFloat(i[e])}function JS(i,t){for(var e=0;e<i.length;e++)t.writeDouble(i[e])}function t2(i,t){for(var e=0;e<i.length;e++)t.writeBoolean(i[e])}function e2(i,t){for(var e=0;e<i.length;e++)t.writeFixed32(i[e])}function i2(i,t){for(var e=0;e<i.length;e++)t.writeSFixed32(i[e])}function n2(i,t){for(var e=0;e<i.length;e++)t.writeFixed64(i[e])}function s2(i,t){for(var e=0;e<i.length;e++)t.writeSFixed64(i[e])}function il(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+i[t+3]*16777216}function nr(i,t,e){i[e]=t,i[e+1]=t>>>8,i[e+2]=t>>>16,i[e+3]=t>>>24}function Zf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function r2(i,t,e){for(var n="",s=t;s<e;){var r=i[s],o=null,a=r>239?4:r>223?3:r>191?2:1;if(s+a>e)break;var l,h,c;a===1?r<128&&(o=r):a===2?(l=i[s+1],(l&192)===128&&(o=(r&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=i[s+1],h=i[s+2],(l&192)===128&&(h&192)===128&&(o=(r&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=i[s+1],h=i[s+2],c=i[s+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(r&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),s+=a}return n}function o2(i,t,e){return n_.decode(i.subarray(t,e))}function a2(i,t,e){for(var n=0,s,r;n<t.length;n++){if(s=t.charCodeAt(n),s>55295&&s<57344)if(r)if(s<56320){i[e++]=239,i[e++]=191,i[e++]=189,r=s;continue}else s=r-55296<<10|s-56320|65536,r=null;else{s>56319||n+1===t.length?(i[e++]=239,i[e++]=191,i[e++]=189):r=s;continue}else r&&(i[e++]=239,i[e++]=191,i[e++]=189,r=null);s<128?i[e++]=s:(s<2048?i[e++]=s>>6|192:(s<65536?i[e++]=s>>12|224:(i[e++]=s>>18|240,i[e++]=s>>12&63|128),i[e++]=s>>6&63|128),i[e++]=s&63|128)}return e}const l2=eo(WS);class h2 extends Ca{constructor(t){super(),t=t||{},this.dataProjection=new jr({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Ge,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,n,s){t.pos=e.geometry;const r=t.readVarint()+t.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;t.pos<r;){if(!a){const g=t.readVarint();o=g&7,a=g>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&c>u&&(s.push(c),u=c),n.push(l,h),c+=2;else if(o===7)c>u&&(n.push(n[u],n[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(s.push(c),u=c)}createFeature_(t,e,n){const s=e.type;if(s===0)return null;let r;const o=e.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const c=f2(s,h.length);if(this.featureClass_===Ge)r=new this.featureClass_(c,l,h,2,o,a),r.transform(n.dataProjection);else{let u;if(c=="Polygon"){const p=y0(l,h);u=p.length>1?new Pi(l,"XY",p):new Ue(l,"XY",h)}else u=c==="Point"?new Re(l,"XY"):c==="LineString"?new ye(l,"XY"):c==="MultiPoint"?new Zi(l,"XY"):c==="MultiLineString"?new ci(l,"XY",h):null;const g=this.featureClass_;r=new g,this.geometryName_&&r.setGeometryName(this.geometryName_);const f=re(u,!1,n);r.setGeometry(f),a!==void 0&&r.setId(a),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(t,e){const n=this.layers_;e=this.adaptOptions(e);const s=tt(e.dataProjection);s.setWorldExtent(e.extent),e.dataProjection=s;const r=new l2(t),o=r.readFields(c2,{}),a=[];for(const l in o){if(n&&!n.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;s.setExtent(c);for(let u=0,g=h.length;u<g;++u){const f=g2(r,h,u),p=this.createFeature_(r,f,e);p!==null&&a.push(p)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function c2(i,t,e){if(i===3){const n={keys:[],values:[],features:[]},s=e.readVarint()+e.pos;e.readFields(u2,n,s),n.length=n.features.length,n.length&&(t[n.name]=n)}}function u2(i,t,e){if(i===15)t.version=e.readVarint();else if(i===1)t.name=e.readString();else if(i===5)t.extent=e.readVarint();else if(i===2)t.features.push(e.pos);else if(i===3)t.keys.push(e.readString());else if(i===4){let n=null;const s=e.readVarint()+e.pos;for(;e.pos<s;)i=e.readVarint()>>3,n=i===1?e.readString():i===2?e.readFloat():i===3?e.readDouble():i===4?e.readVarint64():i===5?e.readVarint():i===6?e.readSVarint():i===7?e.readBoolean():null;t.values.push(n)}}function d2(i,t,e){if(i==1)t.id=e.readVarint();else if(i==2){const n=e.readVarint()+e.pos;for(;e.pos<n;){const s=t.layer.keys[e.readVarint()],r=t.layer.values[e.readVarint()];t.properties[s]=r}}else i==3?t.type=e.readVarint():i==4&&(t.geometry=e.pos)}function g2(i,t,e){i.pos=t.features[e];const n=i.readVarint()+i.pos,s={layer:t,type:0,properties:{}};return i.readFields(d2,s,n),s}function f2(i,t){let e;return i===1?e=t===1?"Point":"MultiPoint":i===2?e=t===1?"LineString":"MultiLineString":i===3&&(e="Polygon"),e}const s_=h2;class Pd{read(t){if(!t)return null;if(typeof t=="string"){const e=Ci(t);return this.readFromDocument(e)}return Ri(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){ct()}}const p2="http://www.w3.org/1999/xlink";function io(i){return i.getAttributeNS(p2,"href")}const di=[null,"http://www.opengis.net/ows/1.1"],m2=X(di,{ServiceIdentification:O(U2),ServiceProvider:O(W2),OperationsMetadata:O(j2)});class _2 extends Pd{constructor(){super()}readFromNode(t){return Z({},m2,t,[])||null}}const y2=X(di,{DeliveryPoint:O($),City:O($),AdministrativeArea:O($),PostalCode:O($),Country:O($),ElectronicMailAddress:O($)}),x2=X(di,{Value:Kt(q2)}),v2=X(di,{AllowedValues:O(L2)}),w2=X(di,{Phone:O(z2),Address:O(A2)}),b2=X(di,{HTTP:O(D2)}),E2=X(di,{Get:Kt(k2),Post:void 0}),S2=X(di,{DCP:O(N2)}),T2=X(di,{Operation:G2}),M2=X(di,{Voice:O($),Facsimile:O($)}),R2=X(di,{Constraint:Kt(O2)}),C2=X(di,{IndividualName:O($),PositionName:O($),ContactInfo:O(F2)}),I2=X(di,{Abstract:O($),AccessConstraints:O($),Fees:O($),Title:O($),ServiceTypeVersion:O($),ServiceType:O($)}),P2=X(di,{ProviderName:O($),ProviderSite:O(io),ServiceContact:O(B2)});function A2(i,t){return Z({},y2,i,t)}function L2(i,t){return Z({},x2,i,t)}function O2(i,t){const e=i.getAttribute("name");if(e)return Z({name:e},v2,i,t)}function F2(i,t){return Z({},w2,i,t)}function N2(i,t){return Z({},b2,i,t)}function k2(i,t){const e=io(i);if(e)return Z({href:e},R2,i,t)}function D2(i,t){return Z({},E2,i,t)}function G2(i,t){const e=i.getAttribute("name"),n=Z({},S2,i,t);if(!n)return;const s=t[t.length-1];s[e]=n}function j2(i,t){return Z({},T2,i,t)}function z2(i,t){return Z({},M2,i,t)}function U2(i,t){return Z({},I2,i,t)}function B2(i,t){return Z({},C2,i,t)}function W2(i,t){return Z({},P2,i,t)}function q2(i,t){return $(i)}const r_=_2;function $f(i,t,e,n,s,r){s!==void 0?(s=s,r=r!==void 0?r:0):(s=[],r=0);let o=t;for(;o<e;){const a=i[o++];s[r++]=i[o++],s[r++]=a;for(let l=2;l<n;++l)s[r++]=i[o++]}return s.length=r,s}class X2 extends yd{constructor(t){super(),t=t||{},this.dataProjection=tt("EPSG:4326"),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY"}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e);return new Ee(n)}readFeaturesFromText(t,e){return[this.readFeatureFromText(t,e)]}readGeometryFromText(t,e){const n=eu(this.geometryLayout_),s=$2(t,n,this.factor_);$f(s,0,s.length,n,s);const r=Rn(s,0,s.length,n),o=new ye(r,this.geometryLayout_);return re(o,!1,this.adaptOptions(e))}writeFeatureText(t,e){const n=t.getGeometry();if(n)return this.writeGeometryText(n,e);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(t,e){return this.writeFeatureText(t[0],e)}writeGeometryText(t,e){t=re(t,!0,this.adaptOptions(e));const n=t.getFlatCoordinates(),s=t.getStride();return $f(n,0,n.length,s,n),Z2(n,s,this.factor_)}}function Z2(i,t,e){e=e||1e5;let n;const s=new Array(t);for(n=0;n<t;++n)s[n]=0;for(let r=0,o=i.length;r<o;)for(n=0;n<t;++n,++r){const a=i[r],l=a-s[n];s[n]=a,i[r]=l}return V2(i,e)}function $2(i,t,e){e=e||1e5;let n;const s=new Array(t);for(n=0;n<t;++n)s[n]=0;const r=Y2(i,e);for(let o=0,a=r.length;o<a;)for(n=0;n<t;++n,++o)s[n]+=r[o],r[o]=s[n];return r}function V2(i,t){t=t||1e5;for(let e=0,n=i.length;e<n;++e)i[e]=Math.round(i[e]*t);return H2(i)}function Y2(i,t){t=t||1e5;const e=K2(i);for(let n=0,s=e.length;n<s;++n)e[n]/=t;return e}function H2(i){for(let t=0,e=i.length;t<e;++t){const n=i[t];i[t]=n<0?~(n<<1):n<<1}return Q2(i)}function K2(i){const t=J2(i);for(let e=0,n=t.length;e<n;++e){const s=t[e];t[e]=s&1?~(s>>1):s>>1}return t}function Q2(i){let t="";for(let e=0,n=i.length;e<n;++e)t+=tT(i[e]);return t}function J2(i){const t=[];let e=0,n=0;for(let s=0,r=i.length;s<r;++s){const o=i.charCodeAt(s)-63;e|=(o&31)<<n,o<32?(t.push(e),e=0,n=0):n+=5}return t}function tT(i){let t,e="";for(;i>=32;)t=(32|i&31)+63,e+=String.fromCharCode(t),i>>=5;return t=i+63,e+=String.fromCharCode(t),e}const eT=X2;class iT extends ud{constructor(t){super(),t=t||{},this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.dataProjection=tt(t.dataProjection?t.dataProjection:"EPSG:4326")}readFeaturesFromObject(t,e){if(t.type=="Topology"){const n=t;let s,r=null,o=null;n.transform&&(s=n.transform,r=s.scale,o=s.translate);const a=n.arcs;s&&uT(a,r,o);const l=[],h=n.objects,c=this.layerName_;let u;for(const g in h)this.layers_&&!this.layers_.includes(g)||(h[g].type==="GeometryCollection"?(u=h[g],l.push.apply(l,cT(u,a,r,o,c,g,e))):(u=h[g],l.push(o_(u,a,r,o,c,g,e))));return l}return[]}readProjectionFromObject(t){return this.dataProjection}}const nT={Point:sT,LineString:oT,Polygon:lT,MultiPoint:rT,MultiLineString:aT,MultiPolygon:hT};function Fh(i,t){const e=[];let n;for(let s=0,r=i.length;s<r;++s)if(n=i[s],s>0&&e.pop(),n>=0){const o=t[n];for(let a=0,l=o.length;a<l;++a)e.push(o[a].slice(0))}else{const o=t[~n];for(let a=o.length-1;a>=0;--a)e.push(o[a].slice(0))}return e}function sT(i,t,e){const n=i.coordinates;return t&&e&&Ad(n,t,e),new Re(n)}function rT(i,t,e){const n=i.coordinates;if(t&&e)for(let s=0,r=n.length;s<r;++s)Ad(n[s],t,e);return new Zi(n)}function oT(i,t){const e=Fh(i.arcs,t);return new ye(e)}function aT(i,t){const e=[];for(let n=0,s=i.arcs.length;n<s;++n)e[n]=Fh(i.arcs[n],t);return new ci(e)}function lT(i,t){const e=[];for(let n=0,s=i.arcs.length;n<s;++n)e[n]=Fh(i.arcs[n],t);return new Ue(e)}function hT(i,t){const e=[];for(let n=0,s=i.arcs.length;n<s;++n){const r=i.arcs[n],o=[];for(let a=0,l=r.length;a<l;++a)o[a]=Fh(r[a],t);e[n]=o}return new Pi(e)}function cT(i,t,e,n,s,r,o){const a=i.geometries,l=[];for(let h=0,c=a.length;h<c;++h)l[h]=o_(a[h],t,e,n,s,r,o);return l}function o_(i,t,e,n,s,r,o){let a=null;const l=i.type;if(l){const u=nT[l];l==="Point"||l==="MultiPoint"?a=u(i,e,n):a=u(i,t),a=re(a,!1,o)}const h=new Ee({geometry:a});i.id!==void 0&&h.setId(i.id);let c=i.properties;return s&&(c||(c={}),c[s]=r),c&&h.setProperties(c,!0),h}function uT(i,t,e){for(let n=0,s=i.length;n<s;++n)dT(i[n],t,e)}function dT(i,t,e){let n=0,s=0;for(let r=0,o=i.length;r<o;++r){const a=i[r];n+=a[0],s+=a[1],a[0]=n,a[1]=s,Ad(a,t,e)}}function Ad(i,t,e){i[0]=i[0]*t[0]+e[0],i[1]=i[1]*t[1]+e[1]}const gT=iT;class Gt extends Rt{constructor(t){t=t||{},super(t),this.schemaLocation=t.schemaLocation?t.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(t,e,n){const s=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},s),super.writeGeometryElement(t,e,n)}}Gt.prototype.namespace="http://www.opengis.net/gml/3.2";Gt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:ht(Rt.prototype.readFlatPos),posList:ht(Rt.prototype.readFlatPosList),coordinates:ht(It.prototype.readFlatCoordinates)}};Gt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:Rt.prototype.interiorParser,exterior:Rt.prototype.exteriorParser}};Gt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ht(rt.prototype.readPoint),MultiPoint:ht(rt.prototype.readMultiPoint),LineString:ht(rt.prototype.readLineString),MultiLineString:ht(rt.prototype.readMultiLineString),LinearRing:ht(rt.prototype.readLinearRing),Polygon:ht(rt.prototype.readPolygon),MultiPolygon:ht(rt.prototype.readMultiPolygon),Surface:ht(Gt.prototype.readSurface),MultiSurface:ht(Rt.prototype.readMultiSurface),Curve:ht(Gt.prototype.readCurve),MultiCurve:ht(Rt.prototype.readMultiCurve),Envelope:ht(Gt.prototype.readEnvelope)}};Gt.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:ot(Rt.prototype.curveMemberParser),curveMembers:ot(Rt.prototype.curveMemberParser)}};Gt.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:ot(Rt.prototype.surfaceMemberParser),surfaceMembers:ot(Rt.prototype.surfaceMemberParser)}};Gt.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(rt.prototype.readLineString),Curve:ot(Rt.prototype.readCurve)}};Gt.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(rt.prototype.readPolygon),Surface:ot(Rt.prototype.readSurface)}};Gt.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:ht(Rt.prototype.readPatch)}};Gt.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:ht(Rt.prototype.readSegment)}};Gt.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:ot(Rt.prototype.readFlatPosList),upperCorner:ot(Rt.prototype.readFlatPosList)}};Gt.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:ht(Rt.prototype.readPolygonPatch)}};Gt.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Ol(Rt.prototype.readLineStringSegment)}};Gt.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:ot(rt.prototype.pointMemberParser),pointMembers:ot(rt.prototype.pointMemberParser)}};Gt.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:ot(rt.prototype.lineStringMemberParser),lineStringMembers:ot(rt.prototype.lineStringMemberParser)}};Gt.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:ot(rt.prototype.polygonMemberParser),polygonMembers:ot(rt.prototype.polygonMemberParser)}};Gt.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ot(rt.prototype.readFlatCoordinatesFromNode)}};Gt.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:ot(rt.prototype.readLineString)}};Gt.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:ot(rt.prototype.readPolygon)}};Gt.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:ht(rt.prototype.readFlatLinearRing),Ring:ht(Gt.prototype.readFlatCurveRing)}};Gt.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:F(Rt.prototype.writeRing),interior:F(Rt.prototype.writeRing)}};Gt.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:F(ft),upperCorner:F(ft)}};Gt.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:F(Rt.prototype.writeSurfaceOrPolygonMember),polygonMember:F(Rt.prototype.writeSurfaceOrPolygonMember)}};Gt.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:F(Rt.prototype.writePointMember)}};Gt.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:F(Rt.prototype.writeLineStringOrCurveMember),curveMember:F(Rt.prototype.writeLineStringOrCurveMember)}};Gt.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:F(Rt.prototype.writeCurveOrLineString),MultiCurve:F(Rt.prototype.writeMultiCurveOrLineString),Point:F(Gt.prototype.writePoint),MultiPoint:F(Rt.prototype.writeMultiPoint),LineString:F(Rt.prototype.writeCurveOrLineString),MultiLineString:F(Rt.prototype.writeMultiCurveOrLineString),LinearRing:F(Rt.prototype.writeLinearRing),Polygon:F(Rt.prototype.writeSurfaceOrPolygon),MultiPolygon:F(Rt.prototype.writeMultiSurfaceOrPolygon),Surface:F(Rt.prototype.writeSurfaceOrPolygon),MultiSurface:F(Rt.prototype.writeMultiSurfaceOrPolygon),Envelope:F(Rt.prototype.writeEnvelope)}};const Ld=Gt;class a_{constructor(t){this.tagName_=t}getTagName(){return this.tagName_}}class fT extends a_{constructor(t,e){super(t),this.conditions=e,At(this.conditions.length>=2,"At least 2 conditions are required")}}class pT extends fT{constructor(t){super("And",Array.prototype.slice.call(arguments))}}const mT=pT;class _T extends a_{constructor(t,e,n){if(super("BBOX"),this.geometryName=t,this.extent=e,e.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function yT(i){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(mT,t))}function xT(i,t,e){return new _T(i,t,e)}const Vf={"http://www.opengis.net/gml":{boundedBy:O(rt.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:ot(rt.prototype.readFeaturesInternal)}},vT={"http://www.opengis.net/wfs":{totalInserted:O(ge),totalUpdated:O(ge),totalDeleted:O(ge)},"http://www.opengis.net/wfs/2.0":{totalInserted:O(ge),totalUpdated:O(ge),totalDeleted:O(ge)}},wT={"http://www.opengis.net/wfs":{TransactionSummary:O(Hf,"transactionSummary"),InsertResults:O(Qf,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:O(Hf,"transactionSummary"),InsertResults:O(Qf,"insertIds")}},bT={"http://www.opengis.net/wfs":{PropertyName:F(ft)},"http://www.opengis.net/wfs/2.0":{PropertyName:F(ft)}},l_={"http://www.opengis.net/wfs":{Insert:F(Jf),Update:F(ep),Delete:F(tp),Property:F(ip),Native:F(np)},"http://www.opengis.net/wfs/2.0":{Insert:F(Jf),Update:F(ep),Delete:F(tp),Property:F(ip),Native:F(np)}},h_="feature",Od="http://www.w3.org/2000/xmlns/",Fd={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},pu={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Nd={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Yf={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},kd={"2.0.0":Ld,"1.1.0":Rt,"1.0.0":It},ET="1.1.0";class ST extends Pa{constructor(t){super(),t=t||{},this.version_=t.version?t.version:ET,this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new kd[this.version_],this.schemaLocation_=t.schemaLocation?t.schemaLocation:Yf[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(t){this.featureType_=t}readFeaturesFromNode(t,e){const n={node:t};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(t,e||{}));const s=[n];let r;this.version_==="2.0.0"?r=Vf:r=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Z([],r,t,s,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(t){if(t){if(typeof t=="string"){const e=Ci(t);return this.readTransactionResponseFromDocument(e)}return Ri(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}}readFeatureCollectionMetadata(t){if(t){if(typeof t=="string"){const e=Ci(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Ri(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}}readFeatureCollectionMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)}readFeatureCollectionMetadataFromNode(t){const e={},n=Cn(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=n,Z(e,Vf,t,[],this.gmlFormat_)}readTransactionResponseFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)}readTransactionResponseFromNode(t){return Z({},wT,t,[])}writeGetFeature(t){const e=mt(pu[this.version_],"GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version",this.version_),t.handle&&e.setAttribute("handle",t.handle),t.outputFormat&&e.setAttribute("outputFormat",t.outputFormat),t.maxFeatures!==void 0&&e.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&e.setAttribute("resultType",t.resultType),t.startIndex!==void 0&&e.setAttribute("startIndex",String(t.startIndex)),t.count!==void 0&&e.setAttribute("count",String(t.count)),t.viewParams!==void 0&&e.setAttribute("viewParams",t.viewParams),e.setAttributeNS(js,"xsi:schemaLocation",this.schemaLocation_);const n={node:e};if(Object.assign(n,{version:this.version_,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,propertyNames:t.propertyNames?t.propertyNames:[]}),At(Array.isArray(t.featureTypes),"`options.featureTypes` must be an Array"),typeof t.featureTypes[0]=="string"){let s=t.filter;t.bbox&&(At(t.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),s=this.combineBboxAndFilter(t.geometryName,t.bbox,t.srsName,s)),Object.assign(n,{geometryName:t.geometryName,filter:s}),gp(e,t.featureTypes,[n])}else t.featureTypes.forEach(s=>{const r=this.combineBboxAndFilter(s.geometryName,s.bbox,t.srsName,t.filter);Object.assign(n,{geometryName:s.geometryName,filter:r}),gp(e,[s.name],[n])});return e}combineBboxAndFilter(t,e,n,s){const r=xT(t,e,n);return s?yT(s,r):r}writeTransaction(t,e,n,s){const r=[],o=s.version?s.version:this.version_,a=mt(pu[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;s&&(l=s.gmlOptions?s.gmlOptions:{},s.handle&&a.setAttribute("handle",s.handle)),a.setAttributeNS(js,"xsi:schemaLocation",Yf[o]);const h=TT(a,l,o,s);return t&&nl("Insert",t,r,h),e&&nl("Update",e,r,h),n&&nl("Delete",n,r,h),s.nativeElements&&nl("Native",s.nativeElements,r,h),a}readProjectionFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null}readProjectionFromNode(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild){t=t.firstElementChild.firstElementChild;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(!(e.childNodes.length===0||e.childNodes.length===1&&e.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(e,n),tt(n.pop().srsName)}}return null}}function TT(i,t,e,n){const s=n.featurePrefix?n.featurePrefix:h_;let r;return e==="1.0.0"?r=2:e==="1.1.0"?r=3:e==="2.0.0"&&(r=3.2),Object.assign({node:i},{version:e,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:s,gmlVersion:r,hasZ:n.hasZ,srsName:n.srsName},t)}function nl(i,t,e,n){pt(n,l_,ce(i),t,e)}function Hf(i,t){return Z({},vT,i,t)}const MT={"http://www.opengis.net/ogc":{FeatureId:ot(function(i,t){return i.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:ot(function(i,t){return i.getAttribute("fid")})}};function Kf(i,t){li(MT,i,t)}const RT={"http://www.opengis.net/wfs":{Feature:Kf},"http://www.opengis.net/wfs/2.0":{Feature:Kf}};function Qf(i,t){return Z([],RT,i,t)}function Jf(i,t,e){const n=e[e.length-1],s=n.featureType,r=n.featureNS,o=n.gmlVersion,a=mt(r,s);i.appendChild(a),o===2?It.prototype.writeFeatureElement(a,t,e):o===3?Rt.prototype.writeFeatureElement(a,t,e):Ld.prototype.writeFeatureElement(a,t,e)}function c_(i,t,e){const n=e[e.length-1].version,s=Fd[n],r=mt(s,"Filter"),o=mt(s,"FeatureId");r.appendChild(o),o.setAttribute("fid",t),i.appendChild(r)}function Dd(i,t){i=i||h_;const e=i+":";return t.startsWith(e)?t:e+t}function tp(i,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const s=n.featureType,r=n.featurePrefix,o=n.featureNS,a=Dd(r,s);i.setAttribute("typeName",a),i.setAttributeNS(Od,"xmlns:"+r,o);const l=t.getId();l!==void 0&&c_(i,l,e)}function ep(i,t,e){const n=e[e.length-1];At(t.getId()!==void 0,"Features must have an id set");const s=n.version,r=n.featureType,o=n.featurePrefix,a=n.featureNS,l=Dd(o,r),h=t.getGeometryName();i.setAttribute("typeName",l),i.setAttributeNS(Od,"xmlns:"+o,a);const c=t.getId();if(c!==void 0){const u=t.getKeys(),g=[];for(let f=0,p=u.length;f<p;f++){const _=t.get(u[f]);if(_!==void 0){let x=u[f];_&&typeof _.getSimplifiedGeometry=="function"&&(x=h),g.push({name:x,value:_})}}pt({version:s,gmlVersion:n.gmlVersion,node:i,hasZ:n.hasZ,srsName:n.srsName},l_,ce("Property"),g,e),c_(i,c,e)}}function ip(i,t,e){const n=e[e.length-1],s=n.version,r=pu[s],o=mt(r,s==="2.0.0"?"ValueReference":"Name"),a=n.gmlVersion;if(i.appendChild(o),ft(o,t.name),t.value!==void 0&&t.value!==null){const l=mt(r,"Value");i.appendChild(l),t.value&&typeof t.value.getSimplifiedGeometry=="function"?a===2?It.prototype.writeGeometryElement(l,t.value,e):a===3?Rt.prototype.writeGeometryElement(l,t.value,e):Ld.prototype.writeGeometryElement(l,t.value,e):ft(l,t.value)}}function np(i,t,e){t.vendorId&&i.setAttribute("vendorId",t.vendorId),t.safeToIgnore!==void 0&&i.setAttribute("safeToIgnore",String(t.safeToIgnore)),t.value!==void 0&&ft(i,t.value)}const Nh={"http://www.opengis.net/wfs":{Query:F(sp)},"http://www.opengis.net/wfs/2.0":{Query:F(sp)},"http://www.opengis.net/ogc":{During:F(ap),And:F(sl),Or:F(sl),Not:F(lp),BBOX:F(rp),Contains:F(ts),Intersects:F(ts),Within:F(ts),DWithin:F(op),PropertyIsEqualTo:F(Si),PropertyIsNotEqualTo:F(Si),PropertyIsLessThan:F(Si),PropertyIsLessThanOrEqualTo:F(Si),PropertyIsGreaterThan:F(Si),PropertyIsGreaterThanOrEqualTo:F(Si),PropertyIsNull:F(hp),PropertyIsBetween:F(cp),PropertyIsLike:F(up)},"http://www.opengis.net/fes/2.0":{During:F(ap),And:F(sl),Or:F(sl),Not:F(lp),BBOX:F(rp),Contains:F(ts),Disjoint:F(ts),Intersects:F(ts),ResourceId:F(IT),Within:F(ts),DWithin:F(op),PropertyIsEqualTo:F(Si),PropertyIsNotEqualTo:F(Si),PropertyIsLessThan:F(Si),PropertyIsLessThanOrEqualTo:F(Si),PropertyIsGreaterThan:F(Si),PropertyIsGreaterThanOrEqualTo:F(Si),PropertyIsNull:F(hp),PropertyIsBetween:F(cp),PropertyIsLike:F(up)}};function sp(i,t,e){const n=e[e.length-1],s=n.version,r=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let h;r?h=Dd(r,t):h=t;let c;s==="2.0.0"?c="typeNames":c="typeName",i.setAttribute(c,h),l&&i.setAttribute("srsName",l),o&&i.setAttributeNS(Od,"xmlns:"+r,o);const u=Object.assign({},n);u.node=i,pt(u,bT,ce("PropertyName"),a,e);const g=n.filter;if(g){const f=mt(kh(s),"Filter");i.appendChild(f),CT(f,g,e)}}function CT(i,t,e){const n=e[e.length-1],s={node:i};Object.assign(s,{context:n}),pt(s,Nh,ce(t.getTagName()),[t],e)}function rp(i,t,e){const n=e[e.length-1],s=n.context.version;n.srsName=t.srsName;const r=kd[s];no(s,i,t.geometryName),r.prototype.writeGeometryElement(i,t.extent,e)}function IT(i,t,e){i.setAttribute("rid",t.rid)}function ts(i,t,e){const n=e[e.length-1],s=n.context.version;n.srsName=t.srsName;const r=kd[s];no(s,i,t.geometryName),r.prototype.writeGeometryElement(i,t.geometry,e)}function op(i,t,e){const n=e[e.length-1].context.version;ts(i,t,e);const s=mt(kh(n),"Distance");ft(s,t.distance.toString()),n==="2.0.0"?s.setAttribute("uom",t.unit):s.setAttribute("units",t.unit),i.appendChild(s)}function ap(i,t,e){const n=e[e.length-1].context.version;jl(Nd[n],"ValueReference",i,t.propertyName);const s=mt(Pn,"TimePeriod");i.appendChild(s);const r=mt(Pn,"begin");s.appendChild(r),dp(r,t.begin);const o=mt(Pn,"end");s.appendChild(o),dp(o,t.end)}function sl(i,t,e){const n=e[e.length-1].context,s={node:i};Object.assign(s,{context:n});const r=t.conditions;for(let o=0,a=r.length;o<a;++o){const l=r[o];pt(s,Nh,ce(l.getTagName()),[l],e)}}function lp(i,t,e){const n=e[e.length-1].context,s={node:i};Object.assign(s,{context:n});const r=t.condition;pt(s,Nh,ce(r.getTagName()),[r],e)}function Si(i,t,e){const n=e[e.length-1].context.version;t.matchCase!==void 0&&i.setAttribute("matchCase",t.matchCase.toString()),no(n,i,t.propertyName),zl(n,i,""+t.expression)}function hp(i,t,e){const n=e[e.length-1].context.version;no(n,i,t.propertyName)}function cp(i,t,e){const n=e[e.length-1].context.version,s=kh(n);no(n,i,t.propertyName);const r=mt(s,"LowerBoundary");i.appendChild(r),zl(n,r,""+t.lowerBoundary);const o=mt(s,"UpperBoundary");i.appendChild(o),zl(n,o,""+t.upperBoundary)}function up(i,t,e){const n=e[e.length-1].context.version;i.setAttribute("wildCard",t.wildCard),i.setAttribute("singleChar",t.singleChar),i.setAttribute("escapeChar",t.escapeChar),t.matchCase!==void 0&&i.setAttribute("matchCase",t.matchCase.toString()),no(n,i,t.propertyName),zl(n,i,""+t.pattern)}function jl(i,t,e,n){const s=mt(i,t);ft(s,n),e.appendChild(s)}function zl(i,t,e){jl(kh(i),"Literal",t,e)}function no(i,t,e){i==="2.0.0"?jl(Nd[i],"ValueReference",t,e):jl(Fd[i],"PropertyName",t,e)}function dp(i,t){const e=mt(Pn,"TimeInstant");i.appendChild(e);const n=mt(Pn,"timePosition");e.appendChild(n),ft(n,t)}function gp(i,t,e){const n=e[e.length-1],s=Object.assign({},n);s.node=i,pt(s,Nh,ce("Query"),t,e)}function kh(i){let t;return i==="2.0.0"?t=Nd[i]:t=Fd[i],t}const PT=ST,Xt={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class fp{constructor(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(t){return this.view_.getUint32((this.pos_+=4)-4,t!==void 0?t:this.isLittleEndian_)}readDouble(t){return this.view_.getFloat64((this.pos_+=8)-8,t!==void 0?t:this.isLittleEndian_)}readPoint(){const t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t}readLineString(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readPoint());return e}readPolygon(){const t=this.readUint32(),e=[];for(let n=0;n<t;n++)e.push(this.readLineString());return e}readWkbHeader(t){const e=this.readUint8()>0,n=this.readUint32(e),s=Math.floor((n&268435455)/1e3),r=!!(n&2147483648)||s===1||s===3,o=!!(n&1073741824)||s===2||s===3,a=!!(n&536870912),l=(n&268435455)%1e3,h=["XY",r?"Z":"",o?"M":""].join(""),c=a?this.readUint32(e):null;if(t!==void 0&&t!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==e)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=e,this.hasZ_=r,this.hasM_=o,this.layout_=h,this.srid_=c,this.initialized_=!0;return l}readWkbPayload(t){switch(t){case Xt.POINT:return this.readPoint();case Xt.LINE_STRING:return this.readLineString();case Xt.POLYGON:case Xt.TRIANGLE:return this.readPolygon();case Xt.MULTI_POINT:return this.readMultiPoint();case Xt.MULTI_LINE_STRING:return this.readMultiLineString();case Xt.MULTI_POLYGON:case Xt.POLYHEDRAL_SURFACE:case Xt.TIN:return this.readMultiPolygon();case Xt.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}}readWkbBlock(t){return this.readWkbPayload(this.readWkbHeader(t))}readWkbCollection(t,e){const n=this.readUint32(),s=[];for(let r=0;r<n;r++){const o=t.call(this,e);o&&s.push(o)}return s}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Xt.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Xt.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Xt.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case Xt.POINT:return new Re(e,this.layout_);case Xt.LINE_STRING:return new ye(e,this.layout_);case Xt.POLYGON:case Xt.TRIANGLE:return new Ue(e,this.layout_);case Xt.MULTI_POINT:return new Zi(e,this.layout_);case Xt.MULTI_LINE_STRING:return new ci(e,this.layout_);case Xt.MULTI_POLYGON:case Xt.POLYHEDRAL_SURFACE:case Xt.TIN:return new Pi(e,this.layout_);case Xt.GEOMETRY_COLLECTION:return new je(e);default:return null}}getSrid(){return this.srid_}}class AT{constructor(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=t.littleEndian!==!1,this.isEWKB_=t.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},t.nodata)}writeUint8(t){this.writeQueue_.push([1,t])}writeUint32(t){this.writeQueue_.push([4,t])}writeDouble(t){this.writeQueue_.push([8,t])}writePoint(t,e){const n=Object.assign.apply(null,e.split("").map((s,r)=>({[s]:t[r]})));for(const s of this.layout_)this.writeDouble(s in n?n[s]:this.nodata_[s])}writeLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writePoint(t[n],e)}writePolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeLineString(t[n],e)}writeWkbHeader(t,e){t%=1e3,this.layout_.includes("Z")&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)}writeMultiPoint(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(1),this.writePoint(t[n],e)}writeMultiLineString(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(2),this.writeLineString(t[n],e)}writeMultiPolygon(t,e){this.writeUint32(t.length);for(let n=0;n<t.length;n++)this.writeWkbHeader(3),this.writePolygon(t[n],e)}writeGeometryCollection(t){this.writeUint32(t.length);for(let e=0;e<t.length;e++)this.writeGeometry(t[e])}findMinimumLayout(t,e="XYZM"){const n=(s,r)=>s===r?s:s==="XYZM"?r:r==="XYZM"?s:"XY";if(t instanceof kn)return n(t.getLayout(),e);if(t instanceof je){const s=t.getGeometriesArray();for(let r=0;r<s.length&&e!=="XY";r++)e=this.findMinimumLayout(s[r],e)}return e}writeGeometry(t,e){const n={Point:Xt.POINT,LineString:Xt.LINE_STRING,Polygon:Xt.POLYGON,MultiPoint:Xt.MULTI_POINT,MultiLineString:Xt.MULTI_LINE_STRING,MultiPolygon:Xt.MULTI_POLYGON,GeometryCollection:Xt.GEOMETRY_COLLECTION},s=t.getType(),r=n[s];if(!r)throw new Error("GeometryType "+s+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(r,e),t instanceof kn?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[s].call(this,t.getCoordinates(),t.getLayout()):t instanceof je&&this.writeGeometryCollection(t.getGeometriesArray())}getBuffer(){const t=this.writeQueue_.reduce((r,o)=>r+o[0],0),e=new ArrayBuffer(t),n=new DataView(e);let s=0;return this.writeQueue_.forEach(r=>{switch(r[0]){case 1:n.setUint8(s,r[1]);break;case 4:n.setUint32(s,r[1],this.isLittleEndian_);break;case 8:n.setFloat64(s,r[1],this.isLittleEndian_);break}s+=r[0]}),e}}class LT extends Ca{constructor(t){super(),t=t||{},this.splitCollection=!!t.splitCollection,this.viewCache_=null,this.hex_=t.hex!==!1,this.littleEndian_=t.littleEndian!==!1,this.ewkb_=t.ewkb!==!1,this.layout_=t.geometryLayout,this.nodataZ_=t.nodataZ||0,this.nodataM_=t.nodataM||0,this.srid_=t.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(t,e){return new Ee({geometry:this.readGeometry(t,e)})}readFeatures(t,e){let n=[];const s=this.readGeometry(t,e);return this.splitCollection&&s instanceof je?n=s.getGeometriesArray():n=[s],n.map(r=>new Ee({geometry:r}))}readGeometry(t,e){const n=pp(t);if(!n)return null;const s=new fp(n).readGeometry();return this.viewCache_=n,e=this.getReadOptions(t,e),this.viewCache_=null,re(s,!1,e)}readProjection(t){const e=this.viewCache_||pp(t);if(!e)return;const n=new fp(e);return n.readWkbHeader(),n.getSrid()&&tt("EPSG:"+n.getSrid())||void 0}writeFeature(t,e){return this.writeGeometry(t.getGeometry(),e)}writeFeatures(t,e){return this.writeGeometry(new je(t.map(n=>n.getGeometry())),e)}writeGeometry(t,e){e=this.adaptOptions(e);const n=new AT({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let s=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=e.dataProjection&&tt(e.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(s=Number(a.substring(5)))}}n.writeGeometry(re(t,!0,e),s);const r=n.getBuffer();return this.hex_?OT(r):r}}function OT(i){const t=new Uint8Array(i);return Array.from(t.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}function FT(i){const t=new Uint8Array(i.length/2);for(let e=0;e<i.length/2;e++)t[e]=parseInt(i.substr(e*2,2),16);return new DataView(t.buffer)}function pp(i){return typeof i=="string"?FT(i):ArrayBuffer.isView(i)?i instanceof DataView?i:new DataView(i.buffer,i.byteOffset,i.byteLength):i instanceof ArrayBuffer?new DataView(i):null}const NT=LT,kT={POINT:Re,LINESTRING:ye,POLYGON:Ue,MULTIPOINT:Zi,MULTILINESTRING:ci,MULTIPOLYGON:Pi},u_="EMPTY",d_="Z",g_="M",DT="ZM",zt={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},GT={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class jT{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let n=t,s;if(t=="(")s=zt.LEFT_PAREN;else if(t==",")s=zt.COMMA;else if(t==")")s=zt.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")s=zt.NUMBER,n=this.readNumber_();else if(this.isAlpha_(t))s=zt.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")s=zt.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:n,type:s}}readNumber_(){let t;const e=this.index_;let n=!1,s=!1;do t=="."?n=!0:(t=="e"||t=="E")&&(s=!0),t=this.nextChar_();while(this.isNumeric_(t,n)||!s&&(t=="e"||t=="E")||s&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}let zT=class{constructor(i){this.lexer_=i,this.token_={position:0,type:zt.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(i){return this.token_.type==i}match(i){const t=this.isTokenType(i);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let i="XY";const t=this.token_;if(this.isTokenType(zt.TEXT)){const e=t.value;e===d_?i="XYZ":e===g_?i="XYM":e===DT&&(i="XYZM"),i!=="XY"&&this.consume_()}return i}parseGeometryCollectionText_(){if(this.match(zt.LEFT_PAREN)){const i=[];do i.push(this.parseGeometry_());while(this.match(zt.COMMA));if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(zt.LEFT_PAREN)){const i=this.parsePoint_();if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(zt.LEFT_PAREN)){const i=this.parsePointList_();if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(zt.LEFT_PAREN)){const i=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(zt.LEFT_PAREN)){let i;if(this.token_.type==zt.LEFT_PAREN?i=this.parsePointTextList_():i=this.parsePointList_(),this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(zt.LEFT_PAREN)){const i=this.parseLineStringTextList_();if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(zt.LEFT_PAREN)){const i=this.parsePolygonTextList_();if(this.match(zt.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePoint_(){const i=[],t=this.layout_.length;for(let e=0;e<t;++e){const n=this.token_;if(this.match(zt.NUMBER))i.push(n.value);else break}if(i.length==t)return i;throw new Error(this.formatErrorMessage_())}parsePointList_(){const i=[this.parsePoint_()];for(;this.match(zt.COMMA);)i.push(this.parsePoint_());return i}parsePointTextList_(){const i=[this.parsePointText_()];for(;this.match(zt.COMMA);)i.push(this.parsePointText_());return i}parseLineStringTextList_(){const i=[this.parseLineStringText_()];for(;this.match(zt.COMMA);)i.push(this.parseLineStringText_());return i}parsePolygonTextList_(){const i=[this.parsePolygonText_()];for(;this.match(zt.COMMA);)i.push(this.parsePolygonText_());return i}isEmptyGeometry_(){const i=this.isTokenType(zt.TEXT)&&this.token_.value==u_;return i&&this.consume_(),i}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const i=this.token_;if(this.match(zt.TEXT)){const t=i.value;this.layout_=this.parseGeometryLayout_();const e=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(e)return new je([]);const r=this.parseGeometryCollectionText_();return new je(r)}const n=kT[t];if(!n)throw new Error("Invalid geometry type: "+t);let s;if(e)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new n(s,this.layout_)}throw new Error(this.formatErrorMessage_())}};class UT extends yd{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new jT(t);return new zT(e).parse()}readFeatureFromText(t,e){const n=this.readGeometryFromText(t,e),s=new Ee;return s.setGeometry(n),s}readFeaturesFromText(t,e){let n=[];const s=this.readGeometryFromText(t,e);this.splitCollection_&&s.getType()=="GeometryCollection"?n=s.getGeometriesArray():n=[s];const r=[];for(let o=0,a=n.length;o<a;++o){const l=new Ee;l.setGeometry(n[o]),r.push(l)}return r}readGeometryFromText(t,e){const n=this.parse_(t);return re(n,!1,e)}writeFeatureText(t,e){const n=t.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const n=[];for(let r=0,o=t.length;r<o;++r)n.push(t[r].getGeometry());const s=new je(n);return this.writeGeometryText(s,e)}writeGeometryText(t,e){return m_(re(t,!0,e))}}function f_(i){const t=i.getCoordinates();return t.length===0?"":t.join(" ")}function BT(i){const t=[],e=i.getPoints();for(let n=0,s=e.length;n<s;++n)t.push("("+f_(e[n])+")");return t.join(",")}function WT(i){const t=[],e=i.getGeometries();for(let n=0,s=e.length;n<s;++n)t.push(m_(e[n]));return t.join(",")}function Gd(i){const t=i.getCoordinates(),e=[];for(let n=0,s=t.length;n<s;++n)e.push(t[n].join(" "));return e.join(",")}function qT(i){const t=[],e=i.getLineStrings();for(let n=0,s=e.length;n<s;++n)t.push("("+Gd(e[n])+")");return t.join(",")}function p_(i){const t=[],e=i.getLinearRings();for(let n=0,s=e.length;n<s;++n)t.push("("+Gd(e[n])+")");return t.join(",")}function XT(i){const t=[],e=i.getPolygons();for(let n=0,s=e.length;n<s;++n)t.push("("+p_(e[n])+")");return t.join(",")}function ZT(i){const t=i.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=d_),(t==="XYM"||t==="XYZM")&&(e+=g_),e}const $T={Point:f_,LineString:Gd,Polygon:p_,MultiPoint:BT,MultiLineString:qT,MultiPolygon:XT,GeometryCollection:WT};function m_(i){const t=i.getType(),e=$T[t],n=e(i);let s=GT[t];if(typeof i.getFlatCoordinates=="function"){const r=ZT(i);r.length>0&&(s+=" "+r)}return n.length===0?s+" "+u_:s+"("+n+")"}const VT=UT,Oe=[null,"http://www.opengis.net/wms"],YT=X(Oe,{Service:O(mM),Capability:O(pM)}),HT=X(Oe,{Request:O(EM),Exception:O(vM),Layer:O(wM)});class KT extends Pd{constructor(){super(),this.version=void 0}readFromNode(t){return this.version=t.getAttribute("version").trim(),Z({version:this.version},YT,t,[])||null}}const QT=X(Oe,{Name:O($),Title:O($),Abstract:O($),KeywordList:O(v_),OnlineResource:O(io),ContactInformation:O(_M),Fees:O($),AccessConstraints:O($),LayerLimit:O(ge),MaxWidth:O(ge),MaxHeight:O(ge)}),JT=X(Oe,{ContactPersonPrimary:O(yM),ContactPosition:O($),ContactAddress:O(xM),ContactVoiceTelephone:O($),ContactFacsimileTelephone:O($),ContactElectronicMailAddress:O($)}),tM=X(Oe,{ContactPerson:O($),ContactOrganization:O($)}),eM=X(Oe,{AddressType:O($),Address:O($),City:O($),StateOrProvince:O($),PostCode:O($),Country:O($)}),iM=X(Oe,{Format:ot($)}),__=X(Oe,{Name:O($),Title:O($),Abstract:O($),KeywordList:O(v_),CRS:Kt($),EX_GeographicBoundingBox:O(fM),BoundingBox:Kt(gM),Dimension:Kt(bM),Attribution:O(dM),AuthorityURL:Kt(MM),Identifier:Kt($),MetadataURL:Kt(RM),DataURL:Kt(Dn),FeatureListURL:Kt(Dn),Style:Kt(CM),MinScaleDenominator:O(Pt),MaxScaleDenominator:O(Pt),Layer:Kt(y_)}),nM=X(Oe,{Title:O($),OnlineResource:O(io),LogoURL:O(x_)}),sM=X(Oe,{westBoundLongitude:O(Pt),eastBoundLongitude:O(Pt),southBoundLatitude:O(Pt),northBoundLatitude:O(Pt)}),rM=X(Oe,{GetCapabilities:O(vc),GetMap:O(vc),GetFeatureInfo:O(vc)}),oM=X(Oe,{Format:Kt($),DCPType:Kt(SM)}),aM=X(Oe,{HTTP:O(TM)}),lM=X(Oe,{Get:O(Dn),Post:O(Dn)}),hM=X(Oe,{Name:O($),Title:O($),Abstract:O($),LegendURL:Kt(x_),StyleSheetURL:O(Dn),StyleURL:O(Dn)}),cM=X(Oe,{Format:O($),OnlineResource:O(io)}),uM=X(Oe,{Keyword:ot($)});function dM(i,t){return Z({},nM,i,t)}function gM(i,t){const e=[Sn(i.getAttribute("minx")),Sn(i.getAttribute("miny")),Sn(i.getAttribute("maxx")),Sn(i.getAttribute("maxy"))],n=[Sn(i.getAttribute("resx")),Sn(i.getAttribute("resy"))];return{crs:i.getAttribute("CRS"),extent:e,res:n}}function fM(i,t){const e=Z({},sM,i,t);if(!e)return;const n=e.westBoundLongitude,s=e.southBoundLatitude,r=e.eastBoundLongitude,o=e.northBoundLatitude;if(!(n===void 0||s===void 0||r===void 0||o===void 0))return[n,s,r,o]}function pM(i,t){return Z({},HT,i,t)}function mM(i,t){return Z({},QT,i,t)}function _M(i,t){return Z({},JT,i,t)}function yM(i,t){return Z({},tM,i,t)}function xM(i,t){return Z({},eM,i,t)}function vM(i,t){return Z([],iM,i,t)}function wM(i,t){const e=Z({},__,i,t);return e.Layer===void 0?Object.assign(e,y_(i,t)):e}function y_(i,t){const e=t[t.length-1],n=Z({},__,i,t);if(!n)return;let s=Ns(i.getAttribute("queryable"));s===void 0&&(s=e.queryable),n.queryable=s!==void 0?s:!1;let r=Cn(i.getAttribute("cascaded"));r===void 0&&(r=e.cascaded),n.cascaded=r;let o=Ns(i.getAttribute("opaque"));o===void 0&&(o=e.opaque),n.opaque=o!==void 0?o:!1;let a=Ns(i.getAttribute("noSubsets"));a===void 0&&(a=e.noSubsets),n.noSubsets=a!==void 0?a:!1;let l=Sn(i.getAttribute("fixedWidth"));l||(l=e.fixedWidth),n.fixedWidth=l;let h=Sn(i.getAttribute("fixedHeight"));return h||(h=e.fixedHeight),n.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(c){if(c in e){const u=n[c]||[];n[c]=u.concat(e[c])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(c){if(!(c in n)){const u=e[c];n[c]=u}}),n}function bM(i,t){return{name:i.getAttribute("name"),units:i.getAttribute("units"),unitSymbol:i.getAttribute("unitSymbol"),default:i.getAttribute("default"),multipleValues:Ns(i.getAttribute("multipleValues")),nearestValue:Ns(i.getAttribute("nearestValue")),current:Ns(i.getAttribute("current")),values:$(i)}}function Dn(i,t){return Z({},cM,i,t)}function EM(i,t){return Z({},rM,i,t)}function SM(i,t){return Z({},aM,i,t)}function TM(i,t){return Z({},lM,i,t)}function vc(i,t){return Z({},oM,i,t)}function x_(i,t){const e=Dn(i,t);if(e){const n=[Cn(i.getAttribute("width")),Cn(i.getAttribute("height"))];return e.size=n,e}}function MM(i,t){const e=Dn(i,t);if(e)return e.name=i.getAttribute("name"),e}function RM(i,t){const e=Dn(i,t);if(e)return e.type=i.getAttribute("type"),e}function CM(i,t){return Z({},hM,i,t)}function v_(i,t){return Z([],uM,i,t)}const IM=KT,PM="_feature",AM="_layer";class LM extends Pa{constructor(t){super(),t=t||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new It,this.layers_=t.layers?t.layers:null}getLayers(){return this.layers_}setLayers(t){this.layers_=t}readFeatures_(t,e){t.setAttribute("namespaceURI",this.featureNS_);const n=t.localName;let s=[];if(t.childNodes.length===0)return s;if(n=="msGMLOutput")for(let r=0,o=t.childNodes.length;r<o;r++){const a=t.childNodes[r];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,h=e[0],c=AM,u=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(u))continue;const g=u+PM;h.featureType=g,h.featureNS=this.featureNS_;const f={};f[g]=ot(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const p=X([h.featureNS,null],f);l.setAttribute("namespaceURI",this.featureNS_);const _=Z([],p,l,e,this.gmlFormat_);_&&Ot(s,_)}if(n=="FeatureCollection"){const r=Z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);r&&(s=r)}return s}readFeaturesFromNode(t,e){const n={};return e&&Object.assign(n,this.getReadOptions(t,e)),this.readFeatures_(t,[n])}}const OM=LM,fn=[null,"http://www.opengis.net/wmts/1.0"],so=[null,"http://www.opengis.net/ows/1.1"],FM=X(fn,{Contents:O(XM)});let NM=class extends Pd{constructor(){super(),this.owsParser_=new r_}readFromNode(i){let t=i.getAttribute("version");t&&(t=t.trim());let e=this.owsParser_.readFromNode(i);return e?(e.version=t,e=Z(e,FM,i,[]),e||null):null}};const kM=X(fn,{Layer:Kt(ZM),TileMatrixSet:Kt($M)}),DM=X(fn,{Style:Kt(VM),Format:Kt($),TileMatrixSetLink:Kt(YM),Dimension:Kt(HM),ResourceURL:Kt(KM)},X(so,{Title:O($),Abstract:O($),WGS84BoundingBox:O(b_),BoundingBox:Kt(QM),Identifier:O($)})),GM=X(fn,{LegendURL:Kt(JM)},X(so,{Title:O($),Identifier:O($)})),jM=X(fn,{TileMatrixSet:O($),TileMatrixSetLimits:O(eR)}),zM=X(fn,{TileMatrixLimits:ot(iR)}),UM=X(fn,{TileMatrix:O($),MinTileRow:O(ge),MaxTileRow:O(ge),MinTileCol:O(ge),MaxTileCol:O(ge)}),BM=X(fn,{Default:O($),Value:Kt($)},X(so,{Identifier:O($)})),w_=X(so,{LowerCorner:ot(mu),UpperCorner:ot(mu)}),WM=X(fn,{WellKnownScaleSet:O($),TileMatrix:Kt(tR)},X(so,{SupportedCRS:O($),Identifier:O($),BoundingBox:O(b_)})),qM=X(fn,{TopLeftCorner:O(mu),ScaleDenominator:O(Pt),TileWidth:O(ge),TileHeight:O(ge),MatrixWidth:O(ge),MatrixHeight:O(ge)},X(so,{Identifier:O($)}));function XM(i,t){return Z({},kM,i,t)}function ZM(i,t){return Z({},DM,i,t)}function $M(i,t){return Z({},WM,i,t)}function VM(i,t){const e=Z({},GM,i,t);if(!e)return;const n=i.getAttribute("isDefault")==="true";return e.isDefault=n,e}function YM(i,t){return Z({},jM,i,t)}function HM(i,t){return Z({},BM,i,t)}function KM(i,t){const e=i.getAttribute("format"),n=i.getAttribute("template"),s=i.getAttribute("resourceType"),r={};return e&&(r.format=e),n&&(r.template=n),s&&(r.resourceType=s),r}function b_(i,t){const e=Z([],w_,i,t);if(e.length==2)return Dr(e)}function QM(i,t){const e=i.getAttribute("crs"),n=Z([],w_,i,t);if(n.length==2)return{extent:Dr(n),crs:e}}function JM(i,t){const e={};return e.format=i.getAttribute("format"),e.href=io(i),e}function mu(i,t){const e=$(i).split(/\s+/);if(!e||e.length!=2)return;const n=+e[0],s=+e[1];if(!(isNaN(n)||isNaN(s)))return[n,s]}function tR(i,t){return Z({},qM,i,t)}function eR(i,t){return Z([],zM,i,t)}function iR(i,t){return Z({},UM,i,t)}const jd=NM,nR=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:aw,GML:Ow,GPX:xb,GeoJSON:w0,IGC:Tb,IIIFInfo:Lb,KML:BS,MVT:s_,OWS:r_,Polyline:eT,TopoJSON:gT,WFS:PT,WKB:NT,WKT:VT,WMSCapabilities:IM,WMSGetFeatureInfo:OM,WMTSCapabilities:jd},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=nR;const rs={ADD:"add",REMOVE:"remove"},mp={LENGTH:"length"};class rl extends gn{constructor(t,e,n){super(t),this.element=e,this.index=n}}let Ul=class extends Vs{constructor(i,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=i||[],this.unique_)for(let e=0,n=this.array_.length;e<n;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(i){for(let t=0,e=i.length;t<e;++t)this.push(i[t]);return this}forEach(i){const t=this.array_;for(let e=0,n=t.length;e<n;++e)i(t[e],e,t)}getArray(){return this.array_}item(i){return this.array_[i]}getLength(){return this.get(mp.LENGTH)}insertAt(i,t){if(i<0||i>this.getLength())throw new Error("Index out of bounds: "+i);this.unique_&&this.assertUnique_(t),this.array_.splice(i,0,t),this.updateLength_(),this.dispatchEvent(new rl(rs.ADD,t,i))}pop(){return this.removeAt(this.getLength()-1)}push(i){this.unique_&&this.assertUnique_(i);const t=this.getLength();return this.insertAt(t,i),this.getLength()}remove(i){const t=this.array_;for(let e=0,n=t.length;e<n;++e)if(t[e]===i)return this.removeAt(e)}removeAt(i){if(i<0||i>=this.getLength())return;const t=this.array_[i];return this.array_.splice(i,1),this.updateLength_(),this.dispatchEvent(new rl(rs.REMOVE,t,i)),t}setAt(i,t){const e=this.getLength();if(i>=e){this.insertAt(i,t);return}if(i<0)throw new Error("Index out of bounds: "+i);this.unique_&&this.assertUnique_(t,i);const n=this.array_[i];this.array_[i]=t,this.dispatchEvent(new rl(rs.REMOVE,n,i)),this.dispatchEvent(new rl(rs.ADD,t,i))}updateLength_(){this.set(mp.LENGTH,this.array_.length)}assertUnique_(i,t){for(let e=0,n=this.array_.length;e<n;++e)if(this.array_[e]===i&&e!==t)throw new Error("Duplicate item added to a unique collection")}};const si={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ut={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class E_ extends Vs{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ut.OPACITY]=t.opacity!==void 0?t.opacity:1,At(typeof e[Ut.OPACITY]=="number","Layer opacity must be a number"),e[Ut.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ut.Z_INDEX]=t.zIndex,e[Ut.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ut.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ut.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ut.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=wt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ct()}getLayerStatesArray(t){return ct()}getExtent(){return this.get(Ut.EXTENT)}getMaxResolution(){return this.get(Ut.MAX_RESOLUTION)}getMinResolution(){return this.get(Ut.MIN_RESOLUTION)}getMinZoom(){return this.get(Ut.MIN_ZOOM)}getMaxZoom(){return this.get(Ut.MAX_ZOOM)}getOpacity(){return this.get(Ut.OPACITY)}getSourceState(){return ct()}getVisible(){return this.get(Ut.VISIBLE)}getZIndex(){return this.get(Ut.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ut.EXTENT,t)}setMaxResolution(t){this.set(Ut.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ut.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ut.MAX_ZOOM,t)}setMinZoom(t){this.set(Ut.MIN_ZOOM,t)}setOpacity(t){At(typeof t=="number","Layer opacity must be a number"),this.set(Ut.OPACITY,t)}setVisible(t){this.set(Ut.VISIBLE,t)}setZIndex(t){this.set(Ut.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const ee={ANIMATING:0,INTERACTING:1},Fi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},S_=42,qr=256;function _p(i,t,e){return function(n,s,r,o,a){if(!n)return;if(!s&&!t)return n;const l=t?0:r[0]*s,h=t?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let g=i[0]+l/2+c,f=i[2]-l/2+c,p=i[1]+h/2+u,_=i[3]-h/2+u;g>f&&(g=(f+g)/2,f=g),p>_&&(p=(_+p)/2,_=p);let x=wt(n[0],g,f),v=wt(n[1],p,_);if(o&&e&&s){const w=30*s;x+=-w*Math.log(1+Math.max(0,g-n[0])/w)+w*Math.log(1+Math.max(0,n[0]-f)/w),v+=-w*Math.log(1+Math.max(0,p-n[1])/w)+w*Math.log(1+Math.max(0,n[1]-_)/w)}return[x,v]}}function sR(i){return i}function zd(i,t,e,n){const s=yt(t)/e[0],r=Vt(t)/e[1];return n?Math.min(i,Math.max(s,r)):Math.min(i,Math.min(s,r))}function Ud(i,t,e){let n=Math.min(i,t);const s=50;return n*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(n=Math.max(n,e),n/=Math.log(1+s*Math.max(0,e/i-1))/s+1),wt(n,e/2,t*2)}function rR(i,t,e,n){return t=t!==void 0?t:!0,function(s,r,o,a){if(s!==void 0){const l=i[0],h=i[i.length-1],c=e?zd(l,e,o,n):l;if(a)return t?Ud(s,c,h):wt(s,h,c);const u=Math.min(c,s),g=Math.floor(gh(i,u,r));return i[g]>c&&g<i.length-1?i[g+1]:i[g]}}}function oR(i,t,e,n,s,r){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=s?zd(t,s,l,r):t;if(h)return n?Ud(o,c,e):wt(o,e,c);const u=1e-9,g=Math.ceil(Math.log(t/c)/Math.log(i)-u),f=-a*(.5-u)+.5,p=Math.min(c,o),_=Math.floor(Math.log(t/p)/Math.log(i)+f),x=Math.max(g,_),v=t/Math.pow(i,x);return wt(v,e,c)}}}function yp(i,t,e,n,s){return e=e!==void 0?e:!0,function(r,o,a,l){if(r!==void 0){const h=n?zd(i,n,a,s):i;return!e||!l?wt(r,t,h):Ud(r,h,t)}}}function aR(i){if(i!==void 0)return 0}function xp(i){if(i!==void 0)return i}function lR(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function hR(i){const t=i===void 0?ko(5):i;return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function T_(i){return Math.pow(i,3)}function cR(i){return 1-T_(1-i)}function uR(i){return 3*i*i-2*i*i*i}const wc=0;class vp extends Vs{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Qu(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&xv(),t.center&&(t.center=$n(t.center,this.projection_)),t.extent&&(t.extent=Gi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Fi)delete e[a];this.setProperties(e,!0);const n=gR(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const s=dR(t),r=n.constraint,o=fR(t);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-e[3]+e[1]-s[1]),a=r/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=$n(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=$n(s.anchor,this.getProjection())),e[n]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===e){n&&ol(n,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<e;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||uR,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const g=an(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+g,l=u.targetRotation}pR(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(ee.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ee.ANIMATING]>0}getInteracting(){return this.hints_[ee.INTERACTING]>0}cancelAnimations(){this.setHint(ee.ANIMATING,-this.hints_[ee.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const s=this.animations_[e];if(s[0].callback&&ol(s[0].callback,!1),!t)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const g=l.sourceCenter[0],f=l.sourceCenter[1],p=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const x=g+u*(p-g),v=f+u*(_-f);this.targetCenter_=[x,v]}if(l.sourceResolution&&l.targetResolution){const g=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(g,0,f,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=g,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const g=u===1?an(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(g,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=g}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[n]=null,this.setHint(ee.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&ol(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-e[0],s[1]-e[1]],pv(n,t-this.getRotation()),e0(n,e)),n}calculateCenterZoom(t,e){let n;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=e[0]-t*(e[0]-s[0])/r,a=e[1]-t*(e[1]-s[1])/r;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],s=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&tu(t,this.getProjection())}getCenterInternal(){return this.get(Fi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return yh(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();At(e,"The view center is not defined");const n=this.getResolution();At(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return At(s!==void 0,"The view rotation is not defined"),Vu(e,n,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Fi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Gi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=yt(t)/e[0],s=Vt(t)/e[1];return Math.max(n,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(e/n)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(Fi.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(n/s)/e;return function(o){return Math.log(n/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=bc(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,n)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,s;if(this.resolutions_){const r=gh(this.resolutions_,t,1);e=r,n=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=n/this.resolutions_[r+1]}else n=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(n/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=wt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,wt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(At(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){At(!Un(t),"Cannot fit empty extent provided as `geometry`");const s=Gi(t,this.getProjection());n=Mf(s)}else if(t.getType()==="Circle"){const s=Gi(t.getExtent(),this.getProjection());n=Mf(s),n.rotate(this.getRotation(),Ce(s))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,g=r.length;u<g;u+=o){const f=r[u]*n-r[u+1]*s,p=r[u]*s+r[u+1]*n;a=Math.min(a,f),l=Math.min(l,p),h=Math.max(h,f),c=Math.max(c,p)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),g=Ce(a);g[0]+=(s[1]-s[3])/2*l,g[1]+=(s[0]-s[2])/2*l;const f=g[0]*u-g[1]*c,p=g[1]*u+g[0]*c,_=this.getConstrainedCenter([f,p],l),x=e.callback?e.callback:Yo;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},x):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),ol(x,!0))}centerOn(t,e,n){this.centerOnInternal($n(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(bc(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,s){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=bc(t,s,[a[0]/2+o[3],a[1]/2+o[0]],e,n);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=tu(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&$n(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,n);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=$n(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&$n(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,n),a=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Fi.ROTATION)!==s&&this.set(Fi.ROTATION,s),this.get(Fi.RESOLUTION)!==o&&(this.set(Fi.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Fi.CENTER)||!Cl(this.get(Fi.CENTER),a))&&this.set(Fi.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Cl(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:t,easing:cR,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ee.INTERACTING,1)}endInteraction(t,e,n){n=n&&$n(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(ee.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function ol(i,t){setTimeout(function(){i(t)},0)}function dR(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return _p(i.extent,i.constrainOnlyCenter,e)}const t=Qu(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,_p(e,!1,!1)}return sR}function gR(i){let t,e,n,s=i.minZoom!==void 0?i.minZoom:wc,r=i.maxZoom!==void 0?i.maxZoom:28;const o=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=Qu(i.projection,"EPSG:3857"),u=c.getExtent();let g=i.constrainOnlyCenter,f=i.extent;if(!a&&!f&&c.isGlobal()&&(g=!1,f=u),i.resolutions!==void 0){const p=i.resolutions;e=p[s],n=p[r]!==void 0?p[r]:p[p.length-1],i.constrainResolution?t=rR(p,l,!g&&f,h):t=yp(e,n,l,!g&&f,h)}else{const p=(u?Math.max(yt(u),Vt(u)):360*Qo.degrees/c.getMetersPerUnit())/qr/Math.pow(2,wc),_=p/Math.pow(2,28-wc);e=i.maxResolution,e!==void 0?s=0:e=p/Math.pow(o,s),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(o,r):n=p/Math.pow(o,r):n=_),r=s+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,r-s),i.constrainResolution?t=oR(o,e,n,l,!g&&f,h):t=yp(e,n,l,!g&&f,h)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:s,zoomFactor:o}}function fR(i){if(i.enableRotation===void 0||i.enableRotation){const t=i.constrainRotation;return t===void 0||t===!0?hR():t===!1?xp:typeof t=="number"?lR(t):xp}return aR}function pR(i){return!(i.sourceCenter&&i.targetCenter&&!Cl(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function bc(i,t,e,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=i[0]*r-i[1]*o,l=i[1]*r+i[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}class mR extends E_{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ut.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ut.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ve(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=le(t,Lt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof vp?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;e.layerStatesArray?s=e.layerStatesArray.find(o=>o.layer===this):s=this.getLayerState();const r=this.getExtent();return _R(s,e.viewState)&&(!r||Qt(r,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const s=t instanceof vp?t.getViewStateAndExtent():t;let r=e(s);return Array.isArray(r)||(r=[r]),r}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Ut.MAP,t)}getMapInternal(){return this.get(Ut.MAP)}setMap(t){this.mapPrecomposeKey_&&(ve(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ve(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=le(t,si.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,s=this.getLayerState(!1);At(!n.some(function(r){return r.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(s)},this),this.mapRenderKey_=le(this,Lt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Ut.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function _R(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}const La=mR;function yR(i,t,e,n,s){M_(i,t,e||0,n||i.length-1,s||xR)}function M_(i,t,e,n,s){for(;n>e;){if(n-e>600){var r=n-e+1,o=t-e+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(e,Math.floor(t-o*l/r+h)),u=Math.min(n,Math.floor(t+(r-o)*l/r+h));M_(i,t,c,u,s)}var g=i[t],f=e,p=n;for(yo(i,e,t),s(i[n],g)>0&&yo(i,e,n);f<p;){for(yo(i,f,p),f++,p--;s(i[f],g)<0;)f++;for(;s(i[p],g)>0;)p--}s(i[e],g)===0?yo(i,e,p):(p++,yo(i,p,n)),p<=t&&(e=p+1),t<=p&&(n=p-1)}}function yo(i,t,e){var n=i[t];i[t]=i[e],i[e]=n}function xR(i,t){return i<t?-1:i>t?1:0}let Bd=class{constructor(i=9){this._maxEntries=Math.max(4,i),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(i){let t=this.data;const e=[];if(!ll(i,t))return e;const n=this.toBBox,s=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],a=t.leaf?n(o):o;ll(i,a)&&(t.leaf?e.push(o):Sc(i,a)?this._all(o,e):s.push(o))}t=s.pop()}return e}collides(i){let t=this.data;if(!ll(i,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const s=t.children[n],r=t.leaf?this.toBBox(s):s;if(ll(i,r)){if(t.leaf||Sc(i,r))return!0;e.push(s)}}t=e.pop()}return!1}load(i){if(!(i&&i.length))return this;if(i.length<this._minEntries){for(let e=0;e<i.length;e++)this.insert(i[e]);return this}let t=this._build(i.slice(),0,i.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(i){return i&&this._insert(i,this.data.height-1),this}clear(){return this.data=fr([]),this}remove(i,t){if(!i)return this;let e=this.data;const n=this.toBBox(i),s=[],r=[];let o,a,l;for(;e||s.length;){if(e||(e=s.pop(),a=s[s.length-1],o=r.pop(),l=!0),e.leaf){const h=vR(i,e.children,t);if(h!==-1)return e.children.splice(h,1),s.push(e),this._condense(s),this}!l&&!e.leaf&&Sc(e,n)?(s.push(e),r.push(o),o=0,a=e,e=e.children[0]):a?(o++,e=a.children[o],l=!1):e=null}return this}toBBox(i){return i}compareMinX(i,t){return i.minX-t.minX}compareMinY(i,t){return i.minY-t.minY}toJSON(){return this.data}fromJSON(i){return this.data=i,this}_all(i,t){const e=[];for(;i;)i.leaf?t.push(...i.children):e.push(...i.children),i=e.pop();return t}_build(i,t,e,n){const s=e-t+1;let r=this._maxEntries,o;if(s<=r)return o=fr(i.slice(t,e+1)),sr(o,this.toBBox),o;n||(n=Math.ceil(Math.log(s)/Math.log(r)),r=Math.ceil(s/Math.pow(r,n-1))),o=fr([]),o.leaf=!1,o.height=n;const a=Math.ceil(s/r),l=a*Math.ceil(Math.sqrt(r));wp(i,t,e,l,this.compareMinX);for(let h=t;h<=e;h+=l){const c=Math.min(h+l-1,e);wp(i,h,c,a,this.compareMinY);for(let u=h;u<=c;u+=a){const g=Math.min(u+a-1,c);o.children.push(this._build(i,u,g,n-1))}}return sr(o,this.toBBox),o}_chooseSubtree(i,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let s=1/0,r=1/0,o;for(let a=0;a<t.children.length;a++){const l=t.children[a],h=Ec(l),c=ER(i,l)-h;c<r?(r=c,s=h<s?h:s,o=l):c===r&&h<s&&(s=h,o=l)}t=o||t.children[0]}return t}_insert(i,t,e){const n=e?i:this.toBBox(i),s=[],r=this._chooseSubtree(n,this.data,t,s);for(r.children.push(i),Mo(r,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)}_split(i,t){const e=i[t],n=e.children.length,s=this._minEntries;this._chooseSplitAxis(e,s,n);const r=this._chooseSplitIndex(e,s,n),o=fr(e.children.splice(r,e.children.length-r));o.height=e.height,o.leaf=e.leaf,sr(e,this.toBBox),sr(o,this.toBBox),t?i[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(i,t){this.data=fr([i,t]),this.data.height=i.height+1,this.data.leaf=!1,sr(this.data,this.toBBox)}_chooseSplitIndex(i,t,e){let n,s=1/0,r=1/0;for(let o=t;o<=e-t;o++){const a=To(i,0,o,this.toBBox),l=To(i,o,e,this.toBBox),h=SR(a,l),c=Ec(a)+Ec(l);h<s?(s=h,n=o,r=c<r?c:r):h===s&&c<r&&(r=c,n=o)}return n||e-t}_chooseSplitAxis(i,t,e){const n=i.leaf?this.compareMinX:wR,s=i.leaf?this.compareMinY:bR,r=this._allDistMargin(i,t,e,n),o=this._allDistMargin(i,t,e,s);r<o&&i.children.sort(n)}_allDistMargin(i,t,e,n){i.children.sort(n);const s=this.toBBox,r=To(i,0,t,s),o=To(i,e-t,e,s);let a=al(r)+al(o);for(let l=t;l<e-t;l++){const h=i.children[l];Mo(r,i.leaf?s(h):h),a+=al(r)}for(let l=e-t-1;l>=t;l--){const h=i.children[l];Mo(o,i.leaf?s(h):h),a+=al(o)}return a}_adjustParentBBoxes(i,t,e){for(let n=e;n>=0;n--)Mo(t[n],i)}_condense(i){for(let t=i.length-1,e;t>=0;t--)i[t].children.length===0?t>0?(e=i[t-1].children,e.splice(e.indexOf(i[t]),1)):this.clear():sr(i[t],this.toBBox)}};function vR(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function sr(i,t){To(i,0,i.children.length,t,i)}function To(i,t,e,n,s){s||(s=fr(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const o=i.children[r];Mo(s,i.leaf?n(o):o)}return s}function Mo(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function wR(i,t){return i.minX-t.minX}function bR(i,t){return i.minY-t.minY}function Ec(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function al(i){return i.maxX-i.minX+(i.maxY-i.minY)}function ER(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function SR(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),r=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-n)}function Sc(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function ll(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function fr(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wp(i,t,e,n,s){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;yR(i,o,t,e,s),r.push(t,o,o,e)}}let ro=0;const Qs=0,te=1<<ro++,Y=1<<ro++,xe=1<<ro++,Wt=1<<ro++,me=1<<ro++,Ne=Math.pow(2,ro)-1,R_={[te]:"boolean",[Y]:"number",[xe]:"string",[Wt]:"color",[me]:"number[]"},TR=Object.keys(R_).map(Number).sort(on);function be(i){const t=[];for(const e of TR)MR(i,e)&&t.push(R_[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function MR(i,t){return(i&t)===t}function ji(i,t){return!!(i&t)}function Oa(i,t){return i===t}class os{constructor(t,e){this.type=t,this.value=e}}class C_{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Wd(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function RR(i){switch(i){case"string":return xe;case"color":return Wt;case"number":return Y;case"boolean":return te;case"number[]":return me;default:throw new Error(`Unrecognized type hint: ${i}`)}}function Bt(i,t,e){switch(typeof i){case"boolean":return new os(te,i);case"number":return new os(Y,i);case"string":{let s=xe;return zb(i)&&(s|=Wt),Oa(s&e,Qs)||(s&=e),new os(s,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return jR(i,t,e);for(const s of i)if(typeof s!="number")throw new Error("Expected an array of numbers");let n=me;return(i.length===3||i.length===4)&&(n|=Wt),e&&(n&=e),new os(n,i)}const z={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},CR={[z.Get]:vt(([i,t])=>t!==void 0?RR(t.value):Ne,Ct(1,2),IR),[z.Var]:vt(([i])=>i.type,Ct(1,1),PR),[z.Id]:vt(Y|xe,xo,AR),[z.Concat]:vt(xe,Ct(2,1/0),Nt(Ne)),[z.GeometryType]:vt(xe,xo,LR),[z.Resolution]:vt(Y,xo),[z.Zoom]:vt(Y,xo),[z.Time]:vt(Y,xo),[z.Any]:vt(te,Ct(2,1/0),Nt(te)),[z.All]:vt(te,Ct(2,1/0),Nt(te)),[z.Not]:vt(te,Ct(1,1),Nt(te)),[z.Equal]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.NotEqual]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.GreaterThan]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.GreaterThanOrEqualTo]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.LessThan]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.LessThanOrEqualTo]:vt(te,Ct(2,2),Nt(Ne),Yn),[z.Multiply]:vt(i=>{let t=Y|Wt;for(let e=0;e<i.length;e++)t&=i[e].type;return t},Ct(2,1/0),Nt(Y|Wt),Yn),[z.Coalesce]:vt(i=>{let t=Ne;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},Ct(2,1/0),Nt(Ne),Yn),[z.Divide]:vt(Y,Ct(2,2),Nt(Y)),[z.Add]:vt(Y,Ct(2,1/0),Nt(Y)),[z.Subtract]:vt(Y,Ct(2,2),Nt(Y)),[z.Clamp]:vt(Y,Ct(3,3),Nt(Y)),[z.Mod]:vt(Y,Ct(2,2),Nt(Y)),[z.Pow]:vt(Y,Ct(2,2),Nt(Y)),[z.Abs]:vt(Y,Ct(1,1),Nt(Y)),[z.Floor]:vt(Y,Ct(1,1),Nt(Y)),[z.Ceil]:vt(Y,Ct(1,1),Nt(Y)),[z.Round]:vt(Y,Ct(1,1),Nt(Y)),[z.Sin]:vt(Y,Ct(1,1),Nt(Y)),[z.Cos]:vt(Y,Ct(1,1),Nt(Y)),[z.Atan]:vt(Y,Ct(1,2),Nt(Y)),[z.Sqrt]:vt(Y,Ct(1,1),Nt(Y)),[z.Match]:vt(i=>{let t=Ne;for(let e=2;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},Ct(4,1/0),bp,FR),[z.Between]:vt(te,Ct(3,3),Nt(Y)),[z.Interpolate]:vt(i=>{let t=Wt|Y;for(let e=3;e<i.length;e+=2)t&=i[e].type;return t},Ct(6,1/0),bp,NR),[z.Case]:vt(i=>{let t=Ne;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},Ct(3,1/0),OR,kR),[z.In]:vt(te,Ct(2,2),DR),[z.Number]:vt(Y,Ct(1,1/0),Nt(Ne)),[z.String]:vt(xe,Ct(1,1/0),Nt(Ne)),[z.Array]:vt(i=>i.length===3||i.length===4?me|Wt:me,Ct(1,1/0),Nt(Y)),[z.Color]:vt(Wt,Ct(1,4),Nt(Y)),[z.Band]:vt(Y,Ct(1,3),Nt(Y)),[z.Palette]:vt(Wt,Ct(2,2),GR),[z.ToString]:vt(xe,Ct(1,1),Nt(te|Y|xe|Wt))};function IR(i,t){const e=Bt(i[1],t);if(!(e instanceof os))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),i.length===3){const n=Bt(i[2],t);return[e,n]}return[e]}function PR(i,t,e,n){const s=i[1];if(typeof s!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(s),!("variables"in t.style)||t.style.variables[s]===void 0)return[new os(Ne,s)];const r=t.style.variables[s],o=Bt(r,t);if(o.value=s,n&&!ji(n,o.type))throw new Error(`The variable ${s} has type ${be(o.type)} but the following type was expected: ${be(n)}`);return[o]}function AR(i,t){t.featureId=!0}function LR(i,t){t.geometryType=!0}function xo(i,t){const e=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Ct(i,t){return function(e,n){const s=e[0],r=e.length-1;if(i===t){if(r!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${s}, got ${r}`)}}else if(r<i||r>t){const o=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`Expected ${o} arguments for ${s}, got ${r}`)}}}function Nt(i){return function(t,e){const n=t[0],s=t.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Bt(t[o+1],e);if(!ji(i,a.type)){const l=be(i),h=be(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,r[o]=a}return r}}function Yn(i,t,e){const n=i[0],s=i.length-1;let r=Ne;for(let a=0;a<e.length;++a)r&=e[a].type;if(r===Qs)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(s);for(let a=0;a<s;++a)o[a]=Bt(i[a+1],t,r);return o}function OR(i,t){const e=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function bp(i,t){const e=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function FR(i,t,e,n){const s=i.length-1;let r=Bt(i[1],t).type;const o=Bt(i[i.length-1],t);let a=n!==void 0?n&o.type:o.type;const l=new Array(s-2);for(let c=0;c<s-2;c+=2){const u=Bt(i[c+2],t),g=Bt(i[c+3],t);r&=u.type,a&=g.type,l[c]=u,l[c+1]=g}const h=xe|Y|te;if(!ji(h,r))throw new Error(`Expected an input of type ${be(h)} for the interpolate operation, got ${be(r)} instead`);if(Oa(a,Qs))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let c=0;c<s-2;c+=2){const u=Bt(i[c+2],t,r),g=Bt(i[c+3],t,a);l[c]=u,l[c+1]=g}return[Bt(i[1],t,r),...l,Bt(i[i.length-1],t,a)]}function NR(i,t,e,n){const s=i[1];let r;switch(s[0]){case"linear":r=1;break;case"exponential":if(r=s[1],typeof r!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(r)} instead`);break;default:r=null}if(!r)throw new Error(`Invalid interpolation type: ${JSON.stringify(s)}`);r=Bt(r,t);let o=Bt(i[2],t);if(!ji(Y,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${be(o.type)} instead`);o=Bt(i[2],t,Y);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=Bt(i[l+3],t);if(!ji(Y,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${be(h.type)} at position ${l+2} instead`);let c=Bt(i[l+4],t);if(!ji(Y|Wt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${be(c.type)} at position ${l+3} instead`);h=Bt(i[l+3],t,Y),c=Bt(i[l+4],t,Y|Wt),a[l]=h,a[l+1]=c}return[r,o,...a]}function kR(i,t,e,n){const s=Bt(i[i.length-1],t);let r=n!==void 0?n&s.type:s.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=Bt(i[a+1],t),h=Bt(i[a+2],t);if(!ji(te,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${be(l.type)} at position ${a} instead`);r&=h.type,o[a]=l,o[a+1]=h}if(Oa(r,Qs))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=Bt(i[a+2],t,r);return o[o.length-1]=Bt(i[i.length-1],t,r),o}function DR(i,t){let e=i[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=xe|Y;const s=new Array(e.length);for(let r=0;r<s.length;r++){const o=Bt(e[r],t);n&=o.type,s[r]=o}if(Oa(n,Qs))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[Bt(i[1],t,n),...s]}function GR(i,t){const e=Bt(i[1],t,Y);if(e.type!==Y)throw new Error(`The first argument of palette must be an number, got ${be(e.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const s=new Array(n.length);for(let r=0;r<s.length;r++){const o=Bt(n[r],t,Wt);if(!(o instanceof os))throw new Error(`The palette color at index ${r} must be a literal value`);if(!ji(o.type,Wt))throw new Error(`The palette color at index ${r} should be of type color, got ${be(o.type)} instead`);s[r]=o}return[e,...s]}function vt(i,...t){return function(e,n,s){const r=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,s)||o;let a=typeof i=="function"?i(o):i;if(s!==void 0){if(!ji(a,s))throw new Error(`The following expression was expected to return ${be(s)}, but returns ${be(a)} instead: ${JSON.stringify(e)}`);a&=s}if(a===Qs)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new C_(a,r,...o)}}function jR(i,t,e){const n=i[0],s=CR[n];if(!s)throw new Error(`Unknown operator: ${n}`);return s(i,t,e)}function qd(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return qd(i.getGeometries()[0]);default:return""}}function I_(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Wn(i,t,e){const n=Bt(i,e);if(!ji(t,n.type)){const s=be(t),r=be(n.type);throw new Error(`Expected expression to be of type ${s}, got ${r}`)}return Xi(n)}function Xi(i,t){if(i instanceof os){if(i.type===Wt&&typeof i.value=="string"){const n=vd(i.value);return function(){return n}}return function(){return i.value}}const e=i.operator;switch(e){case z.Number:case z.String:case z.Coalesce:return zR(i);case z.Get:case z.Var:return UR(i);case z.Id:return n=>n.featureId;case z.GeometryType:return n=>n.geometryType;case z.Concat:{const n=i.args.map(s=>Xi(s));return s=>"".concat(...n.map(r=>r(s).toString()))}case z.Resolution:return n=>n.resolution;case z.Any:case z.All:case z.Between:case z.In:case z.Not:return WR(i);case z.Equal:case z.NotEqual:case z.LessThan:case z.LessThanOrEqualTo:case z.GreaterThan:case z.GreaterThanOrEqualTo:return BR(i);case z.Multiply:case z.Divide:case z.Add:case z.Subtract:case z.Clamp:case z.Mod:case z.Pow:case z.Abs:case z.Floor:case z.Ceil:case z.Round:case z.Sin:case z.Cos:case z.Atan:case z.Sqrt:return qR(i);case z.Case:return XR(i);case z.Match:return ZR(i);case z.Interpolate:return $R(i);case z.ToString:return VR(i);default:throw new Error(`Unsupported operator ${e}`)}}function zR(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=Xi(i.args[r]);switch(e){case z.Coalesce:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case z.Number:case z.String:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function UR(i,t){const e=i.args[0].value;switch(i.operator){case z.Get:return n=>n.properties[e];case z.Var:return n=>n.variables[e];default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function BR(i,t){const e=i.operator,n=Xi(i.args[0]),s=Xi(i.args[1]);switch(e){case z.Equal:return r=>n(r)===s(r);case z.NotEqual:return r=>n(r)!==s(r);case z.LessThan:return r=>n(r)<s(r);case z.LessThanOrEqualTo:return r=>n(r)<=s(r);case z.GreaterThan:return r=>n(r)>s(r);case z.GreaterThanOrEqualTo:return r=>n(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function WR(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=Xi(i.args[r]);switch(e){case z.Any:return r=>{for(let o=0;o<n;++o)if(s[o](r))return!0;return!1};case z.All:return r=>{for(let o=0;o<n;++o)if(!s[o](r))return!1;return!0};case z.Between:return r=>{const o=s[0](r),a=s[1](r),l=s[2](r);return o>=a&&o<=l};case z.In:return r=>{const o=s[0](r);for(let a=1;a<n;++a)if(o===s[a](r))return!0;return!1};case z.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function qR(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=Xi(i.args[r]);switch(e){case z.Multiply:return r=>{let o=1;for(let a=0;a<n;++a)o*=s[a](r);return o};case z.Divide:return r=>s[0](r)/s[1](r);case z.Add:return r=>{let o=0;for(let a=0;a<n;++a)o+=s[a](r);return o};case z.Subtract:return r=>s[0](r)-s[1](r);case z.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case z.Mod:return r=>s[0](r)%s[1](r);case z.Pow:return r=>Math.pow(s[0](r),s[1](r));case z.Abs:return r=>Math.abs(s[0](r));case z.Floor:return r=>Math.floor(s[0](r));case z.Ceil:return r=>Math.ceil(s[0](r));case z.Round:return r=>Math.round(s[0](r));case z.Sin:return r=>Math.sin(s[0](r));case z.Cos:return r=>Math.cos(s[0](r));case z.Atan:return n===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case z.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function XR(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Xi(i.args[s]);return s=>{for(let r=0;r<e-1;r+=2)if(n[r](s))return n[r+1](s);return n[e-1](s)}}function ZR(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Xi(i.args[s]);return s=>{const r=n[0](s);for(let o=1;o<e;o+=2)if(r===n[o](s))return n[o+1](s);return n[e-1](s)}}function $R(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Xi(i.args[s]);return s=>{const r=n[0](s),o=n[1](s);let a,l;for(let h=2;h<e;h+=2){const c=n[h](s);let u=n[h+1](s);const g=Array.isArray(u);if(g&&(u=Gb(u)),c>=o)return h===2?u:g?YR(r,o,a,l,c,u):Ro(r,o,a,l,c,u);a=c,l=u}return l}}function VR(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=Xi(i.args[r]);switch(e){case z.ToString:return r=>{const o=s[0](r);return i.args[0].type===Wt?wd(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Ro(i,t,e,n,s,r){const o=s-e;if(o===0)return n;const a=t-e,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(r-n)}function YR(i,t,e,n,s,r){if(s-e===0)return n;const o=Of(n),a=Of(r);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[Ro(i,t,e,o[0],s,a[0]),Ro(i,t,e,o[1],s,a[1]),o[2]+Ro(i,t,e,0,s,l),Ro(i,t,e,n[3],s,r[3])];return I0(jb(h))}function HR(i){return!0}function KR(i){const t=Wd(),e=QR(i,t),n=I_();return function(s,r){if(n.properties=s.getPropertiesInternal(),n.resolution=r,t.featureId){const o=s.getId();o!==void 0?n.featureId=o:n.featureId=null}return t.geometryType&&(n.geometryType=qd(s.getGeometry())),e(n)}}function Ep(i){const t=Wd(),e=i.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=_u(i[o],t);const s=I_(),r=new Array(e);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,t.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<e;++h){const c=n[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function QR(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s){const r=i[s],o="filter"in r?Wn(r.filter,te,t):HR;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=_u(r.style[h],t)}else a=[_u(r.style,t)];n[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<e;++a){const l=n[a].filter;if(l(s)&&!(i[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function _u(i,t){const e=ra(i,"",t),n=oa(i,"",t),s=JR(i,t),r=tC(i,t),o=oi(i,"z-index",t);if(!e&&!n&&!s&&!r&&!Fn(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new Ve;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function ra(i,t,e){let n;if(t+"fill-pattern-src"in i?n=sC(i,t+"fill-",e):n=Xd(i,t+"fill-color",e),!n)return null;const s=new qi;return function(r){const o=n(r);return o==="none"?null:(s.setColor(o),s)}}function oa(i,t,e){const n=oi(i,t+"stroke-width",e),s=Xd(i,t+"stroke-color",e);if(!n&&!s)return null;const r=Tn(i,t+"stroke-line-cap",e),o=Tn(i,t+"stroke-line-join",e),a=P_(i,t+"stroke-line-dash",e),l=oi(i,t+"stroke-line-dash-offset",e),h=oi(i,t+"stroke-miter-limit",e),c=new cn;return function(u){if(s){const g=s(u);if(g==="none")return null;c.setColor(g)}if(n&&c.setWidth(n(u)),r){const g=r(u);if(g!=="butt"&&g!=="round"&&g!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(g)}if(o){const g=o(u);if(g!=="bevel"&&g!=="round"&&g!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(g)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function JR(i,t){const e="text-",n=Tn(i,e+"value",t);if(!n)return null;const s=ra(i,e,t),r=ra(i,e+"background-",t),o=oa(i,e,t),a=oa(i,e+"background-",t),l=Tn(i,e+"font",t),h=oi(i,e+"max-angle",t),c=oi(i,e+"offset-x",t),u=oi(i,e+"offset-y",t),g=aa(i,e+"overflow",t),f=Tn(i,e+"placement",t),p=oi(i,e+"repeat",t),_=Dh(i,e+"scale",t),x=aa(i,e+"rotate-with-view",t),v=oi(i,e+"rotation",t),w=Tn(i,e+"align",t),E=Tn(i,e+"justify",t),S=Tn(i,e+"baseline",t),T=P_(i,e+"padding",t),R=Gh(i,e+"declutter-mode"),C=new Bs({declutterMode:R});return function(P){if(C.setText(n(P)),s&&C.setFill(s(P)),r&&C.setBackgroundFill(r(P)),o&&C.setStroke(o(P)),a&&C.setBackgroundStroke(a(P)),l&&C.setFont(l(P)),h&&C.setMaxAngle(h(P)),c&&C.setOffsetX(c(P)),u&&C.setOffsetY(u(P)),g&&C.setOverflow(g(P)),f){const N=f(P);if(N!=="point"&&N!=="line")throw new Error("Expected point or line for text-placement");C.setPlacement(N)}if(p&&C.setRepeat(p(P)),_&&C.setScale(_(P)),x&&C.setRotateWithView(x(P)),v&&C.setRotation(v(P)),w){const N=w(P);if(N!=="left"&&N!=="center"&&N!=="right"&&N!=="end"&&N!=="start")throw new Error("Expected left, right, center, start, or end for text-align");C.setTextAlign(N)}if(E){const N=E(P);if(N!=="left"&&N!=="right"&&N!=="center")throw new Error("Expected left, right, or center for text-justify");C.setJustify(N)}if(S){const N=S(P);if(N!=="bottom"&&N!=="top"&&N!=="middle"&&N!=="alphabetic"&&N!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");C.setTextBaseline(N)}return T&&C.setPadding(T(P)),C}}function tC(i,t){return"icon-src"in i?eC(i,t):"shape-points"in i?iC(i,t):"circle-radius"in i?nC(i,t):null}function eC(i,t){const e="icon-",n=e+"src",s=A_(i[n],n),r=Bl(i,e+"anchor",t),o=Dh(i,e+"scale",t),a=oi(i,e+"opacity",t),l=Bl(i,e+"displacement",t),h=oi(i,e+"rotation",t),c=aa(i,e+"rotate-with-view",t),u=Tp(i,e+"anchor-origin"),g=Mp(i,e+"anchor-x-units"),f=Mp(i,e+"anchor-y-units"),p=lC(i,e+"color"),_=oC(i,e+"cross-origin"),x=aC(i,e+"offset"),v=Tp(i,e+"offset-origin"),w=Wl(i,e+"width"),E=Wl(i,e+"height"),S=rC(i,e+"size"),T=Gh(i,e+"declutter-mode"),R=new Rh({src:s,anchorOrigin:u,anchorXUnits:g,anchorYUnits:f,color:p,crossOrigin:_,offset:x,offsetOrigin:v,height:E,width:w,size:S,declutterMode:T});return function(C){return a&&R.setOpacity(a(C)),l&&R.setDisplacement(l(C)),h&&R.setRotation(h(C)),c&&R.setRotateWithView(c(C)),o&&R.setScale(o(C)),r&&R.setAnchor(r(C)),R}}function iC(i,t){const e="shape-",n=e+"points",s=e+"radius",r=yu(i[n],n),o=yu(i[s],s),a=ra(i,e,t),l=oa(i,e,t),h=Dh(i,e+"scale",t),c=Bl(i,e+"displacement",t),u=oi(i,e+"rotation",t),g=aa(i,e+"rotate-with-view",t),f=Wl(i,e+"radius2"),p=Wl(i,e+"angle"),_=Gh(i,e+"declutter-mode"),x=new Ch({points:r,radius:o,radius2:f,angle:p,declutterMode:_});return function(v){return a&&x.setFill(a(v)),l&&x.setStroke(l(v)),c&&x.setDisplacement(c(v)),u&&x.setRotation(u(v)),g&&x.setRotateWithView(g(v)),h&&x.setScale(h(v)),x}}function nC(i,t){const e="circle-",n=ra(i,e,t),s=oa(i,e,t),r=oi(i,e+"radius",t),o=Dh(i,e+"scale",t),a=Bl(i,e+"displacement",t),l=oi(i,e+"rotation",t),h=aa(i,e+"rotate-with-view",t),c=Gh(i,e+"declutter-mode"),u=new Ih({radius:5,declutterMode:c});return function(g){return r&&u.setRadius(r(g)),n&&u.setFill(n(g)),s&&u.setStroke(s(g)),a&&u.setDisplacement(a(g)),l&&u.setRotation(l(g)),h&&u.setRotateWithView(h(g)),o&&u.setScale(o(g)),u}}function oi(i,t,e){if(!(t in i))return;const n=Wn(i[t],Y,e);return function(s){return yu(n(s),t)}}function Tn(i,t,e){if(!(t in i))return null;const n=Wn(i[t],xe,e);return function(s){return A_(n(s),t)}}function sC(i,t,e){const n=Tn(i,t+"pattern-src",e),s=Sp(i,t+"pattern-offset",e),r=Sp(i,t+"pattern-size",e),o=Xd(i,t+"color",e);return function(a){return{src:n(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function aa(i,t,e){if(!(t in i))return null;const n=Wn(i[t],te,e);return function(s){const r=n(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function Xd(i,t,e){if(!(t in i))return null;const n=Wn(i[t],Wt|xe,e);return function(s){return L_(n(s),t)}}function P_(i,t,e){if(!(t in i))return null;const n=Wn(i[t],me,e);return function(s){return Fa(n(s),t)}}function Bl(i,t,e){if(!(t in i))return null;const n=Wn(i[t],me,e);return function(s){const r=Fa(n(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function Sp(i,t,e){if(!(t in i))return null;const n=Wn(i[t],me,e);return function(s){return O_(n(s),t)}}function Dh(i,t,e){if(!(t in i))return null;const n=Wn(i[t],me|Y,e);return function(s){return hC(n(s),t)}}function Wl(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function rC(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return se(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function oC(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function Tp(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Mp(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function aC(i,t){const e=i[t];if(e!==void 0)return Fa(e,t)}function Gh(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function lC(i,t){const e=i[t];if(e!==void 0)return L_(e,t)}function Fa(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let n=0;n<e;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function A_(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function yu(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function L_(i,t){if(typeof i=="string")return i;const e=Fa(i,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function O_(i,t){const e=Fa(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function hC(i,t){return typeof i=="number"?i:O_(i,t)}const Rp={RENDER_ORDER:"renderOrder"};class Na extends La{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Rp.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Bd(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(Rp.RENDER_ORDER,t)}setStyle(t){this.style_=cC(t),this.styleFunction_=t===null?void 0:eE(this.style_),this.changed()}}function cC(i){if(i===void 0)return iE;if(!i)return null;if(typeof i=="function"||i instanceof Ve)return i;if(!Array.isArray(i))return Ep([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof Ve){const n=new Array(t);for(let s=0;s<t;++s){const r=i[s];if(!(r instanceof Ve))throw new Error("Expected a list of style instances");n[s]=r}return n}if("style"in e){const n=new Array(t);for(let s=0;s<t;++s){const r=i[s];if(!("style"in r))throw new Error("Expected a list of rules with a style property");n[s]=r}return KR(n)}return Ep(i)}const ut={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},hl=[ut.FILL],as=[ut.STROKE],As=[ut.BEGIN_PATH],Cp=[ut.CLOSE_PATH];class F_{drawCustom(t,e,n,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class ka extends F_{constructor(t,e,n,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)s[0]=t[a],s[1]=t[a+1],xi(n,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,n,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=s);let c=t[e],u=t[e+1];const g=this.tmpCoordinate_;let f=!0,p,_,x;for(p=e+s;p<n;p+=s)g[0]=t[p],g[1]=t[p+1],x=Yc(h,g),x!==_?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=g[0],a[l++]=g[1]):x===Me.INTERSECTING?(a[l++]=g[0],a[l++]=g[1],f=!1):f=!0,c=g[0],u=g[1],_=x;return(r&&f||p===e+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,n,s,r){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(t,e,l,s,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,n,s,r){this.beginGeometry(t,e,r);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,g,f;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),g=[];const p=t.getEndss();f=0;for(let _=0,x=p.length;_<x;++_){const v=[];f=this.drawCustomCoordinates_(h,f,p[_],a,v),g.push(v)}this.instructions.push([ut.CUSTOM,l,g,t,n,iu,r]),this.hitDetectionInstructions.push([ut.CUSTOM,l,g,t,s||n,iu,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([ut.CUSTOM,l,u,t,n,Jo,r]),this.hitDetectionInstructions.push([ut.CUSTOM,l,u,t,s||n,Jo,r]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([ut.CUSTOM,l,c,t,n,Rn,r]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,s||n,Rn,r]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([ut.CUSTOM,l,c,t,n,Rn,r]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,s||n,Rn,r]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([ut.CUSTOM,l,c,t,n,void 0,r]),this.hitDetectionInstructions.push([ut.CUSTOM,l,c,t,s||n,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[ut.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ut.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let s,r,o=-1;for(e=0;e<n;++e)s=t[e],r=s[0],r==ut.END_GEOMETRY?o=e:r==ut.BEGIN_GEOMETRY&&(s[2]=e,Bx(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const s=t.getColor();n.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,n.fillStyle=nn(s||ni)}else n.fillStyle=void 0;if(e){const s=e.getColor();n.strokeStyle=nn(s||ia);const r=e.getLineCap();n.lineCap=r!==void 0?r:Br;const o=e.getLineDash();n.lineDash=o?o.slice():An;const a=e.getLineDashOffset();n.lineDashOffset=a||Ln;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:Wr;const h=e.getWidth();n.lineWidth=h!==void 0?h:sa;const c=e.getMiterLimit();n.miterLimit=c!==void 0?c:ea,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[ut.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ut.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,s=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||r!=t.currentLineDash&&!$s(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ut.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Qx(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Ii(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class uC extends ka{constructor(t,e,n,s){super(t,e,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!xi(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([ut.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=t.getStride())(!this.maxExtent||xi(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([ut.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const dC=uC;class gC extends ka{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinates_(t,e,n,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,s,!1,!1),a=[ut.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,e,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,An,Ln],As);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(as),this.endGeometry(e)}drawMultiLineString(t,e,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,An,Ln],As);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,g=a.length;u<g;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(as),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(as),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(as),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(As)}}const fC=gC;class pC extends ka{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinatess_(t,e,n,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=n.length;this.instructions.push(As),this.hitDetectionInstructions.push(As);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,g=this.appendFlatLineCoordinates(t,e,c,s,!0,!a),f=[ut.MOVE_TO_LINE_TO,u,g];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Cp),this.hitDetectionInstructions.push(Cp)),e=c}return o&&(this.instructions.push(hl),this.hitDetectionInstructions.push(hl)),a&&(this.instructions.push(as),this.hitDetectionInstructions.push(as)),e}drawCircle(t,e,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,ni]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,An,Ln]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[ut.CIRCLE,h];this.instructions.push(As,c),this.hitDetectionInstructions.push(As,c),s.fillStyle!==void 0&&(this.instructions.push(hl),this.hitDetectionInstructions.push(hl)),s.strokeStyle!==void 0&&(this.instructions.push(as),this.hitDetectionInstructions.push(as)),this.endGeometry(e)}drawPolygon(t,e,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,ni]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,An,Ln]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,ni]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,An,Ln]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,g=a.length;u<g;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,s=e.length;n<s;++n)e[n]=Ms(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const Ip=pC;function mC(i,t,e,n,s){const r=[];let o=e,a=0,l=t.slice(e,2);for(;a<i&&o+s<n;){const[h,c]=l.slice(-2),u=t[o+s],g=t[o+s+1],f=Math.sqrt((u-h)*(u-h)+(g-c)*(g-c));if(a+=f,a>=i){const p=(i-a+f)/f,_=mi(h,u,p),x=mi(c,g,p);l.push(_,x),r.push(l),l=[_,x],a==i&&(o+=s),a=0}else if(a<i)l.push(t[o+s],t[o+s+1]),o+=s;else{const p=f-a,_=mi(h,u,p/f),x=mi(c,g,p/f);l.push(_,x),r.push(l),l=[_,x],a=0,o+=s}}return a>0&&r.push(l),r}function _C(i,t,e,n,s){let r=e,o=e,a=0,l=0,h=e,c,u,g,f,p,_,x,v,w,E;for(u=e;u<n;u+=s){const S=t[u],T=t[u+1];p!==void 0&&(w=S-p,E=T-_,f=Math.sqrt(w*w+E*E),x!==void 0&&(l+=g,c=Math.acos((x*w+v*E)/(g*f)),c>i&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),g=f,x=w,v=E),p=S,_=T}return l+=f,l>a?[h,u]:[r,o]}const ql={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class yC extends ka{constructor(t,e,n,s){super(t,e,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ni]={fillStyle:ni},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Qt(this.maxExtent,t.getExtent()))return;let g;if(c=t.getFlatCoordinates(),h=="LineString")g=[c.length];else if(h=="MultiLineString")g=t.getEnds();else if(h=="Polygon")g=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const x=t.getEndss();g=[];for(let v=0,w=x.length;v<w;++v)g.push(x[v][0])}this.beginGeometry(t,e,n);const f=o.repeat,p=f?void 0:o.textAlign;let _=0;for(let x=0,v=g.length;x<v;++x){let w;f?w=mC(f*this.resolution,c,_,g[x],u):w=[c.slice(_,g[x])];for(let E=0,S=w.length;E<S;++E){const T=w[E];let R=0,C=T.length;if(p==null){const N=_C(o.maxAngle,T,0,T.length,2);R=N[0],C=N[1]}for(let N=R;N<C;N+=u)a.push(T[N],T[N+1]);const P=a.length;_=g[x],this.drawChars_(l,P),l=P}}this.endGeometry(e)}else{let g=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||g.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const w=t.getFlatInteriorPoints();c=[];for(let E=0,S=w.length;E<S;E+=3)o.overflow||g.push(w[E+2]/this.resolution),c.push(w[E],w[E+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(g&&(f-l)/2!==c.length/u){let w=l/2;g=g.filter((E,S)=>{const T=a[(w+S)*2]===c[S*u]&&a[(w+S)*2+1]===c[S*u+1];return T||--w,T})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let p=o.padding;if(p!=Is&&(o.scale[0]<0||o.scale[1]<0)){let w=o.padding[0],E=o.padding[1],S=o.padding[2],T=o.padding[3];o.scale[0]<0&&(E=-E,T=-T),o.scale[1]<0&&(w=-w,S=-S),p=[w,E,S,T]}const _=this.pixelRatio;this.instructions.push([ut.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,p==Is?Is:p.map(function(w){return w*_}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]);const x=1/_,v=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=ni,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,this.declutterMode_,this.declutterImageWithText_,p,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ni:this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]),o.backgroundFill&&(this.state.fillStyle=v,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||na,justify:e.justify,textBaseline:e.textBaseline||Nl,scale:e.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=ql[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,g=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([ut.DRAW_CHARS,t,e,h,s.overflow,a,s.maxAngle,l,c,r,g*l,u,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([ut.DRAW_CHARS,t,e,h,s.overflow,a&&ni,s.maxAngle,l,c,r,g*l,u,o,1/l,this.declutterMode_])}setTextStyle(t,e){let n,s,r;if(!t)this.text_="";else{const o=t.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=nn(o.getColor()||ni)):(s=null,this.textFillState_=s);const a=t.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const p=a.getLineDash(),_=a.getLineDashOffset(),x=a.getWidth(),v=a.getMiterLimit();r.lineCap=a.getLineCap()||Br,r.lineDash=p?p.slice():An,r.lineDashOffset=_===void 0?Ln:_,r.lineJoin=a.getLineJoin()||Wr,r.lineWidth=x===void 0?sa:x,r.miterLimit=v===void 0?ea:v,r.strokeStyle=nn(a.getColor()||ia)}n=this.textState_;const l=t.getFont()||F0;Hb(l);const h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||Nl,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Is,n.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),g=t.getRotateWithView(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=g===void 0?!1:g,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:st(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+st(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const xC={Circle:Ip,Default:ka,Image:dC,LineString:fC,Polygon:Ip,Text:yC};class N_{constructor(t,e,n,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const s in n){const r=n[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[e];if(r===void 0){const o=xC[e];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r}return r}}class k_ extends va{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ct()}getData(t){return null}prepareFrame(t){return ct()}renderFrame(t,e){return ct()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(s,r)=>{const o=this.loadedTileCallback.bind(this,n,s);return t.forEachLoadedTile(e,s,r,o)}}forEachFeatureAtCoordinate(t,e,n,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===et.LOADED||e.getState()===et.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=et.LOADED&&e!=et.ERROR&&t.addEventListener(Lt.CHANGE,this.boundHandleImageChange_),e==et.IDLE&&(t.load(),e=t.getState()),e==et.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class xl extends gn{constructor(t,e,n,s){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=s}}class Zd{constructor(){ju(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof ou()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,s=e.length;n<s;n+=2){const r=e[n],o=e[n+1];if(typeof t[r]=="function")t[r](...o);else{if(typeof o=="function"){t[r]=o(t);continue}t[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Pp=[];let pr=null;function vC(){pr=Jt(1,1,void 0,{willReadFrequently:!0})}class $d extends k_{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=pe(),this.pixelTransform=pe(),this.inversePixelTransform=pe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){pr||vC(),pr.clearRect(0,0,1,1);let s;try{pr.drawImage(t,e,n,1,1,0,0,1,1),s=pr.getImageData(0,0,1,1).data}catch{return pr=null,null}return s}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const s=this.getLayer().getClassName();let r,o;if(t&&t.className===s&&(!n||t&&t.style.backgroundColor&&$s(Wi(t.style.backgroundColor),Wi(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Jt();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const s=zn(n),r=Ea(n),o=mh(n),a=ba(n);ae(e.coordinateToPixelTransform,s),ae(e.coordinateToPixelTransform,r),ae(e.coordinateToPixelTransform,o),ae(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ae(l,s),ae(l,r),ae(l,o),ae(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){const r=new xl(t,this.inversePixelTransform,n,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(si.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(si.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Zd),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(si.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(si.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,s,r,o,a){const l=r/2,h=o/2,c=s/e,u=-c,g=-t[0]+a,f=-t[1];return hi(this.tempTransform,l,h,c,u,-n,g,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function wC(i,t,e,n,s,r,o,a,l,h,c,u){let g=i[t],f=i[t+1],p=0,_=0,x=0,v=0;function w(){p=g,_=f,t+=n,g=i[t],f=i[t+1],v+=x,x=Math.sqrt((g-p)*(g-p)+(f-_)*(f-_))}do w();while(t<e-n&&v+x<r);let E=x===0?0:(r-v)/x;const S=mi(p,g,E),T=mi(_,f,E),R=t-n,C=v,P=r+a*l(h,s,c);for(;t<e-n&&v+x<P;)w();E=x===0?0:(P-v)/x;const N=mi(p,g,E),U=mi(_,f,E);let j;if(u){const b=[S,T,N,U];o0(b,0,4,2,u,b,b),j=b[0]>b[2]}else j=S>N;const B=Math.PI,d=[],m=R+n===t;t=R,x=0,v=C,g=i[t],f=i[t+1];let y;if(m){w(),y=Math.atan2(f-_,g-p),j&&(y+=y>0?-B:B);const b=(N+S)/2,M=(U+T)/2;return d[0]=[b,M,(P-r)/2,y,s],d}s=s.replace(/\n/g," ");for(let b=0,M=s.length;b<M;){w();let I=Math.atan2(f-_,g-p);if(j&&(I+=I>0?-B:B),y!==void 0){let G=I-y;if(G+=G>B?-2*B:G<-B?2*B:0,Math.abs(G)>o)return null}y=I;const A=b;let L=0;for(;b<M;++b){const G=j?M-b-1:b,H=a*l(h,s[G],c);if(t+n<e&&v+x<r+L+H/2)break;L+=H}if(b===A)continue;const k=j?s.substring(M-A,M-b):s.substring(A,b);E=x===0?0:(r+L/2-v)/x;const W=mi(p,g,E),K=mi(_,f,E);d.push([W,K,L/2,I,k]),r+=L}return d}const rr=ze(),Hn=[],vn=[],wn=[],Kn=[];function Ap(i){return i[3].declutterBox}const Lp=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Tc(i,t){return t==="start"?t=Lp.test(i)?"right":"left":t==="end"&&(t=Lp.test(i)?"left":"right"),ql[t]}function bC(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}class EC{constructor(t,e,n,s,r){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=pe(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new Zd:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,s){const r=t+e+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),g=l.justify?ql[l.justify]:Tc(Array.isArray(t)?t[0]:t,l.textAlign||na),f=s&&o.lineWidth?o.lineWidth:0,p=u?t:t.split(`
`).reduce(bC,[]),{width:_,height:x,widths:v,heights:w,lineWidths:E}=Qb(l,p),S=_+f,T=[],R=(S+2)*c[0],C=(x+f)*c[1],P={width:R<0?Math.floor(R):Math.ceil(R),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:T};(c[0]!=1||c[1]!=1)&&T.push("scale",c),s&&(T.push("strokeStyle",o.strokeStyle),T.push("lineWidth",f),T.push("lineCap",o.lineCap),T.push("lineJoin",o.lineJoin),T.push("miterLimit",o.miterLimit),T.push("setLineDash",[o.lineDash]),T.push("lineDashOffset",o.lineDashOffset)),n&&T.push("fillStyle",a.fillStyle),T.push("textBaseline","middle"),T.push("textAlign","center");const N=.5-g;let U=g*S+N*f;const j=[],B=[];let d=0,m=0,y=0,b=0,M;for(let I=0,A=p.length;I<A;I+=2){const L=p[I];if(L===`
`){m+=d,d=0,U=g*S+N*f,++b;continue}const k=p[I+1]||l.font;k!==M&&(s&&j.push("font",k),n&&B.push("font",k),M=k),d=Math.max(d,w[y]);const W=[L,U+N*v[y]+g*(v[y]-E[b]),.5*(f+d)+m];U+=v[y],s&&j.push("strokeText",W),n&&B.push("fillText",W),++y}return Array.prototype.push.apply(T,j),Array.prototype.push.apply(T,B),this.labels_[r]=P,P}replayTextBackground_(t,e,n,s,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,s,r,o,a,l,h,c,u,g,f,p,_,x){a*=g[0],l*=g[1];let v=n-a,w=s-l;const E=r+h>t?t-h:r,S=o+c>e?e-c:o,T=p[3]+E*g[0]+p[1],R=p[0]+S*g[1]+p[2],C=v-p[3],P=w-p[0];(_||u!==0)&&(Hn[0]=C,Kn[0]=C,Hn[1]=P,vn[1]=P,vn[0]=C+T,wn[0]=vn[0],wn[1]=P+R,Kn[1]=wn[1]);let N;return u!==0?(N=hi(pe(),n,s,1,1,u,-n,-s),ae(N,Hn),ae(N,vn),ae(N,wn),ae(N,Kn),Bi(Math.min(Hn[0],vn[0],wn[0],Kn[0]),Math.min(Hn[1],vn[1],wn[1],Kn[1]),Math.max(Hn[0],vn[0],wn[0],Kn[0]),Math.max(Hn[1],vn[1],wn[1],Kn[1]),rr)):Bi(Math.min(C,C+T),Math.min(P,P+R),Math.max(C,C+T),Math.max(P,P+R),rr),f&&(v=Math.round(v),w=Math.round(w)),{drawImageX:v,drawImageY:w,drawImageW:E,drawImageH:S,originX:h,originY:c,declutterBox:{minX:rr[0],minY:rr[1],maxX:rr[2],maxY:rr[3],value:x},canvasTransform:N,scale:g}}replayImageOrLabel_(t,e,n,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Hn,vn,wn,Kn,o,a),Jb(t,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=ae(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(n[0]%s,n[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,s){const r=this.textStates[e],o=this.createLabel(t,e,s,n),a=this.strokeStates[n],l=this.pixelRatio,h=Tc(Array.isArray(t)?t[0]:t,r.textAlign||na),c=ql[r.textBaseline||Nl],u=a&&a.lineWidth?a.lineWidth:0,g=o.width/l-2*r.scale[0],f=h*g+2*(.5-h)*u,p=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:p}}execute_(t,e,n,s,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&$s(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=hs(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),Vx(this.renderedTransform_,n));let u=0;const g=s.length;let f=0,p,_,x,v,w,E,S,T,R,C,P,N,U,j=0,B=0,d=null,m=null;const y=this.coordinateCache_,b=this.viewRotation_,M=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,I={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:b},A=this.instructions!=s||this.overlaps?0:200;let L,k,W,K;for(;u<g;){const G=s[u];switch(G[0]){case ut.BEGIN_GEOMETRY:L=G[1],K=G[3],L.getGeometry()?a!==void 0&&!Qt(a,K.getExtent())?u=G[2]+1:++u:u=G[2],h&&(h.zIndex=G[4]);break;case ut.BEGIN_PATH:j>A&&(this.fill_(t),j=0),B>A&&(t.stroke(),B=0),!j&&!B&&(t.beginPath(),w=NaN,E=NaN),++u;break;case ut.CIRCLE:f=G[1];const H=c[f],Q=c[f+1],nt=c[f+2],xt=c[f+3],dt=nt-H,Tt=xt-Q,Et=Math.sqrt(dt*dt+Tt*Tt);t.moveTo(H+Et,Q),t.arc(H,Q,Et,0,2*Math.PI,!0),++u;break;case ut.CLOSE_PATH:t.closePath(),++u;break;case ut.CUSTOM:f=G[1],p=G[2];const kt=G[3],Yt=G[4],ue=G[5];I.geometry=kt,I.feature=L,u in y||(y[u]=[]);const Ht=y[u];ue?ue(c,f,p,2,Ht):(Ht[0]=c[f],Ht[1]=c[f+1],Ht.length=2),h&&(h.zIndex=G[6]),Yt(Ht,I),++u;break;case ut.DRAW_IMAGE:f=G[1],p=G[2],R=G[3],_=G[4],x=G[5];let Ke=G[6];const $a=G[7],ic=G[8],Va=G[9],Ya=G[10];let fi=G[11];const Li=G[12];let $i=G[13];v=G[14]||"declutter";const Oi=G[15];if(!R&&G.length>=20){C=G[19],P=G[20],N=G[21],U=G[22];const wi=this.drawLabelWithPointPlacement_(C,P,N,U);R=wi.label,G[3]=R;const ws=G[23];_=(wi.anchorX-ws)*this.pixelRatio,G[4]=_;const bi=G[24];x=(wi.anchorY-bi)*this.pixelRatio,G[5]=x,Ke=R.height,G[6]=Ke,$i=R.width,G[13]=$i}let tr;G.length>25&&(tr=G[25]);let er,Zn,pn;G.length>17?(er=G[16],Zn=G[17],pn=G[18]):(er=Is,Zn=!1,pn=!1),Ya&&M?fi+=b:!Ya&&!M&&(fi-=b);let nc=0;for(;f<p;f+=2){if(tr&&tr[nc++]<$i/this.pixelRatio)continue;const wi=this.calculateImageOrLabelDimensions_(R.width,R.height,c[f],c[f+1],$i,Ke,_,x,ic,Va,fi,Li,r,er,Zn||pn,L),ws=[t,e,R,wi,$a,Zn?d:null,pn?m:null];if(l){let bi,Vi,Ei;if(Oi){const de=p-f;if(!Oi[de]){Oi[de]={args:ws,declutterMode:v};continue}const We=Oi[de];bi=We.args,Vi=We.declutterMode,delete Oi[de],Ei=Ap(bi)}let mn,_n;if(bi&&(Vi!=="declutter"||!l.collides(Ei))&&(mn=!0),(v!=="declutter"||!l.collides(wi.declutterBox))&&(_n=!0),Vi==="declutter"&&v==="declutter"){const de=mn&&_n;mn=de,_n=de}mn&&(Vi!=="none"&&l.insert(Ei),this.replayImageOrLabel_.apply(this,bi)),_n&&(v!=="none"&&l.insert(wi.declutterBox),this.replayImageOrLabel_.apply(this,ws))}else this.replayImageOrLabel_.apply(this,ws)}++u;break;case ut.DRAW_CHARS:const Be=G[1],Hg=G[2],sc=G[3],sx=G[4];U=G[5];const rx=G[6],Kg=G[7],Qg=G[8];N=G[9];const rc=G[10];C=G[11],P=G[12];const Jg=[G[13],G[13]];v=G[14]||"declutter";const oc=this.textStates[P],go=oc.font,fo=[oc.scale[0]*Kg,oc.scale[1]*Kg];let po;go in this.widths_?po=this.widths_[go]:(po={},this.widths_[go]=po);const tf=f0(c,Be,Hg,2),ef=Math.abs(fo[0])*kf(go,C,po);if(sx||ef<=tf){const wi=this.textStates[P].textAlign,ws=(tf-ef)*Tc(C,wi),bi=wC(c,Be,Hg,2,C,ws,rx,Math.abs(fo[0]),kf,go,po,M?0:this.viewRotation_);t:if(bi){const Vi=[];let Ei,mn,_n,de,We;if(N)for(Ei=0,mn=bi.length;Ei<mn;++Ei){We=bi[Ei],_n=We[4],de=this.createLabel(_n,P,"",N),_=We[2]+(fo[0]<0?-rc:rc),x=sc*de.height+(.5-sc)*2*rc*fo[1]/fo[0]-Qg;const yn=this.calculateImageOrLabelDimensions_(de.width,de.height,We[0],We[1],de.width,de.height,_,x,0,0,We[3],Jg,!1,Is,!1,L);if(l&&v==="declutter"&&l.collides(yn.declutterBox))break t;Vi.push([t,e,de,yn,1,null,null])}if(U)for(Ei=0,mn=bi.length;Ei<mn;++Ei){We=bi[Ei],_n=We[4],de=this.createLabel(_n,P,U,""),_=We[2],x=sc*de.height-Qg;const yn=this.calculateImageOrLabelDimensions_(de.width,de.height,We[0],We[1],de.width,de.height,_,x,0,0,We[3],Jg,!1,Is,!1,L);if(l&&v==="declutter"&&l.collides(yn.declutterBox))break t;Vi.push([t,e,de,yn,1,null,null])}l&&v!=="none"&&l.load(Vi.map(Ap));for(let yn=0,ox=Vi.length;yn<ox;++yn)this.replayImageOrLabel_.apply(this,Vi[yn])}}++u;break;case ut.END_GEOMETRY:if(o!==void 0){L=G[1];const wi=o(L,K);if(wi)return wi}++u;break;case ut.FILL:A?j++:this.fill_(t),++u;break;case ut.MOVE_TO_LINE_TO:for(f=G[1],p=G[2],k=c[f],W=c[f+1],S=k+.5|0,T=W+.5|0,(S!==w||T!==E)&&(t.moveTo(k,W),w=S,E=T),f+=2;f<p;f+=2)k=c[f],W=c[f+1],S=k+.5|0,T=W+.5|0,(f==p-2||S!==w||T!==E)&&(t.lineTo(k,W),w=S,E=T);++u;break;case ut.SET_FILL_STYLE:d=G,this.alignAndScaleFill_=G[2],j&&(this.fill_(t),j=0,B&&(t.stroke(),B=0)),t.fillStyle=G[1],++u;break;case ut.SET_STROKE_STYLE:m=G,B&&(t.stroke(),B=0),this.setStrokeStyle_(t,G),++u;break;case ut.STROKE:A?B++:t.stroke(),++u;break;default:++u;break}}j&&this.fill_(t),B&&t.stroke()}execute(t,e,n,s,r,o){this.viewRotation_=s,this.execute_(t,e,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,n,s,r){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,r)}}const zo=["Polygon","Circle","LineString","Image","Text","Default"],Xl=["Image","Text"],SC=zo.filter(i=>!Xl.includes(i));class D_{constructor(t,e,n,s,r,o,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=pe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let s=this.executorsByZIndex_[n];s===void 0&&(s={},this.executorsByZIndex_[n]=s);const r=t[n];for(const o in r){const a=r[o];s[o]=new EC(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,s,r,o){s=Math.round(s);const a=s*2+1,l=hi(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Jt(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=ze(),No(u,t),Ii(u,e*(this.renderBuffer_+s),u));const g=TC(s);let f;function p(T,R){const C=c.getImageData(0,0,a,a).data;for(let P=0,N=g.length;P<N;P++)if(C[g[P]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(T)){const U=(g[P]-3)/4,j=s-U%a,B=s-(U/a|0),d=r(T,R,j*j+B*B);if(d)return d}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(on);let x,v,w,E,S;for(x=_.length-1;x>=0;--x){const T=_[x].toString();for(w=this.executorsByZIndex_[T],v=zo.length-1;v>=0;--v)if(f=zo[v],E=w[f],E!==void 0&&(S=E.executeHitDetection(c,l,n,p,u),S))return S}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],s=e[1],r=e[2],o=e[3],a=[n,s,n,o,r,o,r,s];return hs(a,0,8,2,t,a),a}isEmpty(){return Fn(this.executorsByZIndex_)}execute(t,e,n,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(on),o=o||zo;let h,c,u,g,f,p;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const _=l[h].toString();for(f=this.executorsByZIndex_[_],u=0,g=o.length;u<g;++u){const x=o[u];if(p=f[x],p!==void 0){const v=a===null?void 0:p.getZIndexContext(),w=v?v.getContext():t,E=this.maxExtent_&&x!=="Image"&&x!=="Text";if(E&&(w.save(),this.clip(w,n)),p.execute(w,e,n,s,r,a),E&&w.restore(),v){v.offset();const S=l[h];this.deferredZIndexContexts_[S]||(this.deferredZIndexContexts_[S]=[]),this.deferredZIndexContexts_[S].push(v)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(on);for(let n=0,s=e.length;n<s;++n)t[e[n]].forEach(r=>{r.draw(this.renderedContext_),r.clear()})}}const Mc={};function TC(i){if(Mc[i]!==void 0)return Mc[i];const t=i*2+1,e=i*i,n=new Array(e+1);for(let r=0;r<=i;++r)for(let o=0;o<=i;++o){const a=r*r+o*o;if(a>e)break;let l=n[a];l||(l=[],n[a]=l),l.push(((i+r)*t+(i+o))*4+3),r>0&&l.push(((i-r)*t+(i+o))*4+3),o>0&&(l.push(((i+r)*t+(i-o))*4+3),r>0&&l.push(((i-r)*t+(i-o))*4+3))}const s=[];for(let r=0,o=n.length;r<o;++r)n[r]&&s.push(...n[r]);return Mc[i]=s,s}class MC extends F_{constructor(t,e,n,s,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=s,this.transformRotation_=s?Ta(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=pe()}drawImages_(t,e,n,s){if(!this.image_)return;const r=hs(t,e,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const g=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=g+this.imageAnchorX_,_=f+this.imageAnchorY_;hi(a,p,_,1,1,h,-p,-_),o.save(),o.transform.apply(o,a),o.translate(p,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=hs(t,e,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=s){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,s,r){const o=this.context_,a=hs(t,e,n,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),n}drawRings_(t,e,n,s){for(let r=0,o=n.length;r<o;++r)e=this.moveToLineTo_(t,e,n[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Iv(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(n*n+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,s=e.length;n<s;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Qt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Qt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(n,s,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),$s(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:na;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=s&&(n.textAlign=s,e.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:nn(n||ni)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||An;this.strokeState_={lineCap:s!==void 0?s:Br,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Ln)*this.pixelRatio_,lineJoin:a!==void 0?a:Wr,lineWidth:(l!==void 0?l:sa)*this.pixelRatio_,miterLimit:h!==void 0?h:ea,strokeStyle:nn(n||ia)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:nn(f||ni)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const f=n.getColor(),p=n.getLineCap(),_=n.getLineDash(),x=n.getLineDashOffset(),v=n.getLineJoin(),w=n.getWidth(),E=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Br,lineDash:_||An,lineDashOffset:x||Ln,lineJoin:v!==void 0?v:Wr,lineWidth:w!==void 0?w:sa,miterLimit:E!==void 0?E:ea,strokeStyle:nn(f||ia)}}const s=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),g=t.getTextBaseline();this.textState_={font:s!==void 0?s:F0,textAlign:u!==void 0?u:na,textBaseline:g!==void 0?g:Nl},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,p,_)=>f+=_%2?" ":p,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const G_=MC,_i=.5;function j_(i,t,e,n,s,r,o,a,l){const h=l?yh(s):s,c=i[0]*_i,u=i[1]*_i,g=Jt(c,u);g.imageSmoothingEnabled=!1;const f=g.canvas,p=new G_(g,_i,s,null,o,a,l?Hs(Sv(),l):null),_=e.length,x=Math.floor((256*256*256-1)/_),v={};for(let E=1;E<=_;++E){const S=e[E-1],T=S.getStyleFunction()||n;if(!T)continue;let R=T(S,r);if(!R)continue;Array.isArray(R)||(R=[R]);const C=(E*x).toString(16).padStart(7,"#00000");for(let P=0,N=R.length;P<N;++P){const U=R[P],j=U.getGeometryFunction()(S);if(!j||!Qt(h,j.getExtent()))continue;const B=U.clone(),d=B.getFill();d&&d.setColor(C);const m=B.getStroke();m&&(m.setColor(C),m.setLineDash(null)),B.setText(void 0);const y=U.getImage();if(y){const A=y.getImageSize();if(!A)continue;const L=Jt(A[0],A[1],void 0,{alpha:!1}),k=L.canvas;L.fillStyle=C,L.fillRect(0,0,k.width,k.height),B.setImage(new Rh({img:k,anchor:y.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:y.getOrigin(),opacity:1,size:y.getSize(),scale:y.getScale(),rotation:y.getRotation(),rotateWithView:y.getRotateWithView()}))}const b=B.getZIndex()||0;let M=v[b];M||(M={},v[b]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]);const I=j.getType();if(I==="GeometryCollection"){const A=j.getGeometriesArrayRecursive();for(let L=0,k=A.length;L<k;++L){const W=A[L];M[W.getType().replace("Multi","")].push(W,B)}}else M[I.replace("Multi","")].push(j,B)}}const w=Object.keys(v).map(Number).sort(on);for(let E=0,S=w.length;E<S;++E){const T=v[w[E]];for(const R in T){const C=T[R];for(let P=0,N=C.length;P<N;P+=2){p.setStyle(C[P+1]);for(let U=0,j=t.length;U<j;++U)p.setTransform(t[U]),p.drawGeometry(C[P])}}}return g.getImageData(0,0,f.width,f.height)}function z_(i,t,e){const n=[];if(e){const s=Math.floor(Math.round(i[0])*_i),r=Math.floor(Math.round(i[1])*_i),o=(wt(s,0,e.width-1)+wt(r,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&n.push(t[h/c-1])}return n}const RC=.5,U_={Point:NC,LineString:LC,Polygon:DC,MultiPoint:kC,MultiLineString:OC,MultiPolygon:FC,GeometryCollection:AC,Circle:IC};function CC(i,t){return parseInt(st(i),10)-parseInt(st(t),10)}function Zl(i,t){const e=B_(i,t);return e*e}function B_(i,t){return RC*i/t}function IC(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,n,s)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function $l(i,t,e,n,s,r,o,a){const l=[],h=e.getImage();if(h){let g=!0;const f=h.getImageState();f==et.LOADED||f==et.ERROR?g=!1:f==et.IDLE&&h.load(),g&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>s(null)),PC(i,t,e,n,r,o,a),u}function PC(i,t,e,n,s,r,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,s);if(e.getRenderer())W_(i,l,e,t,o);else{const h=U_[l.getType()];h(i,l,e,t,o,r)}}function W_(i,t,e,n,s){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)W_(i,r[o],e,n,s);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),s)}function AC(i,t,e,n,s,r){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=U_[o[a].getType()];h(i,o[a],e,n,s,r)}}function LC(i,t,e,n,s){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,n,s)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,s)}}function OC(i,t,e,n,s){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,n,s)}const o=e.getText();if(o&&o.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n,s)}}function FC(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(o||r){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,n,s)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,s)}}function NC(i,t,e,n,s,r){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=et.LOADED)return;const c=i.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,n,s)}if(l){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,n,s)}}function kC(i,t,e,n,s,r){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=et.LOADED)return;const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,n,s)}if(h){const u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,n,s)}}function DC(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,n,s)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n,s)}}class q_ extends $d{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ze(),this.wrappedRenderedExtent_=ze(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const s=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),g=this.getLayer().getDeclutter(),f=e.pixelRatio,p=e.viewHints,_=!(p[ee.ANIMATING]||p[ee.INTERACTING]),x=this.context,v=Math.round(yt(s)/a*f),w=Math.round(Vt(s)/a*f),E=u.getWrapX()&&l.canWrapX(),S=E?yt(c):null,T=E?Math.ceil((s[2]-c[2])/S)+1:1;let R=E?Math.floor((s[0]-c[0])/S):0;do{const C=this.getRenderTransform(o,a,h,f,v,w,R*S);t.execute(x,[x.canvas.width,x.canvas.height],C,h,_,n===void 0?zo:n?Xl:SC,n?g&&e.declutter[g]:void 0)}while(++R<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Jt(this.context.canvas.width,this.context.canvas.height,Pp))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Us(this.context),Pp.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const n=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];this.opacity_=s.opacity;const r=t.extent,o=t.viewState.resolution,a=Math.round(yt(r)/o*n),l=Math.round(Vt(r)/o*n);hi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,0,-a/2,-l/2),ph(this.inversePixelTransform,this.pixelTransform);const h=qu(this.pixelTransform);this.useContainer(e,h,this.getBackground(t));const c=this.context,u=c.canvas,g=this.replayGroup_;let f=g&&!g.isEmpty();if(!f&&!(this.getLayer().hasListener(si.PRERENDER)||this.getLayer().hasListener(si.POSTRENDER)))return null;u.width!=a||u.height!=l?(u.width=a,u.height=l,u.style.transform!==h&&(u.style.transform=h)):this.containerReused||c.clearRect(0,0,a,l),this.setDrawContext_(),this.preRender(c,t);const p=t.viewState;p.projection;let _=!1;if(f&&s.extent&&this.clipping){const x=Gi(s.extent);f=Qt(x,t.extent),_=f&&!Ze(x,t.extent),_&&this.clipUnrotated(c,t,x)}return f&&this.renderWorlds(g,t,this.getLayer().getDeclutter()?!1:void 0),_&&c.restore(),this.postRender(c,t),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];ae(this.pixelTransform,n);const s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*_i,g=n[1]*_i;c.push(this.getRenderTransform(s,r,o,_i,u,g,0).slice());const f=h.getSource(),p=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!Ze(p,l)){let _=l[0];const x=yt(p);let v=0,w;for(;_<p[0];)--v,w=x*v,c.push(this.getRenderTransform(s,r,o,_i,u,g,w).slice()),_+=x;for(v=0,_=l[2];_>p[2];)++v,w=x*v,c.push(this.getRenderTransform(s,r,o,_i,u,g,w).slice()),_-=x}this.hitDetectionImageData_=j_(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,Zl(r,this.renderedPixelRatio_),null)}e(z_(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,s,r){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(p,_,x){const v=st(p),w=h[v];if(w){if(w!==!0&&x<w.distanceSq){if(x===0)return h[v]=!0,r.splice(r.lastIndexOf(w),1),s(p,l,_);w.geometry=_,w.distanceSq=x}}else{if(x===0)return h[v]=!0,s(p,l,_);r.push(h[v]={feature:p,layer:l,geometry:_,distanceSq:x,callback:s})}};let u;const g=[this.replayGroup_],f=this.getLayer().getDeclutter();return g.some(p=>u=p.forEachFeatureAtCoordinate(t,o,a,n,c,f&&e.declutter[f]?e.declutter[f].all().map(_=>_.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const s=t.viewHints[ee.ANIMATING],r=t.viewHints[ee.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,g=t.pixelRatio,f=e.getRevision(),p=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=CC);const x=h.center.slice(),v=Ii(l,p*u),w=v.slice(),E=[v.slice()],S=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!Ze(S,t.extent)){const m=yt(S),y=Math.max(yt(v)/2,m);v[0]=S[0]-y,v[2]=S[2]+y,i0(x,c);const b=Yu(E[0],c);b[0]<S[0]&&b[2]<S[2]?E.push([b[0]+m,b[1],b[2]+m,b[3]]):b[0]>S[0]&&b[2]>S[2]&&E.push([b[0]-m,b[1],b[2]-m,b[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&Ze(this.wrappedRenderedExtent_,v))return $s(this.renderedExtent_,w)||(this.hitDetectionImageData_=null,this.renderedExtent_=w),this.renderedCenter_=x,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new N_(B_(u,g),v,u,g);let R;for(let m=0,y=E.length;m<y;++m)n.loadFeatures(E[m],u,c);const C=Zl(u,g);let P=!0;const N=(m,y)=>{let b;const M=m.getStyleFunction()||e.getStyleFunction();if(M&&(b=M(m,u)),b){const I=this.renderFeature(m,C,b,T,R,this.getLayer().getDeclutter(),y);P=P&&!I}},U=yh(v),j=n.getFeaturesInExtent(U);_&&j.sort(_);for(let m=0,y=j.length;m<y;++m)N(j[m],m);this.renderedFeatures_=j,this.ready=P;const B=T.finish(),d=new D_(v,u,g,n.getOverlaps(),B,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedExtent_=w,this.wrappedRenderedExtent_=v,this.renderedCenter_=x,this.renderedProjection_=c,this.renderedPixelRatio_=g,this.replayGroup_=d,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,s,r,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=$l(s,t,n[h],e,this.boundHandleStyleImageChange_,r,o,a)||l;else l=$l(s,t,n,e,this.boundHandleStyleImageChange_,r,o,a);return l}}class Vd extends Na{constructor(t){super(t)}createRenderer(){return new q_(this)}}class Op{constructor(t){this.rbush_=new Bd(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[st(e)]=n}load(t,e){const n=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const o=t[s],a=e[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[s]=l,this.items_[st(a)]=l}this.rbush_.load(n)}remove(t){const e=st(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[st(e)],s=[n.minX,n.minY,n.maxX,n.maxY];Nn(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let s=0,r=t.length;s<r;s++)if(n=e(t[s]),n)return n;return n}isEmpty(){return Fn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Bi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class GC extends Vs{constructor(t){super(),this.projection=tt(t.projection),this.attributions_=Fp(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,s){e.viewResolver=n,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Fp(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Fp(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}const oo=GC,ke={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function jC(i,t){return[[-1/0,-1/0,1/0,1/0]]}let zC=!1;function X_(i,t,e,n,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(e,n,s):i,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=zC,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:s}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Np(i,t){return function(e,n,s,r,o){const a=this;X_(i,t,e,n,s,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||Yo)}}class Qn extends gn{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class jh extends oo{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Yo,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(At(this.format_,"`format` must be set when `url` is set"),this.loader_=Np(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:jC;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Op:null,this.loadedExtentsRtree_=new Op,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(t.features)?s=t.features:t.features&&(n=t.features,s=n.getArray()),!e&&n===void 0&&(n=new Ul(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=st(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Qn(ke.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Ge||(this.featureChangeKeys_[t]=[le(e,Lt.CHANGE,this.handleFeatureChange_,this),le(e,zu.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof Ge){const r=this.idIndex_[s];r instanceof Ge?Array.isArray(r)?r.push(e):this.idIndex_[s]=[r,e]:n=!1}else n=!1}return n&&(At(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],s=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=st(a);this.addToIndex_(l,a)&&n.push(a)}for(let r=0,o=n.length;r<o;r++){const a=n[r],l=st(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(ke.ADDFEATURE))for(let r=0,o=n.length;r<o;r++)this.dispatchEvent(new Qn(ke.ADDFEATURE,n[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(ke.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(ke.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(rs.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(rs.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(ve);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(n);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Qn(ke.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(s){const r=s.getGeometry();if(r instanceof Ge||r.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const s=n.getGeometry();if(s instanceof Ge||s.intersectsExtent(t)){const r=e(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Fn(this.nullGeometryFeatures_)||Ot(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=sv(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],s=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||qx,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Ge?0:c.closestPointXY(n,s,o,a),a<u){r=h;const g=Math.sqrt(a);l[0]=n-g,l[1]=s-g,l[2]=n+g,l[3]=s+g}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=st(e),s=e.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const o=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const r=e.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Qn(ke.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:st(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Fn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,n);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(h){return Ze(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Qn(ke.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qn(ke.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qn(ke.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(s){if(Nn(s.extent,t))return n=s,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,s=t.length;n<s;++n){const r=t[n],o=this.removeFeatureInternal(r);o&&e.push(o)}e.length>0&&this.changed()}removeFeature(t){t&&this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=st(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const n=this.featureChangeKeys_[e];if(!n)return;n.forEach(ve),delete this.featureChangeKeys_[e];const s=t.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[e],this.hasListener(ke.REMOVEFEATURE)&&this.dispatchEvent(new Qn(ke.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const s=this.idIndex_[n];if(t instanceof Ge&&Array.isArray(s)&&s.includes(t))s.splice(s.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){At(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Np(t,this.format_))}}function UC(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=i.inversePixelTransform[0],e=i.inversePixelTransform[1],n=Math.sqrt(t*t+e*e),s=i.frameState,r=Qr(i.inversePixelTransform.slice(),s.coordinateToPixelTransform),o=Zl(s.viewState.resolution,n);let a;return new G_(i.context,n,s.extent,r,s.viewState.rotation,o,a)}function Z_(i,t,e){const n=[];let s=i(0),r=i(1),o=t(s),a=t(r);const l=[r,s],h=[a,o],c=[1,0],u={};let g=1e5,f,p,_,x,v,w;for(;--g>0&&c.length>0;)_=c.pop(),s=l.pop(),o=h.pop(),w=_.toString(),w in u||(n.push(o[0],o[1]),u[w]=!0),x=c.pop(),r=l.pop(),a=h.pop(),v=(_+x)/2,f=i(v),p=t(f),t0(p[0],p[1],o[0],o[1],a[0],a[1])<e?(n.push(a[0],a[1]),w=x.toString(),u[w]=!0):(c.push(x,v,v,_),h.push(a,p,p,o),l.push(r,f,f,s));return n}function BC(i,t,e,n,s){const r=tt("EPSG:4326");return Z_(function(o){return[i,t+(e-t)*o]},hn(r,n),s)}function WC(i,t,e,n,s){const r=tt("EPSG:4326");return Z_(function(o){return[t+(e-t)*o,i]},hn(r,n),s)}const qC=new cn({color:"rgba(0,0,0,0.2)"}),XC=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class ZC extends Vd{constructor(t){t=t||{};const e=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete e.maxLines,delete e.strokeStyle,delete e.targetSize,delete e.showLabels,delete e.lonLabelFormatter,delete e.latLabelFormatter,delete e.lonLabelPosition,delete e.latLabelPosition,delete e.lonLabelStyle,delete e.latLabelStyle,delete e.intervals,super(e),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:qC,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?yf.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?yf.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new Ve({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new Bs({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new qi({color:"rgba(0,0,0,1)"}),stroke:new cn({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const s=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(s),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Ve({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new Bs({font:"12px Calibri,sans-serif",textAlign:"right",fill:new qi({color:"rgba(0,0,0,1)"}),stroke:new cn({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const s=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(s),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(si.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:XC,this.setSource(new jh({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Ul,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new Ve({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,e){let n=t.slice();return this.projection_&&this.getSource().getWrapX()&&Yu(n,this.projection_),this.loadedExtent_&&(Jx(this.loadedExtent_,n,e)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(t,e,n){this.loadedExtent_=t;const s=this.getSource(),r=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=we(r,t);if(this.renderedExtent_&&Nn(this.renderedExtent_,o)&&this.renderedResolution_===e||(this.renderedExtent_=o,this.renderedResolution_=e,Un(o)))return;const a=Ce(o),l=e*e/4;(!this.projection_||!Ae(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,e,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let c;for(;h>this.featurePool_.length;)c=new Ee,this.featurePool_.push(c);const u=s.getFeaturesCollection();u.clear();let g=0,f,p;for(f=0,p=this.meridians_.length;f<p;++f)c=this.featurePool_[g++],c.setGeometry(this.meridians_[f]),c.setStyle(this.lineStyle_),u.push(c);for(f=0,p=this.parallels_.length;f<p;++f)c=this.featurePool_[g++],c.setGeometry(this.parallels_[f]),c.setStyle(this.lineStyle_),u.push(c)}addMeridian_(t,e,n,s,r,o){const a=this.getMeridian_(t,e,n,s,o);if(Qt(a.getExtent(),r)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(t);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new Re([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(t,e,n,s,r,o){const a=this.getParallel_(t,e,n,s,o);if(Qt(a.getExtent(),r)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(t);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new Re([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(t){const e=t.frameState.viewState.rotation,n=t.frameState.viewState.resolution,s=t.frameState.size,r=t.frameState.extent,o=Ce(r);let a=r;if(e){const p=s[0]*n,_=s[1]*n;a=[o[0]-p/2,o[1]-_/2,o[0]+p/2,o[1]+_/2]}let l=0,h=0,c=this.latLabelPosition_<.5;const u=this.projection_.getExtent(),g=yt(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ze(u,r)){l=Math.floor((r[0]-u[0])/g),h=Math.ceil((r[2]-u[2])/g);const p=Math.abs(e)>Math.PI/2;c=c!==p}const f=UC(t);for(let p=l;p<=h;++p){let _=this.meridians_.length+this.parallels_.length,x,v,w,E;if(this.meridiansLabels_)for(v=0,w=this.meridiansLabels_.length;v<w;++v){const S=this.meridians_[v];if(!e&&p===0)E=this.getMeridianPoint_(S,r,v);else{const T=S.clone();T.translate(p*g,0),T.rotate(-e,o),E=this.getMeridianPoint_(T,a,v),E.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(E),x.set("graticule_label",this.meridiansLabels_[v].text),f.drawFeature(x,this.lonLabelStyle_(x))}if(this.parallelsLabels_&&(p===l&&c||p===h&&!c))for(v=0,w=this.parallels_.length;v<w;++v){const S=this.parallels_[v];if(!e&&p===0)E=this.getParallelPoint_(S,r,v);else{const T=S.clone();T.translate(p*g,0),T.rotate(-e,o),E=this.getParallelPoint_(T,a,v),E.rotate(e,o)}x=this.featurePool_[_++],x.setGeometry(E),x.set("graticule_label",this.parallelsLabels_[v].text),f.drawFeature(x,this.latLabelStyle_(x))}}}createGraticule_(t,e,n,s){const r=this.getInterval_(n);if(r==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=yt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ze(a,t)&&(yt(t)>=l?(t[0]=a[0],t[2]=a[2]):o=!0);const h=[wt(e[0],this.minX_,this.maxX_),wt(e[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(h);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=wt(c[0],this.minLon_,this.maxLon_),g=wt(c[1],this.minLat_,this.maxLat_);const f=this.maxLines_;let p,_,x,v,w=t;o||(w=[wt(t[0],this.minX_,this.maxX_),wt(t[1],this.minY_,this.maxY_),wt(t[2],this.minX_,this.maxX_),wt(t[3],this.minY_,this.maxY_)]);const E=Gr(w,this.toLonLatTransform_,void 0,8);let S=E[3],T=E[2],R=E[1],C=E[0];if(o||(xi(w,this.bottomLeft_)&&(C=this.minLon_,R=this.minLat_),xi(w,this.bottomRight_)&&(T=this.maxLon_,R=this.minLat_),xi(w,this.topLeft_)&&(C=this.minLon_,S=this.maxLat_),xi(w,this.topRight_)&&(T=this.maxLon_,S=this.maxLat_),S=wt(S,g,this.maxLat_),T=wt(T,u,this.maxLon_),R=wt(R,this.minLat_,g),C=wt(C,this.minLon_,u)),u=Math.floor(u/r)*r,v=wt(u,this.minLon_,this.maxLon_),_=this.addMeridian_(v,R,S,s,t,0),p=0,o)for(;(v-=r)>=C&&p++<f;)_=this.addMeridian_(v,R,S,s,t,_);else for(;v!=this.minLon_&&p++<f;)v=Math.max(v-r,this.minLon_),_=this.addMeridian_(v,R,S,s,t,_);if(v=wt(u,this.minLon_,this.maxLon_),p=0,o)for(;(v+=r)<=T&&p++<f;)_=this.addMeridian_(v,R,S,s,t,_);else for(;v!=this.maxLon_&&p++<f;)v=Math.min(v+r,this.maxLon_),_=this.addMeridian_(v,R,S,s,t,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),g=Math.floor(g/r)*r,x=wt(g,this.minLat_,this.maxLat_),_=this.addParallel_(x,C,T,s,t,0),p=0;x!=this.minLat_&&p++<f;)x=Math.max(x-r,this.minLat_),_=this.addParallel_(x,C,T,s,t,_);for(x=wt(g,this.minLat_,this.maxLat_),p=0;x!=this.maxLat_&&p++<f;)x=Math.min(x+r,this.maxLat_),_=this.addParallel_(x,C,T,s,t,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(t){const e=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let s=-1;const r=Math.pow(this.targetSize_*t,2),o=[],a=[];for(let l=0,h=this.intervals_.length;l<h;++l){const c=wt(this.intervals_[l]/2,0,90),u=wt(n,-90+c,90-c);if(o[0]=e-c,o[1]=u-c,a[0]=e+c,a[1]=u+c,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=r)break;s=this.intervals_[l]}return s}getMeridian_(t,e,n,s,r){const o=BC(t,e,n,this.projection_,s);let a=this.meridians_[r];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new ye(o,"XY"),this.meridians_[r]=a),a}getMeridianPoint_(t,e,n){const s=t.getFlatCoordinates();let r=1,o=s.length-1;s[r]>s[o]&&(r=o,o=1);const a=Math.max(e[1],s[r]),l=Math.min(e[3],s[o]),h=wt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,a,l),c=[s[r-1]+(s[o-1]-s[r-1])*(h-s[r])/(s[o]-s[r]),h],u=this.meridiansLabels_[n].geom;return u.setCoordinates(c),u}getMeridians(){return this.meridians_}getParallel_(t,e,n,s,r){const o=WC(t,e,n,this.projection_,s);let a=this.parallels_[r];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new ye(o,"XY"),a}getParallelPoint_(t,e,n){const s=t.getFlatCoordinates();let r=0,o=s.length-2;s[r]>s[o]&&(r=o,o=0);const a=Math.max(e[0],s[r]),l=Math.min(e[2],s[o]),h=wt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,a,l),c=s[r+1]+(s[o+1]-s[r+1])*(h-s[r])/(s[o]-s[r]),u=[h,c],g=this.parallelsLabels_[n].geom;return g.setCoordinates(u),g}getParallels(){return this.parallels_}updateProjectionInfo_(t){const e=tt("EPSG:4326"),n=t.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const s=hn(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=s;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,h){h=h||2;const c=s(a,l,h);for(let u=0,g=c.length;u<g;u+=h)c[u]<o&&(c[u]+=360);return c}}this.fromLonLatTransform_=hn(e,t);const r=Gr([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=r[0],this.maxX_=r[2],this.minY_=r[1],this.maxY_=r[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Ce(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}}const $C=ZC;class or extends gn{constructor(t,e){super(t),this.layer=e}}const Rc={LAYERS:"layers"};class zh extends E_{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Rc.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Ul(n.slice(),{unique:!0}):At(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Ul(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ve),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(le(t,rs.ADD,this.handleLayersAdd_,this),le(t,rs.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(ve);Kr(this.listenerKeys_);const e=t.getArray();for(let n=0,s=e.length;n<s;n++){const r=e[n];this.registerLayerListeners_(r),this.dispatchEvent(new or("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[le(t,zu.PROPERTYCHANGE,this.handleLayerChange_,this),le(t,Lt.CHANGE,this.handleLayerChange_,this)];t instanceof zh&&e.push(le(t,"addlayer",this.handleLayerGroupAdd_,this),le(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[st(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new or("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new or("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new or("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=st(e);this.listenerKeys_[n].forEach(ve),delete this.listenerKeys_[n],this.dispatchEvent(new or("removelayer",e)),this.changed()}getLayers(){return this.get(Rc.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new or("removelayer",n[s]))}this.set(Rc.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=we(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}const Uh=34962,Bh=34963,VC=35040,Yd=35044,xu=35048,YC=5121,HC=5123,KC=5125,$_=5126,kp=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function QC(i,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!Bb},t);const e=kp.length;for(let n=0;n<e;++n)try{const s=i.getContext(kp[n],t);if(s)return s}catch{}return null}const JC={STATIC_DRAW:Yd,STREAM_DRAW:VC,DYNAMIC_DRAW:xu};class Vl{constructor(t,e){this.array_=null,this.type_=t,At(t===Uh||t===Bh,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:JC.STATIC_DRAW}ofSize(t){return this.array_=new(Cc(this.type_))(t),this}fromArray(t){return this.array_=Cc(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Cc(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Cc(i){switch(i){case Uh:return Float32Array;case Bh:return Uint32Array;default:return Float32Array}}const cl={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},tI=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,eI=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Dp{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||tI),e.compileShader(n);const s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,t.fragmentShader||eI),e.compileShader(s),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,s),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const r=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const s=0,r=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,s,r,n[0],n[1],o,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,s){const r=this.getGL(),o=t.size;if(r.bindFramebuffer(r.FRAMEBUFFER,e?e.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!e){const l=st(r.canvas);if(!t.renderTargets[l]){const h=r.getContextAttributes();h&&h.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(r,t),r.drawArrays(r.TRIANGLES,0,6),s&&s(r,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,s=1;this.uniforms_.forEach(function(r){if(n=typeof r.value=="function"?r.value(t):r.value,n instanceof HTMLCanvasElement||n instanceof ImageData)r.texture||(r.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${s}`]),e.bindTexture(e.TEXTURE_2D,r.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(r.location,s++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(r.location,n[0],n[1]);return;case 3:e.uniform3f(r.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(r.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(r.location,n)})}}function V_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Y_(i,t){return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}const En={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},tn={UNSIGNED_BYTE:YC,UNSIGNED_SHORT:HC,UNSIGNED_INT:KC,FLOAT:$_},Yl={};function Gp(i){return"shared/"+i}let jp=0;function iI(){const i="unique/"+jp;return jp+=1,i}function nI(i){let t=Yl[i];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:QC(e)},Yl[i]=t}return t.users+=1,t.context}function sI(i){const t=Yl[i];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const s=e.canvas;s.width=1,s.height=1,delete Yl[i]}class rI extends Uu{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Gp(t.canvasCacheKey):iI(),this.gl_=nI(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(cl.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(cl.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=pe(),this.offsetScaleMatrix_=pe(),this.tmpMat4_=V_(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new Dp({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Dp({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Gp(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=st(t);let s=this.bufferCache_[n];if(!s){const r=e.createBuffer();s={buffer:t,webGlBuffer:r},this.bufferCache_[n]=s}e.bindBuffer(t.getType(),s.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=st(t),s=this.bufferCache_[n];s&&!e.isContextLost()&&e.deleteBuffer(s.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(cl.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(cl.RESTORED,this.boundHandleWebGLContextRestored_),sI(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const s=this.gl_,r=this.getCanvas(),o=t.size,a=t.pixelRatio;(r.width!==o[0]*a||r.height!==o[1]*a)&&(r.width=o[0]*a,r.height=o[1]*a,r.style.width=o[0]+"px",r.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,e?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindTexture(t,e,n){const s=this.gl_;s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,t),s.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n,s){const r=this.gl_,o=e.getSize();r.bindFramebuffer(r.FRAMEBUFFER,e.getFramebuffer()),r.bindRenderbuffer(r.RENDERBUFFER,e.getDepthbuffer()),r.viewport(0,0,o[0],o[1]),r.bindTexture(r.TEXTURE_2D,e.getTexture()),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,n?r.ZERO:r.ONE_MINUS_SRC_ALPHA),s?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const s=n.UNSIGNED_INT,r=4,o=e-t,a=t*r;n.drawElements(n.TRIANGLES,o,s,a)}finalizeDraw(t,e,n){for(let s=0,r=this.postProcessPasses_.length;s<r;s++)s===r-1?this.postProcessPasses_[s].apply(t,null,e,n):this.postProcessPasses_[s].apply(t,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,s=t.pixelRatio;this.setUniformFloatValue(En.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(En.ZOOM,t.viewState.zoom),this.setUniformFloatValue(En.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(En.PIXEL_RATIO,s),this.setUniformFloatVec2(En.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(En.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(En.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(En.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,s=0;this.uniforms_.forEach(r=>{if(n=typeof r.value=="function"?r.value(t):r.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!r.texture?(r.prevValue=void 0,r.texture=n):r.texture||(r.prevValue=void 0,r.texture=e.createTexture()),this.bindTexture(r.texture,s,r.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&r.prevValue!==n&&(r.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),s++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(r.name,Y_(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(r.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(r.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(r.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(r.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,s=n.createShader(e);return n.shaderSource(s,t),n.compileShader(s),s}getProgram(t,e){const n=this.gl_,s=this.compileShader(t,n.FRAGMENT_SHADER),r=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,s),n.attachShader(o,r),n.linkProgram(o),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=st(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=st(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,s=t.viewState.rotation,r=t.viewState.resolution,o=t.viewState.center;return hi(e,0,0,2/(r*n[0]),2/(r*n[1]),-s,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,s,r){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,s,r))}enableAttributes(t){const e=oI(t);let n=0;for(let s=0;s<t.length;s++){const r=t[s];this.enableAttributeArray_(r.name,r.size,r.type||$_,e,n),n+=r.size*H_(r.type)}}handleWebGLContextLost(t){Kr(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n){const s=this.gl_;n=n||s.createTexture();const r=0,o=s.RGBA,a=0,l=s.RGBA,h=s.UNSIGNED_BYTE;return s.bindTexture(s.TEXTURE_2D,n),e?s.texImage2D(s.TEXTURE_2D,r,o,l,h,e):s.texImage2D(s.TEXTURE_2D,r,o,t[0],t[1],a,l,h,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n}}function oI(i){let t=0;for(let e=0;e<i.length;e++){const n=i[e];t+=n.size*H_(n.type)}return t}function H_(i){switch(i){case tn.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case tn.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case tn.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case tn.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Wh extends k_{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=pe(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(Ut.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(si.PRECOMPOSE)){const s=new xl(si.PRECOMPOSE,void 0,e,t);n.dispatchEvent(s)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(si.POSTCOMPOSE)){const s=new xl(si.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(s)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,s;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Wh)){e=!0;continue}const c=l.getClassName();if((e||c!==s)&&(n+=1,e=!1),s=c,h===this)break}const r="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(r)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new rI({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:r}),s&&(this.helper.getCanvas().className=s),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){hi(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const r=new xl(t,this.inversePixelTransform_,n,e);s.dispatchEvent(r)}}preRender(t,e){this.dispatchRenderEvent_(si.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(si.POSTRENDER,t,e)}}const Yi=new Uint8Array(4);class aI{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){$s(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Yi[0]=0,Yi[1]=0,Yi[2]=0,Yi[3]=0,Yi;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Yi[0]=this.data_[n*4],Yi[1]=this.data_[n*4+1],Yi[2]=this.data_[n*4+2],Yi[3]=this.data_[n*4+3],Yi}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}const zp={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var K_={exports:{}};K_.exports=qh;K_.exports.default=qh;function qh(i,t,e){e=e||2;var n=t&&t.length,s=n?t[0]*e:i.length,r=Q_(i,0,s,e,!0),o=[];if(!r||r.next===r.prev)return o;var a,l,h,c,u,g,f;if(n&&(r=dI(i,t,r,e)),i.length>80*e){a=h=i[0],l=c=i[1];for(var p=e;p<s;p+=e)u=i[p],g=i[p+1],u<a&&(a=u),g<l&&(l=g),u>h&&(h=u),g>c&&(c=g);f=Math.max(h-a,c-l),f=f!==0?32767/f:0}return la(r,o,e,a,l,f,0),o}function Q_(i,t,e,n,s){var r,o;if(s===bu(i,t,e,n)>0)for(r=t;r<e;r+=n)o=Up(r,i[r],i[r+1],o);else for(r=e-n;r>=t;r-=n)o=Up(r,i[r],i[r+1],o);return o&&Xh(o,o.next)&&(ca(o),o=o.next),o}function Ws(i,t){if(!i)return i;t||(t=i);var e=i,n;do if(n=!1,!e.steiner&&(Xh(e,e.next)||he(e.prev,e,e.next)===0)){if(ca(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function la(i,t,e,n,s,r,o){if(i){!o&&r&&_I(i,n,s,r);for(var a=i,l,h;i.prev!==i.next;){if(l=i.prev,h=i.next,r?hI(i,n,s,r):lI(i)){t.push(l.i/e|0),t.push(i.i/e|0),t.push(h.i/e|0),ca(i),i=h.next,a=h.next;continue}if(i=h,i===a){o?o===1?(i=cI(Ws(i),t,e),la(i,t,e,n,s,r,2)):o===2&&uI(i,t,e,n,s,r):la(Ws(i),t,e,n,s,r,1);break}}}}function lI(i){var t=i.prev,e=i,n=i.next;if(he(t,e,n)>=0)return!1;for(var s=t.x,r=e.x,o=n.x,a=t.y,l=e.y,h=n.y,c=s<r?s<o?s:o:r<o?r:o,u=a<l?a<h?a:h:l<h?l:h,g=s>r?s>o?s:o:r>o?r:o,f=a>l?a>h?a:h:l>h?l:h,p=n.next;p!==t;){if(p.x>=c&&p.x<=g&&p.y>=u&&p.y<=f&&br(s,a,r,l,o,h,p.x,p.y)&&he(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function hI(i,t,e,n){var s=i.prev,r=i,o=i.next;if(he(s,r,o)>=0)return!1;for(var a=s.x,l=r.x,h=o.x,c=s.y,u=r.y,g=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<g?c:g:u<g?u:g,_=a>l?a>h?a:h:l>h?l:h,x=c>u?c>g?c:g:u>g?u:g,v=vu(f,p,t,e,n),w=vu(_,x,t,e,n),E=i.prevZ,S=i.nextZ;E&&E.z>=v&&S&&S.z<=w;){if(E.x>=f&&E.x<=_&&E.y>=p&&E.y<=x&&E!==s&&E!==o&&br(a,c,l,u,h,g,E.x,E.y)&&he(E.prev,E,E.next)>=0||(E=E.prevZ,S.x>=f&&S.x<=_&&S.y>=p&&S.y<=x&&S!==s&&S!==o&&br(a,c,l,u,h,g,S.x,S.y)&&he(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;E&&E.z>=v;){if(E.x>=f&&E.x<=_&&E.y>=p&&E.y<=x&&E!==s&&E!==o&&br(a,c,l,u,h,g,E.x,E.y)&&he(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;S&&S.z<=w;){if(S.x>=f&&S.x<=_&&S.y>=p&&S.y<=x&&S!==s&&S!==o&&br(a,c,l,u,h,g,S.x,S.y)&&he(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function cI(i,t,e){var n=i;do{var s=n.prev,r=n.next.next;!Xh(s,r)&&J_(s,n,n.next,r)&&ha(s,r)&&ha(r,s)&&(t.push(s.i/e|0),t.push(n.i/e|0),t.push(r.i/e|0),ca(n),ca(n.next),n=i=r),n=n.next}while(n!==i);return Ws(n)}function uI(i,t,e,n,s,r){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&vI(o,a)){var l=ty(o,a);o=Ws(o,o.next),l=Ws(l,l.next),la(o,t,e,n,s,r,0),la(l,t,e,n,s,r,0);return}a=a.next}o=o.next}while(o!==i)}function dI(i,t,e,n){var s=[],r,o,a,l,h;for(r=0,o=t.length;r<o;r++)a=t[r]*n,l=r<o-1?t[r+1]*n:i.length,h=Q_(i,a,l,n,!1),h===h.next&&(h.steiner=!0),s.push(xI(h));for(s.sort(gI),r=0;r<s.length;r++)e=fI(s[r],e);return e}function gI(i,t){return i.x-t.x}function fI(i,t){var e=pI(i,t);if(!e)return t;var n=ty(e,i);return Ws(n,n.next),Ws(e,e.next)}function pI(i,t){var e=t,n=i.x,s=i.y,r=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var a=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=n&&a>r&&(r=a,o=e.x<e.next.x?e:e.next,a===n))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,g;e=o;do n>=e.x&&e.x>=h&&n!==e.x&&br(s<c?n:r,s,h,c,s<c?r:n,s,e.x,e.y)&&(g=Math.abs(s-e.y)/(n-e.x),ha(e,i)&&(g<u||g===u&&(e.x>o.x||e.x===o.x&&mI(o,e)))&&(o=e,u=g)),e=e.next;while(e!==l);return o}function mI(i,t){return he(i.prev,i,t.prev)<0&&he(t.next,i,i.next)<0}function _I(i,t,e,n){var s=i;do s.z===0&&(s.z=vu(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,yI(s)}function yI(i){var t,e,n,s,r,o,a,l,h=1;do{for(e=i,i=null,r=null,o=0;e;){for(o++,n=e,a=0,t=0;t<h&&(a++,n=n.nextZ,!!n);t++);for(l=h;a>0||l>0&&n;)a!==0&&(l===0||!n||e.z<=n.z)?(s=e,e=e.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;e=n}r.nextZ=null,h*=2}while(o>1);return i}function vu(i,t,e,n,s){return i=(i-e)*s|0,t=(t-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function xI(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function br(i,t,e,n,s,r,o,a){return(s-o)*(t-a)>=(i-o)*(r-a)&&(i-o)*(n-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(s-o)*(n-a)}function vI(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!wI(i,t)&&(ha(i,t)&&ha(t,i)&&bI(i,t)&&(he(i.prev,i,t.prev)||he(i,t.prev,t))||Xh(i,t)&&he(i.prev,i,i.next)>0&&he(t.prev,t,t.next)>0)}function he(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Xh(i,t){return i.x===t.x&&i.y===t.y}function J_(i,t,e,n){var s=dl(he(i,t,e)),r=dl(he(i,t,n)),o=dl(he(e,n,i)),a=dl(he(e,n,t));return!!(s!==r&&o!==a||s===0&&ul(i,e,t)||r===0&&ul(i,n,t)||o===0&&ul(e,i,n)||a===0&&ul(e,t,n))}function ul(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function dl(i){return i>0?1:i<0?-1:0}function wI(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&J_(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function ha(i,t){return he(i.prev,i,i.next)<0?he(i,t,i.next)>=0&&he(i,i.prev,t)>=0:he(i,t,i.prev)<0||he(i,i.next,t)<0}function bI(i,t){var e=i,n=!1,s=(i.x+t.x)/2,r=(i.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&s<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==i);return n}function ty(i,t){var e=new wu(i.i,i.x,i.y),n=new wu(t.i,t.x,t.y),s=i.next,r=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,n.next=e,e.prev=n,r.next=n,n.prev=r,n}function Up(i,t,e,n){var s=new wu(i,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function ca(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function wu(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}qh.deviation=function(i,t,e,n){var s=t&&t.length,r=s?t[0]*e:i.length,o=Math.abs(bu(i,0,r,e));if(s)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:i.length;o-=Math.abs(bu(i,h,c,e))}var u=0;for(a=0;a<n.length;a+=3){var g=n[a]*e,f=n[a+1]*e,p=n[a+2]*e;u+=Math.abs((i[g]-i[p])*(i[f+1]-i[g+1])-(i[g]-i[f])*(i[p+1]-i[g+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function bu(i,t,e,n){for(var s=0,r=t,o=e-n;r<e;r+=n)s+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return s}qh.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,s=0;s<i.length;s++){for(var r=0;r<i[s].length;r++)for(var o=0;o<t;o++)e.vertices.push(i[s][r][o]);s>0&&(n+=i[s-1].length,e.holes.push(n))}return e};const Bp=.985;function EI(i,t){t=t||[];const e=256,n=e-1;return t[0]=Math.floor(i/e/e/e)/n,t[1]=Math.floor(i/e/e)%e/n,t[2]=Math.floor(i/e)%e/n,t[3]=i%e/n,t}function SI(i){let t=0;const e=256,n=e-1;return t+=Math.round(i[0]*e*e*e*n),t+=Math.round(i[1]*e*e*n),t+=Math.round(i[2]*e*n),t+=Math.round(i[3]*n),t}function TI(){const i='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(i,"binary").toString("base64"):URL.createObjectURL(new Blob([i],{type:"application/javascript"})))}function MI(i,t){const e=i.viewState.projection,n=t.getSource().getWrapX()&&e.canWrapX(),s=e.getExtent(),r=i.extent,o=n?yt(s):null,a=n?Math.ceil((r[2]-s[2])/o)+1:1;return[n?Math.floor((r[0]-s[0])/o):0,a,o]}class ey extends Wh{constructor(t,e){const n=e.uniforms||{},s=pe();n[En.PROJECTION_MATRIX]=s,super(t,{uniforms:n,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Vl(Uh,xu),this.indicesBuffer_=new Vl(Bh,xu),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.program_,this.hitDetectionEnabled_=e.hitDetectionEnabled??!0;const r=e.attributes?e.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:tn.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:tn.FLOAT},{name:"a_index",size:1,type:tn.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:tn.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:tn.FLOAT})),this.attributes.push(...r),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=ze(),this.currentTransform_=s,this.renderTransform_=pe(),this.invertRenderTransform_=pe(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=TI(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===zp.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,ph(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[le(o,ke.ADDFEATURE,this.handleSourceFeatureAdded_,this),le(o,ke.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),le(o,ke.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),le(o,ke.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[st(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new aI(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[st(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[st(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){const e=t.feature;delete this.featureCache_[st(e)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[n,s,r]=MI(t,this.getLayer());return this.renderWorlds(t,!1,n,s,r),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,s,r),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),this.helper.getCanvas()}prepareFrameInternal(t){const e=this.getLayer(),n=e.getSource(),s=t.viewState,r=!t.viewHints[ee.ANIMATING]&&!t.viewHints[ee.INTERACTING],o=!Nn(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),r&&(o||a)){const l=s.projection,h=s.resolution,c=e instanceof Na?e.getRenderBuffer():0,u=Ii(t.extent,c*h);n.loadFeatures(u,h,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=pe();this.helper.makeProjectionTransform(t,e);const n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=n*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let r,o;const a=[],l=[];let h=-1;for(const u in this.featureCache_)if(r=this.featureCache_[u],o=r.geometry,!(!o||o.getType()!=="Point")){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],ae(e,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const g=EI(h+5,l);this.renderInstructions_[++h]=g[0],this.renderInstructions_[++h]=g[1],this.renderInstructions_[++h]=g[2],this.renderInstructions_[++h]=g[3],this.renderInstructions_[++h]=Number(u)}for(let g=0;g<this.customAttributes.length;g++){const f=this.customAttributes[g].callback(r.feature,r.properties);this.renderInstructions_[++h]=f}}const c={id:++this.lastSentId,type:zp.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};c.projectionTransform=e,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,e,n,s,r){if(At(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=ae(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=SI(l),c=this.renderInstructions_[h],u=Math.floor(c).toString(),g=this.getLayer().getSource().getFeatureByUid(u);if(g)return s(g,this.getLayer(),null)}renderWorlds(t,e,n,s,r){let o=n;this.helper.useProgram(this.program_,t),e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),Wu(this.currentTransform_,o*r,0),Qr(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(e);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<s)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){ve(t)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class RI{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}const Hd=.5,q={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ao extends xa{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Lt.CHANGE)}release(){this.state===q.ERROR&&this.setState(q.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==q.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==q.LOADED){t.interimTile=null;break}t.getState()==q.LOADING?e=t:t.getState()==q.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==q.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ct()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=e-n+1e3/60;return s>=this.transition_?1:T_(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}function Hl(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Eu(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let ar=null;function CI(i){ar||(ar=Jt(i.width,i.height,void 0,{willReadFrequently:!0}));const t=ar.canvas,e=i.width;t.width!==e&&(t.width=e);const n=i.height;return t.height!==n&&(t.height=n),ar.clearRect(0,0,e,n),ar.drawImage(i,0,0),ar.getImageData(0,0,e,n).data}const II=[256,256];class Kd extends ao{constructor(t){const e=q.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=Hl(this.data_);return t?[t.width,t.height]:II}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=q.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=q.ERROR,t.changed()})}}const PI=10,Wp=.25;class Qd{constructor(t,e,n,s,r,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=hn(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const E=w[0]+"/"+w[1];return a[E]||(a[E]=l(w)),a[E]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&yt(s)>=yt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?yt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?yt(this.targetProj_.getExtent()):null;const h=zn(n),c=Ea(n),u=mh(n),g=ba(n),f=this.transformInv_(h),p=this.transformInv_(c),_=this.transformInv_(u),x=this.transformInv_(g),v=PI+(o?Math.max(0,Math.ceil(Math.log2(Ko(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,g,f,p,_,x,v),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(E,S,T){w=Math.min(w,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-w>this.sourceWorldWidth_/2){const S=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];S[0][0]-w>this.sourceWorldWidth_/2&&(S[0][0]-=this.sourceWorldWidth_),S[1][0]-w>this.sourceWorldWidth_/2&&(S[1][0]-=this.sourceWorldWidth_),S[2][0]-w>this.sourceWorldWidth_/2&&(S[2][0]-=this.sourceWorldWidth_);const T=Math.min(S[0][0],S[1][0],S[2][0]);Math.max(S[0][0],S[1][0],S[2][0])-T<this.sourceWorldWidth_/2&&(E.source=S)}})}a={}}addTriangle_(t,e,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,e,n]})}addQuad_(t,e,n,s,r,o,a,l,h){const c=Dr([r,o,a,l]),u=this.sourceWorldWidth_?yt(c)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const x=Dr([t,e,n,s]);p=yt(x)/this.targetWorldWidth_>Wp||p}!f&&this.sourceProj_.isGlobal()&&u&&(p=u>Wp||p)}if(!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Qt(c,this.maxSourceExtent_))return;let _=0;if(!p&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)p=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!p){const x=[(t[0]+n[0])/2,(t[1]+n[1])/2],v=this.transformInv_(x);let w;f?w=(an(r[0],g)+an(a[0],g))/2-an(v[0],g):w=(r[0]+a[0])/2-v[0];const E=(r[1]+a[1])/2-v[1];p=w*w+E*E>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const x=[(e[0]+n[0])/2,(e[1]+n[1])/2],v=this.transformInv_(x),w=[(s[0]+t[0])/2,(s[1]+t[1])/2],E=this.transformInv_(w);this.addQuad_(t,e,x,w,r,o,v,E,h-1),this.addQuad_(w,x,n,s,E,v,a,l,h-1)}else{const x=[(t[0]+e[0])/2,(t[1]+e[1])/2],v=this.transformInv_(x),w=[(n[0]+s[0])/2,(n[1]+s[1])/2],E=this.transformInv_(w);this.addQuad_(t,x,w,s,r,v,E,l,h-1),this.addQuad_(x,e,n,w,v,o,a,E,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,s,r,a,l),_&14||this.addTriangle_(t,n,e,r,a,o),_&&(_&13||this.addTriangle_(e,s,t,o,l,r),_&7||this.addTriangle_(e,s,n,o,l,a))}calculateSourceExtent(){const t=ze();return this.triangles_.forEach(function(e,n,s){const r=e.source;No(t,r[0]),No(t,r[1]),No(t,r[2])}),t}getTriangles(){return this.triangles_}}let Ic;const On=[];function qp(i,t,e,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,s)),i.restore()}function Pc(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function AI(){if(Ic===void 0){const i=Jt(6,6,On);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",qp(i,4,5,4,0),qp(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Ic=Pc(t,0)||Pc(t,4)||Pc(t,8),Us(i),On.push(i.canvas)}return Ic}function ua(i,t,e,n){const s=_h(e,t,i);let r=vf(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=i.getMetersPerUnit();a!==void 0&&(r/=a);const l=i.getExtent();if(!l||xi(l,s)){const h=vf(i,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function iy(i,t,e,n){const s=Ce(e);let r=ua(i,t,s,n);return(!isFinite(r)||r<=0)&&Km(e,function(o){return r=ua(i,t,o,n),isFinite(r)&&r>0}),r}function Jd(i,t,e,n,s,r,o,a,l,h,c,u,g,f){const p=Jt(Math.round(e*i),Math.round(e*t),On);if(u||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(e,e);function _(T){return Math.round(T*e)/e}p.globalCompositeOperation="lighter";const x=ze();l.forEach(function(T,R,C){Ym(x,T.extent)});let v;const w=e/n,E=(u?1:1+Math.pow(2,-24))/w;if(!g||l.length!==1||h!==0){if(v=Jt(Math.round(yt(x)*w),Math.round(Vt(x)*w),On),u||(v.imageSmoothingEnabled=!1),s&&f){const T=(s[0]-x[0])*w,R=-(s[3]-x[3])*w,C=yt(s)*w,P=Vt(s)*w;v.rect(T,R,C,P),v.clip()}l.forEach(function(T,R,C){const P=(T.extent[0]-x[0])*w,N=-(T.extent[3]-x[3])*w,U=yt(T.extent)*w,j=Vt(T.extent)*w;T.image.width>0&&T.image.height>0&&v.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,u?P:Math.round(P),u?N:Math.round(N),u?U:Math.round(P+U)-Math.round(P),u?j:Math.round(N+j)-Math.round(N))})}const S=zn(o);return a.getTriangles().forEach(function(T,R,C){const P=T.source,N=T.target;let U=P[0][0],j=P[0][1],B=P[1][0],d=P[1][1],m=P[2][0],y=P[2][1];const b=_((N[0][0]-S[0])/r),M=_(-(N[0][1]-S[1])/r),I=_((N[1][0]-S[0])/r),A=_(-(N[1][1]-S[1])/r),L=_((N[2][0]-S[0])/r),k=_(-(N[2][1]-S[1])/r),W=U,K=j;U=0,j=0,B-=W,d-=K,m-=W,y-=K;const G=[[B,d,0,0,I-b],[m,y,0,0,L-b],[0,0,B,d,A-M],[0,0,m,y,k-M]],H=fv(G);if(!H)return;if(p.save(),p.beginPath(),AI()||!u){p.moveTo(I,A);const nt=4,xt=b-I,dt=M-A;for(let Tt=0;Tt<nt;Tt++)p.lineTo(I+_((Tt+1)*xt/nt),A+_(Tt*dt/(nt-1))),Tt!=nt-1&&p.lineTo(I+_((Tt+1)*xt/nt),A+_((Tt+1)*dt/(nt-1)));p.lineTo(L,k)}else p.moveTo(I,A),p.lineTo(b,M),p.lineTo(L,k);p.clip(),p.transform(H[0],H[2],H[1],H[3],b,M),p.translate(x[0]-W,x[3]-K);let Q;if(v)Q=v.canvas,p.scale(E,-E);else{const nt=l[0],xt=nt.extent;Q=nt.image,p.scale(yt(xt)/Q.width,-Vt(xt)/Q.height)}p.drawImage(Q,0,0),p.restore()}),v&&(Us(v),On.push(v.canvas)),c&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(T,R,C){const P=T.target,N=(P[0][0]-S[0])/r,U=-(P[0][1]-S[1])/r,j=(P[1][0]-S[0])/r,B=-(P[1][1]-S[1])/r,d=(P[2][0]-S[0])/r,m=-(P[2][1]-S[1])/r;p.beginPath(),p.moveTo(j,B),p.lineTo(N,U),p.lineTo(d,m),p.closePath(),p.stroke()}),p.restore()),p.canvas}class tg extends Kd{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let s=this.sourceTileGrid_.getExtent();const r=n?we(e,n):e;if(Ko(r)===0){this.state=q.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(s?s=we(s,a):s=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,c=iy(o,h,r,l);if(!isFinite(c)||c<=0){this.state=q.EMPTY;return}const u=t.errorThreshold!==void 0?t.errorThreshold:Hd;if(this.triangulation_=new Qd(o,h,r,s,c*u,l),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let g=this.triangulation_.calculateSourceExtent();if(s&&(o.canWrapX()?(g[1]=wt(g[1],s[1],s[3]),g[3]=wt(g[3],s[1],s[3])):g=we(g,s)),!Ko(g))this.state=q.EMPTY;else{const f=this.sourceTileGrid_.getTileRangeForExtentAndZ(g,this.sourceZ_),p=t.getTileFunction;for(let _=f.minX;_<=f.maxX;_++)for(let x=f.minY;x<=f.maxY;x++){const v=p(this.sourceZ_,_,x,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==q.LOADED)return;const n=e.getSize(),s=this.gutter_;let r;const o=Eu(e.getData());o?r=o:r=CI(Hl(e.getData()));const a=[n[0]+2*s,n[1]+2*s],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(r.buffer),g=c.BYTES_PER_ELEMENT,f=g*u.length/h,p=u.byteLength/a[1],_=Math.floor(p/g/a[0]),x=h*_;let v=u;if(u.length!==x){v=new c(x);let w=0,E=0;const S=a[0]*_;for(let T=0;T<a[1];++T){for(let R=0;R<S;++R)v[w++]=u[E+R];E+=p/g}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(v.buffer),dataType:c,bytesPerPixel:f,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=t[0].bytesPerPixel,g=Math.ceil(u/3);for(let f=g-1;f>=0;--f){const p=[];for(let S=0,T=t.length;S<T;++S){const R=t[S],C=R.data,P=R.pixelSize,N=P[0],U=P[1],j=Jt(N,U,On),B=j.createImageData(N,U),d=B.data;let m=f*3;for(let y=0,b=d.length;y<b;y+=4)d[y]=C[m],d[y+1]=C[m+1],d[y+2]=C[m+2],d[y+3]=255,m+=u;j.putImageData(B,0,0),p.push({extent:R.extent,image:j.canvas})}const _=Jd(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,p,this.gutter_,!1,!1,!1,!0);for(let S=0,T=p.length;S<T;++S){const R=p[S].image.getContext("2d");Us(R),On.push(R.canvas)}const x=_.getContext("2d"),v=x.getImageData(0,0,_.width,_.height);Us(x),On.push(_),h||(c=new Uint8Array(u*v.width*v.height),h=new t[0].dataType(c.buffer));const w=v.data;let E=f*3;for(let S=0,T=w.length;S<T;S+=4)w[S+3]===255?(c[E]=w[S],c[E+1]=w[S+1],c[E+2]=w[S+2]):(c[E]=0,c[E+1]=0,c[E+2]=0),E+=u}this.reprojData_=h,this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=q.LOADED}this.changed()}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n!==q.IDLE&&n!==q.LOADING)return;t++;const s=le(e,Lt.CHANGE,function(){const r=e.getState();(r==q.LOADED||r==q.ERROR||r==q.EMPTY)&&(ve(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==q.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}}class Xr extends ao{constructor(t,e,n,s,r,o,a,l,h,c,u,g){super(r,q.IDLE,g),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const x=p?we(f,p):f;if(Ko(x)===0){this.state=q.EMPTY;return}const v=t.getExtent();v&&(_?_=we(_,v):_=v);const w=s.getResolution(this.wrappedTileCoord_[0]),E=iy(t,n,x,w);if(!isFinite(E)||E<=0){this.state=q.EMPTY;return}const S=c!==void 0?c:Hd;if(this.triangulation_=new Qd(t,n,x,_,E*S,w),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=e.getZForResolution(E);let T=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(T[1]=wt(T[1],_[1],_[3]),T[3]=wt(T[3],_[1],_[3])):T=we(T,_)),!Ko(T))this.state=q.EMPTY;else{const R=e.getTileRangeForExtentAndZ(T,this.sourceZ_);for(let C=R.minX;C<=R.maxX;C++)for(let P=R.minY;P<=R.maxY;P++){const N=h(this.sourceZ_,C,P,a);N&&this.sourceTiles_.push(N)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==q.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Jd(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=q.LOADED}this.changed()}load(){if(this.state==q.IDLE){this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==q.IDLE||n==q.LOADING){t++;const s=le(e,Lt.CHANGE,function(r){const o=e.getState();(o==q.LOADED||o==q.ERROR||o==q.EMPTY)&&(ve(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,s){e.getState()==q.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ve),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Us(this.canvas_.getContext("2d")),On.push(this.canvas_),this.canvas_=null),super.release()}}class Da extends ao{constructor(t,e,n,s,r,o){super(t,e,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=q.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=q.ERROR,this.unlistenImage_(),this.image_=LI(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=q.LOADED:this.state=q.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==q.ERROR&&(this.state=q.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==q.IDLE&&(this.state=q.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=qb(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function LI(){const i=Jt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class OI extends xa{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===q.LOADED,this.loaded)this.uploadTile();else{if(t instanceof Da){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(Lt.CHANGE,this.handleTileChange_)}}uploadTile(){ct()}setReady(){this.ready=!0,this.dispatchEvent(Lt.CHANGE)}handleTileChange_(){this.tile.getState()===q.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}}function ny(i,t,e){const n=e?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function FI(i,t,e,n){ny(i,t,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}function Xp(i,t,e,n,s,r){const o=i.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),ny(o,t,r&&l);const h=e.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(s){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${s}`)}const g=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,g)}let mr=null;function NI(){mr=Jt(1,1,void 0,{willReadFrequently:!0})}class kI extends OI{constructor(t){super(t),this.textures=[],this.renderSize_=se(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new Vl(Uh,Yd);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;this.textures.length=0;let s;n instanceof Da||n instanceof Xr?s=n.getImage():s=n.getData();const r=Hl(s);if(r){const w=e.createTexture();this.textures.push(w),this.bandCount=4,FI(e,w,r,n.interpolate),this.setReady();return}s=Eu(s);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,g=s.byteLength/a[1];this.bandCount=Math.floor(g/u/a[0]);const f=Math.ceil(this.bandCount/4);if(f===1){const w=e.createTexture();this.textures.push(w),Xp(t,w,s,a,this.bandCount,n.interpolate),this.setReady();return}const p=new Array(f);for(let w=0;w<f;++w){const E=e.createTexture();this.textures.push(E);const S=w<f-1?4:(this.bandCount-1)%4+1;p[w]=new c(h*S)}let _=0,x=0;const v=a[0]*this.bandCount;for(let w=0;w<a[1];++w){for(let E=0;E<v;++E){const S=s[x+E],T=Math.floor(_/this.bandCount),R=E%this.bandCount,C=Math.floor(R/4),P=p[C],N=P.length/h,U=R%4;P[T*N+U]=S,++_}x+=g/u}for(let w=0;w<f;++w){const E=this.textures[w],S=p[w],T=S.length/h;Xp(t,E,S,a,T,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(Lt.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const s=this.gutter_,r=this.renderSize_[0],o=this.renderSize_[1];mr||NI(),mr.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*s,c=l-2*s,u=s+Math.floor(h*(e/r)),g=s+Math.floor(c*(n/o));let f;try{mr.drawImage(t,u,g,1,1,0,0,1,1),f=mr.getImageData(0,0,1,1).data}catch{return mr=null,null}return f}getArrayPixelData_(t,e,n,s){const r=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*r,u=h+2*r,g=r+Math.floor(l*(n/o)),f=r+Math.floor(h*(s/a));if(t instanceof DataView){const _=t.byteLength/(c*u),x=_*(f*c+g),v=t.buffer.slice(x,x+_);return new DataView(v)}const p=this.bandCount*(f*c+g);return t.slice(p,p+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Kd){const n=this.tile.getData(),s=Eu(n);if(s){const r=this.tile.getSize();return this.getArrayPixelData_(s,r,t,e)}return this.getImagePixelData_(Hl(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class eg{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return At(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return At(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){At(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}class Zh{constructor(t,e,n,s){this.minX=t,this.maxX=e,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function lr(i,t,e,n,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=n,s):new Zh(i,t,e,n)}function da(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function un(i,t,e){return i+"/"+t+"/"+e}function es(i){return un(i[0],i[1],i[2])}function DI(i){const[t,e,n]=i.substring(i.lastIndexOf("/")+1,i.length).split(",").map(Number);return un(t,e,n)}function sy(i){return i.split("/").map(Number)}function ig(i){return(i[1]<<i[0])+i[2]}function GI(i,t){const e=i[0],n=i[1],s=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(n,s):!0}const jI={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},zI={};function Zp(i){return 1/(i+2)}function UI(){return{tileIds:new Set,representationsByZ:{}}}function $p(i,t){return i.tileIds.has(st(t))}function Vp(i,t,e){const n=i.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),i.tileIds.add(st(t.tile))}function Ac(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=we(t,Gi(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=we(t,s))}return t}function Su(i,t){return`${i.getKey()},${es(t)}`}class BI extends Wh{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=pe(),this.tempMat4=V_(),this.tempTileRange_=new Zh(0,0,0,0),this.tempTileCoord_=da(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new eg(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),s=e.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!s}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||Un(Ac(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return ct()}enqueueTiles(t,e,n,s,r){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=st(l);u in t.wantedTiles||(t.wantedTiles[u]={});const g=t.wantedTiles[u],f=this.tileRepresentationCache,p=a.getMapInternal(),_=Math.max(n-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let x=n;x>=_;--x){const v=h.getTileRangeForExtentAndZ(e,x,this.tempTileRange_),w=h.getResolution(x);for(let E=v.minX;E<=v.maxX;++E)for(let S=v.minY;S<=v.maxY;++S){const T=da(x,E,S,this.tempTileCoord_),R=Su(l,T);let C,P;if(f.containsKey(R)&&(C=f.get(R),P=C.tile),(!C||C.tile.key!==l.getKey())&&(P=l.getTile(x,E,S,t.pixelRatio,o.projection)),$p(s,P))continue;if(!C)C=this.createTileRepresentation({tile:P,grid:h,helper:this.helper,gutter:c}),f.set(R,C);else if(this.isDrawableTile_(P))C.setTile(P);else{const U=P.getInterimTile();C.setTile(U)}Vp(s,C,x);const N=P.getKey();g[N]=!0,P.getState()===q.IDLE&&(t.tileQueue.isKeyQueued(N)||t.tileQueue.enqueue([P,u,h.getTileCoordCenter(T),w]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,s,r,o,a,l,h,c,u){}renderTileMask(t,e,n,s){}drawTile_(t,e,n,s,r,o,a){if(!e.ready)return;const l=e.tile.tileCoord,h=es(l),c=h in o?o[h]:1,u=a.getResolution(n),g=se(a.getTileSize(n),this.tempSize_),f=a.getOrigin(n),p=a.getTileCoordExtent(l),_=c<1?-1:Zp(n);c<1&&(t.animate=!0);const x=t.viewState,v=x.center[0],w=x.center[1],E=g[0]+2*s,S=g[1]+2*s,T=E/S,R=(v-f[0])/(g[0]*u),C=(f[1]-w)/(g[1]*u),P=x.resolution/u,N=l[1],U=l[2];Vc(this.tileTransform_),Fo(this.tileTransform_,2/(t.size[0]*P/E),-2/(t.size[1]*P/E)),Yx(this.tileTransform_,x.rotation),Fo(this.tileTransform_,1,1/T),Wu(this.tileTransform_,(g[0]*(N-R)-s)/E,(g[1]*(U-C)-s)/S),this.renderTile(e,this.tileTransform_,t,r,u,g,f,p,_,s,c)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,s=this.getLayer(),r=s.getRenderSource(),o=r.getTileGridForProjection(n.projection),a=r.getGutterForProjection(n.projection),l=Ac(t,t.extent),h=o.getZForResolution(n.resolution,r.zDirection),c=UI(),u=s.getPreload();if(t.nextExtent){const T=o.getZForResolution(n.nextResolution,r.zDirection),R=Ac(t,t.nextExtent);this.enqueueTiles(t,R,T,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const g={},f=st(this),p=t.time;let _=!1;for(const T of c.representationsByZ[h]){const R=T.tile;if((R instanceof Xr||R instanceof tg)&&R.getState()===q.EMPTY)continue;const C=R.tileCoord;if(T.ready){const N=R.getAlpha(f,p);if(N===1){R.endTransition(f);continue}_=!0;const U=es(C);g[U]=N}if(this.renderComplete=!1,this.findAltTiles_(o,C,h+1,c))continue;const P=o.getMinZoom();for(let N=h-1;N>=P&&!this.findAltTiles_(o,C,N,c);--N);}const x=c.representationsByZ,v=Object.keys(x).map(Number).sort(Ux);if(this.beforeTilesMaskRender(t))for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const P of x[C]){const N=P.tile.tileCoord;if(es(N)in g)continue;const U=o.getTileCoordExtent(N);this.renderTileMask(P,C,U,Zp(C))}}this.beforeTilesRender(t,_);for(let T=0,R=v.length;T<R;++T){const C=v[T];for(const P of x[C]){const N=P.tile.tileCoord;es(N)in g||this.drawTile_(t,P,C,a,l,g,o)}}for(const T of x[h]){const R=T.tile.tileCoord;es(R)in g&&this.drawTile_(t,T,h,a,l,g,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),E=this.tileRepresentationCache;for(;E.canExpireCache();)E.pop().dispose();const S=function(T,R){r.updateCacheSize(.1,R.viewState.projection),r.expireCache(R.viewState.projection,zI)};return t.postRenderFunctions.push(S),this.postRender(e,t),w}findAltTiles_(t,e,n,s){const r=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=r.minX;h<=r.maxX;++h)for(let c=r.minY;c<=r.maxY;++c){const u=Su(l,[n,h,c]);let g=!1;if(a.containsKey(u)){const f=a.get(u);f.ready&&!$p(s,f.tile)&&(Vp(s,f,n),g=!0)}g||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const St={...jI,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},vl={TEXTURE_COORD:"a_textureCoord"},WI=[{name:vl.TEXTURE_COORD,size:2,type:tn.FLOAT}];class qI extends BI{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new Vl(Bh,Yd),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new kI(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,s,r,o,a,l,h,c,u){const g=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(WI);let f=0;for(;f<t.textures.length;){const T=`${St.TILE_TEXTURE_ARRAY}[${f}]`;this.helper.bindTexture(t.textures[f],f,T),++f}for(let T=0;T<this.paletteTextures_.length;++T){const R=this.paletteTextures_[T],C=R.getTexture(g);this.helper.bindTexture(C,f,R.name),++f}const p=n.viewState,_=o[0]+2*c,x=o[1]+2*c,v=t.tile.tileCoord,w=v[1],E=v[2];this.helper.setUniformMatrixValue(St.TILE_TRANSFORM,Y_(this.tempMat4,e)),this.helper.setUniformFloatValue(St.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(St.DEPTH,h);let S=s;c>0&&(S=l,we(S,s,S)),this.helper.setUniformFloatVec4(St.RENDER_EXTENT,S),this.helper.setUniformFloatValue(St.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(St.ZOOM,p.zoom),this.helper.setUniformFloatValue(St.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(St.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(St.TEXTURE_RESOLUTION,r),this.helper.setUniformFloatValue(St.TEXTURE_ORIGIN_X,a[0]+w*o[0]*r-c*r),this.helper.setUniformFloatValue(St.TEXTURE_ORIGIN_Y,a[1]-E*o[1]*r+c*r),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=ae(e.pixelToCoordinateTransform,t.slice()),r=e.viewState,o=n.getExtent();if(o&&!xi(Gi(o,r.projection),s))return null;const a=n.getSources(Dr([s]),r.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(r.projection),h.getWrapX())break;const g=c.getExtent();if(!g||xi(g,s))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let g=c.getZForResolution(r.resolution);g>=c.getMinZoom();--g){const f=c.getTileCoordForCoordAndZ(s,g),p=Su(h,f);if(!u.containsKey(p))continue;const _=u.get(p),x=_.tile;if((x instanceof Xr||x instanceof tg)&&x.getState()===q.EMPTY)return null;if(!_.loaded)continue;const v=c.getOrigin(g),w=se(c.getTileSize(g)),E=c.getResolution(g),S=(s[0]-v[0])/E-f[1]*w[0],T=(v[1]-s[1])/E-f[2]*w[1];return _.getPixelData(S,T)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}function XI(i,t){return`operator_${i}_${Object.keys(t.functions).length}`}function Ds(i){const t=i.toString();return t.includes(".")?t:t+".0"}function ng(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Ds).join(", ")})`}function wl(i){const t=Wi(i),e=t.length>3?t[3]:1;return ng([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const Lc={};let ZI=0;function Kl(i){return i in Lc||(Lc[i]=ZI++),Lc[i]}function Mn(i){return Ds(Kl(i))}function sg(i){return"u_var_"+i}function $I(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Oc="getBandValue",ry="u_paletteTextures";function VI(i,t,e,n){const s=Bt(i,e,t);if(Oa(s.type,Qs))throw new Error("No matching type was found");if(!ji(t,s.type)){const r=be(t),o=be(s.type);throw new Error(`Expected expression to be of type ${r}, got ${o}`)}return rg(s,t,n)}function Dt(i){return(t,e,n)=>{const s=e.args.length,r=new Array(s);for(let o=0;o<s;++o)r[o]=rg(e.args[o],n,t);return i(r,t)}}const YI={[z.Get]:(i,t)=>{const e=t.args[0].value;return e in i.properties||(i.properties[e]={name:e,type:t.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+e},[z.GeometryType]:(i,t,e)=>{const n="geometryType";return n in i.properties||(i.properties[n]={name:n,type:xe,evaluator:s=>qd(s.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[z.Var]:(i,t)=>{const e=t.args[0].value;return e in i.variables||(i.variables[e]={name:e,type:t.type}),sg(e)},[z.Resolution]:()=>"u_resolution",[z.Zoom]:()=>"u_zoom",[z.Time]:()=>"u_time",[z.Any]:Dt(i=>`(${i.join(" || ")})`),[z.All]:Dt(i=>`(${i.join(" && ")})`),[z.Not]:Dt(([i])=>`(!${i})`),[z.Equal]:Dt(([i,t])=>`(${i} == ${t})`),[z.NotEqual]:Dt(([i,t])=>`(${i} != ${t})`),[z.GreaterThan]:Dt(([i,t])=>`(${i} > ${t})`),[z.GreaterThanOrEqualTo]:Dt(([i,t])=>`(${i} >= ${t})`),[z.LessThan]:Dt(([i,t])=>`(${i} < ${t})`),[z.LessThanOrEqualTo]:Dt(([i,t])=>`(${i} <= ${t})`),[z.Multiply]:Dt(i=>`(${i.join(" * ")})`),[z.Divide]:Dt(([i,t])=>`(${i} / ${t})`),[z.Add]:Dt(i=>`(${i.join(" + ")})`),[z.Subtract]:Dt(([i,t])=>`(${i} - ${t})`),[z.Clamp]:Dt(([i,t,e])=>`clamp(${i}, ${t}, ${e})`),[z.Mod]:Dt(([i,t])=>`mod(${i}, ${t})`),[z.Pow]:Dt(([i,t])=>`pow(${i}, ${t})`),[z.Abs]:Dt(([i])=>`abs(${i})`),[z.Floor]:Dt(([i])=>`floor(${i})`),[z.Ceil]:Dt(([i])=>`ceil(${i})`),[z.Round]:Dt(([i])=>`floor(${i} + 0.5)`),[z.Sin]:Dt(([i])=>`sin(${i})`),[z.Cos]:Dt(([i])=>`cos(${i})`),[z.Atan]:Dt(([i,t])=>t!==void 0?`atan(${i}, ${t})`:`atan(${i})`),[z.Sqrt]:Dt(([i])=>`sqrt(${i})`),[z.Match]:Dt(i=>{const t=i[0],e=i[i.length-1];let n=null;for(let s=i.length-3;s>=1;s-=2){const r=i[s],o=i[s+1];n=`(${t} == ${r} ? ${o} : ${n||e})`}return n}),[z.Between]:Dt(([i,t,e])=>`(${i} >= ${t} && ${i} <= ${e})`),[z.Interpolate]:Dt(([i,t,...e])=>{let n="";for(let s=0;s<e.length-2;s+=2){const r=e[s],o=n||e[s+1],a=e[s+2],l=e[s+3];let h;i===Ds(1)?h=`(${t} - ${r}) / (${a} - ${r})`:h=`(pow(${i}, (${t} - ${r})) - 1.0) / (pow(${i}, (${a} - ${r})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[z.Case]:Dt(i=>{const t=i[i.length-1];let e=null;for(let n=i.length-3;n>=0;n-=2){const s=i[n],r=i[n+1];e=`(${s} ? ${r} : ${e||t})`}return e}),[z.In]:Dt(([i,...t],e)=>{const n=XI("in",e),s=[];for(let r=0;r<t.length;r+=1)s.push(`  if (inputValue == ${t[r]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${s.join(`
`)}
  return false;
}`,`${n}(${i})`}),[z.Array]:Dt(i=>`vec${i.length}(${i.join(", ")})`),[z.Color]:Dt(i=>{if(i.length===1)return`vec4(vec3(${i[0]} / 255.0), 1.0)`;if(i.length===2)return`(${i[1]} * vec4(vec3(${i[0]} / 255.0), 1.0))`;const t=i.slice(0,3).map(e=>`${e} / 255.0`);return i.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${i[3]} * vec4(${t.join(", ")}, 1.0))`}),[z.Band]:Dt(([i,t,e],n)=>{if(!(Oc in n.functions)){let s="";const r=n.bandCount||1;for(let o=0;o<r;o++){const a=Math.floor(o/4);let l=o%4;o===r-1&&l===1&&(l=3);const h=`${St.TILE_TEXTURE_ARRAY}[${a}]`;s+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Oc]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${St.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${St.TEXTURE_PIXEL_HEIGHT};
${s}
}`}return`${Oc}(${i}, ${t??"0.0"}, ${e??"0.0"})`}),[z.Palette]:(i,t)=>{const[e,...n]=t.args,s=n.length,r=new Uint8Array(s*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Wi(c),g=h*4;r[g]=u[0],r[g+1]=u[1],r[g+2]=u[2],r[g+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${ry}[${i.paletteTextures.length}]`,a=new RI(o,r);i.paletteTextures.push(a);const l=rg(e,Y,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${s}.0, 0.5))`}};function rg(i,t,e){if(i instanceof C_){const n=YI[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(e,i,t)}if((i.type&Y)>0)return Ds(i.value);if((i.type&te)>0)return i.value.toString();if((i.type&xe)>0)return Mn(i.value.toString());if((i.type&Wt)>0)return wl(i.value);if((i.type&me)>0)return ng(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${be(t)})`)}function HI(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const hr=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,cr=HI();class oy{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ds(cr["circle-radius"])} + ${Ds(cr["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=wl(cr["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ds(cr["stroke-width"]),this.strokeColorExpression_=wl(cr["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Mn("round"),this.strokeJoinExpression_=Mn("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=wl(cr["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,e,n){return this.varyings_.push({name:t,type:e,expression:n}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Bp} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Bp}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Mn("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Mn("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Mn("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Mn("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${hr}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const Ni={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},KI=["#00f","#0ff","#0f0","#ff0","#f00"];class QI extends Na{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener(Ni.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:KI),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const n=t.weight?t.weight:"weight";typeof n=="string"?this.weightFunction_=function(s){return s.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(Ni.BLUR)}getGradient(){return this.get(Ni.GRADIENT)}getRadius(){return this.get(Ni.RADIUS)}handleGradientChanged_(){this.gradient_=JI(this.getGradient())}setBlur(t){this.set(Ni.BLUR,t)}setGradient(t){this.set(Ni.GRADIENT,t)}setRadius(t){this.set(Ni.RADIUS,t)}createRenderer(){const t=new oy().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new ey(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const n=this.weightFunction_(e);return n!==void 0?wt(n,0,1):1}}],uniforms:{u_size:()=>(this.get(Ni.RADIUS)+this.get(Ni.BLUR))*2,u_blurSlope:()=>this.get(Ni.RADIUS)/Math.max(1,this.get(Ni.BLUR))},hitDetectionEnabled:!0,vertexShader:t.getSymbolVertexShader(),fragmentShader:t.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function JI(i){const t=Jt(1,256),e=t.createLinearGradient(0,0,1,256),n=1/(i.length-1);for(let s=0,r=i.length;s<r;++s)e.addColorStop(s*n,i[s]);return t.fillStyle=e,t.fillRect(0,0,1,256),t.canvas}const tP=QI;class eP extends La{constructor(t){t=t||{},super(t)}}class ay extends $d{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,s=t.viewState,r=s.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=we(l,Gi(e.extent,s.projection))),!a[ee.ANIMATING]&&!a[ee.INTERACTING]&&!Un(l))if(o){const h=s.projection,c=o.getImage(l,r,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===et.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=ae(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!xi(r,s))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=yt(o),h=Math.floor(a.width*((s[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=Vt(o),u=Math.floor(a.height*((o[3]-s[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const n=this.image_,s=n.getExtent(),r=n.getResolution(),[o,a]=Array.isArray(r)?r:[r,r],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,g=u.center,f=u.resolution,p=c*o/(f*l),_=c*a/(f*l),x=t.extent,v=u.resolution,w=u.rotation,E=Math.round(yt(x)/v*c),S=Math.round(Vt(x)/v*c);hi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,w,-E/2,-S/2),ph(this.inversePixelTransform,this.pixelTransform);const T=qu(this.pixelTransform);this.useContainer(e,T,this.getBackground(t));const R=this.getRenderContext(t),C=this.context.canvas;C.width!=E||C.height!=S?(C.width=E,C.height=S):this.containerReused||R.clearRect(0,0,E,S);let P=!1,N=!0;if(h.extent){const m=Gi(h.extent,u.projection);N=Qt(m,t.extent),P=N&&!Ze(m,t.extent),P&&this.clipUnrotated(R,t,m)}const U=n.getImage(),j=hi(this.tempTransform,E/2,S/2,p,_,0,l*(s[0]-g[0])/o,l*(g[1]-s[3])/a);this.renderedResolution=a*c/l;const B=U.width*j[0],d=U.height*j[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,t),N&&B>=.5&&d>=.5){const m=j[4],y=j[5],b=h.opacity;b!==1&&(R.save(),R.globalAlpha=b),R.drawImage(U,0,0,+U.width,+U.height,m,y,B,d),b!==1&&R.restore()}return this.postRender(this.context,t),P&&R.restore(),R.imageSmoothingEnabled=!0,T!==C.style.transform&&(C.style.transform=T),this.container}}class og extends eP{constructor(t){super(t)}createRenderer(){return new ay(this)}getData(t){return super.getData(t)}}const ls={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class ly extends La{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(ls.PRELOAD)}setPreload(t){this.set(ls.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(ls.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(ls.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class hy extends $d{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ze(),this.tmpTileRange_=new Zh(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),s=e.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!s}getTile(t,e,n,s){const r=s.pixelRatio,o=s.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,n,r,o);return l.getState()==q.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=ae(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!xi(r,s))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let g=c.getZForResolution(l.resolution);g>=c.getMinZoom();--g){const f=c.getTileCoordForCoordAndZ(s,g),p=h.getTile(g,f[1],f[2],o,a);if(!(p instanceof Da||p instanceof Xr)||p instanceof Xr&&p.getState()===q.EMPTY)return null;if(p.getState()!==q.LOADED)continue;const _=c.getOrigin(g),x=se(c.getTileSize(g)),v=c.getResolution(g),w=Math.floor(u*((s[0]-_[0])/v-f[1]*x[0])),E=Math.floor(u*((_[1]-s[1])/v-f[2]*x[1])),S=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),w+S,E+S)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,o=s.resolution,a=s.center,l=s.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),g=u.getRevision(),f=u.getTileGridForProjection(r),p=f.getZForResolution(o,u.zDirection),_=f.getResolution(p);let x=t.extent;const v=t.viewState.resolution,w=u.getTilePixelRatio(h),E=Math.round(yt(x)/v*h),S=Math.round(Vt(x)/v*h),T=n.extent&&Gi(n.extent);T&&(x=we(x,Gi(n.extent)));const R=_*E/2/w,C=_*S/2/w,P=[a[0]-R,a[1]-C,a[0]+R,a[1]+C],N=f.getTileRangeForExtentAndZ(x,p),U={};U[p]={};const j=this.createLoadedTileFinder(u,r,U),B=this.tmpExtent,d=this.tmpTileRange_;this.newTiles_=!1;const m=l?Hc(s.center,v,l,t.size):void 0;for(let K=N.minX;K<=N.maxX;++K)for(let G=N.minY;G<=N.maxY;++G){if(l&&!f.tileCoordIntersectsViewport([p,K,G],m))continue;const H=this.getTile(p,K,G,t);if(this.isDrawableTile(H)){const xt=st(this);if(H.getState()==q.LOADED){U[p][H.tileCoord.toString()]=H;let dt=H.inTransition(xt);dt&&n.opacity!==1&&(H.endTransition(xt),dt=!1),!this.newTiles_&&(dt||!this.renderedTiles.includes(H))&&(this.newTiles_=!0)}if(H.getAlpha(xt,t.time)===1)continue}const Q=f.getTileCoordChildTileRange(H.tileCoord,d,B);let nt=!1;Q&&(nt=j(p+1,Q)),nt||f.forEachTileCoordParentTileRange(H.tileCoord,j,d,B)}const y=_/o*h/w;hi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-E/2,-S/2);const b=qu(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const M=this.getRenderContext(t),I=this.context.canvas;ph(this.inversePixelTransform,this.pixelTransform),hi(this.tempTransform,E/2,S/2,y,y,0,-E/2,-S/2),I.width!=E||I.height!=S?(I.width=E,I.height=S):this.containerReused||M.clearRect(0,0,E,S),T&&this.clipUnrotated(M,t,T),u.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,t),this.renderedTiles.length=0;let A=Object.keys(U).map(Number);A.sort(on);let L,k,W;n.opacity===1&&(!this.containerReused||u.getOpaque(t.viewState.projection))?A=A.reverse():(L=[],k=[]);for(let K=A.length-1;K>=0;--K){const G=A[K],H=u.getTilePixelSize(G,h,r),Q=f.getResolution(G)/_,nt=H[0]*Q*y,xt=H[1]*Q*y,dt=f.getTileCoordForCoordAndZ(zn(P),G),Tt=f.getTileCoordExtent(dt),Et=ae(this.tempTransform,[w*(Tt[0]-P[0])/_,w*(P[3]-Tt[3])/_]),kt=w*u.getGutterForProjection(r),Yt=U[G];for(const ue in Yt){const Ht=Yt[ue],Ke=Ht.tileCoord,$a=dt[1]-Ke[1],ic=Math.round(Et[0]-($a-1)*nt),Va=dt[2]-Ke[2],Ya=Math.round(Et[1]-(Va-1)*xt),fi=Math.round(Et[0]-$a*nt),Li=Math.round(Et[1]-Va*xt),$i=ic-fi,Oi=Ya-Li,tr=p===G,er=tr&&Ht.getAlpha(st(this),t.time)!==1;let Zn=!1;if(!er)if(L){W=[fi,Li,fi+$i,Li,fi+$i,Li+Oi,fi,Li+Oi];for(let pn=0,nc=L.length;pn<nc;++pn)if(p!==G&&G<k[pn]){const Be=L[pn];Qt([fi,Li,fi+$i,Li+Oi],[Be[0],Be[3],Be[4],Be[7]])&&(Zn||(M.save(),Zn=!0),M.beginPath(),M.moveTo(W[0],W[1]),M.lineTo(W[2],W[3]),M.lineTo(W[4],W[5]),M.lineTo(W[6],W[7]),M.moveTo(Be[6],Be[7]),M.lineTo(Be[4],Be[5]),M.lineTo(Be[2],Be[3]),M.lineTo(Be[0],Be[1]),M.clip())}L.push(W),k.push(G)}else M.clearRect(fi,Li,$i,Oi);this.drawTileImage(Ht,t,fi,Li,$i,Oi,kt,tr),L&&!er?(Zn&&M.restore(),this.renderedTiles.unshift(Ht)):this.renderedTiles.push(Ht),this.updateUsedTiles(t.usedTiles,u,Ht)}}return this.renderedRevision=g,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!Nn(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,u,f,h,r,x,p,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(this.context,t),n.extent&&M.restore(),M.imageSmoothingEnabled=!0,b!==I.style.transform&&(I.style.transform=b),this.container}drawTileImage(t,e,n,s,r,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=st(this),g=e.layerStatesArray[e.layerIndex],f=g.opacity*(l?t.getAlpha(u,e.time):1),p=f!==c.globalAlpha;p&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,s,r,o),p&&c.restore(),f!==g.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=(function(s,r,o){const a=st(s);a in o.usedTiles&&s.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const s=st(e);s in t||(t[s]={}),t[s][n.getKey()]=!0}manageTilePyramid(t,e,n,s,r,o,a,l,h){const c=st(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],g=t.tileQueue,f=n.getMinZoom(),p=t.viewState.rotation,_=p?Hc(t.viewState.center,t.viewState.resolution,p,t.size):void 0;let x=0,v,w,E,S,T,R;for(R=f;R<=a;++R)for(w=n.getTileRangeForExtentAndZ(o,R,w),E=n.getResolution(R),S=w.minX;S<=w.maxX;++S)for(T=w.minY;T<=w.maxY;++T)p&&!n.tileCoordIntersectsViewport([R,S,T],_)||(a-R<=l?(++x,v=e.getTile(R,S,T,s,r),v.getState()==q.IDLE&&(u[v.getKey()]=!0,g.isKeyQueued(v.getKey())||g.enqueue([v,c,n.getTileCoordCenter(v.tileCoord),E])),h!==void 0&&h(v)):e.useTile(R,S,T,r));e.updateCacheSize(x,r)}}class Ql extends ly{constructor(t){super(t)}createRenderer(){return new hy(this)}}class ag extends Th{constructor(t,e,n,s,r){const o=r!==void 0?et.IDLE:et.LOADED;super(t,e,n,o),this.loader_=r!==void 0?r:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=et.ERROR):this.state=et.LOADED,this.changed()}load(){this.state==et.IDLE&&(this.state=et.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}function Jl(i){return Array.isArray(i)?Math.min(...i):i}class iP extends ay{constructor(t){super(t),this.vectorRenderer_=new q_(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=pe(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return Promise.resolve([]);const e=ae(this.coordinateToVectorPixelTransform_,ae(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const e=t.pixelRatio,n=t.viewState,s=n.resolution,r=t.viewHints,o=this.vectorRenderer_;let a=t.extent;this.layerImageRatio_!==1&&(a=a.slice(0),Qm(a,this.layerImageRatio_));const l=yt(a)/s,h=Vt(a)/s;if(!r[ee.ANIMATING]&&!r[ee.INTERACTING]&&!Un(a)){o.useContainer(null,null);const c=o.context,u=t.layerStatesArray[t.layerIndex],g=Object.assign({},u,{opacity:1}),f=Object.assign({},t,{extent:a,size:[l,h],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[g],layerIndex:0,declutter:null}),p=this.getLayer().getDeclutter();p&&(f.declutter={[p]:new Bd(9)});let _=!0;const x=new ag(a,s,e,c.canvas,function(v){o.prepareFrame(f)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(f,null)&&(o.renderDeclutter(f),o.renderDeferred(f),_=!1),v())});x.addEventListener(Lt.CHANGE,()=>{if(x.getState()!==et.LOADED)return;this.image_=_?null:x;const v=x.getPixelRatio(),w=Jl(x.getResolution())*e/v;this.renderedResolution=w,this.coordinateToVectorPixelTransform_=hi(this.coordinateToVectorPixelTransform_,l/2,h/2,1/w,-1/w,0,-n.center[0],-n.center[1])}),x.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,n,s,r){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,n,s,r):super.forEachFeatureAtCoordinate(t,e,n,s,r)}}class nP extends Na{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=t.imageRatio!==void 0?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new iP(this)}}const sP=nP,rP={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Yp={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class oP extends hy{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=pe(),this.tileClipContexts_=null}prepareTile(t,e,n){let s;const r=t.getState();return(r===q.LOADED||r===q.ERROR)&&(this.updateExecutorGroup_(t,e,n),this.tileImageNeedsRender_(t)&&(s=!0)),s}getTile(t,e,n,s){const r=s.pixelRatio,o=s.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(t,e,n,r,l),u=s.viewHints,g=!(u[ee.ANIMATING]||u[ee.INTERACTING]);return(g||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,r,l)&&(g||Date.now()-s.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,s),super.getTile(t,e,n,s)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&(e.getRenderMode()==="vector"?st(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,n){var s;const r=this.getLayer(),o=r.getRevision(),a=r.getRenderOrder()||null,l=t.wantedResolution,h=t.getReplayState(r);if(!h.dirty&&h.renderedResolution===l&&h.renderedRevision==o&&h.renderedRenderOrder==a)return;const c=r.getSource(),u=!!r.getDeclutter(),g=c.getTileGrid(),f=c.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),p=c.getSourceTiles(e,n,t),_=st(r);delete t.hitDetectionImageData[_],t.executorGroups[_]=[],h.dirty=!1;for(let x=0,v=p.length;x<v;++x){const w=p[x];if(w.getState()!=q.LOADED)continue;const E=w.tileCoord,S=g.getTileCoordExtent(E),T=we(f,S),R=Ii(T,r.getRenderBuffer()*l,this.tmpExtent),C=Nn(S,T)?null:R,P=new N_(0,T,l,e),N=Zl(l,e),U=function(y,b){let M;const I=y.getStyleFunction()||r.getStyleFunction();if(I&&(M=I(y,l)),M){const A=this.renderFeature(y,N,M,P,u,b);h.dirty=h.dirty||A}},j=w.getFeatures();a&&a!==h.renderedRenderOrder&&j.sort(a);for(let y=0,b=j.length;y<b;++y){const M=j[y];(!C||Qt(C,M.getGeometry().getExtent()))&&U.call(this,M,y)}const B=P.finish(),d=r.getRenderMode()!=="vector"&&u&&p.length===1?null:T,m=new D_(d,l,e,c.getOverlaps(),B,r.getRenderBuffer(),!!((s=this.frameState)!=null&&s.declutter));t.executorGroups[_].push(m)}h.renderedRevision=o,h.renderedRenderOrder=a,h.renderedResolution=l}forEachFeatureAtCoordinate(t,e,n,s,r){const o=e.viewState.resolution,a=e.viewState.rotation;n=n??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),c=Dr([t]);Ii(c,o*n,c);const u={},g=function(_,x,v){let w=_.getId();w===void 0&&(w=st(_));const E=u[w];if(E){if(E!==!0&&v<E.distanceSq){if(v===0)return u[w]=!0,r.splice(r.lastIndexOf(E),1),s(_,l,x);E.geometry=x,E.distanceSq=v}}else{if(v===0)return u[w]=!0,s(_,l,x);r.push(u[w]={feature:_,layer:l,geometry:x,distanceSq:v,callback:s})}},f=this.renderedTiles;let p;for(let _=0,x=f.length;!p&&_<x;++_){const v=f[_],w=h.getTileCoordExtent(v.wrappedTileCoord);if(!Qt(w,c))continue;const E=st(l),S=[v.executorGroups[E]],T=l.getDeclutter();S.some(R=>{const C=T?e.declutter[T].all().map(P=>P.value):null;for(let P=0,N=R.length;P<N;++P)if(p=R[P].forEachFeatureAtCoordinate(t,o,a,n,g,C),p)return!0})}return p}getFeatures(t){return new Promise((e,n)=>{const s=this.getLayer(),r=st(s),o=s.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=ae(this.renderedPixelToCoordinateTransform_,t.slice()),g=c.getTileCoordForCoordAndResolution(u,h);let f;for(let E=0,S=this.renderedTiles.length;E<S;++E)if(g.toString()===this.renderedTiles[E].tileCoord.toString()){if(f=this.renderedTiles[E],f.getState()===q.LOADED){const T=c.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!Ze(l,T)&&i0(u,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){e([]);return}const p=c.getTileCoordExtent(f.wrappedTileCoord),_=zn(p),x=[(u[0]-_[0])/h,(_[1]-u[1])/h],v=f.getSourceTiles().reduce(function(E,S){return E.concat(S.getFeatures())},[]);let w=f.hitDetectionImageData[r];if(!w){const E=se(c.getTileSize(c.getZForResolution(h,o.zDirection))),S=this.renderedRotation_,T=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),h,0,_i,E[0]*_i,E[1]*_i,0)];w=j_(E,T,v,s.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(s).renderedResolution,S),f.hitDetectionImageData[r]=w}e(z_(x,v,w))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const n=this.context,s=n.globalAlpha;n.globalAlpha=e.opacity;const r=t.viewHints,o=!(r[ee.ANIMATING]||r[ee.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.executorGroups[st(this.getLayer())],g=this.getLayer().getDeclutter();if(u)for(let f=u.length-1;f>=0;--f)u[f].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(c,t),t.viewState.rotation,o,Xl,g?t.declutter[g]:void 0)}n.globalAlpha=s}renderDeferredInternal(t){const e=this.renderedTiles.reduce((s,r,o)=>(r.executorGroups[st(this.getLayer())].forEach(a=>s.push({executorGroup:a,index:o})),s),[]),n=e.map(({executorGroup:s})=>s.getDeferredZIndexContexts());n.map(s=>Object.keys(s)).flat().sort(on).map(Number).forEach(s=>{n.forEach((r,o)=>{r[s]&&r[s].forEach(a=>{const{executorGroup:l,index:h}=e[o],c=l.getRenderedContext(),u=c.globalAlpha;c.globalAlpha=this.renderedOpacity_;const g=this.tileClipContexts_[h];g&&g.draw(c),a.draw(c),g&&c.restore(),c.globalAlpha=u,a.clear()})})})}getTileRenderTransform(t,e){const n=e.pixelRatio,s=e.viewState,r=s.center,o=s.resolution,a=s.rotation,l=e.size,h=Math.round(l[0]*n),c=Math.round(l[1]*n),u=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),g=t.tileCoord,f=u.getTileCoordExtent(t.wrappedTileCoord),p=u.getTileCoordExtent(g,this.tmpExtent)[0]-f[0];return Qr(Fo(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(r,o,a,n,h,c,p))}postRender(t,e){const n=e.viewHints,s=!(n[ee.ANIMATING]||n[ee.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const r=this.getLayer(),o=r.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=r.getDeclutter(),h=l?Yp[o].filter(E=>!Xl.includes(E)):Yp[o],c=e.viewState,u=c.rotation,g=r.getSource(),f=g.getTileGridForProjection(c.projection).getZForResolution(c.resolution,g.zDirection),p=this.renderedTiles,_=[],x=[],v=[];let w=!0;for(let E=p.length-1;E>=0;--E){const S=p[E];w=w&&!S.getReplayState(r).dirty;const T=S.executorGroups[st(r)].filter(B=>B.hasExecutors(h));if(T.length===0)continue;const R=this.getTileRenderTransform(S,e),C=S.tileCoord[0];let P=!1;const N=T[0].getClipCoords(R);let U=t,j;if(N){l&&(j=new Zd,U=j.getContext());for(let B=0,d=_.length;B<d;++B)if(f!==C&&C<x[B]){const m=_[B];Qt([N[0],N[3],N[4],N[7]],[m[0],m[3],m[4],m[7]])&&(P||(U.save(),P=!0),U.beginPath(),U.moveTo(N[0],N[1]),U.lineTo(N[2],N[3]),U.lineTo(N[4],N[5]),U.lineTo(N[6],N[7]),U.moveTo(m[6],m[7]),U.lineTo(m[4],m[5]),U.lineTo(m[2],m[3]),U.lineTo(m[0],m[1]),U.clip())}_.push(N),x.push(C)}for(let B=0,d=T.length;B<d;++B)T[B].execute(t,[t.canvas.width,t.canvas.height],R,u,s,h);P&&(U===t?U.restore():v[E]=j)}t.globalAlpha=a,this.ready=w,this.tileClipContexts_=v,super.postRender(t,e)}renderFeature(t,e,n,s,r,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=$l(s,t,n[l],e,this.boundHandleStyleImageChange_,void 0,r,o)||a;else a=$l(s,t,n,e,this.boundHandleStyleImageChange_,void 0,r,o);return a}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const n=t.getReplayState(e),s=e.getRevision(),r=t.wantedResolution;return n.renderedTileResolution!==r||n.renderedTileRevision!==s}renderTileImage_(t,e){const n=this.getLayer(),s=t.getReplayState(n),r=n.getRevision(),o=t.executorGroups[st(n)];s.renderedTileRevision=r;const a=t.wrappedTileCoord,l=a[0],h=n.getSource();let c=e.pixelRatio;const u=e.viewState.projection,g=h.getTileGridForProjection(u),f=g.getResolution(t.tileCoord[0]),p=e.pixelRatio/t.wantedResolution*f,_=g.getResolution(l),x=t.getContext(n);c=Math.round(Math.max(c,p/c));const v=h.getTilePixelSize(l,c,u);x.canvas.width=v[0],x.canvas.height=v[1];const w=c/p;if(w!==1){const R=Vc(this.tmpTransform_);Fo(R,w,w),x.setTransform.apply(x,R)}const E=g.getTileCoordExtent(a,this.tmpExtent),S=p/_,T=Vc(this.tmpTransform_);Fo(T,S,-S),Wu(T,-E[0],-E[3]);for(let R=0,C=o.length;R<C;++R)o[R].execute(x,[x.canvas.width*w,x.canvas.height*w],T,0,!0,rP[n.getRenderMode()],null);s.renderedTileResolution=t.wantedResolution}}class cy extends Na{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;const n=t.renderMode||"hybrid";At(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new oP(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ls.PRELOAD)}getUseInterimTilesOnError(){return this.get(ls.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(ls.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(ls.USE_INTERIM_TILES_ON_ERROR,t)}}function _t(i,t,e){const n=Wd();return n.style=i.style,VI(t,e,n,i)}function Hp(i){const t=Wi(i),e=t[0]*256,n=t[1],s=t[2]*256,r=Math.round(t[3]*255);return[e+n,s+r]}const aP=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function uy(i){return i===Wt?2:i===me?4:1}function Fc(i){const t=uy(i);return t>1?`vec${t}`:"float"}function th(i){return(JSON.stringify(i).split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0),0)>>>0).toString()}function lg(i,t,e,n){if(`${n}radius`in i&&n!=="icon-"){let s=_t(e,i[`${n}radius`],Y);if(`${n}radius2`in i){const r=_t(e,i[`${n}radius2`],Y);s=`max(${s}, ${r})`}`${n}stroke-width`in i&&(s=`(${s} + ${_t(e,i[`${n}stroke-width`],Y)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${s} * 2. + 0.5)`)}if(`${n}scale`in i){const s=_t(e,i[`${n}scale`],Y|me);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${s}`)}`${n}displacement`in i&&t.setSymbolOffsetExpression(_t(e,i[`${n}displacement`],me)),`${n}rotation`in i&&t.setSymbolRotationExpression(_t(e,i[`${n}rotation`],Y)),`${n}rotate-with-view`in i&&t.setSymbolRotateWithView(!!i[`${n}rotate-with-view`])}function dy(i,t,e,n,s){let r="vec4(0.)";if(t!==null&&(r=t),e!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${i})`;r=`mix(${e}, ${r}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${i}))`;let a=`${r} * ${o}`;return s!==null&&(a=`${a} * ${s}`),a}function hg(i,t,e,n,s){const r=new Image;let o;return r.crossOrigin=i[`${n}cross-origin`]===void 0?"anonymous":i[`${n}cross-origin`],r.src=i[`${n}src`],r.complete&&r.width&&r.height?o=ng([r.width,r.height]):(e[`u_texture${s}_size`]=()=>r.complete?[r.width,r.height]:[0,0],t.addUniform(`vec2 u_texture${s}_size`),o=`u_texture${s}_size`),e[`u_texture${s}`]=r,t.addUniform(`sampler2D u_texture${s}`),o}function cg(i,t,e,n,s){let r=_t(e,i[`${t}offset`],me);if(`${t}offset-origin`in i)switch(i[`${t}offset-origin`]){case"top-right":r=`vec2(${n}.x, 0.) + ${s} * vec2(-1., 0.) + ${r} * vec2(-1., 1.)`;break;case"bottom-left":r=`vec2(0., ${n}.y) + ${s} * vec2(0., -1.) + ${r} * vec2(1., -1.)`;break;case"bottom-right":r=`${n} - ${s} - ${r}`;break}return r}function lP(i,t,e,n,s){s.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,lg(i,t,n,"circle-");let r=null;"circle-opacity"in i&&(r=_t(s,i["circle-opacity"],Y));let o="coordsPx";"circle-scale"in i&&(o=`coordsPx / ${_t(s,i["circle-scale"],Y|me)}`);let a=null;"circle-fill-color"in i&&(a=_t(s,i["circle-fill-color"],Wt));let l=null;"circle-stroke-color"in i&&(l=_t(s,i["circle-stroke-color"],Wt));let h=_t(s,i["circle-radius"],Y),c=null;"circle-stroke-width"in i&&(c=_t(s,i["circle-stroke-width"],Y),h=`(${h} + ${c} * 0.5)`);const u=`circleDistanceField(${o}, ${h})`,g=dy(u,a,l,c,r);t.setSymbolColorExpression(g)}function hP(i,t,e,n,s){s.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,s.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,s.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,lg(i,t,n,"shape-");let r=null;"shape-opacity"in i&&(r=_t(s,i["shape-opacity"],Y));let o="coordsPx";"shape-scale"in i&&(o=`coordsPx / ${_t(s,i["shape-scale"],Y|me)}`);let a=null;"shape-fill-color"in i&&(a=_t(s,i["shape-fill-color"],Wt));let l=null;"shape-stroke-color"in i&&(l=_t(s,i["shape-stroke-color"],Wt));let h=null;"shape-stroke-width"in i&&(h=_t(s,i["shape-stroke-width"],Y));const c=_t(s,i["shape-points"],Y);let u="0.";"shape-angle"in i&&(u=_t(s,i["shape-angle"],Y));let g,f=_t(s,i["shape-radius"],Y);if(h!==null&&(f=`${f} + ${h} * 0.5`),"shape-radius2"in i){let _=_t(s,i["shape-radius2"],Y);h!==null&&(_=`${_} + ${h} * 0.5`),g=`starDistanceField(${o}, ${c}, ${f}, ${_}, ${u})`}else g=`regularDistanceField(${o}, ${c}, ${f}, ${u})`;const p=dy(g,a,l,h,r);t.setSymbolColorExpression(p)}function cP(i,t,e,n,s){let r="vec4(1.0)";"icon-color"in i&&(r=_t(s,i["icon-color"],Wt)),"icon-opacity"in i&&(r=`${r} * ${_t(s,i["icon-opacity"],Y)}`);const o=th(i["icon-src"]),a=hg(i,t,e,"icon-",o);if(t.setSymbolColorExpression(`${r} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in i&&"icon-height"in i&&t.setSymbolSizeExpression(`vec2(${_t(n,i["icon-width"],Y)}, ${_t(n,i["icon-height"],Y)})`),"icon-offset"in i&&"icon-size"in i){const l=_t(n,i["icon-size"],me),h=t.getSymbolSizeExpression();t.setSymbolSizeExpression(l);const c=cg(i,"icon-",n,"v_quadSizePx",l);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(lg(i,t,n,"icon-"),"icon-anchor"in i){const l=_t(n,i["icon-anchor"],me);let h="1.0";"icon-scale"in i&&(h=_t(n,i["icon-scale"],Y|me));let c;i["icon-anchor-x-units"]==="pixels"&&i["icon-anchor-y-units"]==="pixels"?c=`${l} * ${h}`:i["icon-anchor-x-units"]==="pixels"?c=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:i["icon-anchor-y-units"]==="pixels"?c=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:c=`${l} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in i)switch(i["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function uP(i,t,e,n,s){if("stroke-color"in i&&t.setStrokeColorExpression(_t(s,i["stroke-color"],Wt)),"stroke-pattern-src"in i){const r=th(i["stroke-pattern-src"]),o=hg(i,t,e,"stroke-pattern-",r);let a=o,l="vec2(0.)";"stroke-pattern-offset"in i&&"stroke-pattern-size"in i&&(a=_t(s,i["stroke-pattern-size"],me),l=cg(i,"stroke-pattern-",s,o,a));let h="0.";"stroke-pattern-spacing"in i&&(h=_t(s,i["stroke-pattern-spacing"],Y)),s.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const c=`u_texture${r}`;let u="1.";"stroke-color"in i&&(u=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${o}, ${l}, ${a}, ${h}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in i&&t.setStrokeWidthExpression(_t(n,i["stroke-width"],Y)),"stroke-offset"in i&&t.setStrokeOffsetExpression(_t(n,i["stroke-offset"],Y)),"stroke-line-cap"in i&&t.setStrokeCapExpression(_t(n,i["stroke-line-cap"],xe)),"stroke-line-join"in i&&t.setStrokeJoinExpression(_t(n,i["stroke-line-join"],xe)),"stroke-miter-limit"in i&&t.setStrokeMiterLimitExpression(_t(n,i["stroke-miter-limit"],Y)),"stroke-line-dash"in i){s.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Mn("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Mn("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let r=i["stroke-line-dash"].map(g=>_t(s,g,Y));r.length%2===1&&(r=[...r,...r]);let o="0.";"stroke-line-dash-offset"in i&&(o=_t(n,i["stroke-line-dash-offset"],Y));const a=`dashDistanceField_${th(i["stroke-line-dash"])}`,l=r.map((g,f)=>`float dashLength${f} = ${g};`),h=r.map((g,f)=>`dashLength${f}`).join(" + ");let c="0.",u=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType)`;for(let g=2;g<r.length;g+=2)c=`${c} + dashLength${g-2} + dashLength${g-1}`,u=`min(${u}, getSingleDashDistance(distance, radius, ${c}, dashLength${g}, totalDashLength, capType))`;s.functions[a]=`float ${a}(float distance, float radius, float capType) {
  ${l.join(`
  `)}
  float totalDashLength = ${h};
  return ${u};
}`,t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function dP(i,t,e,n,s){if("fill-color"in i&&t.setFillColorExpression(_t(s,i["fill-color"],Wt)),"fill-pattern-src"in i){const r=th(i["fill-pattern-src"]),o=hg(i,t,e,"fill-pattern-",r);let a=o,l="vec2(0.)";"fill-pattern-offset"in i&&"fill-pattern-size"in i&&(a=_t(s,i["fill-pattern-size"],me),l=cg(i,"fill-pattern-",s,o,a)),s.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${r}`;let c="1.";"fill-color"in i&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${h}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function gP(i){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:i},e={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:i},n=new oy,s={};if("icon-src"in i?cP(i,n,s,t,e):"shape-points"in i?hP(i,n,s,t,e):"circle-radius"in i&&lP(i,n,s,t,e),uP(i,n,s,t,e),dP(i,n,s,t,e),i.filter){const o=_t(e,i.filter,te);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(e.variables).forEach(function(o){const a=e.variables[o],l=sg(a.name);n.addUniform(`${Fc(a.type)} ${l}`);let h;a.type===xe?h=()=>Kl(i.variables[a.name]):a.type===Wt?h=()=>Hp([...Wi(i.variables[a.name]||"#eee")]):a.type===te?h=()=>i.variables[a.name]?1:0:h=()=>i.variables[a.name],s[l]=h}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];t.properties[o]||(t.properties[o]=a);let l=Fc(a.type),h=`a_prop_${a.name}`;a.type===Wt&&(l="vec4",h=`unpackColor(${h})`,n.addVertexShaderFunction(aP)),n.addVarying(`v_prop_${a.name}`,l,h)}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];n.addAttribute(`${Fc(a.type)} a_prop_${a.name}`)});const r=Object.keys(t.properties).map(function(o){const a=t.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===xe?l=h=>Kl(h.get(a.name)):a.type===Wt?l=h=>Hp([...Wi(h.get(a.name)||"#eee")]):a.type===te?l=h=>h.get(a.name)?1:0:l=h=>h.get(a.name),{name:a.name,size:uy(a.type),callback:l}});for(const o in t.functions)n.addVertexShaderFunction(t.functions[o]);for(const o in e.functions)n.addFragmentShaderFunction(e.functions[o]);return{builder:n,attributes:r.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:s}}class fP extends La{constructor(t){const e=Object.assign({},t);super(e),this.parseResult_=gP(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){const t=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new ey(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:t})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}const pP=fP;function Kp(i,t){const e=`
    attribute vec2 ${vl.TEXTURE_COORD};
    uniform mat4 ${St.TILE_TRANSFORM};
    uniform float ${St.TEXTURE_PIXEL_WIDTH};
    uniform float ${St.TEXTURE_PIXEL_HEIGHT};
    uniform float ${St.TEXTURE_RESOLUTION};
    uniform float ${St.TEXTURE_ORIGIN_X};
    uniform float ${St.TEXTURE_ORIGIN_Y};
    uniform float ${St.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${vl.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${St.TEXTURE_ORIGIN_X} + ${St.TEXTURE_RESOLUTION} * ${St.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${St.TEXTURE_ORIGIN_Y} - ${St.TEXTURE_RESOLUTION} * ${St.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${St.TILE_TRANSFORM} * vec4(${vl.TEXTURE_COORD}, ${St.DEPTH}, 1.0);
    }
  `,n={...$I(),inFragmentShader:!0,bandCount:t,style:i},s=[];if(i.color!==void 0){const u=_t(n,i.color,Wt);s.push(`color = ${u};`)}if(i.contrast!==void 0){const u=_t(n,i.contrast,Y);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=_t(n,i.exposure,Y);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=_t(n,i.saturation,Y);s.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=_t(n,i.gamma,Y);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=_t(n,i.brightness,Y);s.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const r={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const g=n.variables[Object.keys(n.variables)[u]];if(!(g.name in i.variables))throw new Error(`Missing '${g.name}' in style variables`);const f=sg(g.name);r[f]=function(){let p=i.variables[g.name];return typeof p=="string"&&(p=Kl(p)),p!==void 0?p:-9999999}}const a=Object.keys(r).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${St.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${ry}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${St.RENDER_EXTENT};
    uniform float ${St.TRANSITION_ALPHA};
    uniform float ${St.TEXTURE_PIXEL_WIDTH};
    uniform float ${St.TEXTURE_PIXEL_HEIGHT};
    uniform float ${St.RESOLUTION};
    uniform float ${St.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${St.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${St.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${St.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${St.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${St.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${St.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:r,paletteTextures:n.paletteTextures}}class eh extends ly{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Ut.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=Kp(this.style_,this.getSourceBandCount_());return new qI(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let s;for(let r=0,o=e.length;r<o;++r)this.renderedSource_=e[r],n.prepareFrame(t)&&(s=n.renderFrame(t));return s}render(t,e){this.rendered=!0;const n=t.viewState,s=this.getSources(t.extent,n.resolution);let r=!0;for(let a=0,l=s.length;a<l;++a){const h=s[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}r=r&&c=="ready"}const o=this.renderSources(t,s);if(this.getRenderer().renderComplete&&r)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!s.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=Kp(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}eh.prototype.dispose;const mP=Object.freeze(Object.defineProperty({__proto__:null,Graticule:$C,Group:zh,Heatmap:tP,Image:og,Layer:La,Tile:Ql,Vector:Vd,VectorImage:sP,VectorTile:cy,WebGLPoints:pP,WebGLTile:eh},Symbol.toStringTag,{value:"Module"}));var Xe=(i,t,e)=>new Promise((n,s)=>{var r=l=>{try{a(e.next(l))}catch(h){s(h)}},o=l=>{try{a(e.throw(l))}catch(h){s(h)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,o);a((e=e.apply(i,t)).next())}),yi=Uint8Array,Er=Uint16Array,_P=Int32Array,gy=new yi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fy=new yi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yP=new yi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),py=function(i,t){for(var e=new Er(31),n=0;n<31;++n)e[n]=t+=1<<i[n-1];for(var s=new _P(e[30]),n=1;n<30;++n)for(var r=e[n];r<e[n+1];++r)s[r]=r-e[n]<<5|n;return{b:e,r:s}},my=py(gy,2),_y=my.b,xP=my.r;_y[28]=258,xP[258]=28;var vP=py(fy,0),wP=vP.b,Tu=new Er(32768);for(qt=0;qt<32768;++qt)bn=(qt&43690)>>1|(qt&21845)<<1,bn=(bn&52428)>>2|(bn&13107)<<2,bn=(bn&61680)>>4|(bn&3855)<<4,Tu[qt]=((bn&65280)>>8|(bn&255)<<8)>>1;var bn,qt,Uo=function(i,t,e){for(var n=i.length,s=0,r=new Er(t);s<n;++s)i[s]&&++r[i[s]-1];var o=new Er(t);for(s=1;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(e){a=new Er(1<<t);var l=15-t;for(s=0;s<n;++s)if(i[s])for(var h=s<<4|i[s],c=t-i[s],u=o[i[s]-1]++<<c,g=u|(1<<c)-1;u<=g;++u)a[Tu[u]>>l]=h}else for(a=new Er(n),s=0;s<n;++s)i[s]&&(a[s]=Tu[o[i[s]-1]++]>>15-i[s]);return a},Ga=new yi(288);for(qt=0;qt<144;++qt)Ga[qt]=8;var qt;for(qt=144;qt<256;++qt)Ga[qt]=9;var qt;for(qt=256;qt<280;++qt)Ga[qt]=7;var qt;for(qt=280;qt<288;++qt)Ga[qt]=8;var qt,yy=new yi(32);for(qt=0;qt<32;++qt)yy[qt]=5;var qt,bP=Uo(Ga,9,1),EP=Uo(yy,5,1),Nc=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},ki=function(i,t,e){var n=t/8|0;return(i[n]|i[n+1]<<8)>>(t&7)&e},kc=function(i,t){var e=t/8|0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>(t&7)},SP=function(i){return(i+7)/8|0},TP=function(i,t,e){(t==null||t<0)&&(t=0),(e==null||e>i.length)&&(e=i.length);var n=new yi(e-t);return n.set(i.subarray(t,e)),n},MP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pi=function(i,t,e){var n=new Error(t||MP[i]);if(n.code=i,Error.captureStackTrace&&Error.captureStackTrace(n,pi),!e)throw n;return n},ug=function(i,t,e,n){var s=i.length,r=n?n.length:0;if(!s||t.f&&!t.l)return e||new yi(0);var o=!e||t.i!=2,a=t.i;e||(e=new yi(s*3));var l=function(Tt){var Et=e.length;if(Tt>Et){var kt=new yi(Math.max(Et*2,Tt));kt.set(e),e=kt}},h=t.f||0,c=t.p||0,u=t.b||0,g=t.l,f=t.d,p=t.m,_=t.n,x=s*8;do{if(!g){h=ki(i,c,1);var v=ki(i,c+1,3);if(c+=3,v)if(v==1)g=bP,f=EP,p=9,_=5;else if(v==2){var w=ki(i,c,31)+257,E=ki(i,c+10,15)+4,S=w+ki(i,c+5,31)+1;c+=14;for(var T=new yi(S),R=new yi(19),C=0;C<E;++C)R[yP[C]]=ki(i,c+C*3,7);c+=E*3;for(var P=Nc(R),N=(1<<P)-1,U=Uo(R,P,1),C=0;C<S;){var j=U[ki(i,c,N)];c+=j&15;var B=j>>4;if(B<16)T[C++]=B;else{var d=0,m=0;for(B==16?(m=3+ki(i,c,3),c+=2,d=T[C-1]):B==17?(m=3+ki(i,c,7),c+=3):B==18&&(m=11+ki(i,c,127),c+=7);m--;)T[C++]=d}}var y=T.subarray(0,w),b=T.subarray(w);p=Nc(y),_=Nc(b),g=Uo(y,p,1),f=Uo(b,_,1)}else pi(1);else{var B=SP(c)+4,M=i[B-4]|i[B-3]<<8,I=B+M;if(I>s){a&&pi(0);break}o&&l(u+M),e.set(i.subarray(B,I),u),t.b=u+=M,t.p=c=I*8,t.f=h;continue}if(c>x){a&&pi(0);break}}o&&l(u+131072);for(var A=(1<<p)-1,L=(1<<_)-1,k=c;;k=c){var d=g[kc(i,c)&A],W=d>>4;if(c+=d&15,c>x){a&&pi(0);break}if(d||pi(2),W<256)e[u++]=W;else if(W==256){k=c,g=null;break}else{var K=W-254;if(W>264){var C=W-257,G=gy[C];K=ki(i,c,(1<<G)-1)+_y[C],c+=G}var H=f[kc(i,c)&L],Q=H>>4;H||pi(3),c+=H&15;var b=wP[Q];if(Q>3){var G=fy[Q];b+=kc(i,c)&(1<<G)-1,c+=G}if(c>x){a&&pi(0);break}o&&l(u+131072);var nt=u+K;if(u<b){var xt=r-b,dt=Math.min(b,nt);for(xt+u<0&&pi(3);u<dt;++u)e[u]=n[xt+u]}for(;u<nt;u+=4)e[u]=e[u-b],e[u+1]=e[u+1-b],e[u+2]=e[u+2-b],e[u+3]=e[u+3-b];u=nt}}t.l=g,t.p=k,t.b=u,t.f=h,g&&(h=1,t.m=p,t.d=f,t.n=_)}while(!h);return u==e.length?e:TP(e,0,u)},RP=new yi(0),CP=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&pi(6,"invalid gzip data");var t=i[3],e=10;t&4&&(e+=(i[10]|i[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!i[e++]);return e+(t&2)},IP=function(i){var t=i.length;return(i[t-4]|i[t-3]<<8|i[t-2]<<16|i[t-1]<<24)>>>0},PP=function(i,t){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&pi(6,"invalid zlib data"),(i[1]>>5&1)==+!t&&pi(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function AP(i,t){return ug(i,{i:2},t&&t.out,t&&t.dictionary)}function LP(i,t){var e=CP(i);return e+8>i.length&&pi(6,"invalid gzip data"),ug(i.subarray(e,-8),{i:2},t&&t.out||new yi(IP(i)),t&&t.dictionary)}function OP(i,t){return ug(i.subarray(PP(i,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function Mu(i,t){return i[0]==31&&i[1]==139&&i[2]==8?LP(i,t):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?AP(i,t):OP(i,t)}var FP=typeof TextDecoder<"u"&&new TextDecoder,NP=0;try{FP.decode(RP,{stream:!0}),NP=1}catch{}var xy=(i,t)=>i*Math.pow(2,t),vo=(i,t)=>Math.floor(i/Math.pow(2,t)),ih=(i,t)=>xy(i.getUint16(t+1,!0),8)+i.getUint8(t),vy=(i,t)=>xy(i.getUint32(t+2,!0),16)+i.getUint16(t,!0),kP=(i,t,e,n,s)=>{if(i!=n.getUint8(s))return i-n.getUint8(s);const r=ih(n,s+1);if(t!=r)return t-r;const o=ih(n,s+4);return e!=o?e-o:0},DP=(i,t,e,n)=>{const s=wy(i,t|128,e,n);return s?{z:t,x:e,y:n,offset:s[0],length:s[1],is_dir:!0}:null},Qp=(i,t,e,n)=>{const s=wy(i,t,e,n);return s?{z:t,x:e,y:n,offset:s[0],length:s[1],is_dir:!1}:null},wy=(i,t,e,n)=>{let s=0,r=i.byteLength/17-1;for(;s<=r;){const o=r+s>>1,a=kP(t,e,n,i,o*17);if(a>0)s=o+1;else if(a<0)r=o-1;else return[vy(i,o*17+7),i.getUint32(o*17+13,!0)]}return null},GP=(i,t)=>i.is_dir&&!t.is_dir?1:!i.is_dir&&t.is_dir?-1:i.z!==t.z?i.z-t.z:i.x!==t.x?i.x-t.x:i.y-t.y,by=(i,t)=>{const e=i.getUint8(t*17);return{z:e&127,x:ih(i,t*17+1),y:ih(i,t*17+4),offset:vy(i,t*17+7),length:i.getUint32(t*17+13,!0),is_dir:e>>7===1}},Jp=i=>{const t=[],e=new DataView(i);for(let n=0;n<e.byteLength/17;n++)t.push(by(e,n));return jP(t)},jP=i=>{i.sort(GP);const t=new ArrayBuffer(17*i.length),e=new Uint8Array(t);for(let n=0;n<i.length;n++){const s=i[n];let r=s.z;s.is_dir&&(r=r|128),e[n*17]=r,e[n*17+1]=s.x&255,e[n*17+2]=s.x>>8&255,e[n*17+3]=s.x>>16&255,e[n*17+4]=s.y&255,e[n*17+5]=s.y>>8&255,e[n*17+6]=s.y>>16&255,e[n*17+7]=s.offset&255,e[n*17+8]=vo(s.offset,8)&255,e[n*17+9]=vo(s.offset,16)&255,e[n*17+10]=vo(s.offset,24)&255,e[n*17+11]=vo(s.offset,32)&255,e[n*17+12]=vo(s.offset,48)&255,e[n*17+13]=s.length&255,e[n*17+14]=s.length>>8&255,e[n*17+15]=s.length>>16&255,e[n*17+16]=s.length>>24&255}return t},zP=(i,t)=>{if(i.byteLength<17)return null;const e=i.byteLength/17,n=by(i,e-1);if(n.is_dir){const s=n.z,r=t.z-s,o=Math.trunc(t.x/(1<<r)),a=Math.trunc(t.y/(1<<r));return{z:s,x:o,y:a}}return null};function UP(i){return Xe(this,null,function*(){const t=yield i.getBytes(0,512e3),e=new DataView(t.data),n=e.getUint32(4,!0),s=e.getUint16(8,!0),r=new TextDecoder("utf-8"),o=JSON.parse(r.decode(new DataView(t.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let h=0;"maxzoom"in o&&(h=+o.maxzoom);let c=0,u=0,g=0,f=-180,p=-85,_=180,x=85;if(o.bounds){const v=o.bounds.split(",");f=+v[0],p=+v[1],_=+v[2],x=+v[3]}if(o.center){const v=o.center.split(",");c=+v[0],u=+v[1],g=+v[2]}return{specVersion:e.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:h,minLon:f,minLat:p,maxLon:_,maxLat:x,centerZoom:g,centerLon:c,centerLat:u,etag:t.etag}})}function BP(i,t,e,n,s,r,o){return Xe(this,null,function*(){let a=yield e.getArrayBuffer(t,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(a=Jp(a));const l=Qp(new DataView(a),n,s,r);if(l){let c=(yield t.getBytes(l.offset,l.length,o)).data;const u=new DataView(c);return u.getUint8(0)==31&&u.getUint8(1)==139&&(c=Mu(new Uint8Array(c))),{data:c}}const h=zP(new DataView(a),{z:n,x:s,y:r});if(h){const c=DP(new DataView(a),h.z,h.x,h.y);if(c){let u=yield e.getArrayBuffer(t,c.offset,c.length,i);i.specVersion===1&&(u=Jp(u));const g=Qp(new DataView(u),n,s,r);if(g){let f=(yield t.getBytes(g.offset,g.length,o)).data;const p=new DataView(f);return p.getUint8(0)==31&&p.getUint8(1)==139&&(f=Mu(new Uint8Array(f))),{data:f}}}}})}var Ey={getHeader:UP,getZxy:BP};function WP(i,t){return(t>>>0)*4294967296+(i>>>0)}function qP(i,t){const e=t.buf;let n,s;if(s=e[t.pos++],n=(s&112)>>4,s<128||(s=e[t.pos++],n|=(s&127)<<3,s<128)||(s=e[t.pos++],n|=(s&127)<<10,s<128)||(s=e[t.pos++],n|=(s&127)<<17,s<128)||(s=e[t.pos++],n|=(s&127)<<24,s<128)||(s=e[t.pos++],n|=(s&1)<<31,s<128))return WP(i,n);throw new Error("Expected varint not more than 10 bytes")}function wo(i){const t=i.buf;let e,n;return n=t[i.pos++],e=n&127,n<128||(n=t[i.pos++],e|=(n&127)<<7,n<128)||(n=t[i.pos++],e|=(n&127)<<14,n<128)||(n=t[i.pos++],e|=(n&127)<<21,n<128)?e:(n=t[i.pos],e|=(n&15)<<28,qP(e,i))}function XP(i,t,e,n){if(n==0){e==1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const s=t[0];t[0]=t[1],t[1]=s}}var ZP=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function $P(i,t,e){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,i)-1||e>Math.pow(2,i)-1)throw Error("tile x/y outside zoom level bounds");const n=ZP[i],s=Math.pow(2,i);let r=0,o=0,a=0;const l=[t,e];let h=s/2;for(;h>0;)r=(l[0]&h)>0?1:0,o=(l[1]&h)>0?1:0,a+=h*h*(3*r^o),XP(h,l,r,o),h=h/2;return n+a}function Sy(i,t){return Xe(this,null,function*(){if(t===1||t===0)return i;if(t===2){if(typeof globalThis.DecompressionStream>"u")return Mu(new Uint8Array(i));{let e=new Response(i).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(e).arrayBuffer()}}else throw Error("Compression method not supported")})}var _r=(i=>(i[i.Unknown=0]="Unknown",i[i.Mvt=1]="Mvt",i[i.Png=2]="Png",i[i.Jpeg=3]="Jpeg",i[i.Webp=4]="Webp",i[i.Avif=5]="Avif",i))(_r||{}),VP=127;function YP(i,t){let e=0,n=i.length-1;for(;e<=n;){const s=n+e>>1,r=t-i[s].tileId;if(r>0)e=s+1;else if(r<0)n=s-1;else return i[s]}return n>=0&&(i[n].runLength===0||t-i[n].tileId<i[n].runLength)?i[n]:null}var HP=class{constructor(i,t=new Headers){this.url=i,this.customHeaders=t}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,t,e){return Xe(this,null,function*(){let n;e||(n=new AbortController,e=n.signal);const s=new Headers(this.customHeaders);s.set("Range","bytes="+i+"-"+(i+t-1));let r=yield fetch(this.url,{signal:e,headers:s});if(r.status===416&&i===0){const a=r.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+a.substr(8);r=yield fetch(this.url,{signal:e,headers:{Range:"bytes=0-"+(l-1)}})}if(r.status>=300)throw Error("Bad response code: "+r.status);const o=r.headers.get("Content-Length");if(r.status===200&&(!o||+o>t))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield r.arrayBuffer(),etag:r.headers.get("ETag")||void 0,cacheControl:r.headers.get("Cache-Control")||void 0,expires:r.headers.get("Expires")||void 0}})}};function Di(i,t){const e=i.getUint32(t+4,!0),n=i.getUint32(t+0,!0);return e*Math.pow(2,32)+n}function KP(i,t){const e=new DataView(i),n=e.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:Di(e,8),rootDirectoryLength:Di(e,16),jsonMetadataOffset:Di(e,24),jsonMetadataLength:Di(e,32),leafDirectoryOffset:Di(e,40),leafDirectoryLength:Di(e,48),tileDataOffset:Di(e,56),tileDataLength:Di(e,64),numAddressedTiles:Di(e,72),numTileEntries:Di(e,80),numTileContents:Di(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}function Ty(i){const t={buf:new Uint8Array(i),pos:0},e=wo(t),n=[];let s=0;for(let r=0;r<e;r++){const o=wo(t);n.push({tileId:s+o,offset:0,length:0,runLength:1}),s+=o}for(let r=0;r<e;r++)n[r].runLength=wo(t);for(let r=0;r<e;r++)n[r].length=wo(t);for(let r=0;r<e;r++){const o=wo(t);o===0&&r>0?n[r].offset=n[r-1].offset+n[r-1].length:n[r].offset=o-1}return n}function QP(i){const t=new DataView(i);return t.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):t.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Sr=class extends Error{};function JP(i,t,e,n){return Xe(this,null,function*(){const s=yield i.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(QP(s.data)<3)return[yield Ey.getHeader(i)];const r=s.data.slice(0,VP);let o=s.etag;n&&s.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+i.getKey()),o=void 0);const a=KP(r,o);if(e){const l=s.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),h=i.getKey()+"|"+(a.etag||"")+"|"+a.rootDirectoryOffset+"|"+a.rootDirectoryLength,c=Ty(yield t(l,a.internalCompression));return[a,[h,c.length,c]]}return[a,void 0]})}function tA(i,t,e,n,s){return Xe(this,null,function*(){const r=yield i.getBytes(e,n);if(s.etag&&s.etag!==r.etag)throw new Sr(r.etag);const o=yield t(r.data,s.internalCompression),a=Ty(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var eA=class{constructor(i=100,t=!0,e=Sy){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.prefetch=t,this.decompress=e}getHeader(i,t){return Xe(this,null,function*(){const e=i.getKey();if(this.cache.has(e))return this.cache.get(e).lastUsed=this.counter++,yield this.cache.get(e).data;const n=new Promise((s,r)=>{JP(i,this.decompress,this.prefetch,t).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),s(o[0]),this.prune()}).catch(o=>{r(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(i,t,e,n){return Xe(this,null,function*(){const s=i.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const r=new Promise((o,a)=>{tA(i,this.decompress,t,e,n).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:r}),r})}getArrayBuffer(i,t,e,n){return Xe(this,null,function*(){const s=i.getKey()+"|"+(n.etag||"")+"|"+t+"|"+e;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const r=new Promise((o,a)=>{i.getBytes(t,e).then(l=>{if(n.etag&&n.etag!==l.etag)throw new Sr(l.etag);o(l.data),this.cache.has(s),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:r}),r})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,t;this.cache.forEach((e,n)=>{e.lastUsed<i&&(i=e.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(i,t){return Xe(this,null,function*(){this.cache.delete(i.getKey()),yield this.getHeader(i,t)})}},dg=class{constructor(i,t,e){typeof i=="string"?this.source=new HP(i):this.source=i,e?this.decompress=e:this.decompress=Sy,t?this.cache=t:this.cache=new eA}getHeader(){return Xe(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,t,e,n){return Xe(this,null,function*(){const s=$P(i,t,e),r=yield this.cache.getHeader(this.source);if(r.specVersion<3)return Ey.getZxy(r,this.source,this.cache,i,t,e,n);if(i<r.minZoom||i>r.maxZoom)return;let o=r.rootDirectoryOffset,a=r.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,o,a,r),c=YP(h,s);if(c)if(c.runLength>0){const u=yield this.source.getBytes(r.tileDataOffset+c.offset,c.length,n);if(r.etag&&r.etag!==u.etag)throw new Sr(u.etag);return{data:yield this.decompress(u.data,r.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}else o=r.leafDirectoryOffset+c.offset,a=c.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,t,e,n){return Xe(this,null,function*(){try{return yield this.getZxyAttempt(i,t,e,n)}catch(s){if(s instanceof Sr)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(i,t,e,n);throw s}})}getMetadataAttempt(){return Xe(this,null,function*(){const i=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength);if(i.etag&&i.etag!==t.etag)throw new Sr(t.etag);const e=yield this.decompress(t.data,i.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(e))})}getMetadata(){return Xe(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof Sr)return this.cache.invalidate(this.source,i.message),yield this.getMetadataAttempt();throw i}})}};class iA extends gn{constructor(t){super(Lt.ERROR),this.error=t}}class $h extends eg{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=sy(t)[0];this.forEach(n=>{n.tileCoord[0]!==e&&(this.remove(es(n.tileCoord)),n.release())})}}const Or={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},ur=[0,0,0],Jn=5;class ys{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,At(Wx(this.resolutions_,(s,r)=>r-s,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,At(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=zn(n)),At(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,At(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:qr,At(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new Zh(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)n([e,r,a])}forEachTileCoordParentTileRange(t,e,n,s){let r,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=lr(o,o,a,a,n)):r=this.getTileRangeForExtentAndZ(l,h,n),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return lr(r,r+1,o,o+1,e)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(e===s)return lr(r,o,r,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*l),c=Math.floor(o*l);if(e<s)return lr(h,h,c,c,n);const u=Math.floor(l*(r+1))-1,g=Math.floor(l*(o+1))-1;return lr(h,u,c,g,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,ur);const s=ur[1],r=ur[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,ur);const o=ur[1],a=ur[2];return lr(s,o,r,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=se(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*n,e[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=se(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*r[0]*s,a=n[1]-(t[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return Bi(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,s,r){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=se(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/n/h[0],u=a*(l[1]-e)/n/h[1];return s?(c=ns(c,Jn)-1,u=ns(u,Jn)-1):(c=wr(c,Jn),u=wr(u,Jn)),da(o,c,u,r)}getTileCoordForXYAndZ_(t,e,n,s,r){const o=this.getOrigin(n),a=this.getResolution(n),l=se(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return s?(h=ns(h,Jn)-1,c=ns(c,Jn)-1):(h=wr(h,Jn),c=wr(c,Jn)),da(n,h,c,r)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=gh(this.resolutions_,t,e||0);return wt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return d0(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let s=this.minZoom;s<e;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}}class nA extends ys{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function sA(i,t,e){const n=[],s=[],r=[],o=[],a=[];e=e!==void 0?e:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",g="TopLeftCorner",f="TileWidth",p="TileHeight",_=i[l],x=tt(_),v=x.getMetersPerUnit(),w=x.getAxisOrientation().substr(0,2)=="ne";return i[h].sort(function(E,S){return S[u]-E[u]}),i[h].forEach(function(E){let S;if(e.length>0?S=e.find(function(T){return E[c]==T[h]?!0:E[c].includes(":")?!1:i[c]+":"+E[c]===T[h]}):S=!0,S){s.push(E[c]);const T=E[u]*28e-5/v,R=E[f],C=E[p];w?r.push([E[g][1],E[g][0]]):r.push(E[g]),n.push(T),o.push(R==C?R:[R,C]),a.push([E.MatrixWidth,E.MatrixHeight])}}),new nA({extent:t,origins:r,resolutions:n,matrixIds:s,tileSizes:o,sizes:a})}function gg(i){let t=i.getDefaultTileGrid();return t||(t=aA(i),i.setDefaultTileGrid(t)),t}function rA(i,t,e){const n=t[0],s=i.getTileCoordCenter(t),r=qn(e);if(!xi(r,s)){const o=yt(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,i.getTileCoordForCoordAndZ(s,n)}return t}function oA(i,t,e,n){n=n!==void 0?n:"top-left";const s=My(i,t,e);return new ys({extent:i,origin:ev(i,n),resolutions:s,tileSize:e})}function Js(i){const t=i||{},e=t.extent||tt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:My(e,t.maxZoom,t.tileSize,t.maxResolution)};return new ys(n)}function My(i,t,e,n){t=t!==void 0?t:S_,e=se(e!==void 0?e:qr);const s=Vt(i),r=yt(i);n=n>0?n:Math.max(r/e[0],s/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function aA(i,t,e,n){const s=qn(i);return oA(s,t,e,n)}function qn(i){i=tt(i);let t=i.getExtent();if(!t){const e=180*Qo.degrees/i.getMetersPerUnit();t=Bi(-e,-e,e,e)}return t}class lA extends oo{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&se(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new $h(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,s){const r=this.getTileCacheForProjection(t);if(!r)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=un(e,c,u),h=!1,r.containsKey(l)&&(a=r.get(l),h=a.getState()===q.LOADED,h&&(h=s(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,s,r){return ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:gg(t)}getTileCacheForProjection(t){const e=this.getProjection();return At(e===null||Ae(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(e),o=se(s.getTileSize(t),this.tmpSize);return r==1?o:L0(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=rA(n,t,e)),GI(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,s){}}class Ry extends gn{constructor(t,e){super(t),this.tile=e}}const ja=lA;class fg extends ja{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let n=t.tileGrid;n===void 0&&e&&(n=Js({extent:qn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:n,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?se(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?se(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||Ae(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,n,s,r){const o=this.getTileCacheForProjection(s),a=un(t,e,n);if(o.containsKey(a)){const x=o.get(a);if(x&&x.key==this.getKey())return x}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((x,v)=>{const w=se(l.getTileSize(v)),E=this.getTileSize(v);return Math.max(E[0]/w[0],E[1]/w[1])})),c=this.getTileGridForProjection(r),u=this.getTileGridForProjection(s),g=[t,e,n],f=this.getTileCoordForTileUrlFunction(g,s),p=Object.assign({sourceProj:r,sourceTileGrid:c,targetProj:s,targetTileGrid:u,tileCoord:g,wrappedTileCoord:f,pixelRatio:h,gutter:this.getGutterForProjection(r),getTileFunction:(x,v,w,E)=>this.getTile(x,v,w,E,r)},this.tileOptions),_=new tg(p);return _.key=this.getKey(),_}getTile(t,e,n,s,r){const o=this.getProjection();if(o&&r&&!Ae(o,r))return this.getReprojTile_(t,e,n,r,o);const a=this.getTileSize(t),l=un(t,e,n);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function c(){return Vm(function(){return h(t,e,n)})}const u=Object.assign({tileCoord:[t,e,n],loader:c,size:a},this.tileOptions),g=new Kd(u);return g.key=this.getKey(),g.addEventListener(Lt.CHANGE,this.handleTileChange_),this.tileCache.set(l,g),g}handleTileChange_(t){const e=t.target,n=st(e),s=e.getState();let r;s==q.LOADING?(this.tileLoadingKeys_[n]=!0,r=Or.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==q.ERROR?Or.TILELOADERROR:s==q.LOADED?Or.TILELOADEND:void 0),r&&this.dispatchEvent(new Ry(r,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ae(e,t)))return this.tileGrid;const n=st(t);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=gg(t)),this.tileGridForProjection_[n]}setTileGridForProjection(t,e){const n=tt(t);if(n){const s=st(n);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ae(e,t))return this.tileCache;const n=st(t);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new $h(.1)),this.tileCacheForProjection_[n]}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const s in this.tileCacheForProjection_){const r=this.tileCacheForProjection_[s];r.expireCache(r==n?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}function Fe(i){return(t,...e)=>hA(i,t,e)}function lo(i,t){return Fe(Cy(i,t).get)}const{apply:hA,construct:UD,defineProperty:BD,get:WD,getOwnPropertyDescriptor:Cy,getPrototypeOf:pg,has:qD,ownKeys:cA,set:XD,setPrototypeOf:ZD}=Reflect,{iterator:za,species:$D,toStringTag:uA,for:VD}=Symbol,dA=Object,{create:mg,defineProperty:gA,freeze:YD,is:HD}=dA,fA=Array,pA=fA.prototype,Iy=pA[za],mA=Fe(Iy),Py=ArrayBuffer,_A=Py.prototype;lo(_A,"byteLength");const tm=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;tm&&lo(tm.prototype,"byteLength");const Ay=pg(Uint8Array);Ay.from;const He=Ay.prototype;He[za];Fe(He.keys);Fe(He.values);Fe(He.entries);Fe(He.set);Fe(He.reverse);Fe(He.fill);Fe(He.copyWithin);Fe(He.sort);Fe(He.slice);Fe(He.subarray);lo(He,"buffer");lo(He,"byteOffset");lo(He,"length");lo(He,uA);const yA=Uint8Array,Ly=Uint16Array,_g=Uint32Array,xA=Float32Array,ga=pg([][za]()),Oy=Fe(ga.next),vA=Fe(function*(){}().next),wA=pg(ga),bA=DataView.prototype,EA=Fe(bA.getUint16),yg=WeakMap,Fy=yg.prototype,Ny=Fe(Fy.get),SA=Fe(Fy.set),ky=new yg,TA=mg(null,{next:{value:function(){const i=Ny(ky,this);return Oy(i)}},[za]:{value:function(){return this}}});function MA(i){if(i[za]===Iy&&ga.next===Oy)return i;const t=mg(TA);return SA(ky,t,mA(i)),t}const RA=new yg,CA=mg(wA,{next:{value:function(){const i=Ny(RA,this);return vA(i)},writable:!0,configurable:!0}});for(const i of cA(ga))i!=="next"&&gA(CA,i,Cy(ga,i));const Dy=new Py(4),IA=new xA(Dy),PA=new _g(Dy),Hi=new Ly(512),Ki=new yA(512);for(let i=0;i<256;++i){const t=i-127;t<-27?(Hi[i]=0,Hi[i|256]=32768,Ki[i]=24,Ki[i|256]=24):t<-14?(Hi[i]=1024>>-t-14,Hi[i|256]=1024>>-t-14|32768,Ki[i]=-t-1,Ki[i|256]=-t-1):t<=15?(Hi[i]=t+15<<10,Hi[i|256]=t+15<<10|32768,Ki[i]=13,Ki[i|256]=13):t<128?(Hi[i]=31744,Hi[i|256]=64512,Ki[i]=24,Ki[i|256]=24):(Hi[i]=31744,Hi[i|256]=64512,Ki[i]=13,Ki[i|256]=13)}const xg=new _g(2048);for(let i=1;i<1024;++i){let t=i<<13,e=0;for(;!(t&8388608);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,xg[i]=t|e}for(let i=1024;i<2048;++i)xg[i]=939524096+(i-1024<<13);const ho=new _g(64);for(let i=1;i<31;++i)ho[i]=i<<23;ho[31]=1199570944;ho[32]=2147483648;for(let i=33;i<63;++i)ho[i]=2147483648+(i-32<<23);ho[63]=3347054592;const Gy=new Ly(64);for(let i=1;i<64;++i)i!==32&&(Gy[i]=1024);function AA(i){const t=i>>10;return PA[0]=xg[Gy[t]+(i&1023)]+ho[t],IA[0]}function jy(i,t,...e){return AA(EA(i,t,...MA(e)))}var vg={exports:{}};function zy(i,t,e){const n=e&&e.debug||!1;n&&console.log("[xml-utils] getting "+t+" in "+i);const s=typeof i=="object"?i.outer:i,r=s.slice(0,s.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],h=t+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",h);const c=new RegExp(h).exec(r);if(n&&console.log("[xml-utils] match:",c),c)return c[1]}}vg.exports=zy;vg.exports.default=zy;var LA=vg.exports;const Dc=eo(LA);var wg={exports:{}},bg={exports:{}},Eg={exports:{}};function Uy(i,t,e){const n=new RegExp(t).exec(i.slice(e));return n?e+n.index:-1}Eg.exports=Uy;Eg.exports.default=Uy;var OA=Eg.exports,Sg={exports:{}};function By(i,t,e){const n=new RegExp(t).exec(i.slice(e));return n?e+n.index+n[0].length-1:-1}Sg.exports=By;Sg.exports.default=By;var FA=Sg.exports,Tg={exports:{}};function Wy(i,t){const e=new RegExp(t,"g"),n=i.match(e);return n?n.length:0}Tg.exports=Wy;Tg.exports.default=Wy;var NA=Tg.exports;const kA=OA,Gc=FA,em=NA;function qy(i,t,e){const n=e&&e.debug||!1,s=!(e&&typeof e.nested===!1),r=e&&e.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",t," and ",e);const o=kA(i,`<${t}[ 
>/]`,r);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=i.slice(o+t.length);let l=Gc(a,"^[^<]*[ /]>",0);const h=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",h),h===!1)if(s){let f=0,p=1,_=0;for(;(l=Gc(a,"[ /]"+t+">",f))!==-1;){const x=a.substring(f,l+1);if(p+=em(x,"<"+t+`[ 
	>]`),_+=em(x,"</"+t+">"),_>=p)break;f=l}}else l=Gc(a,"[ /]"+t+">",0);const c=o+t.length+l+1;if(n&&console.log("[xml-utils] end:",c),c===-1)return;const u=i.slice(o,c);let g;return h?g=null:g=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:g,outer:u,start:o,end:c}}bg.exports=qy;bg.exports.default=qy;var DA=bg.exports;const GA=DA;function Xy(i,t,e){const n=[],s=e&&e.debug||!1,r=e&&typeof e.nested=="boolean"?e.nested:!0;let o=e&&e.startIndex||0,a;for(;a=GA(i,t,{debug:s,startIndex:o});)r?o=a.start+1+t.length:o=a.end,n.push(a);return s&&console.log("findTagsByName found",n.length,"tags"),n}wg.exports=Xy;wg.exports.default=Xy;var jA=wg.exports;const zA=eo(jA),Bo={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Ji={};for(const i in Bo)Bo.hasOwnProperty(i)&&(Ji[Bo[i]]=parseInt(i,10));const UA=[Ji.BitsPerSample,Ji.ExtraSamples,Ji.SampleFormat,Ji.StripByteCounts,Ji.StripOffsets,Ji.StripRowCounts,Ji.TileByteCounts,Ji.TileOffsets,Ji.SubIFDs],jc={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Mt={};for(const i in jc)jc.hasOwnProperty(i)&&(Mt[jc[i]]=parseInt(i,10));const Qe={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},BA={Unspecified:0,Assocalpha:1,Unassalpha:2},KD={Version:0,AddCompression:1},QD={None:0,Deflate:1,Zstandard:2},WA={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function qA(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let o=0,a=0;o<i.length;++o,a+=3)r=256-i[o]/t*256,s[a]=r,s[a+1]=r,s[a+2]=r;return s}function XA(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let o=0,a=0;o<i.length;++o,a+=3)r=i[o]/t*256,s[a]=r,s[a+1]=r,s[a+2]=r;return s}function ZA(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3),r=t.length/3,o=t.length/3*2;for(let a=0,l=0;a<i.length;++a,l+=3){const h=i[a];s[l]=t[h]/65536*256,s[l+1]=t[h+r]/65536*256,s[l+2]=t[h+o]/65536*256}return s}function $A(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=4,r+=3){const o=i[s],a=i[s+1],l=i[s+2],h=i[s+3];n[r]=255*((255-o)/256)*((255-h)/256),n[r+1]=255*((255-a)/256)*((255-h)/256),n[r+2]=255*((255-l)/256)*((255-h)/256)}return n}function VA(i){const{width:t,height:e}=i,n=new Uint8ClampedArray(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s],a=i[s+1],l=i[s+2];n[r]=o+1.402*(l-128),n[r+1]=o-.34414*(a-128)-.71414*(l-128),n[r+2]=o+1.772*(a-128)}return n}const YA=.95047,HA=1,KA=1.08883;function QA(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s+0],a=i[s+1]<<24>>24,l=i[s+2]<<24>>24;let h=(o+16)/116,c=a/500+h,u=h-l/200,g,f,p;c=YA*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=HA*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=KA*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),g=c*3.2406+h*-1.5372+u*-.4986,f=c*-.9689+h*1.8758+u*.0415,p=c*.0557+h*-.204+u*1.057,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,n[r]=Math.max(0,Math.min(1,g))*255,n[r+1]=Math.max(0,Math.min(1,f))*255,n[r+2]=Math.max(0,Math.min(1,p))*255}return n}const Zy=new Map;function xs(i,t){Array.isArray(i)||(i=[i]),i.forEach(e=>Zy.set(e,t))}async function $y(i){const t=Zy.get(i.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${i.Compression}`);const e=await t();return new e(i)}xs([void 0,1],()=>jn(()=>import("./raw-CcGKjn8q-DFOt-i8n.Bw407ngt.js"),__vite__mapDeps([0,1])).then(i=>i.default));xs(5,()=>jn(()=>import("./lzw-BOMhmEDy-Dboc93VO.P5nsTiIb.js"),__vite__mapDeps([2,1])).then(i=>i.default));xs(6,()=>{throw new Error("old style JPEG compression is not supported.")});xs(7,()=>jn(()=>import("./jpeg-DNfUpLwy-Fjan-04T.BxqdrV3-.js"),__vite__mapDeps([3,1])).then(i=>i.default));xs([8,32946],()=>jn(()=>import("./deflate-Be2Arps5-hDqMz3RA.CZq5SbJs.js"),__vite__mapDeps([4,5,1])).then(i=>i.default));xs(32773,()=>jn(()=>import("./packbits-DaUD6MLm-Bu1PoTGa.CJbViLSe.js"),__vite__mapDeps([6,1])).then(i=>i.default));xs(34887,()=>jn(()=>import("./lerc-C9VL9kri-cIdbW0sg.fJvNmKzg.js"),__vite__mapDeps([7,5,1,8,9,10,11])).then(async i=>(await i.zstd.init(),i)).then(i=>i.default));xs(50001,()=>jn(()=>import("./webimage-D2c098k3-DLj1LQxB.7ggil7aE.js"),__vite__mapDeps([12,1])).then(i=>i.default));function Vh(i,t,e,n=1){return new(Object.getPrototypeOf(i)).constructor(t*e*n)}function JA(i,t,e,n,s){const r=t/n,o=e/s;return i.map(a=>{const l=Vh(a,n,s);for(let h=0;h<s;++h){const c=Math.min(Math.round(o*h),e-1);for(let u=0;u<n;++u){const g=Math.min(Math.round(r*u),t-1),f=a[c*t+g];l[h*n+u]=f}}return l})}function Fr(i,t,e){return(1-e)*i+e*t}function tL(i,t,e,n,s){const r=t/n,o=e/s;return i.map(a=>{const l=Vh(a,n,s);for(let h=0;h<s;++h){const c=o*h,u=Math.floor(c),g=Math.min(Math.ceil(c),e-1);for(let f=0;f<n;++f){const p=r*f,_=p%1,x=Math.floor(p),v=Math.min(Math.ceil(p),t-1),w=a[u*t+x],E=a[u*t+v],S=a[g*t+x],T=a[g*t+v],R=Fr(Fr(w,E,_),Fr(S,T,_),c%1);l[h*n+f]=R}}return l})}function eL(i,t,e,n,s,r="nearest"){switch(r.toLowerCase()){case"nearest":return JA(i,t,e,n,s);case"bilinear":case"linear":return tL(i,t,e,n,s);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function iL(i,t,e,n,s,r){const o=t/n,a=e/s,l=Vh(i,n,s,r);for(let h=0;h<s;++h){const c=Math.min(Math.round(a*h),e-1);for(let u=0;u<n;++u){const g=Math.min(Math.round(o*u),t-1);for(let f=0;f<r;++f){const p=i[c*t*r+g*r+f];l[h*n*r+u*r+f]=p}}}return l}function nL(i,t,e,n,s,r){const o=t/n,a=e/s,l=Vh(i,n,s,r);for(let h=0;h<s;++h){const c=a*h,u=Math.floor(c),g=Math.min(Math.ceil(c),e-1);for(let f=0;f<n;++f){const p=o*f,_=p%1,x=Math.floor(p),v=Math.min(Math.ceil(p),t-1);for(let w=0;w<r;++w){const E=i[u*t*r+x*r+w],S=i[u*t*r+v*r+w],T=i[g*t*r+x*r+w],R=i[g*t*r+v*r+w],C=Fr(Fr(E,S,_),Fr(T,R,_),c%1);l[h*n*r+f*r+w]=C}}}return l}function sL(i,t,e,n,s,r,o="nearest"){switch(o.toLowerCase()){case"nearest":return iL(i,t,e,n,s,r);case"bilinear":case"linear":return nL(i,t,e,n,s,r);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function rL(i,t,e){let n=0;for(let s=t;s<e;++s)n+=i[s];return n}function Ru(i,t,e){switch(i){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function oL(i,t){return(i===1||i===2)&&t<=32&&t%8===0?!1:!(i===3&&(t===16||t===32||t===64))}function aL(i,t,e,n,s,r,o){const a=new DataView(i),l=e===2?o*r:o*r*n,h=e===2?1:n,c=Ru(t,s,l),u=parseInt("1".repeat(s),2);if(t===1){let g;e===1?g=n*s:g=s;let f=r*g;f&7&&(f=f+7&-8);for(let p=0;p<o;++p){const _=p*f;for(let x=0;x<r;++x){const v=_+x*h*s;for(let w=0;w<h;++w){const E=v+w*s,S=(p*r+x)*h+w,T=Math.floor(E/8),R=E%8;if(R+s<=8)c[S]=a.getUint8(T)>>8-s-R&u;else if(R+s<=16)c[S]=a.getUint16(T)>>16-s-R&u;else if(R+s<=24){const C=a.getUint16(T)<<8|a.getUint8(T+2);c[S]=C>>24-s-R&u}else c[S]=a.getUint32(T)>>32-s-R&u}}}}return c.buffer}class Vy{constructor(t,e,n,s,r,o){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=s,this.tiles=r?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,r){return jy(this,s,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),s=this.getBitsPerSample(t);return Ru(n,s,e)}async getTileOrStrip(t,e,n,s,r){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=e*o+t:this.planarConfiguration===2&&(l=n*o*a+e*o+t);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const g=(await this.source.fetch([{offset:c,length:u}],r))[0];let f;return h===null||!h[l]?(f=(async()=>{let p=await s.decode(this.fileDirectory,g);const _=this.getSampleFormat(),x=this.getBitsPerSample();return oL(_,x)&&(p=aL(p,_,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(e))),p})(),h!==null&&(h[l]=f)):f=h[l],{x:t,y:e,sample:n,data:await f}}async _readRaster(t,e,n,s,r,o,a,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),g=this.getWidth(),f=this.getHeight(),p=Math.max(Math.floor(t[0]/c),0),_=Math.min(Math.ceil(t[2]/c),Math.ceil(g/c)),x=Math.max(Math.floor(t[1]/u),0),v=Math.min(Math.ceil(t[3]/u),Math.ceil(f/u)),w=t[2]-t[0];let E=this.getBytesPerPixel();const S=[],T=[];for(let P=0;P<e.length;++P)this.planarConfiguration===1?S.push(rL(this.fileDirectory.BitsPerSample,0,e[P])/8):S.push(0),T.push(this.getReaderForSample(e[P]));const R=[],{littleEndian:C}=this;for(let P=x;P<v;++P)for(let N=p;N<_;++N){let U;this.planarConfiguration===1&&(U=this.getTileOrStrip(N,P,0,r,h));for(let j=0;j<e.length;++j){const B=j,d=e[j];this.planarConfiguration===2&&(E=this.getSampleByteSize(d),U=this.getTileOrStrip(N,P,d,r,h));const m=U.then(y=>{const b=y.data,M=new DataView(b),I=this.getBlockHeight(y.y),A=y.y*u,L=y.x*c,k=A+I,W=(y.x+1)*c,K=T[B],G=Math.min(I,I-(k-t[3]),f-A),H=Math.min(c,c-(W-t[2]),g-L);for(let Q=Math.max(0,t[1]-A);Q<G;++Q)for(let nt=Math.max(0,t[0]-L);nt<H;++nt){const xt=(Q*c+nt)*E,dt=K.call(M,xt+S[B],C);let Tt;s?(Tt=(Q+A-t[1])*w*e.length+(nt+L-t[0])*e.length+B,n[Tt]=dt):(Tt=(Q+A-t[1])*w+nt+L-t[0],n[B][Tt]=dt)}});R.push(m)}}if(await Promise.all(R),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let P;return s?P=sL(n,t[2]-t[0],t[3]-t[1],o,a,e.length,l):P=eL(n,t[2]-t[0],t[3]-t[1],o,a,l),P.width=o,P.height=a,P}return n.width=o||t[2]-t[0],n.height=a||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:s=null,width:r,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],g=c[3]-c[1],f=u*g,p=this.getSamplesPerPixel();if(!e||!e.length)for(let v=0;v<p;++v)e.push(v);else for(let v=0;v<e.length;++v)if(e[v]>=p)return Promise.reject(new RangeError(`Invalid sample index '${e[v]}'.`));let _;if(n){const v=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Ru(v,w,f*e.length),l&&_.fill(l)}else{_=[];for(let v=0;v<e.length;++v){const w=this.getArrayForSample(e[v],f);Array.isArray(l)&&v<l.length?w.fill(l[v]):l&&!Array.isArray(l)&&w.fill(l),_.push(w)}}const x=s||await $y(this.fileDirectory);return await this._readRaster(c,e,_,n,x,r,o,a,h)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:s,height:r,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===Qe.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==BA.Unspecified&&a){v=[];for(let w=0;w<this.fileDirectory.BitsPerSample.length;w+=1)v.push(w)}return this.readRasters({window:t,interleave:e,samples:v,pool:n,width:s,height:r,resampleMethod:o,signal:l})}let u;switch(c){case Qe.WhiteIsZero:case Qe.BlackIsZero:case Qe.Palette:u=[0];break;case Qe.CMYK:u=[0,1,2,3];break;case Qe.YCbCr:case Qe.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const g={window:h,interleave:!0,samples:u,pool:n,width:s,height:r,resampleMethod:o,signal:l},{fileDirectory:f}=this,p=await this.readRasters(g),_=2**this.fileDirectory.BitsPerSample[0];let x;switch(c){case Qe.WhiteIsZero:x=qA(p,_);break;case Qe.BlackIsZero:x=XA(p,_);break;case Qe.Palette:x=ZA(p,f.ColorMap);break;case Qe.CMYK:x=$A(p);break;case Qe.YCbCr:x=VA(p);break;case Qe.CIELab:x=QA(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const v=new Uint8Array(x.length/3),w=new Uint8Array(x.length/3),E=new Uint8Array(x.length/3);for(let S=0,T=0;S<x.length;S+=3,++T)v[T]=x[S],w[T]=x[S+1],E[T]=x[S+2];x=[v,w,E]}return x.width=p.width,x.height=p.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=zA(n,"Item");t===null?s=s.filter(r=>Dc(r,"sample")===void 0):s=s.filter(r=>Number(Dc(r,"sample"))===t);for(let r=0;r<s.length;++r){const o=s[r];e[Dc(o,"name")]=o.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return[n[0],-n[5],n[10]];if(t){const[s,r,o]=t.getResolution();return[s*t.getWidth()/this.getWidth(),r*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getHeight(),e=this.getWidth();if(this.fileDirectory.ModelTransformation){const[n,s,r,o,a,l,h,c]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[e,0],[e,t]].map(([p,_])=>[o+n*p+s*_,c+a*p+l*_]),g=u.map(p=>p[0]),f=u.map(p=>p[1]);return[Math.min(...g),Math.min(...f),Math.max(...g),Math.max(...f)]}else{const n=this.getOrigin(),s=this.getResolution(),r=n[0],o=n[1],a=r+s[0]*this.getWidth(),l=o+s[1]*this.getHeight();return[Math.min(r,a),Math.min(o,l),Math.max(r,a),Math.max(o,l)]}}}class lL{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),s=this.getUint32(t+4,e);let r;if(e){if(r=n+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*n+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(t,e){let n=0;const s=(this._dataView.getUint8(t+(e?7:0))&128)>0;let r=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(e?o:7-o));s&&(r?a!==0&&(a=~(a-1)&255,r=!1):a=~a&255),n+=a*256**o}return s&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return jy(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class hL{constructor(t,e,n,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*e+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let s=!0;for(let r=0;r<8;r++){let o=this._dataView.getUint8(t+(this._littleEndian?r:7-r));n&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),e+=o*256**r}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const cL=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class uL{constructor(t=cL,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(n=>{jn(()=>import("./decoder-kAoyGIq9-BBR5CgzS.DDHdXxCM.js"),__vite__mapDeps([13,8,9,10,11])).then(s=>{n(s.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<t;s++)this.workers.push({worker:n(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?$y(t).then(n=>n.decode(t,e)):new Promise(n=>{const s=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const r=this.messageId++,o=a=>{a.data.id===r&&(s.idle=!0,n(a.data.decoded),s.worker.removeEventListener("message",o))};s.worker.addEventListener("message",o),s.worker.postMessage({fileDirectory:t,buffer:e,id:r},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const im=`\r
\r
`;function Yy(i){if(typeof Object.fromEntries<"u")return Object.fromEntries(i);const t={};for(const[e,n]of i)t[e.toLowerCase()]=n;return t}function dL(i){const t=i.split(`\r
`).map(e=>{const n=e.split(":").map(s=>s.trim());return n[0]=n[0].toLowerCase(),n});return Yy(t)}function gL(i){const[t,...e]=i.split(";").map(s=>s.trim()),n=e.map(s=>s.split("="));return{type:t,params:Yy(n)}}function Cu(i){let t,e,n;return i&&([,t,e,n]=i.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function fL(i,t){let e=null;const n=new TextDecoder("ascii"),s=[],r=`--${t}`,o=`${r}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(i,a,r.length))===r&&(e=a);if(e===null)throw new Error("Could not find initial boundary");for(;e<i.byteLength;){const a=n.decode(new Uint8Array(i,e,Math.min(r.length+1024,i.byteLength-e)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(r))throw new Error("Part does not start with boundary");const l=a.substr(r.length+2);if(l.length===0)break;const h=l.indexOf(im),c=dL(l.substr(0,h)),{start:u,end:g,total:f}=Cu(c["content-range"]),p=e+r.length+h+im.length,_=parseInt(g,10)+1-parseInt(u,10);s.push({headers:c,data:i.slice(p,p+_),offset:u,length:_,fileSize:f}),e=p+_+4}return s}class Mg{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class pL extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield t)}for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const s=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:s}):this._set(t,{value:e,expiry:s}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,s]of this.entriesAscending())t.call(e,s,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function mL(i){return new Promise(t=>setTimeout(t,i))}function _L(i,t){const e=Array.isArray(i)?i:Array.from(i),n=Array.isArray(t)?t:Array.from(t);return e.map((s,r)=>[s,n[r]])}class Zr extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,Zr),this.name="AbortError"}}class yL extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const xL=yL;class vL{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class nm{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class wL extends Mg{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new pL({maxSize:n,onEviction:(s,r)=>{this.evictedBlocks.set(s,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=[],s=[],r=[];this.evictedBlocks.clear();for(const{offset:g,length:f}of t){let p=g+f;const{fileSize:_}=this;_!==null&&(p=Math.min(p,_));const x=Math.floor(g/this.blockSize)*this.blockSize;for(let v=x;v<p;v+=this.blockSize){const w=Math.floor(v/this.blockSize);!this.blockCache.has(w)&&!this.blockRequests.has(w)&&(this.blockIdsToFetch.add(w),s.push(w)),this.blockRequests.has(w)&&n.push(this.blockRequests.get(w)),r.push(w)}}await mL(),this.fetchBlocks(e);const o=[];for(const g of s)this.blockRequests.has(g)&&o.push(this.blockRequests.get(g));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=r.filter(g=>this.abortedBlockIds.has(g)||!this.blockCache.has(g));if(l.forEach(g=>this.blockIdsToFetch.add(g)),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const g of l){const f=this.blockRequests.get(g);if(!f)throw new Error(`Block ${g} is not in the block requests`);a.push(f)}await Promise.allSettled(a)}if(e&&e.aborted)throw new Zr("Request was aborted");const h=r.map(g=>this.blockCache.get(g)||this.evictedBlocks.get(g)),c=h.filter(g=>!g);if(c.length)throw new xL(c,"Request failed");const u=new Map(_L(r,h));return this.readSliceData(t,u)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let s=0;s<e.length;++s){const r=e[s];for(const o of r.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[s],l=o*this.blockSize,h=l-a.offset,c=Math.min(h+this.blockSize,a.data.byteLength),u=a.data.slice(h,c),g=new vL(l,u.byteLength,u,o);this.blockCache.set(o,g),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((o,a)=>o-a);if(e.length===0)return[];let n=[],s=null;const r=[];for(const o of e)s===null||s+1===o?(n.push(o),s=o):(r.push(new nm(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],s=o);return r.push(new nm(n[0]*this.blockSize,n.length*this.blockSize,n)),r}readSliceData(t,e){return t.map(n=>{let s=n.offset+n.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const r=Math.floor(n.offset/this.blockSize),o=Math.floor(s/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let h=r;h<=o;++h){const c=e.get(h),u=c.offset-n.offset,g=c.top-s;let f=0,p=0,_;u<0?f=-u:u>0&&(p=u),g<0?_=c.length-f:_=s-c.offset-f;const x=new Uint8Array(c.data,f,_);l.set(x,p)}return a})}}class Rg{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Cg{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:n}={}){throw new Error("request is not implemented")}}class bL extends Rg{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class EL extends Cg{constructor(t,e){super(t),this.credentials=e}async request({headers:t,credentials:e,signal:n}={}){const s=await fetch(this.url,{headers:t,credentials:e,signal:n});return new bL(s)}}class SL extends Rg{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class TL extends Cg{constructRequest(t,e){return new Promise((n,s)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[o,a]of Object.entries(t))r.setRequestHeader(o,a);r.onload=()=>{const o=r.response;n(new SL(r,o))},r.onerror=s,r.onabort=()=>s(new Zr("Request aborted")),r.send(),e&&(e.aborted&&r.abort(),e.addEventListener("abort",()=>r.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const sm={};class ML extends Rg{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class RL extends Cg{constructor(t){super(t),this.parsedUrl=sm.parse(this.url),this.httpApi=(this.parsedUrl.protocol,sm)}constructRequest(t,e){return new Promise((n,s)=>{const r=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const a=new Promise(l=>{const h=[];o.on("data",c=>{h.push(c)}),o.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),o.on("error",s)});n(new ML(o,a))});r.on("error",s),e&&(e.aborted&&r.destroy(new Zr("Request aborted")),e.addEventListener("abort",()=>r.destroy(new Zr("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class Ig extends Mg{constructor(t,e,n,s){super(),this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=s,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:s,length:r})=>`${s}-${s+r}`).join(",")}`},signal:e});if(n.ok)if(n.status===206){const{type:s,params:r}=gL(n.getHeader("content-type"));if(s==="multipart/byteranges"){const u=fL(await n.getData(),r.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await n.getData(),{start:a,end:l,total:h}=Cu(n.getHeader("content-range"));this._fileSize=h||null;const c=[{data:o,offset:a,length:l-a}];if(t.length>1){const u=await Promise.all(t.slice(1).map(g=>this.fetchSlice(g,e)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await n.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:s}=t,r=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+s}`},signal:e});if(r.ok)if(r.status===206){const o=await r.getData(),{total:a}=Cu(r.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await r.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Pg(i,{blockSize:t,cacheSize:e}){return t===null?i:new wL(i,{blockSize:t,cacheSize:e})}function CL(i,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:s=!1,...r}={}){const o=new EL(i,e),a=new Ig(o,t,n,s);return Pg(a,r)}function IL(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new TL(i),o=new Ig(r,t,e,n);return Pg(o,s)}function PL(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new RL(i),o=new Ig(r,t,e,n);return Pg(o,s)}function Iu(i,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?CL(i,e):typeof XMLHttpRequest<"u"?IL(i,e):PL(i,e)}class AL extends Mg{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((n,s)=>{const r=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=s,o.onabort=s,o.readAsArrayBuffer(r),e&&e.addEventListener("abort",()=>o.abort())})}}function LL(i){return new AL(i)}function Pu(i){switch(i){case Mt.BYTE:case Mt.ASCII:case Mt.SBYTE:case Mt.UNDEFINED:return 1;case Mt.SHORT:case Mt.SSHORT:return 2;case Mt.LONG:case Mt.SLONG:case Mt.FLOAT:case Mt.IFD:return 4;case Mt.RATIONAL:case Mt.SRATIONAL:case Mt.DOUBLE:case Mt.LONG8:case Mt.SLONG8:case Mt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${i}`)}}function OL(i){const t=i.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const s=WA[t[n]],r=t[n+1]?Bo[t[n+1]]:null,o=t[n+2],a=t[n+3];let l=null;if(!r)l=a;else{if(l=i[r],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}e[s]=l}return e}function dr(i,t,e,n){let s=null,r=null;const o=Pu(t);switch(t){case Mt.BYTE:case Mt.ASCII:case Mt.UNDEFINED:s=new Uint8Array(e),r=i.readUint8;break;case Mt.SBYTE:s=new Int8Array(e),r=i.readInt8;break;case Mt.SHORT:s=new Uint16Array(e),r=i.readUint16;break;case Mt.SSHORT:s=new Int16Array(e),r=i.readInt16;break;case Mt.LONG:case Mt.IFD:s=new Uint32Array(e),r=i.readUint32;break;case Mt.SLONG:s=new Int32Array(e),r=i.readInt32;break;case Mt.LONG8:case Mt.IFD8:s=new Array(e),r=i.readUint64;break;case Mt.SLONG8:s=new Array(e),r=i.readInt64;break;case Mt.RATIONAL:s=new Uint32Array(e*2),r=i.readUint32;break;case Mt.SRATIONAL:s=new Int32Array(e*2),r=i.readInt32;break;case Mt.FLOAT:s=new Float32Array(e),r=i.readFloat32;break;case Mt.DOUBLE:s=new Float64Array(e),r=i.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===Mt.RATIONAL||t===Mt.SRATIONAL)for(let a=0;a<e;a+=2)s[a]=r.call(i,n+a*o),s[a+1]=r.call(i,n+(a*o+4));else for(let a=0;a<e;++a)s[a]=r.call(i,n+a*o);return t===Mt.ASCII?new TextDecoder("utf-8").decode(s):s}class FL{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class gl extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class Hy{async readRasters(t={}){const{window:e,width:n,height:s}=t;let{resX:r,resY:o,bbox:a}=t;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(e&&a)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(e){const[p,_]=l.getOrigin(),[x,v]=l.getResolution();a=[p+e[0]*x,_+e[1]*v,p+e[2]*x,_+e[3]*v]}const f=a||u;if(n){if(r)throw new Error("Both width and resX passed");r=(f[2]-f[0])/n}if(s){if(o)throw new Error("Both width and resY passed");o=(f[3]-f[1])/s}}if(r||o){const f=[];for(let p=0;p<c;++p){const _=await this.getImage(p),{SubfileType:x,NewSubfileType:v}=_.fileDirectory;(p===0||x===2||v&1)&&f.push(_)}f.sort((p,_)=>p.getWidth()-_.getWidth());for(let p=0;p<f.length;++p){const _=f[p],x=(u[2]-u[0])/_.getWidth(),v=(u[3]-u[1])/_.getHeight();if(h=_,r&&r>x||o&&o>v)break}}let g=e;if(a){const[f,p]=l.getOrigin(),[_,x]=h.getResolution(l);g=[Math.round((a[0]-f)/_),Math.round((a[1]-p)/x),Math.round((a[2]-f)/_),Math.round((a[3]-p)/x)],g=[Math.min(g[0],g[2]),Math.min(g[1],g[3]),Math.max(g[0],g[2]),Math.max(g[1],g[3])]}return h.readRasters({...t,window:g})}}class $r extends Hy{constructor(t,e,n,s,r={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=s,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new hL((await this.source.fetch([{offset:t,length:typeof e<"u"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(t);const r=this.bigTiff?s.readUint64(t):s.readUint16(t),o=r*e+(this.bigTiff?16:6);s.covers(t,o)||(s=await this.getSlice(t,o));const a={};let l=t+(this.bigTiff?8:2);for(let u=0;u<r;l+=e,++u){const g=s.readUint16(l),f=s.readUint16(l+2),p=this.bigTiff?s.readUint64(l+4):s.readUint32(l+4);let _,x;const v=Pu(f),w=l+(this.bigTiff?12:8);if(v*p<=(this.bigTiff?8:4))_=dr(s,f,p,w);else{const E=s.readOffset(w),S=Pu(f)*p;if(s.covers(E,S))_=dr(s,f,p,E);else{const T=await this.getSlice(E,S);_=dr(T,f,p,E)}}p===1&&UA.indexOf(g)===-1&&!(f===Mt.RATIONAL||f===Mt.SRATIONAL)?x=_[0]:x=_,a[Bo[g]]=x}const h=OL(a),c=s.readOffset(t+n+e*r);return new FL(a,h,c)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof gl?new gl(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new gl(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new Vy(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof gl)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let s=await this.getSlice(t,n);if(e===dr(s,Mt.ASCII,e.length,t)){const r=dr(s,Mt.ASCII,n,t).split(`
`)[0],o=Number(r.split("=")[1].split(" ")[0])+r.length;o>n&&(s=await this.getSlice(t,o));const a=dr(s,Mt.ASCII,o,t);this.ghostValues={},a.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,h])=>{this.ghostValues[l]=h})}return this.ghostValues}static async fromSource(t,e,n){const s=(await t.fetch([{offset:0,length:1024}],n))[0],r=new lL(s),o=r.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=r.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,r.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?r.getUint64(8,a):r.getUint32(4,a);return new $r(t,a,h,c,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class NL extends Hy{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,n=0;for(let s=0;s<this.imageFiles.length;s++){const r=this.imageFiles[s];for(let o=0;o<this.imageCounts[s];o++){if(t===e){const a=await r.requestIFD(n);return new Vy(a.fileDirectory,a.geoKeyDirectory,r.dataView,r.littleEndian,r.cache,r.source)}e++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,n)=>e+n,0),this.imageCount}}async function kL(i,t={},e){return $r.fromSource(Iu(i,t),e)}async function DL(i,t){return $r.fromSource(LL(i),t)}async function GL(i,t=[],e={},n){const s=await $r.fromSource(Iu(i,e),n),r=await Promise.all(t.map(o=>$r.fromSource(Iu(o,e))));return new NL(s,r)}function jL(i){return((i.fileDirectory.NewSubfileType||0)&4)===4}function zL(i,t){if(!i)return!1;if(i===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,n=Qe;return e===n.CMYK||e===n.YCbCr||e===n.CIELab||e===n.ICCLab}const rm="STATISTICS_MAXIMUM",om="STATISTICS_MINIMUM",zc=256;let Uc;function UL(){return Uc||(Uc=new uL),Uc}function BL(i){try{return i.getBoundingBox()}catch{return[0,0,i.getWidth(),i.getHeight()]}}function WL(i){try{return i.getOrigin().slice(0,2)}catch{return[0,i.getHeight()]}}function qL(i,t){try{return i.getResolution(t)}catch{return[t.getWidth()/i.getWidth(),t.getHeight()/i.getHeight()]}}function XL(i){const t=i.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let n=tt(e);if(!n){const s=ff(t.ProjLinearUnitsGeoKey);s&&(n=new jr({code:e,units:s}))}return n}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let n=tt(e);if(!n){const s=ff(t.GeogAngularUnitsGeoKey);s&&(n=new jr({code:e,units:s}))}return n}return null}function ZL(i){return i.getImageCount().then(function(t){const e=new Array(t);for(let n=0;n<t;++n)e[n]=i.getImage(n);return Promise.all(e)})}function $L(i,t){let e;return i.blob?e=DL(i.blob):i.overviews?e=GL(i.url,i.overviews,t):e=kL(i.url,t),e.then(ZL)}function Co(i,t,e,n,s){if(Array.isArray(i)){const r=i.length;if(!Array.isArray(t)||r!=t.length){const o=new Error(n);throw s(o),o}for(let o=0;o<r;++o)Co(i[o],t[o],e,n,s);return}if(t=t,Math.abs(i-t)>e*i)throw new Error(n)}function VL(i){return i instanceof Int8Array?-128:i instanceof Int16Array?-32768:i instanceof Int32Array?-2147483648:i instanceof Float32Array?12e-39:0}function YL(i){return i instanceof Int8Array?127:i instanceof Uint8Array||i instanceof Uint8ClampedArray?255:i instanceof Int16Array?32767:i instanceof Uint16Array?65535:i instanceof Int32Array?2147483647:i instanceof Uint32Array?4294967295:i instanceof Float32Array?34e37:255}class Ag extends fg{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(r=>r.url).join(","));const n=this,s=new Array(e);for(let r=0;r<e;++r)s[r]=$L(this.sourceInfo_[r],this.sourceOptions_);Promise.all(s).then(function(r){n.configure_(r)}).catch(function(r){Il(r),n.error_=r,n.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const s=e[n],r=XL(s);if(r){this.projection=r;break}}}configure_(t){let e,n,s,r,o;const a=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let c=0;const u=t.length;for(let p=0;p<u;++p){const _=[],x=[];t[p].forEach(C=>{jL(C)?x.push(C):_.push(C)});const v=_.length;if(x.length>0&&x.length!==v)throw new Error(`Expected one mask per image found ${x.length} masks and ${v} images`);let w,E;const S=new Array(v),T=new Array(v),R=new Array(v);l[p]=new Array(v),h[p]=new Array(v);for(let C=0;C<v;++C){const P=_[C],N=P.getGDALNoData();h[p][C]=P.getGDALMetadata(0),l[p][C]=N;const U=this.sourceInfo_[p].bands;a[p]=U?U.length:P.getSamplesPerPixel();const j=v-(C+1);w||(w=BL(P)),E||(E=WL(P));const B=qL(P,_[0]);R[j]=B[0];const d=[P.getTileWidth(),P.getTileHeight()];d[0]!==d[1]&&d[1]<zc&&(d[0]=zc,d[1]=zc),S[j]=d;const m=B[0]/Math.abs(B[1]);T[j]=[d[0],d[1]/m]}if(e?we(e,w,e):e=w,!n)n=E;else{const C=`Origin mismatch for source ${p}, got [${E}] but expected [${n}]`;Co(n,E,0,C,this.viewRejector)}if(!o)o=R,this.resolutionFactors_[p]=1;else{o.length-c>R.length&&(c=o.length-R.length);const C=o[o.length-1]/R[R.length-1];this.resolutionFactors_[p]=C;const P=R.map(U=>U*=C),N=`Resolution mismatch for source ${p}, got [${P}] but expected [${o}]`;Co(o.slice(c,o.length),P,.02,N,this.viewRejector)}s?Co(s.slice(c,s.length),T,.01,`Tile size mismatch for source ${p}`,this.viewRejector):s=T,r?Co(r.slice(c,r.length),S,0,`Tile size mismatch for source ${p}`,this.viewRejector):r=S,this.sourceImagery_[p]=_.reverse(),this.sourceMasks_[p]=x.reverse()}for(let p=0,_=this.sourceImagery_.length;p<_;++p){const x=this.sourceImagery_[p];for(;x.length<o.length;)x.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;t:for(let p=0;p<u;++p){if(this.sourceInfo_[p].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[p].length){this.addAlpha_=!0;break}const _=l[p],x=this.sourceInfo_[p].bands;if(x){for(let v=0;v<x.length;++v)if(_[x[v]-1]!==null){this.addAlpha_=!0;break t}continue}for(let v=0;v<_.length;++v)if(_[v]!==null){this.addAlpha_=!0;break t}}let g=this.addAlpha_?1:0;for(let p=0;p<u;++p)g+=a[p];this.bandCount=g;const f=new ys({extent:e,minZoom:c,origin:n,resolutions:o,tileSizes:s});this.tileGrid=f,this.setTileSizes(r),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:tu(Ce(e),this.projection),extent:yh(e,this.projection),zoom:1})}loadTile_(t,e,n){const s=this.getTileSize(t),r=this.sourceImagery_.length,o=new Array(r*2),a=this.nodataValues_,l=this.sourceInfo_,h=UL();for(let c=0;c<r;++c){const u=l[c],g=this.resolutionFactors_[c],f=[Math.round(e*(s[0]*g)),Math.round(n*(s[1]*g)),Math.round((e+1)*(s[0]*g)),Math.round((n+1)*(s[1]*g))],p=this.sourceImagery_[c][t];let _;u.bands&&(_=u.bands.map(function(S){return S-1}));let x;"nodata"in u&&u.nodata!==null?x=u.nodata:_?x=_.map(function(S){return a[c][S]}):x=a[c];const v={window:f,width:s[0],height:s[1],samples:_,fillValue:x,pool:h,interleave:!1};zL(this.convertToRGB_,p)?o[c]=p.readRGB(v):o[c]=p.readRasters(v);const w=r+c,E=this.sourceMasks_[c][t];if(!E){o[w]=Promise.resolve(null);continue}o[w]=E.readRasters({window:f,width:s[0],height:s[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,s)).catch(function(c){throw Il(c),c})}composeTile_(t,e){const n=this.metadata_,s=this.sourceInfo_,r=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],g=u*o;let f;h?f=new Uint8Array(g):f=new Float32Array(g);let p=0;for(let _=0;_<u;++_){let x=c;for(let v=0;v<r;++v){const w=s[v];let E=w.min,S=w.max,T,R;if(h){const C=n[v][0];E===void 0&&(C&&om in C?E=parseFloat(C[om]):E=VL(e[v][0])),S===void 0&&(C&&rm in C?S=parseFloat(C[rm]):S=YL(e[v][0])),T=255/(S-E),R=-E*T}for(let C=0;C<a[v];++C){const P=e[v][C][_];let N;if(h?N=wt(T*P+R,0,255):N=P,!c)f[p]=N;else{let U=w.nodata;if(U===void 0){let B;w.bands?B=w.bands[C]-1:B=C,U=l[v][B]}const j=isNaN(U);(!j&&P!==U||j&&!isNaN(P))&&(x=!1,f[p]=N)}p++}if(!x){const C=r+v,P=e[C];P&&!P[0][_]&&(x=!0)}}c&&(x||(f[p]=255),p++)}return f}}Ag.prototype.getView;class ie{constructor(t){this.name=t}toString(){return this.name}}ie.GeoTIFF=new ie("GeoTIFF");ie.ImageStatic=new ie("ImageStatic");ie.PMTilesRaster=new ie("PMTilesRaster");ie.PMTilesVector=new ie("PMTilesVector");ie.TileJSON=new ie("TileJSON");ie.TileWMS=new ie("TileWMS");ie.WMTS=new ie("WMTS");ie.XYZ=new ie("XYZ");class HL extends Th{constructor(t,e,n,s,r,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?we(n,h):n,u=Ce(c),g=ua(t,e,u,s),f=Hd,p=new Qd(t,e,c,l,g*f,s),_=p.calculateSourceExtent(),x=Un(_)?null:o(_,g,r),v=x?et.IDLE:et.EMPTY,w=x?x.getPixelRatio():1;super(n,s,w,v),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=p,this.targetResolution_=s,this.targetExtent_=n,this.sourceImage_=x,this.sourcePixelRatio_=w,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==et.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==et.LOADED){const e=yt(this.targetExtent_)/this.targetResolution_,n=Vt(this.targetExtent_)/this.targetResolution_;this.canvas_=Jd(e,n,this.sourcePixelRatio_,Jl(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==et.IDLE){this.state=et.LOADING,this.changed();const t=this.sourceImage_.getState();t==et.LOADED||t==et.ERROR?this.reproject_():(this.sourceListenerKey_=le(this.sourceImage_,Lt.CHANGE,function(e){const n=this.sourceImage_.getState();(n==et.LOADED||n==et.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ve(this.sourceListenerKey_),this.sourceListenerKey_=null}}const sn=4,Bc={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class KL extends gn{constructor(t,e){super(t),this.image=e}}class QL extends oo{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=gh(e,t,0);t=e[n]}return t}getImage(t,e,n,s){const r=this.getProjection();if(!r||!s||Ae(r,s))return r&&(s=r),this.getImageInternal(t,e,n,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ae(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&Nn(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new HL(r,s,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,s){if(this.loader){const r=Hh(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&Ze(this.wantedExtent_,r)||Ze(this.image.getExtent(),r))&&(this.wantedResolution_&&Jl(this.wantedResolution_)===o||Jl(this.image.getResolution())===o)))return this.image;this.wantedProjection_=s,this.wantedExtent_=r,this.wantedResolution_=o,this.image=new Th(r,o,n,this.loader),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case et.LOADING:this.loading=!0,n=Bc.IMAGELOADSTART;break;case et.LOADED:this.loading=!1,n=Bc.IMAGELOADEND;break;case et.ERROR:this.loading=!1,n=Bc.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new KL(n,e))}}function Yh(i,t){i.getImage().src=t}function Hh(i,t,e,n){const s=t/e,r=Ce(i),o=ns(yt(i)/s,sn),a=ns(Vt(i)/s,sn),l=ns((n-1)*o/2,sn),h=o+2*l,c=ns((n-1)*a/2,sn),u=a+2*c;return Vu(r,s,0,[h,u])}const vs=QL;function Ky(i){const t=i.load||_s,e=i.imageExtent,n=new Image;return i.crossOrigin!==null&&(n.crossOrigin=i.crossOrigin),()=>t(n,i.url).then(s=>{const r=yt(e)/s.width,o=Vt(e)/s.height;return{image:s,extent:e,resolution:r!==o?[r,o]:o,pixelRatio:1}})}class Qy extends vs{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,n=t.imageLoadFunction!==void 0?t.imageLoadFunction:Yh;super({attributions:t.attributions,interpolate:t.interpolate,projection:tt(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new Th(this.imageExtent_,void 0,1,Ky({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(s,r)=>(this.image.setImage(s),n(this.image,r),_s(s))})),this.image.addEventListener(Lt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,n,s){return Qt(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function JL(i,t){const e=/\{z\}/g,n=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(s,o[2].toString()).replace(r,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function Lg(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=JL(i[s],t);return Vr(n)}function Vr(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const s=ig(t),r=an(s,i.length);return i[r](t,e,n)}}function tO(i,t,e){}function Og(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(i.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=n;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}class Fg extends ja{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Fg.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=st(e),s=e.getState();let r;s==q.LOADING?(this.tileLoadingKeys_[n]=!0,r=Or.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==q.ERROR?Or.TILELOADERROR:s==q.LOADED?Or.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Ry(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Og(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Lg(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const s=un(t,e,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const Ng=Fg;class Ai extends Ng{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:eO,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Da,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ae(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Ae(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ae(e,t)))return this.tileGrid;const n=st(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=gg(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ae(e,t))return this.tileCache;const n=st(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new $h(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,s,r,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?q.IDLE:q.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(Lt.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,n,s,r){const o=this.getProjection();if(!o||!r||Ae(o,r))return this.getTileInternal(t,e,n,s,o||r);const a=this.getTileCacheForProjection(r),l=[t,e,n];let h;const c=es(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const g=this.getTileGridForProjection(o),f=this.getTileGridForProjection(r),p=this.getTileCoordForTileUrlFunction(l,r),_=new Xr(o,g,r,f,l,p,this.getTilePixelRatio(s),this.getGutter(),(x,v,w,E)=>this.getTileInternal(x,v,w,E,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(t,e,n,s,r){let o=null;const a=un(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,s,r,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,s,r,l),h.getState()==q.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=tt(t);if(n){const s=st(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function eO(i,t){i.getImage().src=t}function kg(i,t,e,n){const s=document.createElement("script"),r="olc_"+st(t);function o(){delete window[r],s.parentNode.removeChild(s)}s.async=!0,s.src=i+(i.includes("?")?"&":"?")+(n||"callback")+"="+r;const a=setTimeout(function(){o(),e&&e()},1e4);window[r]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(s)}class iO extends Error{constructor(t){const e="Unexpected response status: "+t.status;super(e),this.name="ResponseError",this.response=t}}class nO extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function Jy(i){return new Promise(function(t,e){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(h){const c="Error parsing response text as JSON: "+h.message;e(new Error(c));return}t(l);return}e(new iO(a))}function s(o){e(new nO(o.target))}const r=new XMLHttpRequest;r.addEventListener("load",n),r.addEventListener("error",s),r.open("GET",i),r.setRequestHeader("Accept","application/json"),r.send()})}function t1(i,t){return t.includes("://")?t:new URL(t,i).href}class e1 extends Ai{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)kg(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let s;if(t.bounds!==void 0){const h=Hs(e,n);s=Gr(t.bounds,h)}const r=qn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Js({extent:r,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=Lg(t.tiles,l),t.attribution&&!this.getAttributions()){const h=s!==void 0?s:r;this.setAttributions(function(c){return Qt(h,c.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}let sO=class extends ao{constructor(i,t,e,n,s,r){super(i,t,r),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=e,this.key=e}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==q.IDLE&&(this.setState(q.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(i,t){this.setFeatures(i)}onError(){this.setState(q.ERROR)}setFeatures(i){this.features_=i,this.setState(q.LOADED)}setLoader(i){this.loader_=i}};const am=[];class rO extends ao{constructor(t,e,n,s){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.wrappedTileCoord=n}getContext(t){const e=st(t);return e in this.context_||(this.context_[e]=Jt(1,1,am)),this.context_[e]}hasContext(t){return st(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=st(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];Us(e),am.push(e.canvas),delete this.context_[t]}super.release()}}class Kh extends Ng{constructor(t){const e=t.projection||"EPSG:3857",n=t.extent||qn(e),s=t.tileGrid||Js({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:s,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:oO,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new $h(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:sO,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],n=this.tileCache;if(n.getCount()===0)return e;const s=sy(n.peekFirstKey())[0],r=this.tileGrid;return n.forEach(function(o){if(o.tileCoord[0]!==s||o.getState()!==q.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(Qt(t,r.getTileCoordExtent(u))){const g=c.getFeatures();if(g)for(let f=0,p=g.length;f<p;++f){const _=g[f],x=_.getGeometry();Qt(t,x.getExtent())&&e.push(_)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const n=this.getTileCacheForProjection(t),s=Object.keys(e).reduce((r,o)=>{const a=DI(o),l=n.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)r[h[c].getKey()]=!0}return r},{});super.expireCache(t,e),this.sourceTileCache.expireCache(s)}getSourceTiles(t,e,n){if(n.getState()===q.IDLE){n.setState(q.LOADING);const s=n.wrappedTileCoord,r=this.getTileGridForProjection(e),o=r.getTileCoordExtent(s),a=s[0],l=r.getResolution(a);Ii(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&we(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,g=>{const f=this.tileUrlFunction(g,t,e),p=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(g,f?q.IDLE:q.EMPTY,f,this.format_,this.tileLoadFunction);n.sourceTiles.push(p);const _=p.getState();if(_<q.LOADED){const x=v=>{this.handleTileChange(v);const w=p.getState();if(w===q.LOADED||w===q.ERROR){const E=p.getKey();E in n.errorTileKeys?p.getState()===q.LOADED&&delete n.errorTileKeys[E]:n.loadingSourceTiles--,w===q.ERROR?n.errorTileKeys[E]=!0:p.removeEventListener(Lt.CHANGE,x),n.loadingSourceTiles===0&&n.setState(Fn(n.errorTileKeys)?q.LOADED:q.ERROR)}};p.addEventListener(Lt.CHANGE,x),n.loadingSourceTiles++}_===q.IDLE&&(p.extent=h.getTileCoordExtent(g),p.projection=e,p.resolution=h.getResolution(g[0]),this.sourceTileCache.set(f,p),p.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(g=>g.getState()===q.ERROR)?q.ERROR:q.LOADED)}return n.sourceTiles}getTile(t,e,n,s,r){const o=un(t,e,n),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[t,e,n];let c=this.getTileCoordForTileUrlFunction(h,r);const u=this.getTileGrid().getExtent(),g=this.getTileGridForProjection(r);if(c&&u){const _=g.getTileCoordExtent(c);Ii(_,-g.getResolution(t),_),Qt(u,_)||(c=null)}let f=!0;if(c!==null){const _=this.tileGrid,x=g.getResolution(t),v=_.getZForResolution(x,1),w=g.getTileCoordExtent(c);Ii(w,-x,w),_.forEachTileCoord(w,v,E=>{f=f&&!this.tileUrlFunction(E,s,r)})}const p=new rO(h,f?q.EMPTY:q.IDLE,c,this.getSourceTiles.bind(this,s,r));return p.key=a,l?(p.interimTile=l,p.refreshInterimChain(),this.tileCache.replace(o,p)):this.tileCache.set(o,p),p}getTileGridForProjection(t){const e=t.getCode();let n=this.tileGrids_[e];if(!n){const s=this.tileGrid,r=s.getResolutions().slice(),o=r.map(function(h,c){return s.getOrigin(c)}),a=r.map(function(h,c){return s.getTileSize(c)}),l=S_+1;for(let h=r.length;h<l;++h)r.push(r[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);n=new ys({extent:s.getExtent(),origins:o,resolutions:r,tileSizes:a}),this.tileGrids_[e]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),r=se(s.getTileSize(t),this.tmpSize);return[Math.round(r[0]*e),Math.round(r[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(t*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}function oO(i,t){i.setLoader(function(e,n,s){X_(t,i.getFormat(),e,n,s,i.onLoad.bind(i),i.onError.bind(i))})}function Gn(i,t){const e=[];Object.keys(t).forEach(function(s){t[s]!==null&&t[s]!==void 0&&e.push(s+"="+encodeURIComponent(t[s]))});const n=e.join("&");return i=i.replace(/[?&]$/,""),i+=i.includes("?")?"&":"?",i+n}const nh="1.3.0",lm=[101,101];function i1(i,t,e,n,s){s.WIDTH=e[0],s.HEIGHT=e[1];const r=n.getAxisOrientation();let o;const a=Hu(s.VERSION,"1.3")>=0;return s[a?"CRS":"SRS"]=n.getCode(),a&&r.substr(0,2)=="ne"?o=[t[1],t[0],t[3],t[2]]:o=t,s.BBOX=o.join(","),Gn(i,s)}function n1(i,t,e,n,s,r,o){r=Object.assign({REQUEST:"GetMap"},r);const a=t/e,l=[Rl(yt(i)/a,sn),Rl(Vt(i)/a,sn)];if(e!=1)switch(o){case"geoserver":const h=90*e+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+h:r.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":r.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":r.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return i1(s,i,l,n,r)}function sh(i,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:nh,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},i)}function s1(i){const t=i.hidpi===void 0?!0:i.hidpi,e=tt(i.projection||"EPSG:3857"),n=i.ratio||1.5,s=i.load||_s;return(r,o,a)=>{r=Hh(r,o,a,n),a!=1&&(!t||i.serverType===void 0)&&(a=1);const l=n1(r,o,a,e,i.url,sh(i.params,"GetMap"),i.serverType),h=new Image;return i.crossOrigin!==null&&(h.crossOrigin=i.crossOrigin),s(h,l).then(c=>({image:c,extent:r,pixelRatio:a}))}}function aO(i,t,e){if(i.url===void 0)return;const n=tt(i.projection||"EPSG:3857"),s=Vu(t,e,0,lm),r={QUERY_LAYERS:i.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(r,sh(i.params,"GetFeatureInfo"),i.params);const o=wr((t[0]-s[0])/e,sn),a=wr((s[3]-t[1])/e,sn),l=Hu(r.VERSION,"1.3")>=0;return r[l?"I":"X"]=o,r[l?"J":"Y"]=a,i1(i.url,s,lm,n,r)}function lO(i,t){if(i.url===void 0)return;const e={SERVICE:"WMS",VERSION:nh,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(i.params===void 0||i.params.LAYER===void 0){const n=i.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;e.LAYER=n}if(t!==void 0){const n=tt(i.projection||"EPSG:3857").getMetersPerUnit()||1,s=28e-5;e.SCALE=t*n/s}return Object.assign(e,i.params),Gn(i.url,e)}class r1 extends Ai{constructor(t){t=t||{};const e=Object.assign({},t.params),n="TRANSPARENT"in e?e.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!n,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=ze(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,n,s){const r=tt(n),o=this.getProjection()||r;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=_h(t,r,o),h=ua(o,r,t,e),c=a.getZForResolution(h,this.zDirection),u=a.getResolution(c),g=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=g[0])return;let f=a.getTileCoordExtent(g,this.tmpExtent_);const p=this.gutter_;p!==0&&(f=Ii(f,u*p,f));const _={QUERY_LAYERS:this.params_.LAYERS};Object.assign(_,sh(this.params_,"GetFeatureInfo"),s);const x=Math.floor((l[0]-f[0])/u),v=Math.floor((f[3]-l[1])/u);return _[this.v13_?"I":"X"]=x,_[this.v13_?"J":"Y"]=v,this.getRequestUrl_(g,f,1,o||r,_)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:nh,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;n.LAYER=s}if(t!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;n.SCALE=t*s/r}return Object.assign(n,e),Gn(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,n,s,r){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=an(ig(t),o.length);a=o[l]}return n1(e,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(t[0]),n,s,a,r,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||nh;this.v13_=Hu(t,"1.3")>=0}tileUrlFunction(t,e,n){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(n)),s.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const r=s.getResolution(t[0]);let o=s.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=Ii(o,r*a,o));const l=Object.assign({},sh(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,n,l)}}class o1 extends Ai{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",n=t.tileGrid;let s=t.urls;s===void 0&&t.url!==void 0&&(s=Og(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:s,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=Vr(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(Vr(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Gn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,r);let c=t;return e=="KVP"?c=Gn(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,g){return h[g]}),c}}}function a1(i,t){const e=i.Contents.Layer,n=e==null?void 0:e.find(function(j){return j.Identifier==t.layer});if(!n)return null;const s=i.Contents.TileMatrixSet;let r;n.TileMatrixSetLink.length>1?"projection"in t?r=n.TileMatrixSetLink.findIndex(function(j){const B=s.find(function(y){return y.Identifier==j.TileMatrixSet}).SupportedCRS,d=tt(B),m=tt(t.projection);return d&&m?Ae(d,m):B==t.projection}):r=n.TileMatrixSetLink.findIndex(function(j){return j.TileMatrixSet==t.matrixSet}):r=0,r<0&&(r=0);const o=n.TileMatrixSetLink[r].TileMatrixSet,a=n.TileMatrixSetLink[r].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),r=n.Style.findIndex(function(j){return"style"in t?j.Title==t.style:j.isDefault}),r<0&&(r=0);const h=n.Style[r].Identifier,c={};"Dimension"in n&&n.Dimension.forEach(function(j,B,d){const m=j.Identifier;let y=j.Default;y===void 0&&(y=j.Value[0]),c[m]=y});const u=i.Contents.TileMatrixSet.find(function(j){return j.Identifier==o});let g;const f=u.SupportedCRS;if(f&&(g=tt(f)),"projection"in t){const j=tt(t.projection);j&&(!g||Ae(j,g))&&(g=j)}let p=!1;const _=g.getAxisOrientation().substr(0,2)=="ne";let x=u.TileMatrix[0],v={MinTileCol:0,MinTileRow:0,MaxTileCol:x.MatrixWidth-1,MaxTileRow:x.MatrixHeight-1};if(a){v=a[a.length-1];const j=u.TileMatrix.find(B=>B.Identifier===v.TileMatrix||u.Identifier+":"+B.Identifier===v.TileMatrix);j&&(x=j)}const w=x.ScaleDenominator*28e-5/g.getMetersPerUnit(),E=_?[x.TopLeftCorner[1],x.TopLeftCorner[0]]:x.TopLeftCorner,S=x.TileWidth*w,T=x.TileHeight*w;let R=u.BoundingBox;R&&_&&(R=[R[1],R[0],R[3],R[2]]);let C=[E[0]+S*v.MinTileCol,E[1]-T*(1+v.MaxTileRow),E[0]+S*(1+v.MaxTileCol),E[1]-T*v.MinTileRow];if(R!==void 0&&!Ze(R,C)){const j=n.WGS84BoundingBox,B=tt("EPSG:4326").getExtent();if(C=R,j)p=j[0]===B[0]&&j[2]===B[2];else{const d=Ju(R,u.SupportedCRS,"EPSG:4326");p=d[0]-1e-10<=B[0]&&d[2]+1e-10>=B[2]}}const P=sA(u,C,a),N=[];let U=t.requestEncoding;if(U=U!==void 0?U:"","OperationsMetadata"in i&&"GetTile"in i.OperationsMetadata){const j=i.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let B=0,d=j.length;B<d;++B)if(j[B].Constraint){const m=j[B].Constraint.find(function(y){return y.name=="GetEncoding"}).AllowedValues.Value;if(U===""&&(U=m[0]),U==="KVP")m.includes("KVP")&&N.push(j[B].href);else break}else j[B].href&&(U="KVP",N.push(j[B].href))}return N.length===0&&(U="REST",n.ResourceURL.forEach(function(j){j.resourceType==="tile"&&(l=j.format,N.push(j.template))})),{urls:N,layer:t.layer,matrixSet:o,format:l,projection:g,requestEncoding:U,tileGrid:P,style:h,dimensions:c,wrapX:p,crossOrigin:t.crossOrigin}}class qs extends Ai{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Js({extent:qn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var l1={exports:{}};(function(i,t){(function(e,n){i.exports=n()})(ks,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(u,g){return u.indexOf(g)===-1?u.length:u.indexOf(g)}function s(u){var g=u.replace(/^v/,"").replace(/\+.*$/,""),f=n(g,"-"),p=g.substring(0,f).split(".");return p.push(g.substring(f+1)),p}function r(u){return isNaN(Number(u))?u:Number(u)}function o(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!e.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function a(u,g){[u,g].forEach(o);for(var f=s(u),p=s(g),_=0;_<Math.max(f.length-1,p.length-1);_++){var x=parseInt(f[_]||0,10),v=parseInt(p[_]||0,10);if(x>v)return 1;if(v>x)return-1}var w=f[f.length-1],E=p[p.length-1];if(w&&E){var S=w.split(".").map(r),T=E.split(".").map(r);for(_=0;_<Math.max(S.length,T.length);_++){if(S[_]===void 0||typeof T[_]=="string"&&typeof S[_]=="number")return-1;if(T[_]===void 0||typeof S[_]=="string"&&typeof T[_]=="number"||S[_]>T[_])return 1;if(T[_]>S[_])return-1}}else if(w||E)return w?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(u){return typeof u=="string"&&e.test(u)},a.compare=function(u,g,f){c(f);var p=a(u,g);return h[f].indexOf(p)>-1},a})})(l1);var hO=l1.exports,Au=hO;const Dg="1.0.0",gt={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Gs={itemAndCollection:{"cube:":gt.datacube,"eo:":gt.eo,"file:":gt.file,"label:":gt.label,"pc:":gt.pointcloud,"processing:":gt.processing,"proj:":gt.projection,"raster:":gt.raster,"sar:":gt.sar,"sat:":gt.sat,"sci:":gt.scientific,"view:":gt.view,version:gt.version,deprecated:gt.version,published:gt.timestamps,expires:gt.timestamps,unpublished:gt.timestamps},catalog:{},collection:{item_assets:gt["item-assets"]},item:{}};Gs.collection=Object.assign(Gs.collection,Gs.itemAndCollection);Gs.item=Object.assign(Gs.item,Gs.itemAndCollection);var Io={parseUrl(i){let t=i.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(t)return{id:t[1],version:t[2]}}},Ft={version:Dg,extensions:{},set(i){if(typeof i.stac_version!="string"?Ft.version="0.6.0":Ft.version=i.stac_version,Array.isArray(i.stac_extensions))for(let t of i.stac_extensions){let e=Io.parseUrl(t);e&&(Ft.extensions[e.id]=e.version)}},before(i,t=null){let e=t?Ft.extensions[t]:Ft.version;return typeof e>"u"?!1:Au.compare(e,i,"<")}},D={type(i){let t=typeof i;if(t==="object"){if(i===null)return"null";if(Array.isArray(i))return"array"}return t},is(i,t){return D.type(i)===t},isDefined(i){return typeof i<"u"},isObject(i){return typeof i=="object"&&i===Object(i)&&!Array.isArray(i)},rename(i,t,e){return typeof i[t]<"u"&&typeof i[e]>"u"?(i[e]=i[t],delete i[t],!0):!1},forAll(i,t,e){if(i[t]&&typeof i[t]=="object")for(let n in i[t])e(i[t][n])},toArray(i,t){return typeof i[t]<"u"&&!Array.isArray(i[t])?(i[t]=[i[t]],!0):!1},flattenArray(i,t,e,n=!1){if(Array.isArray(i[t])){for(let s in i[t])if(typeof e[s]=="string"){let r=i[t][s];i[e[s]]=n?[r]:r}return delete i[t],!0}return!1},flattenOneElementArray(i,t,e=!1){return!e&&Array.isArray(i[t])?i[t].length===1?(i[t]=i[t][0],!0):!1:!0},removeFromArray(i,t,e){if(Array.isArray(i[t])){let n=i[t].indexOf(e);return n>-1&&i[t].splice(n,1),!0}return!1},ensure(i,t,e){return D.type(e)!==D.type(i[t])&&(i[t]=e),!0},upgradeExtension(i,t){let{id:e,version:n}=Io.parseUrl(t),s=i.stac_extensions.findIndex(r=>{let o=Io.parseUrl(r);return o&&o.id===e&&Au.compare(o.version,n,"<")});return s!==-1?(i.stac_extensions[s]=t,!0):!1},addExtension(i,t){let{id:e,version:n}=Io.parseUrl(t),s=i.stac_extensions.findIndex(r=>{if(r===t)return!0;let o=Io.parseUrl(r);return!!(o&&o.id===e&&Au.compare(o.version,n,"<"))});return s===-1?i.stac_extensions.push(t):i.stac_extensions[s]=t,i.stac_extensions.sort(),!0},removeExtension(i,t){return D.removeFromArray(i,"stac_extensions",t)},migrateExtensionShortnames(i){let t=Object.keys(gt),e=Object.values(gt);return D.mapValues(i,"stac_extensions",t,e)},populateExtensions(i,t){let e=[];(t=="catalog"||t=="collection")&&e.push(i),(t=="item"||t=="collection")&&D.isObject(i.assets)&&(e=e.concat(Object.values(i.assets))),t=="collection"&&D.isObject(i.item_assets)&&(e=e.concat(Object.values(i.item_assets))),t=="collection"&&D.isObject(i.summaries)&&e.push(i.summaries),t=="item"&&D.isObject(i.properties)&&e.push(i.properties);for(let n of e)Object.keys(n).forEach(s=>{let r=s.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(r)){let o=Gs[t][r[0]];D.is(o,"string")&&D.addExtension(i,o)}})},mapValues(i,t,e,n){let s=r=>{let o=e.indexOf(r);return o>=0?n[o]:r};return Array.isArray(i[t])?i[t]=i[t].map(s):typeof i[t]<"u"&&(i[t]=s(i[t])),!0},mapObject(i,t){for(let e in i)i[e]=t(i[e],e)},moveTo(i,t,e,n=!1,s=!1){let r;return n?s?r=o=>Array.isArray(o):r=o=>Array.isArray(o)&&o.length===1:r=D.isDefined,r(i[t])?(e[t]=n&&!s?i[t][0]:i[t],delete i[t],!0):!1},runAll(i,t,e,n){for(let s in i)s.startsWith("migrate")||i[s](t,e,n)},toUTC(i,t){if(typeof i[t]=="string")try{return i[t]=this.toISOString(i[t]),!0}catch{}return delete i[t],!1},toISOString(i){return i instanceof Date||(i=new Date(i)),i.toISOString().replace(".000","")}},en={multihash:null,hexToUint8(i){if(i.length===0||i.length%2!==0)throw new Error(`The string "${i}" is not valid hex.`);return new Uint8Array(i.match(/.{1,2}/g).map(t=>parseInt(t,16)))},uint8ToHex(i){return i.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),"")},toMultihash(i,t,e){if(!en.multihash||!D.is(i[t],"string"))return!1;try{const n=en.multihash.encode(en.hexToUint8(i[t]),e);return i[t]=en.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},Gg={migrate(i,t=!0){return Ft.set(i),t&&(i.stac_version=Dg),i.type="Catalog",D.ensure(i,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&D.migrateExtensionShortnames(i),D.ensure(i,"id",""),D.ensure(i,"description",""),D.ensure(i,"links",[]),D.runAll(Gg,i,i),Ft.before("0.8.0")&&D.populateExtensions(i,"catalog"),i}},jg={migrate(i,t=!0){return Gg.migrate(i,t),i.type="Collection",Ft.before("1.0.0-rc.1")&&D.migrateExtensionShortnames(i),D.ensure(i,"license","proprietary"),D.ensure(i,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),D.runAll(jg,i,i),D.isObject(i.properties)&&(D.removeFromArray(i,"stac_extensions","commons"),delete i.properties),Ft.before("0.8.0")&&D.populateExtensions(i,"collection"),Ft.before("1.0.0-beta.1")&&D.mapValues(i,"stac_extensions",["assets"],["item-assets"]),i},extent(i){if(D.ensure(i,"extent",{}),Ft.before("0.8.0")&&(Array.isArray(i.extent.spatial)&&(i.extent.spatial={bbox:[i.extent.spatial]}),Array.isArray(i.extent.temporal)&&(i.extent.temporal={interval:[i.extent.temporal]})),D.ensure(i.extent,"spatial",{}),D.ensure(i.extent.spatial,"bbox",[]),D.ensure(i.extent,"temporal",{}),D.ensure(i.extent.temporal,"interval",[]),Ft.before("1.0.0-rc.3")){if(i.extent.temporal.interval.length>1){let t,e;for(let n of i.extent.temporal.interval){if(n[0]===null)t=null;else if(typeof n[0]=="string"&&t!==null)try{let s=new Date(n[0]);(typeof t>"u"||s<t)&&(t=s)}catch{}if(n[1]===null)e=null;else if(typeof n[1]=="string"&&e!==null)try{let s=new Date(n[1]);(typeof e>"u"||s>e)&&(e=s)}catch{}}i.extent.temporal.interval.unshift([t?D.toISOString(t):null,e?D.toISOString(e):null])}if(i.extent.spatial.bbox.length>1){let t=i.extent.spatial.bbox.reduce((e,n)=>Array.isArray(n)?Math.max(n.length,e):e,4);if(t>=4){let e=new Array(t).fill(null),n=t/2;for(let s of i.extent.spatial.bbox){if(!Array.isArray(s)||s.length<4)break;for(let r in s){let o=s[r];e[r]===null?e[r]=o:r<n?e[r]=Math.min(o,e[r]):e[r]=Math.max(o,e[r])}}e.findIndex(s=>s===null)===-1&&i.extent.spatial.bbox.unshift(e)}}}},collectionAssets(i){Ft.before("1.0.0-rc.1")&&D.removeExtension(i,"collection-assets"),fa.migrateAll(i)},itemAsset(i){Ft.before("1.0.0-beta.2")&&D.rename(i,"item_assets","assets"),fa.migrateAll(i,"item_assets")},summaries(i){if(D.ensure(i,"summaries",{}),Ft.before("0.8.0")&&D.isObject(i.other_properties)){for(let t in i.other_properties){let e=i.other_properties[t];Array.isArray(e.extent)&&e.extent.length===2?i.summaries[t]={minimum:e.extent[0],maximum:e.extent[1]}:Array.isArray(e.values)&&(e.values.filter(n=>Array.isArray(n)).length===e.values.length?i.summaries[t]=e.values.reduce((n,s)=>n.concat(s),[]):i.summaries[t]=e.values)}delete i.other_properties}if(Ft.before("1.0.0-beta.1")&&D.isObject(i.properties)&&!i.links.find(t=>["child","item"].includes(t.rel)))for(let t in i.properties){let e=i.properties[t];Array.isArray(e)||(e=[e]),i.summaries[t]=e}Ft.before("1.0.0-rc.1")&&D.mapObject(i.summaries,t=>(D.rename(t,"min","minimum"),D.rename(t,"max","maximum"),t)),Qh.migrate(i.summaries,i,!0),D.moveTo(i.summaries,"sci:doi",i,!0)&&D.addExtension(i,gt.scientific),D.moveTo(i.summaries,"sci:publications",i,!0,!0)&&D.addExtension(i,gt.scientific),D.moveTo(i.summaries,"sci:citation",i,!0)&&D.addExtension(i,gt.scientific),D.moveTo(i.summaries,"cube:dimensions",i,!0)&&D.addExtension(i,gt.datacube),Object.keys(i.summaries).length===0&&delete i.summaries}},zg={migrate(i,t=null,e=!0){Ft.set(i),e&&(i.stac_version=Dg),D.ensure(i,"stac_extensions",[]),Ft.before("1.0.0-rc.1")&&D.migrateExtensionShortnames(i),D.ensure(i,"id",""),D.ensure(i,"type","Feature"),D.isObject(i.geometry)||(i.geometry=null),i.geometry!==null&&D.ensure(i,"bbox",[]),D.ensure(i,"properties",{}),D.ensure(i,"links",[]),D.ensure(i,"assets",{});let n=!1;return D.isObject(t)&&D.isObject(t.properties)&&(D.removeFromArray(i,"stac_extensions","commons"),i.properties=Object.assign({},t.properties,i.properties),n=!0),D.runAll(zg,i,i),Qh.migrate(i.properties,i),fa.migrateAll(i),(Ft.before("0.8.0")||n)&&D.populateExtensions(i,"item"),i}},h1={migrate(i,t=!0){return D.ensure(i,"collections",[]),D.ensure(i,"links",[]),D.runAll(h1,i,i),i.collections=i.collections.map(e=>jg.migrate(e,t)),i}},c1={migrate(i,t=!0){return D.ensure(i,"type","FeatureCollection"),D.ensure(i,"features",[]),D.ensure(i,"links",[]),D.runAll(c1,i,i),i.features=i.features.map(e=>zg.migrate(e,null,t)),i}},fa={migrateAll(i,t="assets"){for(let e in i[t])fa.migrate(i[t][e],i)},migrate(i,t){return D.runAll(fa,i,t),Qh.migrate(i,t),i},mediaTypes(i){D.is(i.type,"string")&&D.mapValues(i,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(i,t){let e=D.isObject(t.properties)&&Array.isArray(t.properties["eo:bands"])?t.properties["eo:bands"]:[];if(Array.isArray(i["eo:bands"]))for(let n in i["eo:bands"]){let s=i["eo:bands"][n];D.is(s,"number")&&D.isObject(e[s])?s=e[s]:D.isObject(s)||(s={}),i["eo:bands"][n]=s}}},Qh={migrate(i,t,e=!1){return D.runAll(Qh,i,t,e),i},_commonMetadata(i){Ft.before("1.0.0-rc.3")&&(D.toUTC(i,"created"),D.toUTC(i,"updated"))},_timestamps(i,t){D.toUTC(i,"published"),D.toUTC(i,"expires"),D.toUTC(i,"unpublished"),D.upgradeExtension(t,gt.timestamps)},_versioningIndicator(i,t){D.upgradeExtension(t,gt.version)},checksum(i,t){Ft.before("0.9.0")&&en.multihash&&(D.rename(i,"checksum:md5","checksum:multihash")&&en.toMultihash(i,"checksum:multihash","md5"),D.rename(i,"checksum:sha1","checksum:multihash")&&en.toMultihash(i,"checksum:multihash","sha1"),D.rename(i,"checksum:sha2","checksum:multihash")&&en.toMultihash(i,"checksum:multihash","sha2-256"),D.rename(i,"checksum:sha3","checksum:multihash")&&en.toMultihash(i,"checksum:multihash","sha3-256")),Ft.before("1.0.0-rc.1")&&D.rename(i,"checksum:multihash","file:checksum")&&D.addExtension(t,gt.file),D.removeExtension(t,"checksum")},classification(i,t){Ft.before("1.1.0","classification")&&D.forAll(i,"classification:classes",e=>D.rename(e,"color-hint","color_hint")),D.upgradeExtension(t,gt.classification)},cube(i,t){D.upgradeExtension(t,gt.datacube)},dtr(i,t){Ft.before("0.9.0")&&(D.rename(i,"dtr:start_datetime","start_datetime"),D.rename(i,"dtr:end_datetime","end_datetime"),D.removeExtension(t,"datetime-range"))},eo(i,t){Ft.before("0.9.0")&&(D.rename(i,"eo:epsg","proj:epsg")&&D.addExtension(t,gt.projection),D.rename(i,"eo:platform","platform"),D.rename(i,"eo:instrument","instruments")&&D.toArray(i,"instruments"),D.rename(i,"eo:constellation","constellation"),D.rename(i,"eo:off_nadir","view:off_nadir")&&D.addExtension(t,gt.view),D.rename(i,"eo:azimuth","view:azimuth")&&D.addExtension(t,gt.view),D.rename(i,"eo:incidence_angle","view:incidence_angle")&&D.addExtension(t,gt.view),D.rename(i,"eo:sun_azimuth","view:sun_azimuth")&&D.addExtension(t,gt.view),D.rename(i,"eo:sun_elevation","view:sun_elevation")&&D.addExtension(t,gt.view)),Ft.before("1.0.0-beta.1")&&D.rename(i,"eo:gsd","gsd"),D.upgradeExtension(t,gt.eo)},file(i,t){D.upgradeExtension(t,gt.file)},label(i,t){Ft.before("0.8.0")&&(D.rename(i,"label:property","label:properties"),D.rename(i,"label:task","label:tasks"),D.rename(i,"label:overview","label:overviews")&&D.toArray(i,"label:overviews"),D.rename(i,"label:method","label:methods"),D.toArray(i,"label:classes")),D.upgradeExtension(t,gt.label)},pc(i,t){Ft.before("0.8.0")&&D.rename(i,"pc:schema","pc:schemas"),D.upgradeExtension(t,gt.pointcloud)},processing(i,t){D.upgradeExtension(t,gt.processing)},proj(i,t){D.upgradeExtension(t,gt.projection)},raster(i,t){D.upgradeExtension(t,gt.raster)},sar(i,t,e){D.rename(i,"sar:incidence_angle","view:incidence_angle")&&D.addExtension(t,gt.view),D.rename(i,"sar:pass_direction","sat:orbit_state")&&D.mapValues(i,"sat:orbit_state",[null],["geostationary"])&&D.addExtension(t,gt.sat),Ft.before("0.7.0")&&(D.flattenArray(i,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],e),D.flattenArray(i,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],e),D.flattenArray(i,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],e),D.rename(i,"sar:off_nadir","view:off_nadir")&&D.addExtension(t,gt.view)),Ft.before("0.9.0")&&(D.rename(i,"sar:platform","platform"),D.rename(i,"sar:instrument","instruments")&&D.toArray(i,"instruments"),D.rename(i,"sar:constellation","constellation"),D.rename(i,"sar:type","sar:product_type"),D.rename(i,"sar:polarization","sar:polarizations"),D.flattenOneElementArray(i,"sar:absolute_orbit",e)&&D.rename(i,"sar:absolute_orbit","sat:absolute_orbit")&&D.addExtension(t,gt.sat),D.flattenOneElementArray(i,"sar:relative_orbit",e)&&D.rename(i,"sar:relative_orbit","sat:relative_orbit")&&D.addExtension(t,gt.sat)),D.upgradeExtension(t,gt.sar)},sat(i,t){Ft.before("0.9.0")&&(D.rename(i,"sat:off_nadir_angle","sat:off_nadir"),D.rename(i,"sat:azimuth_angle","sat:azimuth"),D.rename(i,"sat:sun_azimuth_angle","sat:sun_azimuth"),D.rename(i,"sat:sun_elevation_angle","sat:sun_elevation")),D.upgradeExtension(t,gt.sat)},sci(i,t){D.upgradeExtension(t,gt.scientific)},item(i){Ft.before("0.8.0")&&(D.rename(i,"item:license","license"),D.rename(i,"item:providers","providers"))},table(i,t){D.upgradeExtension(t,gt.table)},view(i,t){D.upgradeExtension(t,gt.view)}},yr={item(i,t=null,e=!0){return zg.migrate(i,t,e)},catalog(i,t=!0){return Gg.migrate(i,t)},collection(i,t=!0){return jg.migrate(i,t)},collectionCollection(i,t=!0){return h1.migrate(i,t)},itemCollection(i,t=!0){return c1.migrate(i,t)},stac(i,t=!0){return i.type==="Feature"?yr.item(i,null,t):i.type==="FeatureCollection"?yr.itemCollection(i,t):i.type==="Collection"||!i.type&&D.isDefined(i.extent)&&D.isDefined(i.license)?yr.collection(i,t):!i.type&&Array.isArray(i.collections)?yr.collectionCollection(i,t):yr.catalog(i,t)},enableMultihash(i){en.multihash=i}},cO=yr;const uO=eo(cO);function co(i){let t=i.length>=6,e=i[0],n=i[t?3:2],s=i[1],r=i[t?4:3],o={west:e,east:n,south:s,north:r};return t&&(o.base=i[2],o.height=i[5]),o}function Wc(i){let{west:t,east:e,south:n,north:s}=co(i);return[[[t,s],[t,n],[e,n],[e,s],[t,s]]]}function dO(i){if(!zi(i))return null;let t=co(i),e=[];if(d1(i)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function u1(i){if(zi(i)?i=[i]:Array.isArray(i)&&(i=i.filter(n=>zi(n))),!Array.isArray(i)||i.length===0)return null;let t=i.reduce((n,s)=>{if(d1(s)){let{west:r,east:o,south:a,north:l}=co(s);n.push(Wc([-180,a,o,l])),n.push(Wc([r,a,180,l]))}else n.push(Wc(s));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function zi(i){if(!Array.isArray(i)||![4,6].includes(i.length)||i.some(r=>typeof r!="number"))return!1;let{west:t,east:e,south:n,north:s}=co(i);return n<=s&&t>=-180&&t<=180&&n>=-90&&e<=180&&e>=-180&&s<=90}function d1(i){if(!zi(i))return!1;let{west:t,east:e}=co(i);return t>e}function g1(i){if(!Array.isArray(i)||i.length===0)return null;let t={west:180,south:90,east:-180,north:-90};i.forEach(n=>{if(!zi(n))return;let s=co(n),r=["west","south"];for(let o in s){let a=r.includes(o)?Math.min:Math.max;t[o]=a(t[o],s[o])}});let e=[t.west,t.south,t.east,t.north];return zi(e)?e:null}function ai(i){return typeof i=="string"&&i.length>0}function ei(i){return typeof i=="object"&&i===Object(i)&&!Array.isArray(i)}function f1(...i){if(i=i.filter(t=>Array.isArray(t)),i.length>1){let t=Math.max(...i.map(n=>n.length)),e=[];for(let n=0;n<t;n++)e.push(Object.assign({},...i.map(s=>s[n])));return e}else if(i.length===1)return i[0];return[]}function gO(i){switch(i){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return i.startsWith("u")?0:null}function fO(i){switch(i){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Jh{constructor(t,e={},n=[]){if(!ei(t))throw new Error("Given data is not an object");if(t instanceof Jh){for(let s of n)this[s]=t[s];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let s in t)typeof this[s]>"u"&&(s in e?this[s]=e[s](t[s],this):this[s]=t[s])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return dO(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let s=Array.isArray(n)?[]:{};for(let r in n)s[r]=n[r].toJSON();n=s}t[e]=n}),t}}var p1={exports:{}},bl={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */bl.exports;var hm;function pO(){return hm||(hm=1,function(i,t){(function(e){var n=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,r=typeof ks=="object"&&ks;(r.global===r||r.window===r||r.self===r)&&(e=r);var o,a=2147483647,l=36,h=1,c=26,u=38,g=700,f=72,p=128,_="-",x=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-h,T=Math.floor,R=String.fromCharCode,C;function P(L){throw new RangeError(E[L])}function N(L,k){for(var W=L.length,K=[];W--;)K[W]=k(L[W]);return K}function U(L,k){var W=L.split("@"),K="";W.length>1&&(K=W[0]+"@",L=W[1]),L=L.replace(w,".");var G=L.split("."),H=N(G,k).join(".");return K+H}function j(L){for(var k=[],W=0,K=L.length,G,H;W<K;)G=L.charCodeAt(W++),G>=55296&&G<=56319&&W<K?(H=L.charCodeAt(W++),(H&64512)==56320?k.push(((G&1023)<<10)+(H&1023)+65536):(k.push(G),W--)):k.push(G);return k}function B(L){return N(L,function(k){var W="";return k>65535&&(k-=65536,W+=R(k>>>10&1023|55296),k=56320|k&1023),W+=R(k),W}).join("")}function d(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:l}function m(L,k){return L+22+75*(L<26)-((k!=0)<<5)}function y(L,k,W){var K=0;for(L=W?T(L/g):L>>1,L+=T(L/k);L>S*c>>1;K+=l)L=T(L/S);return T(K+(S+1)*L/(L+u))}function b(L){var k=[],W=L.length,K,G=0,H=p,Q=f,nt,xt,dt,Tt,Et,kt,Yt,ue,Ht;for(nt=L.lastIndexOf(_),nt<0&&(nt=0),xt=0;xt<nt;++xt)L.charCodeAt(xt)>=128&&P("not-basic"),k.push(L.charCodeAt(xt));for(dt=nt>0?nt+1:0;dt<W;){for(Tt=G,Et=1,kt=l;dt>=W&&P("invalid-input"),Yt=d(L.charCodeAt(dt++)),(Yt>=l||Yt>T((a-G)/Et))&&P("overflow"),G+=Yt*Et,ue=kt<=Q?h:kt>=Q+c?c:kt-Q,!(Yt<ue);kt+=l)Ht=l-ue,Et>T(a/Ht)&&P("overflow"),Et*=Ht;K=k.length+1,Q=y(G-Tt,K,Tt==0),T(G/K)>a-H&&P("overflow"),H+=T(G/K),G%=K,k.splice(G++,0,H)}return B(k)}function M(L){var k,W,K,G,H,Q,nt,xt,dt,Tt,Et,kt=[],Yt,ue,Ht,Ke;for(L=j(L),Yt=L.length,k=p,W=0,H=f,Q=0;Q<Yt;++Q)Et=L[Q],Et<128&&kt.push(R(Et));for(K=G=kt.length,G&&kt.push(_);K<Yt;){for(nt=a,Q=0;Q<Yt;++Q)Et=L[Q],Et>=k&&Et<nt&&(nt=Et);for(ue=K+1,nt-k>T((a-W)/ue)&&P("overflow"),W+=(nt-k)*ue,k=nt,Q=0;Q<Yt;++Q)if(Et=L[Q],Et<k&&++W>a&&P("overflow"),Et==k){for(xt=W,dt=l;Tt=dt<=H?h:dt>=H+c?c:dt-H,!(xt<Tt);dt+=l)Ke=xt-Tt,Ht=l-Tt,kt.push(R(m(Tt+Ke%Ht,0))),xt=T(Ke/Ht);kt.push(R(m(xt,0))),H=y(W,ue,K==G),W=0,++K}++W,++k}return kt.join("")}function I(L){return U(L,function(k){return x.test(k)?b(k.slice(4).toLowerCase()):k})}function A(L){return U(L,function(k){return v.test(k)?"xn--"+M(k):k})}if(o={version:"1.3.2",ucs2:{decode:j,encode:B},decode:b,encode:M,toASCII:A,toUnicode:I},n&&s)if(i.exports==n)s.exports=o;else for(C in o)o.hasOwnProperty(C)&&(n[C]=o[C]);else e.punycode=o})(ks)}(bl,bl.exports)),bl.exports}var cm={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var um;function mO(){return um||(um=1,function(i){(function(t,e){i.exports?i.exports=e():t.IPv6=e(t)})(ks,function(t){var e=t&&t.IPv6;function n(r){var o=r.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&a[c]!=="";c++);if(c<h)for(a.splice(c,1,"0000");a.length<h;)a.splice(c,0,"0000");for(var u,g=0;g<h;g++){u=a[g].split("");for(var f=0;f<3&&u[0]==="0"&&u.length>1;f++)u.splice(0,1);a[g]=u.join("")}var p=-1,_=0,x=0,v=-1,w=!1;for(g=0;g<h;g++)w?a[g]==="0"?x+=1:(w=!1,x>_&&(p=v,_=x)):a[g]==="0"&&(w=!0,v=g,x=1);x>_&&(p=v,_=x),_>1&&a.splice(p,_,""),l=a.length;var E="";for(a[0]===""&&(E=":"),g=0;g<l&&(E+=a[g],g!==l-1);g++)E+=":";return a[l-1]===""&&(E+=":"),E}function s(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:s}})}(cm)),cm.exports}var dm={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var gm;function _O(){return gm||(gm=1,function(i){(function(t,e){i.exports?i.exports=e():t.SecondLevelDomains=e(t)})(ks,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var o=s.lastIndexOf(".",r-1);if(o<=0||o>=r-1)return!1;var a=n.list[s.slice(r+1)];return a?a.indexOf(" "+s.slice(o+1,r)+" ")>=0:!1},is:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var o=s.lastIndexOf(".",r-1);if(o>=0)return!1;var a=n.list[s.slice(r+1)];return a?a.indexOf(" "+s.slice(0,r)+" ")>=0:!1},get:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return null;var o=s.lastIndexOf(".",r-1);if(o<=0||o>=r-1)return null;var a=n.list[s.slice(r+1)];return!a||a.indexOf(" "+s.slice(o+1,r)+" ")<0?null:s.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(dm)),dm.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(i){(function(t,e){i.exports?i.exports=e(pO(),mO(),_O()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(ks,function(t,e,n,s){var r=s&&s.URI;function o(d,m){var y=arguments.length>=1,b=arguments.length>=2;if(!(this instanceof o))return y?b?new o(d,m):new o(d):new o;if(d===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?d=location.href+"":d=""}if(d===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(d),m!==void 0?this.absoluteTo(m):this}function a(d){return/^[0-9]+$/.test(d)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function c(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(d){return d===void 0?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function g(d){return u(d)==="Array"}function f(d,m){var y={},b,M;if(u(m)==="RegExp")y=null;else if(g(m))for(b=0,M=m.length;b<M;b++)y[m[b]]=!0;else y[m]=!0;for(b=0,M=d.length;b<M;b++){var I=y&&y[d[b]]!==void 0||!y&&m.test(d[b]);I&&(d.splice(b,1),M--,b--)}return d}function p(d,m){var y,b;if(g(m)){for(y=0,b=m.length;y<b;y++)if(!p(d,m[y]))return!1;return!0}var M=u(m);for(y=0,b=d.length;y<b;y++)if(M==="RegExp"){if(typeof d[y]=="string"&&d[y].match(m))return!0}else if(d[y]===m)return!0;return!1}function _(d,m){if(!g(d)||!g(m)||d.length!==m.length)return!1;d.sort(),m.sort();for(var y=0,b=d.length;y<b;y++)if(d[y]!==m[y])return!1;return!0}function x(d){var m=/^\/+|\/+$/g;return d.replace(m,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(d){if(!(!d||!d.nodeName)){var m=d.nodeName.toLowerCase();if(!(m==="input"&&d.type!=="image"))return o.domAttributes[m]}};function v(d){return escape(d)}function w(d){return encodeURIComponent(d).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}o.encode=w,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=w,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(d,m){var y=o.encode(d+"");return m===void 0&&(m=o.escapeQuerySpace),m?y.replace(/%20/g,"+"):y},o.decodeQuery=function(d,m){d+="",m===void 0&&(m=o.escapeQuerySpace);try{return o.decode(m?d.replace(/\+/g,"%20"):d)}catch{return d}};var E={encode:"encode",decode:"decode"},S,T=function(d,m){return function(y){try{return o[m](y+"").replace(o.characters[d][m].expression,function(b){return o.characters[d][m].map[b]})}catch{return y}}};for(S in E)o[S+"PathSegment"]=T("pathname",E[S]),o[S+"UrnPathSegment"]=T("urnpath",E[S]);var R=function(d,m,y){return function(b){var M;y?M=function(k){return o[m](o[y](k))}:M=o[m];for(var I=(b+"").split(d),A=0,L=I.length;A<L;A++)I[A]=M(I[A]);return I.join(d)}};o.decodePath=R("/","decodePathSegment"),o.decodeUrnPath=R(":","decodeUrnPathSegment"),o.recodePath=R("/","encodePathSegment","decode"),o.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),o.encodeReserved=T("reserved","encode"),o.parse=function(d,m){var y;return m||(m={preventInvalidHostname:o.preventInvalidHostname}),d=d.replace(o.leading_whitespace_expression,""),d=d.replace(o.ascii_tab_whitespace,""),y=d.indexOf("#"),y>-1&&(m.fragment=d.substring(y+1)||null,d=d.substring(0,y)),y=d.indexOf("?"),y>-1&&(m.query=d.substring(y+1)||null,d=d.substring(0,y)),d=d.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),d=d.replace(/^[/\\]{2,}/i,"//"),d.substring(0,2)==="//"?(m.protocol=null,d=d.substring(2),d=o.parseAuthority(d,m)):(y=d.indexOf(":"),y>-1&&(m.protocol=d.substring(0,y)||null,m.protocol&&!m.protocol.match(o.protocol_expression)?m.protocol=void 0:d.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(d=d.substring(y+3),d=o.parseAuthority(d,m)):(d=d.substring(y+1),m.urn=!0))),m.path=d,m},o.parseHost=function(d,m){d||(d=""),d=d.replace(/\\/g,"/");var y=d.indexOf("/"),b,M;if(y===-1&&(y=d.length),d.charAt(0)==="[")b=d.indexOf("]"),m.hostname=d.substring(1,b)||null,m.port=d.substring(b+2,y)||null,m.port==="/"&&(m.port=null);else{var I=d.indexOf(":"),A=d.indexOf("/"),L=d.indexOf(":",I+1);L!==-1&&(A===-1||L<A)?(m.hostname=d.substring(0,y)||null,m.port=null):(M=d.substring(0,y).split(":"),m.hostname=M[0]||null,m.port=M[1]||null)}return m.hostname&&d.substring(y).charAt(0)!=="/"&&(y++,d="/"+d),m.preventInvalidHostname&&o.ensureValidHostname(m.hostname,m.protocol),m.port&&o.ensureValidPort(m.port),d.substring(y)||"/"},o.parseAuthority=function(d,m){return d=o.parseUserinfo(d,m),o.parseHost(d,m)},o.parseUserinfo=function(d,m){var y=d,b=d.indexOf("\\");b!==-1&&(d=d.replace(/\\/g,"/"));var M=d.indexOf("/"),I=d.lastIndexOf("@",M>-1?M:d.length-1),A;return I>-1&&(M===-1||I<M)?(A=d.substring(0,I).split(":"),m.username=A[0]?o.decode(A[0]):null,A.shift(),m.password=A[0]?o.decode(A.join(":")):null,d=y.substring(I+1)):(m.username=null,m.password=null),d},o.parseQuery=function(d,m){if(!d)return{};if(d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!d)return{};for(var y={},b=d.split("&"),M=b.length,I,A,L,k=0;k<M;k++)I=b[k].split("="),A=o.decodeQuery(I.shift(),m),L=I.length?o.decodeQuery(I.join("="),m):null,A!=="__proto__"&&(h.call(y,A)?((typeof y[A]=="string"||y[A]===null)&&(y[A]=[y[A]]),y[A].push(L)):y[A]=L);return y},o.build=function(d){var m="",y=!1;return d.protocol&&(m+=d.protocol+":"),!d.urn&&(m||d.hostname)&&(m+="//",y=!0),m+=o.buildAuthority(d)||"",typeof d.path=="string"&&(d.path.charAt(0)!=="/"&&y&&(m+="/"),m+=d.path),typeof d.query=="string"&&d.query&&(m+="?"+d.query),typeof d.fragment=="string"&&d.fragment&&(m+="#"+d.fragment),m},o.buildHost=function(d){var m="";if(d.hostname)o.ip6_expression.test(d.hostname)?m+="["+d.hostname+"]":m+=d.hostname;else return"";return d.port&&(m+=":"+d.port),m},o.buildAuthority=function(d){return o.buildUserinfo(d)+o.buildHost(d)},o.buildUserinfo=function(d){var m="";return d.username&&(m+=o.encode(d.username)),d.password&&(m+=":"+o.encode(d.password)),m&&(m+="@"),m},o.buildQuery=function(d,m,y){var b="",M,I,A,L;for(I in d)if(I!=="__proto__"&&h.call(d,I))if(g(d[I]))for(M={},A=0,L=d[I].length;A<L;A++)d[I][A]!==void 0&&M[d[I][A]+""]===void 0&&(b+="&"+o.buildQueryParameter(I,d[I][A],y),m!==!0&&(M[d[I][A]+""]=!0));else d[I]!==void 0&&(b+="&"+o.buildQueryParameter(I,d[I],y));return b.substring(1)},o.buildQueryParameter=function(d,m,y){return o.encodeQuery(d,y)+(m!==null?"="+o.encodeQuery(m,y):"")},o.addQuery=function(d,m,y){if(typeof m=="object")for(var b in m)h.call(m,b)&&o.addQuery(d,b,m[b]);else if(typeof m=="string"){if(d[m]===void 0){d[m]=y;return}else typeof d[m]=="string"&&(d[m]=[d[m]]);g(y)||(y=[y]),d[m]=(d[m]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(d,m,y){if(typeof m=="object")for(var b in m)h.call(m,b)&&o.setQuery(d,b,m[b]);else if(typeof m=="string")d[m]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(d,m,y){var b,M,I;if(g(m))for(b=0,M=m.length;b<M;b++)d[m[b]]=void 0;else if(u(m)==="RegExp")for(I in d)m.test(I)&&(d[I]=void 0);else if(typeof m=="object")for(I in m)h.call(m,I)&&o.removeQuery(d,I,m[I]);else if(typeof m=="string")y!==void 0?u(y)==="RegExp"?!g(d[m])&&y.test(d[m])?d[m]=void 0:d[m]=f(d[m],y):d[m]===String(y)&&(!g(y)||y.length===1)?d[m]=void 0:g(d[m])&&(d[m]=f(d[m],y)):d[m]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(d,m,y,b){switch(u(m)){case"String":break;case"RegExp":for(var M in d)if(h.call(d,M)&&m.test(M)&&(y===void 0||o.hasQuery(d,M,y)))return!0;return!1;case"Object":for(var I in m)if(h.call(m,I)&&!o.hasQuery(d,I,m[I]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(y)){case"Undefined":return m in d;case"Boolean":var A=!!(g(d[m])?d[m].length:d[m]);return y===A;case"Function":return!!y(d[m],m,d);case"Array":if(!g(d[m]))return!1;var L=b?p:_;return L(d[m],y);case"RegExp":return g(d[m])?b?p(d[m],y):!1:!!(d[m]&&d[m].match(y));case"Number":y=String(y);case"String":return g(d[m])?b?p(d[m],y):!1:d[m]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var d=[],m=[],y=0,b=0;b<arguments.length;b++){var M=new o(arguments[b]);d.push(M);for(var I=M.segment(),A=0;A<I.length;A++)typeof I[A]=="string"&&m.push(I[A]),I[A]&&y++}if(!m.length||!y)return new o("");var L=new o("").segment(m);return(d[0].path()===""||d[0].path().slice(0,1)==="/")&&L.path("/"+L.path()),L.normalize()},o.commonPath=function(d,m){var y=Math.min(d.length,m.length),b;for(b=0;b<y;b++)if(d.charAt(b)!==m.charAt(b)){b--;break}return b<1?d.charAt(0)===m.charAt(0)&&d.charAt(0)==="/"?"/":"":((d.charAt(b)!=="/"||m.charAt(b)!=="/")&&(b=d.substring(0,b).lastIndexOf("/")),d.substring(0,b+1))},o.withinString=function(d,m,y){y||(y={});var b=y.start||o.findUri.start,M=y.end||o.findUri.end,I=y.trim||o.findUri.trim,A=y.parens||o.findUri.parens,L=/[a-z0-9-]=["']?$/i;for(b.lastIndex=0;;){var k=b.exec(d);if(!k)break;var W=k.index;if(y.ignoreHtml){var K=d.slice(Math.max(W-3,0),W);if(K&&L.test(K))continue}for(var G=W+d.slice(W).search(M),H=d.slice(W,G),Q=-1;;){var nt=A.exec(H);if(!nt)break;var xt=nt.index+nt[0].length;Q=Math.max(Q,xt)}if(Q>-1?H=H.slice(0,Q)+H.slice(Q).replace(I,""):H=H.replace(I,""),!(H.length<=k[0].length)&&!(y.ignore&&y.ignore.test(H))){G=W+H.length;var dt=m(H,W,G,d);if(dt===void 0){b.lastIndex=G;continue}dt=String(dt),d=d.slice(0,W)+dt+d.slice(G),b.lastIndex=W+dt.length}}return b.lastIndex=0,d},o.ensureValidHostname=function(d,m){var y=!!d,b=!!m,M=!1;if(b&&(M=p(o.hostProtocols,m)),M&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+m);if(d&&d.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(d).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(d){if(d){var m=Number(d);if(!(a(m)&&m>0&&m<65536))throw new TypeError('Port "'+d+'" is not a valid port')}},o.noConflict=function(d){if(d){var m={URI:this.noConflict()};return s.URITemplate&&typeof s.URITemplate.noConflict=="function"&&(m.URITemplate=s.URITemplate.noConflict()),s.IPv6&&typeof s.IPv6.noConflict=="function"&&(m.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&typeof s.SecondLevelDomains.noConflict=="function"&&(m.SecondLevelDomains=s.SecondLevelDomains.noConflict()),m}else s.URI===this&&(s.URI=r);return this},l.build=function(d){return d===!0?this._deferred_build=!0:(d===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(d){return function(m,y){return m===void 0?this._parts[d]||"":(this._parts[d]=m||null,this.build(!y),this)}}function P(d,m){return function(y,b){return y===void 0?this._parts[d]||"":(y!==null&&(y=y+"",y.charAt(0)===m&&(y=y.substring(1))),this._parts[d]=y,this.build(!b),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=P("query","?"),l.fragment=P("fragment","#"),l.search=function(d,m){var y=this.query(d,m);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(d,m){var y=this.fragment(d,m);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(d,m){if(d===void 0||d===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return d?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=d?o.recodeUrnPath(d):"":this._parts.path=d?o.recodePath(d):"/",this.build(!m),this},l.path=l.pathname,l.href=function(d,m){var y;if(d===void 0)return this.toString();this._string="",this._parts=o._parts();var b=d instanceof o,M=typeof d=="object"&&(d.hostname||d.path||d.pathname);if(d.nodeName){var I=o.getDomAttribute(d);d=d[I]||"",M=!1}if(!b&&M&&d.pathname!==void 0&&(d=d.toString()),typeof d=="string"||d instanceof String)this._parts=o.parse(String(d),this._parts);else if(b||M){var A=b?d._parts:d;for(y in A)y!=="query"&&h.call(this._parts,y)&&(this._parts[y]=A[y]);A.query&&this.query(A.query,!1)}else throw new TypeError("invalid input");return this.build(!m),this},l.is=function(d){var m=!1,y=!1,b=!1,M=!1,I=!1,A=!1,L=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,y=o.ip4_expression.test(this._parts.hostname),b=o.ip6_expression.test(this._parts.hostname),m=y||b,M=!m,I=M&&n&&n.has(this._parts.hostname),A=M&&o.idn_expression.test(this._parts.hostname),L=M&&o.punycode_expression.test(this._parts.hostname)),d.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return M;case"sld":return I;case"ip":return m;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return b;case"idn":return A;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return L}return null};var N=l.protocol,U=l.port,j=l.hostname;l.protocol=function(d,m){if(d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(o.protocol_expression)))throw new TypeError('Protocol "'+d+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return N.call(this,d,m)},l.scheme=l.protocol,l.port=function(d,m){return this._parts.urn?d===void 0?"":this:(d!==void 0&&(d===0&&(d=null),d&&(d+="",d.charAt(0)===":"&&(d=d.substring(1)),o.ensureValidPort(d))),U.call(this,d,m))},l.hostname=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},b=o.parseHost(d,y);if(b!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');d=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(d,this._parts.protocol)}return j.call(this,d,m)},l.origin=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=this.protocol(),b=this.authority();return b?(y?y+"://":"")+this.authority():""}else{var M=o(d);return this.protocol(M.protocol()).authority(M.authority()).build(!m),this}},l.host=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.authority=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(d,this._parts);if(y!=="/")throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.userinfo=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return d[d.length-1]!=="@"&&(d+="@"),o.parseUserinfo(d,this._parts),this.build(!m),this},l.resource=function(d,m){var y;return d===void 0?this.path()+this.search()+this.hash():(y=o.parse(d),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!m),this)},l.subdomain=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var b=this._parts.hostname.length-this.domain().length,M=this._parts.hostname.substring(0,b),I=new RegExp("^"+c(M));if(d&&d.charAt(d.length-1)!=="."&&(d+="."),d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return d&&o.ensureValidHostname(d,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(I,d),this.build(!m),this}},l.domain=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(m=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var b=this._parts.hostname.length-this.tld(m).length-1;return b=this._parts.hostname.lastIndexOf(".",b-1)+1,this._parts.hostname.substring(b)||""}else{if(!d)throw new TypeError("cannot set domain empty");if(d.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(d,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=d;else{var M=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(M,d)}return this.build(!m),this}},l.tld=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d=="boolean"&&(m=d,d=void 0),d===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),b=this._parts.hostname.substring(y+1);return m!==!0&&n&&n.list[b.toLowerCase()]&&n.get(this._parts.hostname)||b}else{var M;if(d)if(d.match(/[^a-zA-Z0-9-]/))if(n&&n.is(d))M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d);else throw new TypeError('TLD "'+d+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");M=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(M,d)}else throw new TypeError("cannot set TLD empty");return this.build(!m),this}},l.directory=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,b=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return d?o.decodePath(b):b}else{var M=this._parts.path.length-this.filename().length,I=this._parts.path.substring(0,M),A=new RegExp("^"+c(I));return this.is("relative")||(d||(d="/"),d.charAt(0)!=="/"&&(d="/"+d)),d&&d.charAt(d.length-1)!=="/"&&(d+="/"),d=o.recodePath(d),this._parts.path=this._parts.path.replace(A,d),this.build(!m),this}},l.filename=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(typeof d!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),b=this._parts.path.substring(y+1);return d?o.decodePathSegment(b):b}else{var M=!1;d.charAt(0)==="/"&&(d=d.substring(1)),d.match(/\.?\//)&&(M=!0);var I=new RegExp(c(this.filename())+"$");return d=o.recodePath(d),this._parts.path=this._parts.path.replace(I,d),M?this.normalizePath(m):this.build(!m),this}},l.suffix=function(d,m){if(this._parts.urn)return d===void 0?"":this;if(d===void 0||d===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),b=y.lastIndexOf("."),M,I;return b===-1?"":(M=y.substring(b+1),I=/^[a-z0-9%]+$/i.test(M)?M:"",d?o.decodePathSegment(I):I)}else{d.charAt(0)==="."&&(d=d.substring(1));var A=this.suffix(),L;if(A)d?L=new RegExp(c(A)+"$"):L=new RegExp(c("."+A)+"$");else{if(!d)return this;this._parts.path+="."+o.recodePath(d)}return L&&(d=o.recodePath(d),this._parts.path=this._parts.path.replace(L,d)),this.build(!m),this}},l.segment=function(d,m,y){var b=this._parts.urn?":":"/",M=this.path(),I=M.substring(0,1)==="/",A=M.split(b);if(d!==void 0&&typeof d!="number"&&(y=m,m=d,d=void 0),d!==void 0&&typeof d!="number")throw new Error('Bad segment "'+d+'", must be 0-based integer');if(I&&A.shift(),d<0&&(d=Math.max(A.length+d,0)),m===void 0)return d===void 0?A:A[d];if(d===null||A[d]===void 0)if(g(m)){A=[];for(var L=0,k=m.length;L<k;L++)!m[L].length&&(!A.length||!A[A.length-1].length)||(A.length&&!A[A.length-1].length&&A.pop(),A.push(x(m[L])))}else(m||typeof m=="string")&&(m=x(m),A[A.length-1]===""?A[A.length-1]=m:A.push(m));else m?A[d]=x(m):A.splice(d,1);return I&&A.unshift(""),this.path(A.join(b),y)},l.segmentCoded=function(d,m,y){var b,M,I;if(typeof d!="number"&&(y=m,m=d,d=void 0),m===void 0){if(b=this.segment(d,m,y),!g(b))b=b!==void 0?o.decode(b):void 0;else for(M=0,I=b.length;M<I;M++)b[M]=o.decode(b[M]);return b}if(!g(m))m=typeof m=="string"||m instanceof String?o.encode(m):m;else for(M=0,I=m.length;M<I;M++)m[M]=o.encode(m[M]);return this.segment(d,m,y)};var B=l.query;return l.query=function(d,m){if(d===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),b=d.call(this,y);return this._parts.query=o.buildQuery(b||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this}else return d!==void 0&&typeof d!="string"?(this._parts.query=o.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this):B.call(this,d,m)},l.setQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof d=="string"||d instanceof String)b[d]=m!==void 0?m:null;else if(typeof d=="object")for(var M in d)h.call(d,M)&&(b[M]=d[M]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.addQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(b,d,m===void 0?null:m),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.removeQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(b,d,m),this._parts.query=o.buildQuery(b,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof d!="string"&&(y=m),this.build(!y),this},l.hasQuery=function(d,m,y){var b=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(b,d,m,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(d){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d)),this},l.normalizeHostname=function(d){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d)),this},l.normalizePort=function(d){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d)),this},l.normalizePath=function(d){var m=this._parts.path;if(!m)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!d),this;if(this._parts.path==="/")return this;m=o.recodePath(m);var y,b="",M,I;for(m.charAt(0)!=="/"&&(y=!0,m="/"+m),(m.slice(-3)==="/.."||m.slice(-2)==="/.")&&(m+="/"),m=m.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(b=m.substring(1).match(/^(\.\.\/)+/)||"",b&&(b=b[0]));M=m.search(/\/\.\.(\/|$)/),M!==-1;){if(M===0){m=m.substring(3);continue}I=m.substring(0,M).lastIndexOf("/"),I===-1&&(I=M),m=m.substring(0,I)+m.substring(M+3)}return y&&this.is("relative")&&(m=b+m.substring(1)),this._parts.path=m,this.build(!d),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(d){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d)),this},l.normalizeFragment=function(d){return this._parts.fragment||(this._parts.fragment=null,this.build(!d)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var d=o.encode,m=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=d,o.decode=m}return this},l.unicode=function(){var d=o.encode,m=o.decode;o.encode=w,o.decode=unescape;try{this.normalize()}finally{o.encode=d,o.decode=m}return this},l.readable=function(){var d=this.clone();d.username("").password("").normalize();var m="";if(d._parts.protocol&&(m+=d._parts.protocol+"://"),d._parts.hostname&&(d.is("punycode")&&t?(m+=t.toUnicode(d._parts.hostname),d._parts.port&&(m+=":"+d._parts.port)):m+=d.host()),d._parts.hostname&&d._parts.path&&d._parts.path.charAt(0)!=="/"&&(m+="/"),m+=d.path(!0),d._parts.query){for(var y="",b=0,M=d._parts.query.split("&"),I=M.length;b<I;b++){var A=(M[b]||"").split("=");y+="&"+o.decodeQuery(A[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),A[1]!==void 0&&(y+="="+o.decodeQuery(A[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}m+="?"+y.substring(1)}return m+=o.decodeQuery(d.hash(),!0),m},l.absoluteTo=function(d){var m=this.clone(),y=["protocol","username","password","hostname","port"],b,M,I;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d instanceof o||(d=new o(d)),m._parts.protocol||(m._parts.protocol=d._parts.protocol,this._parts.hostname))return m;for(M=0;I=y[M];M++)m._parts[I]=d._parts[I];return m._parts.path?(m._parts.path.substring(-2)===".."&&(m._parts.path+="/"),m.path().charAt(0)!=="/"&&(b=d.directory(),b=b||(d.path().indexOf("/")===0?"/":""),m._parts.path=(b?b+"/":"")+m._parts.path,m.normalizePath())):(m._parts.path=d._parts.path,m._parts.query||(m._parts.query=d._parts.query)),m.build(),m},l.relativeTo=function(d){var m=this.clone().normalize(),y,b,M,I,A;if(m._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(d=new o(d).normalize(),y=m._parts,b=d._parts,I=m.path(),A=d.path(),I.charAt(0)!=="/")throw new Error("URI is already relative");if(A.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===b.protocol&&(y.protocol=null),y.username!==b.username||y.password!==b.password||y.protocol!==null||y.username!==null||y.password!==null)return m.build();if(y.hostname===b.hostname&&y.port===b.port)y.hostname=null,y.port=null;else return m.build();if(I===A)return y.path="",m.build();if(M=o.commonPath(I,A),!M)return m.build();var L=b.path.substring(M.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=L+y.path.substring(M.length)||"./",m.build()},l.equals=function(d){var m=this.clone(),y=new o(d),b={},M={},I={},A,L,k;if(m.normalize(),y.normalize(),m.toString()===y.toString())return!0;if(A=m.query(),L=y.query(),m.query(""),y.query(""),m.toString()!==y.toString()||A.length!==L.length)return!1;b=o.parseQuery(A,this._parts.escapeQuerySpace),M=o.parseQuery(L,this._parts.escapeQuerySpace);for(k in b)if(h.call(b,k)){if(g(b[k])){if(!_(b[k],M[k]))return!1}else if(b[k]!==M[k])return!1;I[k]=!0}for(k in M)if(h.call(M,k)&&!I[k])return!1;return!0},l.preventInvalidHostname=function(d){return this._parts.preventInvalidHostname=!!d,this},l.duplicateQueryParameters=function(d){return this._parts.duplicateQueryParameters=!!d,this},l.escapeQuerySpace=function(d){return this._parts.escapeQuerySpace=!!d,this},o})})(p1);var yO=p1.exports;const Lu=eo(yO),fm=["http","https"];function xO(i){return typeof i=="string"&&i.startsWith("/vsi")&&!i.startsWith("/vsicurl/")}function vO(i,t,e=!0){return wO(i,t,!1,e)}function wO(i,t=null,e=!1,n=!0){typeof i=="string"&&i.startsWith("/vsicurl/")&&(i=i.replace(/^\/vsicurl\//,""));let s=Lu(i);if(t&&s.is("relative")&&!xO(i)){let r=Lu(t),o=r.path();!o.endsWith("/")&&!o.endsWith(".json")&&r.path(o+"/"),s=s.absoluteTo(r)}return s.normalize(),e&&(s.query(""),s.fragment("")),n?s.toString():s}const bO="application/geo+json",EO=["application/json",bO,"text/json"],pm=["image/gif","image/jpeg","image/apng","image/png","image/webp"],m1=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],_1=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(m1);function Ug(i,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof i>"u"?!0:typeof i!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(i.toLowerCase()))}function SO(i,t=!1){return Ug(i,EO,t)}class y1 extends Jh{constructor(t,e=null,n={},s=[]){super(t,n,["_context"].concat(s)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?vO(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string"||!t&&typeof this.type>"u")return!1;let e=new Lu(this.href),n=e.protocol().toLowerCase(),s=e.suffix().toLowerCase();return ai(n)&&!fm.includes(n)?!1:ai(this.type)&&pm.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ai(s)&&(s==="jpg"||pm.includes("image/"+s)))}isType(t){return ai(this.type)&&Ug(this.type,t)}isGeoTIFF(){return this.isType(_1)}isCOG(){return this.isType(m1)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ai(t)&&fm.includes(t)}}class Bg extends y1{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>ei(n)?new Bg(n,e):n):[]}}class x1 extends Jh{constructor(t,e=null,n={},s=[]){if(super(t,Object.assign({links:Bg.fromLinks},n),["_url"].concat(s)),!this._url&&(this._url=e,!this._url)){let r=this.getSelfLink();r&&(this._url=r.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>SO(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>ei(t)&&ai(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class v1 extends x1{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getAll(){return[]}}class cs extends y1{constructor(t,e=null,n=null){super(t,n,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return f1(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let n in e){let s=parseInt(n,10),r=e[s];ei(r)&&ai(r.common_name)&&r.common_name in t&&(t[r.common_name]={index:s,band:r})}return Object.values(t).every(n=>n!==null)?t:null}findBand(t,e="name",n=null){Array.isArray(t)||(t=[t]),ei(n)||(n=this.getBands());let s=n.findIndex(r=>ei(r)&&t.includes(r[e]));return s>=0?{index:s,band:n[s]}:null}getBand(t){return ei(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(t&&(ei(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),n(e))||ei(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),n(e))))return e;let s=this.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),n(e)))return e;let r=this.getMetadata("file:values");if(Array.isArray(r)&&(r.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),n(e)))return e;let o=ei(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=gO(o),e.maximum=fO(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")e=n;else{let s=this.getMetadata("classification:classes");Array.isArray(s)&&(e=s.filter(r=>!!r.nodata).map(r=>r.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!ai(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(ei(t))for(let s in t)n[s]=new cs(t[s],s,e);return n}}class Ua extends x1{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),t&&(n=n.filter(s=>s.canBrowserDisplayImage())),e&&n.length>1){let s=r=>Array.isArray(r.roles)&&r.roles.includes(e)||r.getKey()===e;n=n.filter(s).concat(n.filter(r=>!s(r)))}return n}getDefaultGeoTIFF(t=!0,e=!1){var n;return(n=this.rankGeoTIFFs(t,e)[0])==null?void 0:n.asset}rankGeoTIFFs(t=!0,e=!1,n=null,s=null){ei(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let r=[],o=this.getAssetsByTypes(_1);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(n);for(let l of o){let h=0;if(a.length>0){let c=a.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof s=="function"&&(h+=s(l)),r.push({asset:l,score:h})}return r.sort((l,h)=>h.score-l.score),r}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let s of n){let r=s.getBands();if(r.length!==1)continue;let o=s.findBand(e,"common_name",r);o&&(t[o.band.common_name]=s)}return Object.values(t).every(s=>s!==null)?t:null}getAsset(t){return ei(this.assets)&&this.assets[t]||null}getAssets(){return ei(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>Ug(e.type,t))}equals(t){return this===t?!0:!(t instanceof Ua)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}}class w1 extends Ua{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class TO extends w1{constructor(t,e=null){super(t,e)}}function Po(i){if(ai(i)&&i.length>=10)try{let t=i.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(e=>parseInt(e,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function MO(i,t){return new Date(i.valueOf()+(t-i)/2)}function b1(i){if(!Array.isArray(i)||i.length===0)return null;let t,e;const n=(s,r,o)=>typeof s>"u"?r:s===null||r===null?null:o(s,r);return i.forEach(([s,r])=>{t=n(t,s,Math.min),e=n(e,r,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}class E1 extends w1{constructor(t,e=null){const n={assets:cs.fromAssets,item_assets:cs.fromAssets};super(t,e,n)}toGeoJSON(){let t=u1(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&zi(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&zi(t[0])?t:t.length>1?t.filter((e,n)=>n>0&&zi(e)):[]}getRawBoundingBoxes(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.spatial)==null?void 0:e.bbox;return Array.isArray(n)&&n.length>0?n:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,e;let n=(e=(t=this.extent)==null?void 0:t.temporal)==null?void 0:e.interval;return Array.isArray(n)&&n.length>0?n.filter(s=>Array.isArray(s)&&(ai(s[0])||ai(s[1]))).map(s=>s.map(r=>Po(r))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),n=[t,e].filter(s=>Array.isArray(s));return n.length>=2?f1(...n):n.length===1?n[0]:[]}}class RO extends v1{constructor(t,e=null){const n={collections:s=>s.map(r=>new E1(r))};super(t,e,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return g1(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return b1(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}class S1 extends Ua{constructor(t,e=null){super(t,e,{assets:cs.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return zi(this.bbox)?this.bbox:null}getBoundingBoxes(){return zi(this.bbox)?[this.bbox]:[]}getDateTime(){let t=Po(this.properties.datetime);if(!t){let e=Po(this.properties.start_datetime),n=Po(this.properties.end_datetime);return e&&n?MO(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return ai(this.properties.start_datetime)||ai(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ai(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>Po(n)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class CO extends v1{constructor(t,e=null){const n={features:s=>s.map(r=>new S1(r))};super(t,e,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return g1(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return b1(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function IO(i,t=!0,e=!1){return t&&(i=uO.stac(i,e)),i.type==="Feature"?new S1(i):i.type==="FeatureCollection"?new CO(i):i.type==="Collection"||!i.type&&typeof i.extent<"u"&&typeof i.license<"u"?new E1(i):!i.type&&Array.isArray(i.collections)?new RO(i):new TO(i)}class mm extends fg{constructor(t){super({...t,state:"loading"}),ju(this,"loadImage",n=>new Promise((s,r)=>{const o=new Image;o.addEventListener("load",()=>s(o)),o.addEventListener("error",()=>r(new Error("load failed"))),o.src=n}));const e=new dg(t.url);e.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setLoader(async(s,r,o)=>{const a=await e.getZxy(s,r,o),l=URL.createObjectURL(new Blob([a.data])),h=await this.loadImage(l);return URL.revokeObjectURL(l),h}),this.setState("ready")})}}class PO extends Kh{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new s_}),ju(this,"tileLoadFunction",(e,n)=>{const s=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=n.match(s),o=+r[2],a=+r[3],l=+r[4];e.setLoader((h,c,u)=>{e.setState(q.LOADING),this.pmtiles_.getZxy(o,a,l).then(g=>{if(g){const f=e.getFormat();e.setFeatures(f.readFeatures(g.data,{extent:h,featureProjection:u})),e.setState(q.LOADED)}else e.setFeatures([]),e.setState(q.EMPTY)}).catch(g=>{e.setFeatures([]),e.setState(q.ERROR)})})}),this.pmtiles_=new dg(t.url),this.pmtiles_.getHeader().then(e=>{this.tileGrid.minZoom=e.minZoom,this.tileGrid.maxZoom=e.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let Wg=null;function AO(){return!!Wg}function T1(i){Wg=i;const t=Object.keys(i.defs),e=t.length;let n,s;for(n=0;n<e;++n){const r=t[n];if(!tt(r)){const o=i.defs(r);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),r0(new jr({code:r,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(n=0;n<e;++n){const r=t[n],o=tt(r);for(s=0;s<e;++s){const a=t[s],l=tt(a);if(!Jm(r,a))if(i.defs[r]===i.defs[a])Jc([o,l]);else{const h=i(r,a);bv(o,l,Ef(o,l,h.forward),Ef(l,o,h.inverse))}}}}let LO=async function(i){const t=await fetch(`https://epsg.io/${i}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};async function OO(i){typeof i=="string"&&(i=parseInt(i.split(":").pop(),10));const t=Wg;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const e="EPSG:"+i;return t.defs(e)||(t.defs(e,await LO(i)),T1(t)),tt(e)}const FO=new Ve({fill:new qi({color:"rgba(255,255,255,0.4)"}),stroke:new cn({color:"#3399CC",width:3})}),NO=new Ve({stroke:new cn({color:"#ff9933",width:1})});function kO(i,t){const e={url:i.getAbsoluteUrl()};let n=null;i.getBands().length===1&&(n=0);const{minimum:s,maximum:r}=i.getMinMaxValues(n);typeof s=="number"&&(e.min=s),typeof r=="number"&&(e.max=r);const o=i.getNoDataValues(n);return o.length>0&&(e.nodata=o[0]),t.length>0&&(e.bands=t),e}async function _m(i,t=void 0){let e=t;if(AO()){const n=i.getMetadata("proj:epsg");if(n)try{e=await OO(n)}catch{}}return e}function ym(i,t){const e=i.clone();return t.hasOnlyBounds()||e.setFill(null),e}function DO(i){let t=i.href;if(t.includes("{s}"))if(Array.isArray(i["href:servers"])&&i["href:servers"].length>0){const e=Math.random()*i["href:servers"].length|0;t=t.replace("{s}",i["href:servers"][e])}else return null;return t}async function GO(i){try{const t=new URL(i);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const e=await fetch(t);return new jd().read(await e.text())}catch{return null}}class qg extends zh{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>e[n]=t[n]),super(e),this.getSourceOptions_=t.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=t.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!t.displayGeoTiffByDefault,this.displayPreview_=!!t.displayPreview,this.displayOverview_=t.displayOverview!==!1,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||FO,this.collectionStyle_=t.collectionStyle||NO,this.boundsLayer_=null,t.data){try{this.configure_(t.data,t.url,t.assets,t.bands)}catch(n){this.handleError_(n)}return}if(!t.url)throw new Error("Either url or data must be provided");fetch(t.url).then(n=>n.json()).then(n=>this.configure_(n,t.url,t.assets,t.bands)).catch(n=>this.handleError_(n))}getBoundsLayer(){return this.boundsLayer_}handleError_(t){this.dispatchEvent(new iA(t))}configure_(t,e=null,n=null,s=[]){t instanceof cs||t instanceof Ua?this.data_=t:this.data_=IO(t),e&&e.includes("://")&&this.data_.setAbsoluteUrl(e),this.bands_=s,this.boundsLayer_=this.addFootprint_();const r=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(ym(this.boundsStyle_,this))};this.getLayers().on("add",r),this.getLayers().on("remove",r),this.setAssets(n).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const t=this.getData().getAll().map(e=>{const n=new qg({data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(n),n});return await Promise.all(t)}async addStacAssets_(){let t=this.getAssets();if(t===null){t=[];const n=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(n)t.push(n);else{const s=this.getData().getThumbnails();s.length>0&&t.push(s[0])}}const e=t.map(n=>this.addImagery_(n));return await Promise.all(e)}async addImagery_(t){if(t){if(t.isGeoTIFF())return await this.addGeoTiff_(t);if(t.canBrowserDisplayImage())return await this.addThumbnail_(t)}}async addThumbnail_(t){if(!this.displayPreview_)return;let e={url:t.getAbsoluteUrl(),projection:await _m(t,"EPSG:4326"),imageExtent:t.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(e=await this.getSourceOptions_(ie.ImageStatic,e,t));const n=new og({source:new Qy(e)});return this.addLayer_(n,t),n}async addWebMapLinks_(){const t=this.getWebMapLinks();if(t.length>0)return await this.addLayerForLink(t[0])}async addLayerForLink(t){const e=DO(t);if(!e)return;const n={attributions:t.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},s=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,t)),a),r=[];switch(t.rel){case"pmtiles":const o=await new dg(n.url).getHeader();let a;switch(o.tileType){case _r.Mvt:a=new PO(await s(ie.PMTilesVector,n));break;case _r.Avif:case _r.Jpeg:case _r.Png:case _r.Webp:a=new mm(await s(ie.PMTilesRaster,n));break;default:return}r.push(a);break;case"tilejson":r.push(new e1(await s(ie.TileJSON,n)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const c in t["wms:layers"]){const u=t["wms:layers"][c];let g;Array.isArray(t["wms:styles"])&&typeof t["wms:styles"][c]=="string"&&(g=t["wms:styles"][c]);const f=Object.assign({LAYERS:u,STYLES:g},t["wms:dimensions"]);typeof t["wms:transparent"]=="boolean"&&(f.TRANSPARENT=String(t["wms:transparent"])),typeof t.type=="string"&&t.type.startsWith("image/")&&(f.FORMAT=t.type);const p=await s(ie.TileWMS,Object.assign({},n,{params:f}));r.push(new r1(p))}break;case"wmts":const l=await GO(e);if(!l)return;const h=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const c of h){let u=Object.assign({},n,{layer:c});typeof t.type=="string"&&t.type.startsWith("image/")&&(u.format=t.type),u=await s(ie.WMTS,u),r.push(new o1(a1(l,u)))}break;case"xyz":r.push(new qs(await s(ie.XYZ,n)));break;default:return}return r.map(o=>{let a;return o instanceof Kh?a=new cy({source:o,declutter:!0}):o instanceof mm?a=new eh({source:o}):a=new Ql({source:o}),this.addLayer_(a,t),a})}async addGeoTiff_(t){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);let e={sources:[kO(t,this.bands_)]};const n=await _m(t);n&&(e.projection=n),this.getSourceOptions_&&(e=await this.getSourceOptions_(ie.GeoTIFF,e,t));const s=async(r,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(r));try{const r=new Ag(e),o=new eh({source:r});if(this.useTileLayerAsFallback_){const a=()=>s(t,o);r.on("error",a),r.on("tileloaderror",a),r.on("change",()=>{r.getState()==="error"&&s(t,o)}),o.on("error",a),await r.getView()}return this.addLayer_(o,t),o}catch(r){if(this.useTileLayerAsFallback_)return await s(t,null);this.handleError_(r)}}async addTileLayerForImagery_(t){let e={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(t)};this.getSourceOptions_&&(e=await this.getSourceOptions_(ie.XYZ,e,t));const n=new Ql({source:new qs(e)});return this.addLayer_(n,t),n}addLayer_(t,e,n=0){t.set("stac",e),t.setZIndex(n),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(e.isItemCollection()||e.isCollectionCollection()?t=u1(e.getBoundingBox()):t=e.toGeoJSON(),t){const n=new w0,s=new jh({format:n,loader:(o,a,l)=>{const h=n.readFeatures(t,{featureProjection:l});s.addFeatures(h)}}),r=new Vd({source:s,style:ym(this.boundsStyle_,this),visible:this.displayFootprint_});return r.set("bounds",!0),this.addLayer_(r,e,1),r}return null}async updateLayers_(){const t=this.getLayers();for(let n=t.getLength()-1;n>=0;n--){const s=t.item(n).get("stac");s&&(s.isLink()||s.isAsset())&&t.removeAt(n)}const e=this.getData();e.isItemCollection()||e.isCollectionCollection()?await this.addApiCollection_():(e.isItem()||e.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&(Array.isArray(this.displayWebMapLink_)||this.hasOnlyBounds())&&await this.addWebMapLinks_()}hasOnlyBounds(){const t=this.getBoundsLayer();return typeof this.getLayersArray().find(e=>e!==t)>"u"}getWebMapLinks(){let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let e=this.data_.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?e=this.displayWebMapLink_.map(n=>typeof n=="string"?e.find(s=>s.id===n)||null:n).filter(n=>!!n):e.sort((n,s)=>{const r=t.indexOf(n.rel),o=t.indexOf(s.rel);return r-o}),e}async setAssets(t){Array.isArray(t)?this.assets_=t.map(e=>typeof e=="string"?this.getData().getAsset(e):e instanceof cs?e:new cs(e)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const t=this.boundsLayer_.getMapInternal();if(!t)return;const e=t.getView();if(!e)return;const n=this.getData();if(!n)return;const s=n.getBoundingBox();if(s)return Ju(s,"EPSG:4326",e.getProjection())}}function jO(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var Xs=1,Zs=2,Nr=3,zO=4,Ou=5,xm=6378137,UO=6356752314e-3,vm=.0066943799901413165,Wo=484813681109536e-20,V=Math.PI/2,BO=.16666666666666666,WO=.04722222222222222,qO=.022156084656084655,J=1e-10,Pe=.017453292519943295,rn=57.29577951308232,Zt=Math.PI/4,pa=Math.PI*2,fe=3.14159265359,gi={};gi.greenwich=0;gi.lisbon=-9.131906111111;gi.paris=2.337229166667;gi.bogota=-74.080916666667;gi.madrid=-3.687938888889;gi.rome=12.452333333333;gi.bern=7.439583333333;gi.jakarta=106.807719444444;gi.ferro=-17.666666666667;gi.brussels=4.367975;gi.stockholm=18.058277777778;gi.athens=23.7163375;gi.oslo=10.722916666667;const XO={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var wm=/[\s_\-\/\(\)]/g;function ps(i,t){if(i[t])return i[t];for(var e=Object.keys(i),n=t.toLowerCase().replace(wm,""),s=-1,r,o;++s<e.length;)if(r=e[s],o=r.toLowerCase().replace(wm,""),o===n)return i[r]}function Fu(i){var t={},e=i.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),n,s,r,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*Pe},lat_1:function(a){t.lat1=a*Pe},lat_2:function(a){t.lat2=a*Pe},lat_ts:function(a){t.lat_ts=a*Pe},lon_0:function(a){t.long0=a*Pe},lon_1:function(a){t.long1=a*Pe},lon_2:function(a){t.long2=a*Pe},alpha:function(a){t.alpha=parseFloat(a)*Pe},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*Pe},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r:function(a){t.a=t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var l=ps(XO,a);l&&(t.to_meter=l.to_meter)},from_greenwich:function(a){t.from_greenwich=a*Pe},pm:function(a){var l=ps(gi,a);t.from_greenwich=(l||parseFloat(a))*Pe},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(n in e)s=e[n],n in o?(r=o[n],typeof r=="function"?r(s):t[r]=s):t[n]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var ma=1,M1=2,R1=3,rh=4,C1=5,Xg=-1,ZO=/\s/,$O=/[A-Za-z]/,VO=/[A-Za-z84_]/,tc=/[,\]]/,I1=/[\d\.E\-\+]/;function Xn(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=ma}Xn.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==rh)for(;ZO.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case ma:return this.neutral(i);case M1:return this.keyword(i);case rh:return this.quoted(i);case C1:return this.afterquote(i);case R1:return this.number(i);case Xg:return}};Xn.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=rh;return}if(tc.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};Xn.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=ma;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=ma,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Xg);return}};Xn.prototype.number=function(i){if(I1.test(i)){this.word+=i;return}if(tc.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};Xn.prototype.quoted=function(i){if(i==='"'){this.state=C1;return}this.word+=i};Xn.prototype.keyword=function(i){if(VO.test(i)){this.word+=i;return}if(i==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=ma;return}if(tc.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};Xn.prototype.neutral=function(i){if($O.test(i)){this.word=i,this.state=M1;return}if(i==='"'){this.word="",this.state=rh;return}if(I1.test(i)){this.word=i,this.state=R1;return}if(tc.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};Xn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Xg)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function YO(i){var t=new Xn(i);return t.output()}function bm(i,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:i,s=e.reduce(function(r,o){return Tr(o,r),r},n);t&&(i[t]=s)}function Tr(i,t){if(!Array.isArray(i)){t[i]=!0;return}var e=i.shift();if(e==="PARAMETER"&&(e=i.shift()),i.length===1){if(Array.isArray(i[0])){t[e]={},Tr(i[0],t[e]);return}t[e]=i[0];return}if(!i.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=i;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(i);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&Tr(i[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:i[0],a:i[1],rf:i[2]},i.length===4&&Tr(i[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":i[0]=["name",i[0]],bm(t,e,i);return;default:for(n=-1;++n<i.length;)if(!Array.isArray(i[n]))return Tr(i,t[e]);return bm(t,e,i)}}var HO=.017453292519943295;function KO(i,t){var e=t[0],n=t[1];!(e in i)&&n in i&&(i[e]=i[n],t.length===3&&(i[e]=t[2](i[e])))}function Qi(i){return i*HO}function QO(i){if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var t="",e=0,n=i.AXIS.length;e<n;++e){var s=[i.AXIS[e][0].toLowerCase(),i.AXIS[e][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?t+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?t+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?t+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(i.axis=t)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var r=i.GEOGCS;i.type==="GEOGCS"&&(r=i),r&&(r.DATUM?i.datumCode=r.DATUM.name.toLowerCase():i.datumCode=r.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),(i.datumCode==="new_zealand_geodetic_datum_1949"||i.datumCode==="new_zealand_1949")&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode.slice(-6)==="_ferro"&&(i.datumCode=i.datumCode.slice(0,-6)),i.datumCode.slice(-8)==="_jakarta"&&(i.datumCode=i.datumCode.slice(0,-8)),~i.datumCode.indexOf("belge")&&(i.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(i.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=r.DATUM.SPHEROID.a,i.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(i.datum_params=r.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a);function o(h){var c=i.to_meter||1;return h*c}var a=function(h){return KO(i,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Qi],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Qi],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Qi],["lat0","latitude_of_origin",Qi],["lat0","standard_parallel_1",Qi],["lat1","standard_parallel_1",Qi],["lat2","standard_parallel_2",Qi],["azimuth","Azimuth"],["alpha","azimuth",Qi],["srsCode","name"]];l.forEach(a),!i.long0&&i.longc&&(i.projName==="Albers_Conic_Equal_Area"||i.projName==="Lambert_Azimuthal_Equal_Area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(i.projName==="Stereographic_South_Pole"||i.projName==="Polar Stereographic (variant B)")?(i.lat0=Qi(i.lat1>0?90:-90),i.lat_ts=i.lat1):!i.lat_ts&&i.lat0&&i.projName==="Polar_Stereographic"&&(i.lat_ts=i.lat0,i.lat0=Qi(i.lat0>0?90:-90))}function P1(i){var t=YO(i),e=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",e]);var s={};return Tr(t,s),QO(s),s}function qe(i){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?qe[i]=Fu(arguments[1]):qe[i]=P1(arguments[1]):qe[i]=e}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(n){Array.isArray(n)?qe.apply(t,n):qe(n)});if(typeof i=="string"){if(i in qe)return qe[i]}else"EPSG"in i?qe["EPSG:"+i.EPSG]=i:"ESRI"in i?qe["ESRI:"+i.ESRI]=i:"IAU2000"in i?qe["IAU2000:"+i.IAU2000]=i:console.log(i);return}}jO(qe);function JO(i){return typeof i=="string"}function tF(i){return i in qe}var eF=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function iF(i){return eF.some(function(t){return i.indexOf(t)>-1})}var nF=["3857","900913","3785","102113"];function sF(i){var t=ps(i,"authority");if(t){var e=ps(t,"epsg");return e&&nF.indexOf(e)>-1}}function rF(i){var t=ps(i,"extension");if(t)return ps(t,"proj4")}function oF(i){return i[0]==="+"}function aF(i){if(JO(i)){if(tF(i))return qe[i];if(iF(i)){var t=P1(i);if(sF(t))return qe["EPSG:3857"];var e=rF(t);return e?Fu(e):t}if(oF(i))return Fu(i)}else return i}function Em(i,t){i=i||{};var e,n;if(!t)return i;for(n in t)e=t[n],e!==void 0&&(i[n]=e);return i}function dn(i,t,e){var n=i*t;return e/Math.sqrt(1-n*n)}function Ba(i){return i<0?-1:1}function it(i){return Math.abs(i)<=fe?i:i-Ba(i)*pa}function Ui(i,t,e){var n=i*e,s=.5*i;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(V-t))/n}function _a(i,t){for(var e=.5*i,n,s,r=V-2*Math.atan(t),o=0;o<=15;o++)if(n=i*Math.sin(r),s=V-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function lF(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function hF(i){var t=i.x,e=i.y;if(e*rn>90&&e*rn<-90&&t*rn>180&&t*rn<-180)return null;var n,s;if(Math.abs(Math.abs(e)-V)<=J)return null;if(this.sphere)n=this.x0+this.a*this.k0*it(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(Zt+.5*e));else{var r=Math.sin(e),o=Ui(this.e,e,r);n=this.x0+this.a*this.k0*it(t-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return i.x=n,i.y=s,i}function cF(i){var t=i.x-this.x0,e=i.y-this.y0,n,s;if(this.sphere)s=V-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var r=Math.exp(-e/(this.a*this.k0));if(s=_a(this.e,r),s===-9999)return null}return n=it(this.long0+t/(this.a*this.k0)),i.x=n,i.y=s,i}var uF=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const dF={init:lF,forward:hF,inverse:cF,names:uF};function gF(){}function Sm(i){return i}var fF=["longlat","identity"];const pF={init:gF,forward:Sm,inverse:Sm,names:fF};var mF=[dF,pF],El={},oh=[];function A1(i,t){var e=oh.length;return i.names?(oh[e]=i,i.names.forEach(function(n){El[n.toLowerCase()]=e}),this):(console.log(t),!0)}function _F(i){if(!i)return!1;var t=i.toLowerCase();if(typeof El[t]<"u"&&oh[El[t]])return oh[El[t]]}function yF(){mF.forEach(A1)}const xF={start:yF,add:A1,get:_F};var bt={};bt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};bt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};bt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};bt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};bt.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};bt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};bt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};bt.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};bt.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};bt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};bt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};bt.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};bt.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};bt.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};bt.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};bt.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};bt.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};bt.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};bt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};bt.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};bt.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};bt.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};bt.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};bt.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};bt.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};bt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};bt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};bt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};bt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};bt.hough={a:6378270,rf:297,ellipseName:"Hough"};bt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};bt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};bt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};bt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};bt.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};bt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};bt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};bt.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};bt.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};bt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};bt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};bt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var vF=bt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};bt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function wF(i,t,e,n){var s=i*i,r=t*t,o=(s-r)/s,a=0;n?(i*=1-o*(BO+o*(WO+o*qO)),s=i*i,o=0):a=Math.sqrt(o);var l=(s-r)/r;return{es:o,e:a,ep2:l}}function bF(i,t,e,n,s){if(!i){var r=ps(bt,n);r||(r=vF),i=r.a,t=r.b,e=r.rf}return e&&!t&&(t=(1-1/e)*i),(e===0||Math.abs(i-t)<J)&&(s=!0,t=i),{a:i,b:t,rf:e,sphere:s}}var Se={};Se.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Se.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Se.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Se.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Se.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Se.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Se.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Se.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Se.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Se.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Se.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Se.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Se.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Se.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Se.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Se.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Se.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Se.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function EF(i,t,e,n,s,r,o){var a={};return i===void 0||i==="none"?a.datum_type=Ou:a.datum_type=zO,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Xs),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Zs,a.datum_params[3]*=Wo,a.datum_params[4]*=Wo,a.datum_params[5]*=Wo,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=Nr,a.grids=o),a.a=e,a.b=n,a.es=s,a.ep2=r,a}var L1={};function SF(i,t){var e=new DataView(t),n=RF(e),s=CF(e,n),r=IF(e,s,n),o={header:s,subgrids:r};return L1[i]=o,o}function TF(i){if(i===void 0)return null;var t=i.split(",");return t.map(MF)}function MF(i){if(i.length===0)return null;var t=i[0]==="@";return t&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:i,mandatory:!t,grid:L1[i]||null,isNull:!1}}function Mr(i){return i/3600*Math.PI/180}function RF(i){var t=i.getInt32(8,!1);return t===11?!1:(t=i.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function CF(i,t){return{nFields:i.getInt32(8,t),nSubgridFields:i.getInt32(24,t),nSubgrids:i.getInt32(40,t),shiftType:Nu(i,56,64).trim(),fromSemiMajorAxis:i.getFloat64(120,t),fromSemiMinorAxis:i.getFloat64(136,t),toSemiMajorAxis:i.getFloat64(152,t),toSemiMinorAxis:i.getFloat64(168,t)}}function Nu(i,t,e){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(t,e)))}function IF(i,t,e){for(var n=176,s=[],r=0;r<t.nSubgrids;r++){var o=AF(i,n,e),a=LF(i,n,o,e),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[Mr(o.lowerLongitude),Mr(o.lowerLatitude)],del:[Mr(o.longitudeInterval),Mr(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:PF(a)}),n+=176+o.gridNodeCount*16}return s}function PF(i){return i.map(function(t){return[Mr(t.longitudeShift),Mr(t.latitudeShift)]})}function AF(i,t,e){return{name:Nu(i,t+8,t+16).trim(),parent:Nu(i,t+24,t+24+8).trim(),lowerLatitude:i.getFloat64(t+72,e),upperLatitude:i.getFloat64(t+88,e),lowerLongitude:i.getFloat64(t+104,e),upperLongitude:i.getFloat64(t+120,e),latitudeInterval:i.getFloat64(t+136,e),longitudeInterval:i.getFloat64(t+152,e),gridNodeCount:i.getInt32(t+168,e)}}function LF(i,t,e,n){for(var s=t+176,r=16,o=[],a=0;a<e.gridNodeCount;a++){var l={latitudeShift:i.getFloat32(s+a*r,n),longitudeShift:i.getFloat32(s+a*r+4,n),latitudeAccuracy:i.getFloat32(s+a*r+8,n),longitudeAccuracy:i.getFloat32(s+a*r+12,n)};o.push(l)}return o}function ln(i,t){if(!(this instanceof ln))return new ln(i);t=t||function(h){if(h)throw h};var e=aF(i);if(typeof e!="object"){t(i);return}var n=ln.projections.get(e.projName);if(!n){t(i);return}if(e.datumCode&&e.datumCode!=="none"){var s=ps(Se,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var r=bF(e.a,e.b,e.rf,e.ellps,e.sphere),o=wF(r.a,r.b,r.rf,e.R_A),a=TF(e.nadgrids),l=e.datum||EF(e.datumCode,e.datum_params,r.a,r.b,o.es,o.ep2,a);Em(this,e),Em(this,n),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),t(null,this)}ln.projections=xF;ln.projections.start();function OF(i,t){return i.datum_type!==t.datum_type||i.a!==t.a||Math.abs(i.es-t.es)>5e-11?!1:i.datum_type===Xs?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]:i.datum_type===Zs?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]&&i.datum_params[3]===t.datum_params[3]&&i.datum_params[4]===t.datum_params[4]&&i.datum_params[5]===t.datum_params[5]&&i.datum_params[6]===t.datum_params[6]:!0}function O1(i,t,e){var n=i.x,s=i.y,r=i.z?i.z:0,o,a,l,h;if(s<-V&&s>-1.001*V)s=-V;else if(s>V&&s<1.001*V)s=V;else{if(s<-V)return{x:-1/0,y:-1/0,z:i.z};if(s>V)return{x:1/0,y:1/0,z:i.z}}return n>Math.PI&&(n-=2*Math.PI),a=Math.sin(s),h=Math.cos(s),l=a*a,o=e/Math.sqrt(1-t*l),{x:(o+r)*h*Math.cos(n),y:(o+r)*h*Math.sin(n),z:(o*(1-t)+r)*a}}function F1(i,t,e,n){var s=1e-12,r=s*s,o=30,a,l,h,c,u,g,f,p,_,x,v,w,E,S=i.x,T=i.y,R=i.z?i.z:0,C,P,N;if(a=Math.sqrt(S*S+T*T),l=Math.sqrt(S*S+T*T+R*R),a/e<s){if(C=0,l/e<s)return P=V,N=-n,{x:i.x,y:i.y,z:i.z}}else C=Math.atan2(T,S);h=R/l,c=a/l,u=1/Math.sqrt(1-t*(2-t)*c*c),p=c*(1-t)*u,_=h*u,E=0;do E++,f=e/Math.sqrt(1-t*_*_),N=a*p+R*_-f*(1-t*_*_),g=t*f/(f+N),u=1/Math.sqrt(1-g*(2-g)*c*c),x=c*(1-g)*u,v=h*u,w=v*p-x*_,p=x,_=v;while(w*w>r&&E<o);return P=Math.atan(v/Math.abs(x)),{x:C,y:P,z:N}}function FF(i,t,e){if(t===Xs)return{x:i.x+e[0],y:i.y+e[1],z:i.z+e[2]};if(t===Zs){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6];return{x:h*(i.x-l*i.y+a*i.z)+n,y:h*(l*i.x+i.y-o*i.z)+s,z:h*(-a*i.x+o*i.y+i.z)+r}}}function NF(i,t,e){if(t===Xs)return{x:i.x-e[0],y:i.y-e[1],z:i.z-e[2]};if(t===Zs){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],h=e[6],c=(i.x-n)/h,u=(i.y-s)/h,g=(i.z-r)/h;return{x:c+l*u-a*g,y:-l*c+u+o*g,z:a*c-o*u+g}}}function fl(i){return i===Xs||i===Zs}function kF(i,t,e){if(OF(i,t)||i.datum_type===Ou||t.datum_type===Ou)return e;var n=i.a,s=i.es;if(i.datum_type===Nr){var r=Tm(i,!1,e);if(r!==0)return;n=xm,s=vm}var o=t.a,a=t.b,l=t.es;if(t.datum_type===Nr&&(o=xm,a=UO,l=vm),s===l&&n===o&&!fl(i.datum_type)&&!fl(t.datum_type))return e;if(e=O1(e,s,n),fl(i.datum_type)&&(e=FF(e,i.datum_type,i.datum_params)),fl(t.datum_type)&&(e=NF(e,t.datum_type,t.datum_params)),e=F1(e,l,o,a),t.datum_type===Nr){var h=Tm(t,!0,e);if(h!==0)return}return e}function Tm(i,t,e){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},r=[];t:for(var o=0;o<i.grids.length;o++){var a=i.grids[o];if(r.push(a.name),a.isNull){s=n;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],g=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,f=u.ll[0]-g,p=u.ll[1]-g,_=u.ll[0]+(u.lim[0]-1)*u.del[0]+g,x=u.ll[1]+(u.lim[1]-1)*u.del[1]+g;if(!(p>n.y||f>n.x||x<n.y||_<n.x)&&(s=DF(n,t,u),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*rn+" "+n.y*rn+" tried: '"+r+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function DF(i,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return n;var s={x:i.x,y:i.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=it(s.x-Math.PI)+Math.PI;var r=Mm(s,e);if(t){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var o=9,a=1e-12,l,h;do{if(h=Mm(r,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(h.x+r.x),y:s.y-(h.y+r.y)},r.x+=l.x,r.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=it(r.x+e.ll[0]),n.y=r.y+e.ll[1]}else isNaN(r.x)||(n.x=i.x+r.x,n.y=i.y+r.y);return n}function Mm(i,t){var e={x:i.x/t.del[0],y:i.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*n.x,y:e.y-1*n.y},r={x:Number.NaN,y:Number.NaN},o;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return r;o=n.y*t.lim[0]+n.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var h={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var c={x:t.cvs[o][0],y:t.cvs[o][1]},u=s.x*s.y,g=s.x*(1-s.y),f=(1-s.x)*(1-s.y),p=(1-s.x)*s.y;return r.x=f*a.x+g*l.x+p*c.x+u*h.x,r.y=f*a.y+g*l.y+p*c.y+u*h.y,r}function Rm(i,t,e){var n=e.x,s=e.y,r=e.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(o=n,"ew".indexOf(i.axis[l])!==-1?a="x":a="y"):l===1?(o=s,"ns".indexOf(i.axis[l])!==-1?a="y":a="x"):(o=r,a="z"),i.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":e[a]!==void 0&&(h.z=o);break;case"d":e[a]!==void 0&&(h.z=-o);break;default:return null}return h}function N1(i){var t={x:i[0],y:i[1]};return i.length>2&&(t.z=i[2]),i.length>3&&(t.m=i[3]),t}function GF(i){Cm(i.x),Cm(i.y)}function Cm(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function jF(i,t){return(i.datum.datum_type===Xs||i.datum.datum_type===Zs||i.datum.datum_type===Nr)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Xs||t.datum.datum_type===Zs||t.datum.datum_type===Nr)&&i.datumCode!=="WGS84"}function ah(i,t,e,n){var s;Array.isArray(e)?e=N1(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var r=e.z!==void 0;if(GF(e),i.datum&&t.datum&&jF(i,t)&&(s=new ln("WGS84"),e=ah(i,s,e,n),i=s),n&&i.axis!=="enu"&&(e=Rm(i,!1,e)),i.projName==="longlat")e={x:e.x*Pe,y:e.y*Pe,z:e.z||0};else if(i.to_meter&&(e={x:e.x*i.to_meter,y:e.y*i.to_meter,z:e.z||0}),e=i.inverse(e),!e)return;if(i.from_greenwich&&(e.x+=i.from_greenwich),e=kF(i.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*rn,y:e.y*rn,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?Rm(t,!0,e):(e&&!r&&delete e.z,e)}var Im=ln("WGS84");function qc(i,t,e,n){var s,r,o;return Array.isArray(e)?(s=ah(i,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.splice(3)):[s.x,s.y,e[2]].concat(e.splice(3)):[s.x,s.y].concat(e.splice(2)):[s.x,s.y]):(r=ah(i,t,e,n),o=Object.keys(e),o.length===2||o.forEach(function(a){if(typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;r[a]=e[a]}),r)}function Pm(i){return i instanceof ln?i:i.oProj?i.oProj:ln(i)}function vi(i,t,e){i=Pm(i);var n=!1,s;return typeof t>"u"?(t=i,i=Im,n=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=i,i=Im,n=!0),t=Pm(t),e?qc(i,t,e):(s={forward:function(r,o){return qc(i,t,r,o)},inverse:function(r,o){return qc(t,i,r,o)}},n&&(s.oProj=t),s)}var Am=6,k1="AJSAJS",D1="AFAFAF",Rr=65,Je=73,Ti=79,Ao=86,Lo=90;const zF={forward:G1,inverse:UF,toPoint:j1};function G1(i,t){return t=t||5,qF(BF({lat:i[1],lon:i[0]}),t)}function UF(i){var t=Zg(U1(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function j1(i){var t=Zg(U1(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Xc(i){return i*(Math.PI/180)}function Lm(i){return 180*(i/Math.PI)}function BF(i){var t=i.lat,e=i.lon,n=6378137,s=.00669438,r=.9996,o,a,l,h,c,u,g,f=Xc(t),p=Xc(e),_,x;x=Math.floor((e+180)/6)+1,e===180&&(x=60),t>=56&&t<64&&e>=3&&e<12&&(x=32),t>=72&&t<84&&(e>=0&&e<9?x=31:e>=9&&e<21?x=33:e>=21&&e<33?x=35:e>=33&&e<42&&(x=37)),o=(x-1)*6-180+3,_=Xc(o),a=s/(1-s),l=n/Math.sqrt(1-s*Math.sin(f)*Math.sin(f)),h=Math.tan(f)*Math.tan(f),c=a*Math.cos(f)*Math.cos(f),u=Math.cos(f)*(p-_),g=n*((1-s/4-3*s*s/64-5*s*s*s/256)*f-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*f)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*f)-35*s*s*s/3072*Math.sin(6*f));var v=r*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*a)*u*u*u*u*u/120)+5e5,w=r*(g+l*Math.tan(f)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*a)*u*u*u*u*u*u/720));return t<0&&(w+=1e7),{northing:Math.round(w),easting:Math.round(v),zoneNumber:x,zoneLetter:WF(t)}}function Zg(i){var t=i.northing,e=i.easting,n=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var r=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),c,u,g,f,p,_,x,v,w,E=e-5e5,S=t;n<"N"&&(S-=1e7),x=(s-1)*6-180+3,l=a/(1-a),_=S/r,v=_/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),w=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),c=o/Math.sqrt(1-a*Math.sin(w)*Math.sin(w)),u=Math.tan(w)*Math.tan(w),g=l*Math.cos(w)*Math.cos(w),f=o*(1-a)/Math.pow(1-a*Math.sin(w)*Math.sin(w),1.5),p=E/(c*r);var T=w-c*Math.tan(w)/f*(p*p/2-(5+3*u+10*g-4*g*g-9*l)*p*p*p*p/24+(61+90*u+298*g+45*u*u-252*l-3*g*g)*p*p*p*p*p*p/720);T=Lm(T);var R=(p-(1+2*u+g)*p*p*p/6+(5-2*g+28*u-3*g*g+8*l+24*u*u)*p*p*p*p*p/120)/Math.cos(w);R=x+Lm(R);var C;if(i.accuracy){var P=Zg({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});C={top:P.lat,right:P.lon,bottom:T,left:R}}else C={lat:T,lon:R};return C}function WF(i){var t="Z";return 84>=i&&i>=72?t="X":72>i&&i>=64?t="W":64>i&&i>=56?t="V":56>i&&i>=48?t="U":48>i&&i>=40?t="T":40>i&&i>=32?t="S":32>i&&i>=24?t="R":24>i&&i>=16?t="Q":16>i&&i>=8?t="P":8>i&&i>=0?t="N":0>i&&i>=-8?t="M":-8>i&&i>=-16?t="L":-16>i&&i>=-24?t="K":-24>i&&i>=-32?t="J":-32>i&&i>=-40?t="H":-40>i&&i>=-48?t="G":-48>i&&i>=-56?t="F":-56>i&&i>=-64?t="E":-64>i&&i>=-72?t="D":-72>i&&i>=-80&&(t="C"),t}function qF(i,t){var e="00000"+i.easting,n="00000"+i.northing;return i.zoneNumber+i.zoneLetter+XF(i.easting,i.northing,i.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function XF(i,t,e){var n=z1(e),s=Math.floor(i/1e5),r=Math.floor(t/1e5)%20;return ZF(s,r,n)}function z1(i){var t=i%Am;return t===0&&(t=Am),t}function ZF(i,t,e){var n=e-1,s=k1.charCodeAt(n),r=D1.charCodeAt(n),o=s+i-1,a=r+t,l=!1;o>Lo&&(o=o-Lo+Rr-1,l=!0),(o===Je||s<Je&&o>Je||(o>Je||s<Je)&&l)&&o++,(o===Ti||s<Ti&&o>Ti||(o>Ti||s<Ti)&&l)&&(o++,o===Je&&o++),o>Lo&&(o=o-Lo+Rr-1),a>Ao?(a=a-Ao+Rr-1,l=!0):l=!1,(a===Je||r<Je&&a>Je||(a>Je||r<Je)&&l)&&a++,(a===Ti||r<Ti&&a>Ti||(a>Ti||r<Ti)&&l)&&(a++,a===Je&&a++),a>Ao&&(a=a-Ao+Rr-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function U1(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var t=i.length,e=null,n="",s,r=0;!/[A-Z]/.test(s=i.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+i;n+=s,r++}var o=parseInt(n,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+i;var a=i.charAt(r++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+i;e=i.substring(r,r+=2);for(var l=z1(o),h=$F(e.charAt(0),l),c=VF(e.charAt(1),l);c<YF(a);)c+=2e6;var u=t-r;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var g=u/2,f=0,p=0,_,x,v,w,E;return g>0&&(_=1e5/Math.pow(10,g),x=i.substring(r,r+g),f=parseFloat(x)*_,v=i.substring(r+g),p=parseFloat(v)*_),w=f+h,E=p+c,{easting:w,northing:E,zoneLetter:a,zoneNumber:o,accuracy:_}}function $F(i,t){for(var e=k1.charCodeAt(t-1),n=1e5,s=!1;e!==i.charCodeAt(0);){if(e++,e===Je&&e++,e===Ti&&e++,e>Lo){if(s)throw"Bad character: "+i;e=Rr,s=!0}n+=1e5}return n}function VF(i,t){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var e=D1.charCodeAt(t-1),n=0,s=!1;e!==i.charCodeAt(0);){if(e++,e===Je&&e++,e===Ti&&e++,e>Ao){if(s)throw"Bad character: "+i;e=Rr,s=!0}n+=1e5}return n}function YF(i){var t;switch(i){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+i}function Yr(i,t,e){if(!(this instanceof Yr))return new Yr(i,t,e);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof t>"u"){var n=i.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=i,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Yr.fromMGRS=function(i){return new Yr(j1(i))};Yr.prototype.toMGRS=function(i){return G1([this.x,this.y],i)};var HF=1,KF=.25,Om=.046875,Fm=.01953125,Nm=.01068115234375,QF=.75,JF=.46875,t3=.013020833333333334,e3=.007120768229166667,i3=.3645833333333333,n3=.005696614583333333,s3=.3076171875;function B1(i){var t=[];t[0]=HF-i*(KF+i*(Om+i*(Fm+i*Nm))),t[1]=i*(QF-i*(Om+i*(Fm+i*Nm)));var e=i*i;return t[2]=e*(JF-i*(t3+i*e3)),e*=i,t[3]=e*(i3-i*n3),t[4]=e*i*s3,t}function ec(i,t,e,n){return e*=t,t*=t,n[0]*i-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var r3=20;function W1(i,t,e){for(var n=1/(1-t),s=i,r=r3;r;--r){var o=Math.sin(s),a=1-t*o*o;if(a=(ec(s,o,Math.cos(s),e)-i)*(a*Math.sqrt(a))*n,s-=a,Math.abs(a)<J)return s}return s}function o3(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=B1(this.es),this.ml0=ec(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function a3(i){var t=i.x,e=i.y,n=it(t-this.long0),s,r,o,a=Math.sin(e),l=Math.cos(e);if(this.es){var h=l*n,c=Math.pow(h,2),u=this.ep2*Math.pow(l,2),g=Math.pow(u,2),f=Math.abs(l)>J?Math.tan(e):0,p=Math.pow(f,2),_=Math.pow(p,2);s=1-this.es*Math.pow(a,2),h=h/Math.sqrt(s);var x=ec(e,a,l,this.en);r=this.a*(this.k0*h*(1+c/6*(1-p+u+c/20*(5-18*p+_+14*u-58*p*u+c/42*(61+179*_-_*p-479*p)))))+this.x0,o=this.a*(this.k0*(x-this.ml0+a*n*h/2*(1+c/12*(5-p+9*u+4*g+c/30*(61+_-58*p+270*u-330*p*u+c/56*(1385+543*_-_*p-3111*p))))))+this.y0}else{var v=l*Math.sin(n);if(Math.abs(Math.abs(v)-1)<J)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,o=l*Math.cos(n)/Math.sqrt(1-Math.pow(v,2)),v=Math.abs(o),v>=1){if(v-1>J)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return i.x=r,i.y=o,i}function l3(i){var t,e,n,s,r=(i.x-this.x0)*(1/this.a),o=(i.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=W1(t,this.es,this.en),Math.abs(e)<V){var a=Math.sin(e),l=Math.cos(e),h=Math.abs(l)>J?Math.tan(e):0,c=this.ep2*Math.pow(l,2),u=Math.pow(c,2),g=Math.pow(h,2),f=Math.pow(g,2);t=1-this.es*Math.pow(a,2);var p=r*Math.sqrt(t)/this.k0,_=Math.pow(p,2);t=t*h,n=e-t*_/(1-this.es)*.5*(1-_/12*(5+3*g-9*c*g+c-4*u-_/30*(61+90*g-252*c*g+45*f+46*c-_/56*(1385+3633*g+4095*f+1574*f*g)))),s=it(this.long0+p*(1-_/6*(1+2*g+c-_/20*(5+28*g+24*f+8*c*g+6*c-_/42*(61+662*g+1320*f+720*f*g))))/l)}else n=V*Ba(o),s=0;else{var x=Math.exp(r/this.k0),v=.5*(x-1/x),w=this.lat0+o/this.k0,E=Math.cos(w);t=Math.sqrt((1-Math.pow(E,2))/(1+Math.pow(v,2))),n=Math.asin(t),o<0&&(n=-n),v===0&&E===0?s=0:s=it(Math.atan2(v,E)+this.long0)}return i.x=s,i.y=n,i}var h3=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Sl={init:o3,forward:a3,inverse:l3,names:h3};function q1(i){var t=Math.exp(i);return t=(t-1/t)/2,t}function Mi(i,t){i=Math.abs(i),t=Math.abs(t);var e=Math.max(i,t),n=Math.min(i,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function c3(i){var t=1+i,e=t-1;return e===0?i:i*Math.log(t)/e}function u3(i){var t=Math.abs(i);return t=c3(t*(1+t/(Mi(1,t)+1))),i<0?-t:t}function $g(i,t){for(var e=2*Math.cos(2*t),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+e*s+i[n],r=s,s=o;return t+o*Math.sin(2*t)}function d3(i,t){for(var e=2*Math.cos(t),n=i.length-1,s=i[n],r=0,o;--n>=0;)o=-r+e*s+i[n],r=s,s=o;return Math.sin(t)*o}function g3(i){var t=Math.exp(i);return t=(t+1/t)/2,t}function X1(i,t,e){for(var n=Math.sin(t),s=Math.cos(t),r=q1(e),o=g3(e),a=2*s*o,l=-2*n*r,h=i.length-1,c=i[h],u=0,g=0,f=0,p,_;--h>=0;)p=g,_=u,g=c,u=f,c=-p+a*g-l*u+i[h],f=-_+l*g+a*u;return a=n*o,l=s*r,[a*c-l*f,a*f+l*c]}function f3(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Sl.init.apply(this),this.forward=Sl.forward,this.inverse=Sl.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),t=i/(2-i),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=$g(this.cbg,this.lat0);this.Zb=-this.Qn*(n+d3(this.gtu,2*n))}function p3(i){var t=it(i.x-this.long0),e=i.y;e=$g(this.cbg,e);var n=Math.sin(e),s=Math.cos(e),r=Math.sin(t),o=Math.cos(t);e=Math.atan2(n,o*s),t=Math.atan2(r*s,Mi(n,s*o)),t=u3(Math.tan(t));var a=X1(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),i.x=l,i.y=h,i}function m3(i){var t=(i.x-this.x0)*(1/this.a),e=(i.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,s;if(Math.abs(t)<=2.623395162778){var r=X1(this.utg,2*e,2*t);e=e+r[0],t=t+r[1],t=Math.atan(q1(t));var o=Math.sin(e),a=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(o*h,Mi(l,h*a)),t=Math.atan2(l,h*a),n=it(t+this.long0),s=$g(this.cgb,e)}else n=1/0,s=1/0;return i.x=n,i.y=s,i}var _3=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Tl={init:f3,forward:p3,inverse:m3,names:_3};function y3(i,t){if(i===void 0){if(i=Math.floor((it(t)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var x3="etmerc";function v3(){var i=y3(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*Pe,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Tl.init.apply(this),this.forward=Tl.forward,this.inverse=Tl.inverse}var w3=["Universal Transverse Mercator System","utm"];const b3={init:v3,names:w3,dependsOn:x3};function Vg(i,t){return Math.pow((1-i)/(1+i),t)}var E3=20;function S3(){var i=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Zt)/(Math.pow(Math.tan(.5*this.lat0+Zt),this.C)*Vg(this.e*i,this.ratexp))}function T3(i){var t=i.x,e=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Zt),this.C)*Vg(this.e*Math.sin(e),this.ratexp))-V,i.x=this.C*t,i}function M3(i){for(var t=1e-14,e=i.x/this.C,n=i.y,s=Math.pow(Math.tan(.5*n+Zt)/this.K,1/this.C),r=E3;r>0&&(n=2*Math.atan(s*Vg(this.e*Math.sin(i.y),-.5*this.e))-V,!(Math.abs(n-i.y)<t));--r)i.y=n;return r?(i.x=e,i.y=n,i):null}var R3=["gauss"];const Yg={init:S3,forward:T3,inverse:M3,names:R3};function C3(){Yg.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function I3(i){var t,e,n,s;return i.x=it(i.x-this.long0),Yg.forward.apply(this,[i]),t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),i.x=s*e*Math.sin(i.x),i.y=s*(this.cosc0*t-this.sinc0*e*n),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function P3(i){var t,e,n,s,r;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,r=Mi(i.x,i.y)){var o=2*Math.atan2(r,this.R2);t=Math.sin(o),e=Math.cos(o),s=Math.asin(e*this.sinc0+i.y*t*this.cosc0/r),n=Math.atan2(i.x*t,r*this.cosc0*e-i.y*this.sinc0*t)}else s=this.phic0,n=0;return i.x=n,i.y=s,Yg.inverse.apply(this,[i]),i.x=it(i.x+this.long0),i}var A3=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const L3={init:C3,forward:I3,inverse:P3,names:A3};function O3(i,t,e){return t*=e,Math.tan(.5*(V+i))*Math.pow((1-t)/(1+t),.5*e)}function F3(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&(this.k0=.5*(1+Ba(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=J&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=J&&Math.abs(Math.cos(this.lat_ts))>J&&(this.k0=.5*this.cons*dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ui(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=dn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-V,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function N3(i){var t=i.x,e=i.y,n=Math.sin(e),s=Math.cos(e),r,o,a,l,h,c,u=it(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=J&&Math.abs(e+this.lat0)<=J?(i.x=NaN,i.y=NaN,i):this.sphere?(r=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(u)),i.x=this.a*r*s*Math.sin(u)+this.x0,i.y=this.a*r*(this.coslat0*n-this.sinlat0*s*Math.cos(u))+this.y0,i):(o=2*Math.atan(this.ssfn_(e,n,this.e))-V,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=J?(h=Ui(this.e,e*this.con,this.con*n),c=2*this.a*this.k0*h/this.cons,i.x=this.x0+c*Math.sin(t-this.long0),i.y=this.y0-this.con*c*Math.cos(t-this.long0),i):(Math.abs(this.sinlat0)<J?(r=2*this.a*this.k0/(1+l*Math.cos(u)),i.y=r*a):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),i.y=r*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),i.x=r*l*Math.sin(u)+this.x0,i))}function k3(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,o=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=J?(i.x=t,i.y=e,i):(e=Math.asin(Math.cos(a)*this.sinlat0+i.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<J?this.lat0>0?t=it(this.long0+Math.atan2(i.x,-1*i.y)):t=it(this.long0+Math.atan2(i.x,i.y)):t=it(this.long0+Math.atan2(i.x*Math.sin(a),o*this.coslat0*Math.cos(a)-i.y*this.sinlat0*Math.sin(a))),i.x=t,i.y=e,i)}else if(Math.abs(this.coslat0)<=J){if(o<=J)return e=this.lat0,t=this.long0,i.x=t,i.y=e,i;i.x*=this.con,i.y*=this.con,n=o*this.cons/(2*this.a*this.k0),e=this.con*_a(this.e,n),t=this.con*it(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=J?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/o),t=it(this.long0+Math.atan2(i.x*Math.sin(s),o*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),e=-1*_a(this.e,Math.tan(.5*(V+r)));return i.x=t,i.y=e,i}var D3=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const G3={init:F3,forward:N3,inverse:k3,names:D3,ssfn_:O3};function j3(){var i=this.lat0;this.lambda0=this.long0;var t=Math.sin(i),e=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),o=this.e=Math.sqrt(r);this.R=this.k0*e*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+i/2)),h=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*l+this.alpha*o/2*h}function z3(i){var t=Math.log(Math.tan(Math.PI/4-i.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),n=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(i.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return i.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,i.x=this.R*o+this.x0,i}function U3(i){for(var t=i.x-this.x0,e=i.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,l=0,h=r,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=a,i.y=h,i}var B3=["somerc"];const W3={init:j3,forward:z3,inverse:U3,names:B3};var xr=1e-7;function q3(i){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof i.PROJECTION=="object"?Object.keys(i.PROJECTION)[0]:i.PROJECTION;return"no_uoff"in i||"no_off"in i||t.indexOf(e)!==-1}function X3(){var i,t,e,n,s,r,o,a,l,h,c=0,u,g=0,f=0,p=0,_=0,x=0,v=0;this.no_off=q3(this),this.no_rot="no_rot"in this;var w=!1;"alpha"in this&&(w=!0);var E=!1;if("rectified_grid_angle"in this&&(E=!0),w&&(v=this.alpha),E&&(c=this.rectified_grid_angle*Pe),w||E)g=this.longc;else if(f=this.long1,_=this.lat1,p=this.long2,x=this.lat2,Math.abs(_-x)<=xr||(i=Math.abs(_))<=xr||Math.abs(i-V)<=xr||Math.abs(Math.abs(this.lat0)-V)<=xr||Math.abs(Math.abs(x)-V)<=xr)throw new Error;var S=1-this.es;t=Math.sqrt(S),Math.abs(this.lat0)>J?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),i=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/S),this.A=this.B*this.k0*t/i,n=this.B*t/(e*Math.sqrt(i)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(Ui(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=s=1),w||E?(w?(u=Math.asin(Math.sin(v)/n),E||(c=v)):(u=c,v=Math.asin(n*Math.sin(u))),this.lam0=g-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(r=Math.pow(Ui(this.e,_,Math.sin(_)),this.B),o=Math.pow(Ui(this.e,x,Math.sin(x)),this.B),s=this.E/r,l=(o-r)/(o+r),h=this.E*this.E,h=(h-o*r)/(h+o*r),i=f-p,i<-Math.pi?p-=pa:i>Math.pi&&(p+=pa),this.lam0=it(.5*(f+p)-Math.atan(h*Math.tan(.5*this.B*(f-p))/l)/this.B),u=Math.atan(2*Math.sin(this.B*it(f-this.lam0))/(s-1/s)),c=v=Math.asin(n*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Zt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Zt+s))}function Z3(i){var t={},e,n,s,r,o,a,l,h;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-V)>J){if(o=this.E/Math.pow(Ui(this.e,i.y,Math.sin(i.y)),this.B),a=1/o,e=.5*(o-a),n=.5*(o+a),r=Math.sin(this.B*i.x),s=(e*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(s)-1)<J)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),a=Math.cos(this.B*i.x),Math.abs(a)<xr?l=this.A*i.x:l=this.ArB*Math.atan2(e*this.cosgam+r*this.singam,a)}else h=i.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*i.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function $3(i){var t,e,n,s,r,o,a,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(e=i.y,t=i.x):(e=i.x*this.cosrot-i.y*this.sinrot,t=i.y*this.cosrot+i.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),s=.5*(n-1/n),r=.5*(n+1/n),o=Math.sin(this.BrA*t),a=(o*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(a)-1)<J)l.x=0,l.y=a<0?-V:V;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=_a(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var V3=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Y3={init:X3,forward:Z3,inverse:$3,names:V3};function H3(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<J)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=dn(this.e,t,e),s=Ui(this.e,this.lat1,t),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=dn(this.e,r,o),l=Ui(this.e,this.lat2,r),h=Ui(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>J?this.ns=Math.log(n/a)/Math.log(s/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function K3(i){var t=i.x,e=i.y;Math.abs(2*Math.abs(e)-Math.PI)<=J&&(e=Ba(e)*(V-2*J));var n=Math.abs(Math.abs(e)-V),s,r;if(n>J)s=Ui(this.e,e,Math.sin(e)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(n=e*this.ns,n<=0)return null;r=0}var o=this.ns*it(t-this.long0);return i.x=this.k0*(r*Math.sin(o))+this.x0,i.y=this.k0*(this.rh-r*Math.cos(o))+this.y0,i}function Q3(i){var t,e,n,s,r,o=(i.x-this.x0)/this.k0,a=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),e=1):(t=-Math.sqrt(o*o+a*a),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*o,e*a)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),s=_a(this.e,n),s===-9999)return null}else s=-V;return r=it(l/this.ns+this.long0),i.x=r,i.y=s,i}var J3=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const tN={init:H3,forward:K3,inverse:Q3,names:J3};function eN(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function iN(i){var t,e,n,s,r,o,a,l=i.x,h=i.y,c=it(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),n=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),r=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(s)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=a*Math.cos(o)/1,i.x=a*Math.sin(o)/1,this.czech||(i.y*=-1,i.x*=-1),i}function nN(i){var t,e,n,s,r,o,a,l,h=i.x;i.x=i.y,i.y=h,this.czech||(i.y*=-1,i.x*=-1),o=Math.sqrt(i.x*i.x+i.y*i.y),r=Math.atan2(i.y,i.x),s=r/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),e=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(t)),i.x=this.long0-e/this.alfa,a=t,l=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-i.y)<1e-10&&(l=1),a=i.y,c+=1;while(l===0&&c<15);return c>=15?null:i}var sN=["Krovak","krovak"];const rN={init:eN,forward:iN,inverse:nN,names:sN};function $e(i,t,e,n,s){return i*s-t*Math.sin(2*s)+e*Math.sin(4*s)-n*Math.sin(6*s)}function Wa(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function qa(i){return .375*i*(1+.25*i*(1+.46875*i))}function Xa(i){return .05859375*i*i*(1+.75*i)}function Za(i){return i*i*i*(35/3072)}function Hr(i,t,e){var n=t*e;return i/Math.sqrt(1-n*n)}function uo(i){return Math.abs(i)<V?i:i-Ba(i)*Math.PI}function lh(i,t,e,n,s){var r,o;r=i/t;for(var a=0;a<15;a++)if(o=(i-(t*r-e*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(t-2*e*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function oN(){this.sphere||(this.e0=Wa(this.es),this.e1=qa(this.es),this.e2=Xa(this.es),this.e3=Za(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0))}function aN(i){var t,e,n=i.x,s=i.y;if(n=it(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),a=Hr(this.a,this.e,r),l=Math.tan(s)*Math.tan(s),h=n*Math.cos(s),c=h*h,u=this.es*o*o/(1-this.es),g=this.a*$e(this.e0,this.e1,this.e2,this.e3,s);t=a*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),e=g-this.ml0+a*r/o*c*(.5+(5-l+6*u)*c/24)}return i.x=t+this.x0,i.y=e+this.y0,i}function lN(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s;if(this.sphere){var r=e+this.lat0;n=Math.asin(Math.sin(r)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(r))}else{var o=this.ml0/this.a+e,a=lh(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-V)<=J)return i.x=this.long0,i.y=V,e<0&&(i.y*=-1),i;var l=Hr(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(a),2),u=t*this.a/l,g=u*u;n=a-l*Math.tan(a)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-g*(c/3+(1+3*c)*c*g/15))/Math.cos(a)}return i.x=it(s+this.long0),i.y=uo(n),i}var hN=["Cassini","Cassini_Soldner","cass"];const cN={init:oN,forward:aN,inverse:lN,names:hN};function us(i,t){var e;return i>1e-7?(e=i*t,(1-i*i)*(t/(1-e*e)-.5/i*Math.log((1-e)/(1+e)))):2*t}var uN=1,dN=2,gN=3,fN=4;function pN(){var i=Math.abs(this.lat0);if(Math.abs(i-V)<J?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(i)<J?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=us(this.e,1),this.mmf=.5/(1-this.es),this.apa=SN(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=us(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function mN(i){var t,e,n,s,r,o,a,l,h,c,u=i.x,g=i.y;if(u=it(u-this.long0),this.sphere){if(r=Math.sin(g),c=Math.cos(g),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+c*n:1+this.sinph0*r+this.cosph0*c*n,e<=J)return null;e=Math.sqrt(2/e),t=e*c*Math.sin(u),e*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(g+this.lat0)<J)return null;e=Zt-g*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=n}}else{switch(a=0,l=0,h=0,n=Math.cos(u),s=Math.sin(u),r=Math.sin(g),o=us(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=V+g,o=this.qp-o;break;case this.S_POLE:h=g-V,o=this.qp+o;break}if(Math.abs(h)<J)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*a-this.sinb1*l*n):e=(h=Math.sqrt(2/(1+l*n)))*a*this.ymf,t=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(h=Math.sqrt(o))*s,e=n*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return i.x=this.a*t+this.x0,i.y=this.a*e+this.y0,i}function _N(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s,r,o,a,l,h;if(this.sphere){var c=0,u,g=0;if(u=Math.sqrt(t*t+e*e),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(g=Math.sin(s),c=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=J?0:Math.asin(e*g/u),t*=g,e=c*u;break;case this.OBLIQ:s=Math.abs(u)<=J?this.lat0:Math.asin(c*this.sinph0+e*g*this.cosph0/u),t*=g*this.cosph0,e=(c-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:e=-e,s=V-s;break;case this.S_POLE:s-=V;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<J)return i.x=this.long0,i.y=this.lat0,i;o=2*Math.asin(.5*l/this.rq),r=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(h=r*this.sinb1+e*o*this.cosb1/l,a=this.qp*h,e=l*this.cosb1*r-e*this.sinb1*o):(h=e*o/l,a=this.qp*h,e=l*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return i.x=this.long0,i.y=this.lat0,i;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}n=Math.atan2(t,e),s=TN(Math.asin(h),this.apa)}return i.x=it(this.long0+n),i.y=s,i}var yN=.3333333333333333,xN=.17222222222222222,vN=.10257936507936508,wN=.06388888888888888,bN=.0664021164021164,EN=.016415012942191543;function SN(i){var t,e=[];return e[0]=i*yN,t=i*i,e[0]+=t*xN,e[1]=t*wN,t*=i,e[0]+=t*vN,e[1]+=t*bN,e[2]=t*EN,e}function TN(i,t){var e=i+i;return i+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var MN=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const RN={init:pN,forward:mN,inverse:_N,names:MN,S_POLE:uN,N_POLE:dN,EQUIT:gN,OBLIQ:fN};function ms(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function CN(){Math.abs(this.lat1+this.lat2)<J||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=dn(this.e3,this.sin_po,this.cos_po),this.qs1=us(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=dn(this.e3,this.sin_po,this.cos_po),this.qs2=us(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=us(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>J?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function IN(i){var t=i.x,e=i.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=us(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*it(t-this.long0),o=s*Math.sin(r)+this.x0,a=this.rh-s*Math.cos(r)+this.y0;return i.x=o,i.y=a,i}function PN(i){var t,e,n,s,r,o;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),n=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),n=-1),s=0,t!==0&&(s=Math.atan2(n*i.x,n*i.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,e)),r=it(s/this.ns0+this.long0),i.x=r,i.y=o,i}function AN(i,t){var e,n,s,r,o,a=ms(.5*t);if(i<J)return a;for(var l=i*i,h=1;h<=25;h++)if(e=Math.sin(a),n=Math.cos(a),s=i*e,r=1-s*s,o=.5*r*r/n*(t/(1-l)-e/r+.5/i*Math.log((1-s)/(1+s))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var LN=["Albers_Conic_Equal_Area","Albers","aea"];const ON={init:CN,forward:IN,inverse:PN,names:LN,phi1z:AN};function FN(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function NN(i){var t,e,n,s,r,o,a,l,h=i.x,c=i.y;return n=it(h-this.long0),t=Math.sin(c),e=Math.cos(c),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*s,r=1,o>0||Math.abs(o)<=J?(a=this.x0+this.a*r*e*Math.sin(n)/o,l=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)/o):(a=this.x0+this.infinity_dist*e*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),i.x=a,i.y=l,i}function kN(i){var t,e,n,s,r,o;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(t=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),n=Math.cos(s),o=ms(n*this.sin_p14+i.y*e*this.cos_p14/t),r=Math.atan2(i.x*e,t*this.cos_p14*n-i.y*this.sin_p14*e),r=it(this.long0+r)):(o=this.phic0,r=0),i.x=r,i.y=o,i}var DN=["gnom"];const GN={init:FN,forward:NN,inverse:kN,names:DN};function jN(i,t){var e=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*V:V;for(var n=Math.asin(.5*t),s,r,o,a,l=0;l<30;l++)if(r=Math.sin(n),o=Math.cos(n),a=i*r,s=Math.pow(1-a*a,2)/(2*o)*(t/(1-i*i)-r/(1-a*a)+.5/i*Math.log((1-a)/(1+a))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function zN(){this.sphere||(this.k0=dn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function UN(i){var t=i.x,e=i.y,n,s,r=it(t-this.long0);if(this.sphere)n=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=us(this.e,Math.sin(e));n=this.x0+this.a*this.k0*r,s=this.y0+this.a*o*.5/this.k0}return i.x=n,i.y=s,i}function BN(i){i.x-=this.x0,i.y-=this.y0;var t,e;return this.sphere?(t=it(this.long0+i.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(e=jN(this.e,2*i.y*this.k0/this.a),t=it(this.long0+i.x/(this.a*this.k0))),i.x=t,i.y=e,i}var WN=["cea"];const qN={init:zN,forward:UN,inverse:BN,names:WN};function XN(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function ZN(i){var t=i.x,e=i.y,n=it(t-this.long0),s=uo(e-this.lat0);return i.x=this.x0+this.a*n*this.rc,i.y=this.y0+this.a*s,i}function $N(i){var t=i.x,e=i.y;return i.x=it(this.long0+(t-this.x0)/(this.a*this.rc)),i.y=uo(this.lat0+(e-this.y0)/this.a),i}var VN=["Equirectangular","Equidistant_Cylindrical","eqc"];const YN={init:XN,forward:ZN,inverse:$N,names:VN};var km=20;function HN(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wa(this.es),this.e1=qa(this.es),this.e2=Xa(this.es),this.e3=Za(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0)}function KN(i){var t=i.x,e=i.y,n,s,r,o=it(t-this.long0);if(r=o*Math.sin(e),this.sphere)Math.abs(e)<=J?(n=this.a*o,s=-1*this.a*this.lat0):(n=this.a*Math.sin(r)/Math.tan(e),s=this.a*(uo(e-this.lat0)+(1-Math.cos(r))/Math.tan(e)));else if(Math.abs(e)<=J)n=this.a*o,s=-1*this.ml0;else{var a=Hr(this.a,this.e,Math.sin(e))/Math.tan(e);n=a*Math.sin(r),s=this.a*$e(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(r))}return i.x=n+this.x0,i.y=s+this.y0,i}function QN(i){var t,e,n,s,r,o,a,l,h;if(n=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=J)t=it(n/this.a+this.long0),e=0;else{o=this.lat0+s/this.a,a=n*n/this.a/this.a+o*o,l=o;var c;for(r=km;r;--r)if(c=Math.tan(l),h=-1*(o*(l*c+1)-l-.5*(l*l+a)*c)/((l-o)/c-1),l+=h,Math.abs(h)<=J){e=l;break}t=it(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(s+this.ml0)<=J)e=0,t=it(this.long0+n/this.a);else{o=(this.ml0+s)/this.a,a=n*n/this.a/this.a+o*o,l=o;var u,g,f,p,_;for(r=km;r;--r)if(_=this.e*Math.sin(l),u=Math.sqrt(1-_*_)*Math.tan(l),g=this.a*$e(this.e0,this.e1,this.e2,this.e3,l),f=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),p=g/this.a,h=(o*(u*p+1)-p-.5*u*(p*p+a))/(this.es*Math.sin(2*l)*(p*p+a-2*o*p)/(4*u)+(o-p)*(u*f-2/Math.sin(2*l))-f),l-=h,Math.abs(h)<=J){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=it(this.long0+Math.asin(n*u/this.a)/Math.sin(e))}return i.x=t,i.y=e,i}var JN=["Polyconic","poly"];const tk={init:HN,forward:KN,inverse:QN,names:JN};function ek(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function ik(i){var t,e=i.x,n=i.y,s=n-this.lat0,r=e-this.long0,o=s/Wo*1e-5,a=r,l=1,h=0;for(t=1;t<=10;t++)l=l*o,h=h+this.A[t]*l;var c=h,u=a,g=1,f=0,p,_,x=0,v=0;for(t=1;t<=6;t++)p=g*c-f*u,_=f*c+g*u,g=p,f=_,x=x+this.B_re[t]*g-this.B_im[t]*f,v=v+this.B_im[t]*g+this.B_re[t]*f;return i.x=v*this.a+this.x0,i.y=x*this.a+this.y0,i}function nk(i){var t,e=i.x,n=i.y,s=e-this.x0,r=n-this.y0,o=r/this.a,a=s/this.a,l=1,h=0,c,u,g=0,f=0;for(t=1;t<=6;t++)c=l*o-h*a,u=h*o+l*a,l=c,h=u,g=g+this.C_re[t]*l-this.C_im[t]*h,f=f+this.C_im[t]*l+this.C_re[t]*h;for(var p=0;p<this.iterations;p++){var _=g,x=f,v,w,E=o,S=a;for(t=2;t<=6;t++)v=_*g-x*f,w=x*g+_*f,_=v,x=w,E=E+(t-1)*(this.B_re[t]*_-this.B_im[t]*x),S=S+(t-1)*(this.B_im[t]*_+this.B_re[t]*x);_=1,x=0;var T=this.B_re[1],R=this.B_im[1];for(t=2;t<=6;t++)v=_*g-x*f,w=x*g+_*f,_=v,x=w,T=T+t*(this.B_re[t]*_-this.B_im[t]*x),R=R+t*(this.B_im[t]*_+this.B_re[t]*x);var C=T*T+R*R;g=(E*T+S*R)/C,f=(S*T-E*R)/C}var P=g,N=f,U=1,j=0;for(t=1;t<=9;t++)U=U*P,j=j+this.D[t]*U;var B=this.lat0+j*Wo*1e5,d=this.long0+N;return i.x=d,i.y=B,i}var sk=["New_Zealand_Map_Grid","nzmg"];const rk={init:ek,forward:ik,inverse:nk,names:sk};function ok(){}function ak(i){var t=i.x,e=i.y,n=it(t-this.long0),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return i.x=s,i.y=r,i}function lk(i){i.x-=this.x0,i.y-=this.y0;var t=it(this.long0+i.x/this.a),e=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=t,i.y=e,i}var hk=["Miller_Cylindrical","mill"];const ck={init:ok,forward:ak,inverse:lk,names:hk};var uk=20;function dk(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=B1(this.es)}function gk(i){var t,e,n=i.x,s=i.y;if(n=it(n-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),o=uk;o;--o){var a=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<J)break}t=this.a*this.C_x*n*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);e=this.a*ec(s,l,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*l*l)}return i.x=t,i.y=e,i}function fk(i){var t,e,n,s;return i.x-=this.x0,n=i.x/this.a,i.y-=this.y0,t=i.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=ms((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=ms(Math.sin(t)/this.n)),n=it(n+this.long0),t=uo(t)):(t=W1(i.y/this.a,this.es,this.en),s=Math.abs(t),s<V?(s=Math.sin(t),e=this.long0+i.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),n=it(e)):s-J<V&&(n=this.long0)),i.x=n,i.y=t,i}var pk=["Sinusoidal","sinu"];const mk={init:dk,forward:gk,inverse:fk,names:pk};function _k(){}function yk(i){for(var t=i.x,e=i.y,n=it(t-this.long0),s=e,r=Math.PI*Math.sin(e);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<J)break}s/=2,Math.PI/2-Math.abs(e)<J&&(n=0);var a=.900316316158*this.a*n*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=a,i.y=l,i}function xk(i){var t,e;i.x-=this.x0,i.y-=this.y0,e=i.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=it(this.long0+i.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return i.x=n,i.y=s,i}var vk=["Mollweide","moll"];const wk={init:_k,forward:yk,inverse:xk,names:vk};function bk(){Math.abs(this.lat1+this.lat2)<J||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wa(this.es),this.e1=qa(this.es),this.e2=Xa(this.es),this.e3=Za(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=dn(this.e,this.sinphi,this.cosphi),this.ml1=$e(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<J?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=dn(this.e,this.sinphi,this.cosphi),this.ml2=$e(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=$e(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Ek(i){var t=i.x,e=i.y,n;if(this.sphere)n=this.a*(this.g-e);else{var s=$e(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-s)}var r=this.ns*it(t-this.long0),o=this.x0+n*Math.sin(r),a=this.y0+this.rh-n*Math.cos(r);return i.x=o,i.y=a,i}function Sk(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var t,e,n,s;this.ns>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),t=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),t=-1);var r=0;if(e!==0&&(r=Math.atan2(t*i.x,t*i.y)),this.sphere)return s=it(this.long0+r/this.ns),n=uo(this.g-e/this.a),i.x=s,i.y=n,i;var o=this.g-e/this.a;return n=lh(o,this.e0,this.e1,this.e2,this.e3),s=it(this.long0+r/this.ns),i.x=s,i.y=n,i}var Tk=["Equidistant_Conic","eqdc"];const Mk={init:bk,forward:Ek,inverse:Sk,names:Tk};function Rk(){this.R=this.a}function Ck(i){var t=i.x,e=i.y,n=it(t-this.long0),s,r;Math.abs(e)<=J&&(s=this.x0+this.R*n,r=this.y0);var o=ms(2*Math.abs(e/Math.PI));(Math.abs(n)<=J||Math.abs(Math.abs(e)-V)<=J)&&(s=this.x0,e>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*o):r=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/n-n/Math.PI),l=a*a,h=Math.sin(o),c=Math.cos(o),u=c/(h+c-1),g=u*u,f=u*(2/h-1),p=f*f,_=Math.PI*this.R*(a*(u-p)+Math.sqrt(l*(u-p)*(u-p)-(p+l)*(g-p)))/(p+l);n<0&&(_=-_),s=this.x0+_;var x=l+u;return _=Math.PI*this.R*(f*x-a*Math.sqrt((p+l)*(l+1)-x*x))/(p+l),e>=0?r=this.y0+_:r=this.y0-_,i.x=s,i.y=r,i}function Ik(i){var t,e,n,s,r,o,a,l,h,c,u,g,f;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,n=i.x/u,s=i.y/u,r=n*n+s*s,o=-Math.abs(s)*(1+r),a=o-2*s*s+n*n,l=-2*o+1+2*s*s+r*r,f=s*s/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,c=2*Math.sqrt(-h/3),u=3*f/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),g=Math.acos(u)/3,i.y>=0?e=(-c*Math.cos(g+Math.PI/3)-a/3/l)*Math.PI:e=-(-c*Math.cos(g+Math.PI/3)-a/3/l)*Math.PI,Math.abs(n)<J?t=this.long0:t=it(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n),i.x=t,i.y=e,i}var Pk=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Ak={init:Rk,forward:Ck,inverse:Ik,names:Pk};function Lk(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Ok(i){var t=i.x,e=i.y,n=Math.sin(i.y),s=Math.cos(i.y),r=it(t-this.long0),o,a,l,h,c,u,g,f,p,_,x,v,w,E,S,T,R,C,P,N,U,j,B;return this.sphere?Math.abs(this.sin_p12-1)<=J?(i.x=this.x0+this.a*(V-e)*Math.sin(r),i.y=this.y0-this.a*(V-e)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=J?(i.x=this.x0+this.a*(V+e)*Math.sin(r),i.y=this.y0+this.a*(V+e)*Math.cos(r),i):(C=this.sin_p12*n+this.cos_p12*s*Math.cos(r),T=Math.acos(C),R=T?T/Math.sin(T):1,i.x=this.x0+this.a*R*s*Math.sin(r),i.y=this.y0+this.a*R*(this.cos_p12*n-this.sin_p12*s*Math.cos(r)),i):(o=Wa(this.es),a=qa(this.es),l=Xa(this.es),h=Za(this.es),Math.abs(this.sin_p12-1)<=J?(c=this.a*$e(o,a,l,h,V),u=this.a*$e(o,a,l,h,e),i.x=this.x0+(c-u)*Math.sin(r),i.y=this.y0-(c-u)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=J?(c=this.a*$e(o,a,l,h,V),u=this.a*$e(o,a,l,h,e),i.x=this.x0+(c+u)*Math.sin(r),i.y=this.y0+(c+u)*Math.cos(r),i):(g=n/s,f=Hr(this.a,this.e,this.sin_p12),p=Hr(this.a,this.e,n),_=Math.atan((1-this.es)*g+this.es*f*this.sin_p12/(p*s)),x=Math.atan2(Math.sin(r),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(r)),x===0?P=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(x)-Math.PI)<=J?P=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):P=Math.asin(Math.sin(r)*Math.cos(_)/Math.sin(x)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),w=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),E=v*w,S=w*w,N=P*P,U=N*P,j=U*P,B=j*P,T=f*P*(1-N*S*(1-S)/6+U/8*E*(1-2*S)+j/120*(S*(4-7*S)-3*v*v*(1-7*S))-B/48*E),i.x=this.x0+T*Math.sin(x),i.y=this.y0+T*Math.cos(x),i))}function Fk(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,o,a,l,h,c,u,g,f,p,_,x,v,w,E,S,T,R,C,P;return this.sphere?(t=Math.sqrt(i.x*i.x+i.y*i.y),t>2*V*this.a?void 0:(e=t/this.a,n=Math.sin(e),s=Math.cos(e),r=this.long0,Math.abs(t)<=J?o=this.lat0:(o=ms(s*this.sin_p12+i.y*n*this.cos_p12/t),a=Math.abs(this.lat0)-V,Math.abs(a)<=J?this.lat0>=0?r=it(this.long0+Math.atan2(i.x,-i.y)):r=it(this.long0-Math.atan2(-i.x,i.y)):r=it(this.long0+Math.atan2(i.x*n,t*this.cos_p12*s-i.y*this.sin_p12*n))),i.x=r,i.y=o,i)):(l=Wa(this.es),h=qa(this.es),c=Xa(this.es),u=Za(this.es),Math.abs(this.sin_p12-1)<=J?(g=this.a*$e(l,h,c,u,V),t=Math.sqrt(i.x*i.x+i.y*i.y),f=g-t,o=lh(f/this.a,l,h,c,u),r=it(this.long0+Math.atan2(i.x,-1*i.y)),i.x=r,i.y=o,i):Math.abs(this.sin_p12+1)<=J?(g=this.a*$e(l,h,c,u,V),t=Math.sqrt(i.x*i.x+i.y*i.y),f=t-g,o=lh(f/this.a,l,h,c,u),r=it(this.long0+Math.atan2(i.x,i.y)),i.x=r,i.y=o,i):(t=Math.sqrt(i.x*i.x+i.y*i.y),x=Math.atan2(i.x,i.y),p=Hr(this.a,this.e,this.sin_p12),v=Math.cos(x),w=this.e*this.cos_p12*v,E=-w*w/(1-this.es),S=3*this.es*(1-E)*this.sin_p12*this.cos_p12*v/(1-this.es),T=t/p,R=T-E*(1+E)*Math.pow(T,3)/6-S*(1+3*E)*Math.pow(T,4)/24,C=1-E*R*R/2-T*R*R*R/6,_=Math.asin(this.sin_p12*Math.cos(R)+this.cos_p12*Math.sin(R)*v),r=it(this.long0+Math.asin(Math.sin(x)*Math.sin(R)/Math.cos(_))),P=Math.sin(_),o=Math.atan2((P-this.es*C*this.sin_p12)*Math.tan(_),P*(1-this.es)),i.x=r,i.y=o,i))}var Nk=["Azimuthal_Equidistant","aeqd"];const kk={init:Lk,forward:Ok,inverse:Fk,names:Nk};function Dk(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Gk(i){var t,e,n,s,r,o,a,l,h=i.x,c=i.y;return n=it(h-this.long0),t=Math.sin(c),e=Math.cos(c),s=Math.cos(n),o=this.sin_p14*t+this.cos_p14*e*s,r=1,(o>0||Math.abs(o)<=J)&&(a=this.a*r*e*Math.sin(n),l=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)),i.x=a,i.y=l,i}function jk(i){var t,e,n,s,r,o,a;return i.x-=this.x0,i.y-=this.y0,t=Math.sqrt(i.x*i.x+i.y*i.y),e=ms(t/this.a),n=Math.sin(e),s=Math.cos(e),o=this.long0,Math.abs(t)<=J?(a=this.lat0,i.x=o,i.y=a,i):(a=ms(s*this.sin_p14+i.y*n*this.cos_p14/t),r=Math.abs(this.lat0)-V,Math.abs(r)<=J?(this.lat0>=0?o=it(this.long0+Math.atan2(i.x,-i.y)):o=it(this.long0-Math.atan2(-i.x,i.y)),i.x=o,i.y=a,i):(o=it(this.long0+Math.atan2(i.x*n,t*this.cos_p14*s-i.y*this.sin_p14*n)),i.x=o,i.y=a,i))}var zk=["ortho"];const Uk={init:Dk,forward:Gk,inverse:jk,names:zk};var oe={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},$t={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Bk(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=V-Zt/2?this.face=oe.TOP:this.lat0<=-(V-Zt/2)?this.face=oe.BOTTOM:Math.abs(this.long0)<=Zt?this.face=oe.FRONT:Math.abs(this.long0)<=V+Zt?this.face=this.long0>0?oe.RIGHT:oe.LEFT:this.face=oe.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Wk(i){var t={x:0,y:0},e,n,s,r,o,a,l={value:0};if(i.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):e=i.y,n=i.x,this.face===oe.TOP)r=V-e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,s=n-V):n>V+Zt||n<=-(V+Zt)?(l.value=$t.AREA_1,s=n>0?n-fe:n+fe):n>-(V+Zt)&&n<=-Zt?(l.value=$t.AREA_2,s=n+V):(l.value=$t.AREA_3,s=n);else if(this.face===oe.BOTTOM)r=V+e,n>=Zt&&n<=V+Zt?(l.value=$t.AREA_0,s=-n+V):n<Zt&&n>=-Zt?(l.value=$t.AREA_1,s=-n):n<-Zt&&n>=-(V+Zt)?(l.value=$t.AREA_2,s=-n-V):(l.value=$t.AREA_3,s=n>0?-n+fe:-n-fe);else{var h,c,u,g,f,p,_;this.face===oe.RIGHT?n=kr(n,+V):this.face===oe.BACK?n=kr(n,+fe):this.face===oe.LEFT&&(n=kr(n,-V)),g=Math.sin(e),f=Math.cos(e),p=Math.sin(n),_=Math.cos(n),h=f*_,c=f*p,u=g,this.face===oe.FRONT?(r=Math.acos(h),s=pl(r,u,c,l)):this.face===oe.RIGHT?(r=Math.acos(c),s=pl(r,u,-h,l)):this.face===oe.BACK?(r=Math.acos(-h),s=pl(r,u,-c,l)):this.face===oe.LEFT?(r=Math.acos(-c),s=pl(r,u,h,l)):(r=s=0,l.value=$t.AREA_0)}return a=Math.atan(12/fe*(s+Math.acos(Math.sin(s)*Math.cos(Zt))-V)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===$t.AREA_1?a+=V:l.value===$t.AREA_2?a+=fe:l.value===$t.AREA_3&&(a+=1.5*fe),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,i.x=t.x,i.y=t.y,i}function qk(i){var t={lam:0,phi:0},e,n,s,r,o,a,l,h,c,u={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,n=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?u.value=$t.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(u.value=$t.AREA_1,e-=V):i.x<0&&-i.x>=Math.abs(i.y)?(u.value=$t.AREA_2,e=e<0?e+fe:e-fe):(u.value=$t.AREA_3,e+=V),c=fe/12*Math.tan(e),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),s=Math.cos(e),r=Math.tan(n),l=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===oe.TOP)h=Math.acos(l),t.phi=V-h,u.value===$t.AREA_0?t.lam=a+V:u.value===$t.AREA_1?t.lam=a<0?a+fe:a-fe:u.value===$t.AREA_2?t.lam=a-V:t.lam=a;else if(this.face===oe.BOTTOM)h=Math.acos(l),t.phi=h-V,u.value===$t.AREA_0?t.lam=-a+V:u.value===$t.AREA_1?t.lam=-a:u.value===$t.AREA_2?t.lam=-a-V:t.lam=a<0?-a-fe:-a+fe;else{var g,f,p;g=l,c=g*g,c>=1?p=0:p=Math.sqrt(1-c)*Math.sin(a),c+=p*p,c>=1?f=0:f=Math.sqrt(1-c),u.value===$t.AREA_1?(c=f,f=-p,p=c):u.value===$t.AREA_2?(f=-f,p=-p):u.value===$t.AREA_3&&(c=f,f=p,p=-c),this.face===oe.RIGHT?(c=g,g=-f,f=c):this.face===oe.BACK?(g=-g,f=-f):this.face===oe.LEFT&&(c=g,g=f,f=-c),t.phi=Math.acos(-p)-V,t.lam=Math.atan2(f,g),this.face===oe.RIGHT?t.lam=kr(t.lam,-V):this.face===oe.BACK?t.lam=kr(t.lam,-fe):this.face===oe.LEFT&&(t.lam=kr(t.lam,+V))}if(this.es!==0){var _,x,v;_=t.phi<0?1:0,x=Math.tan(t.phi),v=this.b/Math.sqrt(x*x+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),_&&(t.phi=-t.phi)}return t.lam+=this.long0,i.x=t.lam,i.y=t.phi,i}function pl(i,t,e,n){var s;return i<J?(n.value=$t.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=Zt?n.value=$t.AREA_0:s>Zt&&s<=V+Zt?(n.value=$t.AREA_1,s-=V):s>V+Zt||s<=-(V+Zt)?(n.value=$t.AREA_2,s=s>=0?s-fe:s+fe):(n.value=$t.AREA_3,s+=V)),s}function kr(i,t){var e=i+t;return e<-fe?e+=pa:e>+fe&&(e-=pa),e}var Xk=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Zk={init:Bk,forward:Wk,inverse:qk,names:Xk};var ku=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Oo=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Z1=.8487,$1=1.3523,V1=rn/5,$k=1/V1,Cr=18,hh=function(i,t){return i[0]+t*(i[1]+t*(i[2]+t*i[3]))},Vk=function(i,t){return i[1]+t*(2*i[2]+t*3*i[3])};function Yk(i,t,e,n){for(var s=t;n;--n){var r=i(s);if(s-=r,Math.abs(r)<e)break}return s}function Hk(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Kk(i){var t=it(i.x-this.long0),e=Math.abs(i.y),n=Math.floor(e*V1);n<0?n=0:n>=Cr&&(n=Cr-1),e=rn*(e-$k*n);var s={x:hh(ku[n],e)*t,y:hh(Oo[n],e)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*Z1+this.x0,s.y=s.y*this.a*$1+this.y0,s}function Qk(i){var t={x:(i.x-this.x0)/(this.a*Z1),y:Math.abs(i.y-this.y0)/(this.a*$1)};if(t.y>=1)t.x/=ku[Cr][0],t.y=i.y<0?-V:V;else{var e=Math.floor(t.y*Cr);for(e<0?e=0:e>=Cr&&(e=Cr-1);;)if(Oo[e][0]>t.y)--e;else if(Oo[e+1][0]<=t.y)++e;else break;var n=Oo[e],s=5*(t.y-n[0])/(Oo[e+1][0]-n[0]);s=Yk(function(r){return(hh(n,r)-t.y)/Vk(n,r)},s,J,100),t.x/=hh(ku[e],s),t.y=(5*e+s)*Pe,i.y<0&&(t.y=-t.y)}return t.x=it(t.x+this.long0),t}var Jk=["Robinson","robin"];const t5={init:Hk,forward:Kk,inverse:Qk,names:Jk};function e5(){this.name="geocent"}function i5(i){var t=O1(i,this.es,this.a);return t}function n5(i){var t=F1(i,this.es,this.a,this.b);return t}var s5=["Geocentric","geocentric","geocent","Geocent"];const r5={init:e5,forward:i5,inverse:n5,names:s5};var De={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},bo={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function o5(){if(Object.keys(bo).forEach((function(e){if(typeof this[e]>"u")this[e]=bo[e].def;else{if(bo[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);bo[e].num&&(this[e]=parseFloat(this[e]))}bo[e].degrees&&(this[e]=this[e]*Pe)}).bind(this)),Math.abs(Math.abs(this.lat0)-V)<J?this.mode=this.lat0<0?De.S_POLE:De.N_POLE:Math.abs(this.lat0)<J?this.mode=De.EQUIT:(this.mode=De.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(i),this.sw=Math.sin(i)}function a5(i){i.x-=this.long0;var t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s,r;switch(this.mode){case De.OBLIQ:r=this.sinph0*t+this.cosph0*e*n;break;case De.EQUIT:r=e*n;break;case De.S_POLE:r=-t;break;case De.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),s=r*e*Math.sin(i.x),this.mode){case De.OBLIQ:r*=this.cosph0*t-this.sinph0*e*n;break;case De.EQUIT:r*=t;break;case De.N_POLE:r*=-(e*n);break;case De.S_POLE:r*=e*n;break}var o,a;return o=r*this.cg+s*this.sg,a=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*a,r=o*a,i.x=s*this.a,i.y=r*this.a,i}function l5(i){i.x/=this.a,i.y/=this.a;var t={x:i.x,y:i.y},e,n,s;s=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*s,n=this.pn1*i.y*this.cw*s,i.x=e*this.cg+n*this.sg,i.y=n*this.cg-e*this.sg;var r=Mi(i.x,i.y);if(Math.abs(r)<J)t.x=0,t.y=i.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case De.OBLIQ:t.y=Math.asin(o*this.sinph0+i.y*a*this.cosph0/r),i.y=(o-this.sinph0*Math.sin(t.y))*r,i.x*=a*this.cosph0;break;case De.EQUIT:t.y=Math.asin(i.y*a/r),i.y=o*r,i.x*=a;break;case De.N_POLE:t.y=Math.asin(o),i.y=-i.y;break;case De.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(i.x,i.y)}return i.x=t.x+this.long0,i.y=t.y,i}var h5=["Tilted_Perspective","tpers"];const c5={init:o5,forward:a5,inverse:l5,names:h5};function u5(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,t=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function d5(i){var t=i.x,e=i.y,n,s,r,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/Mi(this.radius_p*Math.cos(e),Math.sin(e));if(s=a*Math.cos(t)*Math.cos(e),r=a*Math.sin(t)*Math.cos(e),o=a*Math.sin(e),(this.radius_g-s)*s-r*r-o*o*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/Mi(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/Mi(r,n)))}else this.shape==="sphere"&&(n=Math.cos(e),s=Math.cos(t)*n,r=Math.sin(t)*n,o=Math.sin(e),n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/Mi(o,n)),i.y=this.radius_g_1*Math.atan(o/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(o/Mi(r,n))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function g5(i){var t=-1,e=0,n=0,s,r,o,a;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Mi(1,n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*Mi(1,e));var l=n/this.radius_p;if(s=e*e+l*l+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+a*t,e*=a,n*=a,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+n*n+t*t,r=2*this.radius_g*t,o=r*r-4*s*this.C,o<0)return i.x=Number.NaN,i.y=Number.NaN,i;a=(-r-Math.sqrt(o))/(2*s),t=this.radius_g+a*t,e*=a,n*=a,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t)}return i.x=i.x+this.long0,i}var f5=["Geostationary Satellite View","Geostationary_Satellite","geos"];const p5={init:u5,forward:d5,inverse:g5,names:f5};var qo=1.340264,Xo=-.081106,Zo=893e-6,$o=.003796,ch=Math.sqrt(3)/2;function m5(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function _5(i){var t=it(i.x-this.long0),e=i.y,n=Math.asin(ch*Math.sin(e)),s=n*n,r=s*s*s;return i.x=t*Math.cos(n)/(ch*(qo+3*Xo*s+r*(7*Zo+9*$o*s))),i.y=n*(qo+Xo*s+r*(Zo+$o*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function y5(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var t=1e-9,e=12,n=i.y,s,r,o,a,l,h;for(h=0;h<e&&(s=n*n,r=s*s*s,o=n*(qo+Xo*s+r*(Zo+$o*s))-i.y,a=qo+3*Xo*s+r*(7*Zo+9*$o*s),n-=l=o/a,!(Math.abs(l)<t));++h);return s=n*n,r=s*s*s,i.x=ch*i.x*(qo+3*Xo*s+r*(7*Zo+9*$o*s))/Math.cos(n),i.y=Math.asin(Math.sin(n)/ch),i.x=it(i.x+this.long0),i}var x5=["eqearth","Equal Earth","Equal_Earth"];const v5={init:m5,forward:_5,inverse:y5,names:x5};function w5(i){i.Proj.projections.add(Sl),i.Proj.projections.add(Tl),i.Proj.projections.add(b3),i.Proj.projections.add(L3),i.Proj.projections.add(G3),i.Proj.projections.add(W3),i.Proj.projections.add(Y3),i.Proj.projections.add(tN),i.Proj.projections.add(rN),i.Proj.projections.add(cN),i.Proj.projections.add(RN),i.Proj.projections.add(ON),i.Proj.projections.add(GN),i.Proj.projections.add(qN),i.Proj.projections.add(YN),i.Proj.projections.add(tk),i.Proj.projections.add(rk),i.Proj.projections.add(ck),i.Proj.projections.add(mk),i.Proj.projections.add(wk),i.Proj.projections.add(Mk),i.Proj.projections.add(Ak),i.Proj.projections.add(kk),i.Proj.projections.add(Uk),i.Proj.projections.add(Zk),i.Proj.projections.add(t5),i.Proj.projections.add(r5),i.Proj.projections.add(c5),i.Proj.projections.add(p5),i.Proj.projections.add(v5)}vi.defaultDatum="WGS84";vi.Proj=ln;vi.WGS84=new vi.Proj("WGS84");vi.Point=Yr;vi.toPoint=N1;vi.defs=qe;vi.nadgrid=SF;vi.transform=ah;vi.mgrs=zF;vi.version="__VERSION__";w5(vi);T1(vi);window.eoxMapAdvancedOlLayers={...mP,STAC:qg};function b5(i){const t=i[0],e=new Array(t);let n=1<<t-1,s,r;for(s=0;s<t;++s)r=48,i[1]&n&&(r+=1),i[2]&n&&(r+=2),e[s]=String.fromCharCode(r),n>>=1;return e.join("")}const E5='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class S5 extends Ai{constructor(t){const e=t.hidpi!==void 0?t.hidpi:!1;super({cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:!0,projection:tt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.hidpi_=e,this.culture_=t.culture!==void 0?t.culture:"en-us",this.maxZoom_=t.maxZoom!==void 0?t.maxZoom:-1,this.apiKey_=t.key,this.imagerySet_=t.imagerySet,this.placeholderTiles_=t.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(s=>s.json()).then(s=>this.handleImageryMetadataResponse(s))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(t){if(t.statusCode!=200||t.statusDescription!="OK"||t.authenticationResultCode!="ValidCredentials"||t.resourceSets.length!=1||t.resourceSets[0].resources.length!=1){this.setState("error");return}const e=t.resourceSets[0].resources[0],n=this.maxZoom_==-1?e.zoomMax:this.maxZoom_,s=this.getProjection(),r=qn(s),o=this.hidpi_?2:1,a=e.imageWidth==e.imageHeight?e.imageWidth/o:[e.imageWidth/o,e.imageHeight/o],l=Js({extent:r,minZoom:e.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const h=this.culture_,c=this.hidpi_,u=this.placeholderTiles_;if(this.tileUrlFunction=Vr(e.imageUrlSubdomains.map(function(g){const f=[0,0,0],p=e.imageUrl.replace("{subdomain}",g).replace("{culture}",h);return function(_,x,v){if(!_)return;da(_[0],_[1],_[2],f);const w=new URL(p.replace("{quadkey}",b5(f))),E=w.searchParams;return c&&(E.set("dpi","d1"),E.set("device","mobile")),u===!0?E.delete("n"):u===!1&&E.set("n","z"),w.toString()}})),e.imageryProviders){const g=Hs(tt("EPSG:4326"),this.getProjection());this.setAttributions(f=>{const p=[],_=f.viewState,x=this.getTileGrid(),v=x.getZForResolution(_.resolution,this.zDirection),w=x.getTileCoordForCoordAndZ(_.center,v)[0];return e.imageryProviders.map(function(E){let S=!1;const T=E.coverageAreas;for(let R=0,C=T.length;R<C;++R){const P=T[R];if(w>=P.zoomMin&&w<=P.zoomMax){const N=P.bbox,U=[N[1],N[0],N[3],N[2]],j=Gr(U,g);if(Qt(j,f.extent)){S=!0;break}}}S&&p.push(E.attribution)}),p.push(E5),p})}this.setState("ready")}}const T5=S5;class M5 extends qs{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:t.maxZoom!==void 0?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection}),this.account_=t.account,this.mapId_=t.map||"",this.config_=t.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(t){Object.assign(this.config_,t),this.initializeMap_()}setConfig(t){this.config_=t||{},this.initializeMap_()}initializeMap_(){const t=JSON.stringify(this.config_);if(this.templateCache_[t]){this.applyTemplate_(this.templateCache_[t]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,t)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",e),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(t,e){const n=e.target;if(!n.status||n.status>=200&&n.status<300){let s;try{s=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(s),this.templateCache_[t]=s,this.setState("ready")}else this.setState("error")}handleInitError_(t){this.setState("error")}applyTemplate_(t){const e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}}const R5=M5;class C5 extends jh{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){const n=e.getGeometry();return At(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,n){this.source.loadFeatures(t,e,n),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(Lt.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(Lt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const n=t===0?0:Math.min(e,t)/t,s=t!==this.distance||this.interpolationRatio!==n;this.distance=t,this.minDistance=e,this.interpolationRatio=n,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=ze(),e=this.distance*this.resolution,n=this.source.getFeatures(),s={};for(let r=0,o=n.length;r<o;r++){const a=n[r];if(!(st(a)in s)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();Zu(h,t),Ii(t,e,t);const c=this.source.getFeaturesInExtent(t).filter(function(u){const g=st(u);return g in s?!1:(s[g]=!0,!0)});this.features.push(this.createCluster(c,t))}}}}createCluster(t,e){const n=[0,0];for(let a=t.length-1;a>=0;--a){const l=this.geometryFunction(t[a]);l?e0(n,l.getCoordinates()):t.splice(a,1)}mv(n,1/t.length);const s=Ce(e),r=this.interpolationRatio,o=new Re([n[0]*(1-r)+s[0]*r,n[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new Ee({geometry:o,features:t})}}const I5=C5,P5="https://tile.googleapis.com/v1/createSession",A5="https://tile.googleapis.com/v1/2dtiles",L5="https://tile.googleapis.com/tile/v1/viewport",O5=22;class F5 extends Ai{constructor(t){const e=!!t.highDpi,n=t.overlay!==!0;super({attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:n,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const s={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(s.imageFormat=t.imageFormat),t.scale&&(s.scale=t.scale),e&&(s.highDpi=!0),t.layerTypes&&(s.layerTypes=t.layerTypes),t.styles&&(s.styles=t.styles),t.overlay===!0&&(s.overlay=!0),this.sessionTokenRequest_=s,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(t,e){return fetch(t,e)}async createSession_(){const t=P5+"?key="+this.apiKey_,e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(t,e);if(!n.ok){try{const u=await n.json();this.error_=new Error(u.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const s=await n.json(),r=this.getTilePixelRatio(1),o=[s.tileWidth/r,s.tileHeight/r];this.tileGrid=Js({extent:qn(this.getProjection()),maxZoom:O5,tileSize:o});const a=s.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(u,g,f){const p=u[0],_=u[1],x=u[2];return`${A5}/${p}/${_}/${x}?session=${a}&key=${l}`};const h=parseInt(s.expiry,10)*1e3,c=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),c),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(t){if(t.viewHints[ee.ANIMATING]||t.viewHints[ee.INTERACTING]||t.animate)return this.previousViewportAttribution_;const[e,n]=bf(ba(t.extent),t.viewState.projection),[s,r]=bf(Ea(t.extent),t.viewState.projection),o=`zoom=${this.getTileGrid().getZForResolution(t.viewState.resolution,this.zDirection)}&north=${r}&south=${n}&east=${s}&west=${e}`;if(this.previousViewportExtent_==o)return this.previousViewportAttribution_;this.previousViewportExtent_=o;const a=this.sessionTokenValue_,l=this.apiKey_,h=`${L5}?session=${a}&key=${l}&${o}`;return this.previousViewportAttribution_=await fetch(h).then(c=>c.json()).then(c=>c.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const N5=F5;let Y1=class extends Da{constructor(i,t,e,n,s,r,o){super(t,e,n,s,r,o),this.zoomifyImage_=null,this.tileSize_=i}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const i=super.getImage();if(this.state==q.LOADED){const t=this.tileSize_;if(i.width==t[0]&&i.height==t[1])return this.zoomifyImage_=i,i;const e=Jt(t[0],t[1]);return e.drawImage(i,0,0),this.zoomifyImage_=e.canvas,e.canvas}return i}};class k5 extends Ai{constructor(t){const e=t.size,n=t.tierSizeCalculation!==void 0?t.tierSizeCalculation:"default",s=t.tilePixelRatio||1,r=e[0],o=e[1],a=[],l=t.tileSize||qr;let h=l*s;switch(n){case"default":for(;r>h||o>h;)a.push([Math.ceil(r/h),Math.ceil(o/h)]),h+=h;break;case"truncated":let R=r,C=o;for(;R>h||C>h;)a.push([Math.ceil(R/h),Math.ceil(C/h)]),R>>=1,C>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const c=[s],u=[0];for(let R=1,C=a.length;R<C;R++)c.push(s<<R),u.push(a[R-1][0]*a[R-1][1]+u[R-1]);c.reverse();const g=new ys({tileSize:l,extent:t.extent||[0,-o,r,0],resolutions:c});let f=t.url;f&&!f.includes("{TileGroup}")&&!f.includes("{tileIndex}")&&(f+="{TileGroup}/{z}-{x}-{y}.jpg");const p=Og(f);let _=l*s;function x(R){return function(C,P,N){if(!C)return;const U=C[0],j=C[1],B=C[2],d=j+B*a[U][0],m=(d+u[U])/_|0,y={z:U,x:j,y:B,tileIndex:d,TileGroup:"TileGroup"+m};return R.replace(/\{(\w+?)\}/g,function(b,M){return y[M]})}}const v=Vr(p.map(x)),w=Y1.bind(null,se(l*s));super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,tilePixelRatio:s,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:w,tileGrid:g,tileUrlFunction:v,transition:t.transition}),this.zDirection=t.zDirection;const E=g.getTileCoordForCoordAndResolution(Ce(g.getExtent()),c[c.length-1]),S=v(E,1,null),T=new Image;T.addEventListener("error",()=>{_=l,this.changed()}),T.src=S}}const D5=k5;function Eo(i){return i.toLocaleString("en",{maximumFractionDigits:10})}class G5 extends Ai{constructor(t){const e=t||{};let n=e.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const s=e.version||_e.VERSION2,r=e.sizes||[],o=e.size;At(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],h=e.tileSize,c=e.tilePixelRatio||1,u=e.format||"jpg",g=e.quality||(e.version==_e.VERSION1?"native":"default");let f=e.resolutions||[];const p=e.supports||[],_=e.extent||[0,-l,a,0],x=r!=null&&Array.isArray(r)&&r.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),w=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let E,S,T;if(f.sort(function(N,U){return U-N}),v||w)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(E=h,S=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(E=h[0],S=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(E=h[0],S=h[1]):h[0]==null&&Number.isInteger(h[1])&&(E=h[1],S=h[1])))),(E===void 0||S===void 0)&&(E=qr,S=qr),f.length==0){T=Math.max(Math.ceil(Math.log(a/E)/Math.LN2),Math.ceil(Math.log(l/S)/Math.LN2));for(let N=T;N>=0;N--)f.push(Math.pow(2,N))}else{const N=Math.max(...f);T=Math.round(Math.log(N)/Math.LN2)}else if(E=a,S=l,f=[],x){r.sort(function(U,j){return U[0]-j[0]}),T=-1;const N=[];for(let U=0;U<r.length;U++){const j=a/r[U][0];if(f.length>0&&f[f.length-1]==j){N.push(U);continue}f.push(j),T++}if(N.length>0)for(let U=0;U<N.length;U++)r.splice(N[U]-U,1)}else f.push(1),r.push([a,l]),T=0;const R=new ys({tileSize:[E,S],extent:_,origin:zn(_),resolutions:f}),C=function(N,U,j){let B,d;const m=N[0];if(m>T)return;const y=N[1],b=N[2],M=f[m];if(!(y===void 0||b===void 0||M===void 0||y<0||Math.ceil(a/M/E)<=y||b<0||Math.ceil(l/M/S)<=b)){if(w||v){const I=y*E*M,A=b*S*M;let L=E*M,k=S*M,W=E,K=S;if(I+L>a&&(L=a-I),A+k>l&&(k=l-A),I+E*M>a&&(W=Math.floor((a-I+M-1)/M)),A+S*M>l&&(K=Math.floor((l-A+M-1)/M)),I==0&&L==a&&A==0&&k==l)B="full";else if(!w||p.includes("regionByPx"))B=I+","+A+","+L+","+k;else if(p.includes("regionByPct")){const G=Eo(I/a*100),H=Eo(A/l*100),Q=Eo(L/a*100),nt=Eo(k/l*100);B="pct:"+G+","+H+","+Q+","+nt}s==_e.VERSION3&&(!w||p.includes("sizeByWh"))?d=W+","+K:!w||p.includes("sizeByW")?d=W+",":p.includes("sizeByH")?d=","+K:p.includes("sizeByWh")?d=W+","+K:p.includes("sizeByPct")&&(d="pct:"+Eo(100/M))}else if(B="full",x){const I=r[m][0],A=r[m][1];s==_e.VERSION3?I==a&&A==l?d="max":d=I+","+A:I==a?d="full":d=I+","}else d=s==_e.VERSION3?"max":"full";return n+B+"/"+d+"/0/"+g+"."+u}},P=Y1.bind(null,se(h||256).map(function(N){return N*c}));super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:e.state,tileClass:P,tileGrid:R,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:C,transition:e.transition}),this.zDirection=e.zDirection}}const j5=G5;function H1(i,t,e,n,s,r){const o=s.getCode().split(/:(?=\d+$)/).pop(),a=e/n,l=[Rl(yt(t)/a,sn),Rl(Vt(t)/a,sn)];r.SIZE=l[0]+","+l[1],r.BBOX=t.join(","),r.BBOXSR=o,r.IMAGESR=o,r.DPI=Math.round(r.DPI?r.DPI*n:90*n);const h=i.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Gn(h,r)}function K1(i){const t=i.load?i.load:_s,e=tt(i.projection||"EPSG:3857");return function(n,s,r){r=i.hidpi?r:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,i.params),n=Hh(n,s,r,i.ratio);const a=H1(i.url,n,s,r,e,o),l=new Image;return i.crossOrigin!==null&&(l.crossOrigin=i.crossOrigin),t(l,a).then(h=>{const c=yt(n)/h.width*r;return{image:h,extent:n,resolution:c,pixelRatio:r}})}}class z5 extends vs{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Yh,this.params_=Object.assign({},t.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=K1({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),_s(r))})),super.getImageInternal(t,e,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const U5=z5;class B5 extends vs{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5}getImageInternal(t,e,n,s){e=this.findNearestResolution(e);let r=this.canvas_;if(r&&this.renderedRevision_==this.getRevision()&&r.getResolution()==e&&r.getPixelRatio()==n&&Ze(r.getExtent(),t))return r;t=t.slice(),Qm(t,this.ratio_);const o=yt(t)/e,a=Vt(t)/e,l=[o*n,a*n],h=this.canvasFunction_.call(this,t,e,n,l,s);return h&&(r=new ag(t,e,n,h)),this.canvas_=r,this.renderedRevision_=this.getRevision(),r}}const W5=B5;function q5(i,t,e,n){const s=yt(i),r=Vt(i),o=t[0],a=t[1],l=.0254/n;return a*s>o*r?s*e/(o*l):r*e/(a*l)}function X5(i,t,e,n,s,r,o){const a=q5(e,n,r,o),l=Ce(e),h={OPERATION:s?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,t),Gn(i,h)}function Q1(i){const t=i.load||_s;return function(e,n,s){const r=new Image;i.crossOrigin!==null&&(r.crossOrigin=i.crossOrigin),e=Hh(e,n,s,i.ratio);const o=yt(e)/n,a=Vt(e)/n,l=[o*s,a*s],h=X5(i.url,i.params,e,l,i.useOverlay,i.metersPerUnit||1,i.displayDpi||96);return t(r,h).then(c=>({image:c,extent:e,pixelRatio:s}))}}class Z5 extends vs{constructor(t){super({interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.displayDpi_=t.displayDpi!==void 0?t.displayDpi:96,this.params_=Object.assign({},t.params),this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Yh,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.metersPerUnit_=t.metersPerUnit!==void 0?t.metersPerUnit:1,this.ratio_=t.ratio!==void 0?t.ratio:1,this.useOverlay_=t.useOverlay!==void 0?t.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,n,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=Q1({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),_s(r))})),super.getImageInternal(t,e,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(t){Object.assign(this.params_,t),this.changed()}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}changed(){this.image=null,super.changed()}}const $5=Z5;class V5 extends vs{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:Yh,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,n,s){const r=tt(n),o=this.getProjection();o&&o!==r&&(e=ua(o,r,t,e),t=_h(t,r,o));const a={url:this.url_,params:{...this.params_,...s},projection:o||r};return aO(a,t,e)}getLegendUrl(t,e){return lO({url:this.url_,params:{...this.params_,...e}},t)}getParams(){return this.params_}getImageInternal(t,e,n,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=s1({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),_s(r))})),super.getImageInternal(t,e,n,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const Y5=V5,H5={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},K5={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Q5(i,t){let e,n;for(let s=0;s<i.length;++s){const r=i[s];if(r.rel==="item"){if(r.type===t){e=r.href;break}(H5[r.type]||!n&&r.type.startsWith("image/"))&&(n=r.href)}}if(!e)if(n)e=n;else throw new Error('Could not find "item" link');return e}function J5(i,t,e){let n,s;const r={};for(let o=0;o<i.length;++o){const a=i[o];if(r[a.type]=a.href,a.rel==="item"){if(a.type===t){n=a.href;break}K5[a.type]&&(s=a.href)}}if(!n&&e)for(let o=0;o<e.length;++o){const a=e[o];if(r[a]){n=r[a];break}}if(!n)if(s)n=s;else throw new Error('Could not find "item" link');return n}function Dm(i,t,e,n){let s=i.projection;if(!s&&(s=tt(t.crs),!s))throw new Error(`Unsupported CRS: ${t.crs}`);const r=t.orderedAxes,o=(r?r.slice(0,2).map(T=>T.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):s.getAxisOrientation().substr(0,2))!=="en",a=t.tileMatrices,l={};for(let T=0;T<a.length;++T){const R=a[T];l[R.id]=R}const h={},c=[];if(n)for(let T=0;T<n.length;++T){const R=n[T],C=R.tileMatrix;c.push(C),h[C]=R}else for(let T=0;T<a.length;++T){const R=a[T].id;c.push(R)}const u=c.length,g=new Array(u),f=new Array(u),p=new Array(u),_=new Array(u),x=[-1/0,-1/0,1/0,1/0];for(let T=0;T<u;++T){const R=c[T],C=l[R],P=C.pointOfOrigin;o?g[T]=[P[1],P[0]]:g[T]=P,f[T]=C.cellSize,p[T]=[C.matrixWidth,C.matrixHeight],_[T]=[C.tileWidth,C.tileHeight];const N=h[R];if(N){const U=C.cellSize*C.tileWidth,j=g[T][0]+N.minTileCol*U,B=g[T][0]+(N.maxTileCol+1)*U,d=C.cellSize*C.tileHeight,m=C.cornerOfOrigin==="bottomLeft";let y,b;m?(y=g[T][1]+N.minTileRow*d,b=g[T][1]+(N.maxTileRow+1)*d):(y=g[T][1]-(N.maxTileRow+1)*d,b=g[T][1]-N.minTileRow*d),we(x,[j,y,B,b],x)}}const v=new ys({origins:g,resolutions:f,sizes:p,tileSizes:_,extent:n?x:void 0}),w=i.context,E=i.url;function S(T,R,C){if(!T)return;const P=c[T[0]],N=l[P],U=N.cornerOfOrigin==="bottomLeft",j={tileMatrix:P,tileCol:T[1],tileRow:U?-T[2]-1:T[2]};if(n){const d=h[N.id];if(j.tileCol<d.minTileCol||j.tileCol>d.maxTileCol||j.tileRow<d.minTileRow||j.tileRow>d.maxTileRow)return}Object.assign(j,w);const B=e.replace(/\{(\w+?)\}/g,function(d,m){return j[m]});return t1(E,B)}return{grid:v,urlTemplate:e,urlFunction:S}}function tD(i,t){const e=t.tileMatrixSetLimits;let n;if(t.dataType==="map")n=Q5(t.links,i.mediaType);else if(t.dataType==="vector")n=J5(t.links,i.mediaType,i.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(t.tileMatrixSet)return Dm(i,t.tileMatrixSet,n,e);const s=t.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!s)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const r=s.href,o=t1(i.url,r);return Jy(o).then(function(a){return Dm(i,a,n,e)})}function J1(i){return Jy(i.url).then(function(t){return tD(i,t)})}class eD extends Ai{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,context:t.context||null};J1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){Il(t),this.setState("error")}}const iD=eD;class nD extends Kh{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,format:t.format,overlaps:t.overlaps,projection:t.projection,tileClass:t.tileClass,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection,state:"loading"});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,supportedMediaTypes:t.format.supportedMediaTypes,context:t.context||null};J1(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){Il(t),this.setState("error")}}const sD=nD,tx='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class rD extends qs{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[tx];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}const oD=rD,Gm=1/0;class aD{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Kr(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){At(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Gm?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,s=e.length,r=e[t],o=n[t],a=t;for(;t<s>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<s&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=r,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,s=this.priorities_,r=n[e],o=s[e];for(;e>t;){const a=this.getParentIndex_(e);if(s[a]>o)n[e]=n[a],s[e]=s[a],e=a;else break}n[e]=r,s[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let s=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==Gm?delete this.queuedElements_[this.keyFunction_(o)]:(n[s]=l,e[s++]=o);e.length=s,n.length=s,this.heapify_()}}class lD extends aD{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Lt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===q.LOADED||n===q.ERROR||n===q.EMPTY){n!==q.ERROR&&e.removeEventListener(Lt.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,s,r,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),s=r.getState(),s===q.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,r.load())}}let ex=!0;try{new ImageData(10,10)}catch{ex=!1}let Zc;function hD(i,t,e){if(ex)return new ImageData(i,t,e);Zc||(Zc=document.createElement("canvas").getContext("2d"));const n=Zc.createImageData(t,e);return n.data.set(i),n}function ix(i){let t=!0;try{new ImageData(10,10)}catch{t=!1}function e(n,s,r){return t?new ImageData(n,s,r):{data:n,width:s,height:r}}return function(n){const s=n.buffers,r=n.meta,o=n.imageOps,a=n.width,l=n.height,h=s.length,c=s[0].byteLength;if(o){const p=new Array(h);for(let _=0;_<h;++_)p[_]=e(new Uint8ClampedArray(s[_]),a,l);return i(p,r).data.buffer}const u=new Uint8ClampedArray(c),g=new Array(h),f=new Array(h);for(let p=0;p<h;++p)g[p]=new Uint8ClampedArray(s[p]),f[p]=[0,0,0,0];for(let p=0;p<c;p+=4){for(let x=0;x<h;++x){const v=g[x];f[x][0]=v[p],f[x][1]=v[p+1],f[x][2]=v[p+2],f[x][3]=v[p+3]}const _=i(f,r);u[p]=_[0],u[p+1]=_[1],u[p+2]=_[2],u[p+3]=_[3]}return u.buffer}}function cD(i,t){const e=Object.keys(i.lib||{}).map(function(s){return"const "+s+" = "+i.lib[s].toString()+";"}).concat(["const __minion__ = ("+ix.toString()+")(",i.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(e.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(e,{type:"text/javascript"})));return n.addEventListener("message",t),n}function uD(i,t){const e=ix(i.operation);let n=!1;return{postMessage:function(s){setTimeout(function(){n||t({data:{buffer:e(s),meta:s.meta}})},0)},terminate:function(){n=!0}}}class dD extends Uu{constructor(t){super(),this._imageOps=!!t.imageOps;let e;t.threads===0?e=0:this._imageOps?e=1:e=t.threads||1;const n=new Array(e);if(e)for(let s=0;s<e;++s)n[s]=cD(t,this._onWorkerMessage.bind(this,s));else n[0]=uD(t,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,e,n){this._enqueue({inputs:t,meta:e,callback:n}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const e=t.inputs[0].width,n=t.inputs[0].height,s=t.inputs.map(function(l){return l.data.buffer}),r=this._workers.length;if(this._running=r,r===1){this._workers[0].postMessage({buffers:s,meta:t.meta,imageOps:this._imageOps,width:e,height:n},s);return}const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/r);for(let l=0;l<r;++l){const h=l*a,c=[];for(let u=0,g=s.length;u<g;++u)c.push(s[u].slice(h,h+a));this._workers[l].postMessage({buffers:c,meta:t.meta,imageOps:this._imageOps,width:e,height:n},c)}}_onWorkerMessage(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,e=this._workers.length;let n,s;if(e===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),s=this._dataLookup[0].meta;else{const r=t.inputs[0].data.length;n=new Uint8ClampedArray(r),s=new Array(e);const o=4*Math.ceil(r/4/e);for(let a=0;a<e;++a){const l=this._dataLookup[a].buffer,h=a*o;n.set(new Uint8ClampedArray(l),h),s[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,hD(n,t.inputs[0].width,t.inputs[0].height),s),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const jm={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class zm extends gn{constructor(t,e,n){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=n}}class nx extends vs{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=pD(t.sources);const e=this.changed.bind(this);for(let n=0,s=this.layers_.length;n<s;++n)this.layers_[n].addEventListener(Lt.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new lD(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:pe(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:fD(this.layers_),pixelRatio:1,pixelToCoordinateTransform:pe(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:st(this),renderTargets:{}},this.setAttributions(function(n){const s=[];for(let r=0,o=t.sources.length;r<o;++r){const a=t.sources[r],l=a instanceof oo?a:a.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const c=h(n);s.push.apply(s,c)}}return s.length!==0?s:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new dD({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,n){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const r=Ce(t);s.size[0]=Math.ceil(yt(t)/e),s.size[1]=Math.ceil(Vt(t)/e),s.extent=[r[0]-s.size[0]*e/2,r[1]-s.size[1]*e/2,r[0]+s.size[0]*e/2,r[1]+s.size[1]*e/2],s.time=Date.now();const o=s.viewState;return o.center=r,o.projection=n,o.resolution=e,s}allSourcesReady_(){let t=!0,e;for(let n=0,s=this.layers_.length;n<s;++n)if(e=this.layers_[n].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,n,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const r=this.updateFrameState_(t,e,s);if(this.requestedFrameState_=r,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!Nn(r.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),r.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,n=new Array(e);for(let r=0;r<e;++r){t.layerIndex=r,t.renderTargets={};const o=gD(this.layers_[r],t);if(o)n[r]=o;else return}const s={};this.dispatchEvent(new zm(jm.BEFOREOPERATIONS,t,s)),this.processor_.process(n,s,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,n,s){if(e||!n)return;const r=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Nn(r,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(yt(r)/o),h=Math.round(Vt(r)/o);a=Jt(l,h),this.renderedImageCanvas_=new ag(r,o,1,a.canvas)}a.putImageData(n,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new zm(jm.AFTEROPERATIONS,t,s))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let n=0,s=this.layers_.length;n<s&&(e=this.layers_[n].getSource().getResolutions(t),!e);++n);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}nx.prototype.dispose;let Ts=null;function gD(i,t){const e=i.getRenderer();if(!e)throw new Error("Unsupported layer type: "+i);if(!e.prepareFrame(t))return null;const n=t.size[0],s=t.size[1];if(n===0||s===0)return null;const r=e.renderFrame(t,null);let o;if(r instanceof HTMLCanvasElement)o=r;else{if(r&&(o=r.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===s)return o.getContext("2d").getImageData(0,0,n,s)}if(!Ts)Ts=Jt(n,s,void 0,{willReadFrequently:!0});else{const a=Ts.canvas;a.width!==n||a.height!==s?Ts=Jt(n,s,void 0,{willReadFrequently:!0}):Ts.clearRect(0,0,n,s)}return Ts.drawImage(o,0,0,n,s),Ts.getImageData(0,0,n,s)}function fD(i){return i.map(function(t){return t.getLayerState()})}function pD(i){const t=i.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=mD(i[n]);return e}function mD(i){let t;return i instanceof oo?i instanceof ja?t=new Ql({source:i}):i instanceof vs&&(t=new og({source:i})):t=i,t}const _D=nx,yD='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',xD='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',vD='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',wD={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},alidade_satellite:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},bD={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class ED extends qs{constructor(t){const e=t.layer.indexOf("-"),n=e==-1?t.layer:t.layer.slice(0,e),s=bD[n]||{minZoom:0,maxZoom:20,retina:!0},r=wD[t.layer],o=t.apiKey?"?api_key="+t.apiKey:"",a=s.retina&&t.retina?"@2x":"",l=t.url!==void 0?t.url:"https://tiles.stadiamaps.com/tiles/"+t.layer+"/{z}/{x}/{y}"+a+"."+r.extension+o,h=[yD,xD,tx];t.layer.startsWith("stamen_")&&h.splice(1,0,vD),super({attributions:h,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:s.maxZoom,minZoom:t.minZoom!==void 0?t.minZoom:s.minZoom,opaque:r.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:l,tilePixelRatio:a?2:1,wrapX:t.wrapX,zDirection:t.zDirection})}}const SD=ED;class TD extends Ai{constructor(t){t=t||{},super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.params_=Object.assign({},t.params),this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=ze(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,n,s,r,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const h=an(ig(t),a.length);l=a[h]}return H1(l,n,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),s,r,o)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){Object.assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,n){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(n)),s.getResolutions().length<=t[0])return;e!=1&&!this.hidpi_&&(e=1);const r=s.getTileCoordExtent(t,this.tmpExtent_);let o=se(s.getTileSize(t[0]),this.tmpSize);e!=1&&(o=L0(o,e,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(t,o,r,e,n,a)}}const MD=TD;class RD extends qs{constructor(t){t=t||{},super({opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection,url:t.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,n)=>{const s=e.getTileCoord()[0],r=se(this.tileGrid.getTileSize(s)),o=Jt(r[0],r[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,r[0]+.5,r[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(n,r[0]/2,r[1]/2,r[0]),o.fillText(n,r[0]/2,r[1]/2,r[0]),e.setImage(o.canvas)}})}}const CD=RD;class ID extends ao{constructor(t,e,n,s,r,o){super(t,e),this.src_=n,this.extent_=s,this.preemptive_=r,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),s=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof s!="string")return null;let r=s.charCodeAt(Math.floor(e*s.length));r>=93&&r--,r>=35&&r--,r-=32;let o=null;if(r in this.keys_){const a=this.keys_[r];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(t,e,n){this.state==q.EMPTY&&n===!0?(this.state=q.IDLE,Ho(this,Lt.CHANGE,function(s){e(this.getData(t))},this),this.loadInternal_()):n===!0?setTimeout(()=>{e(this.getData(t))},0):e(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=q.ERROR,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=q.LOADED,this.changed()}loadInternal_(){if(this.state==q.IDLE)if(this.state=q.LOADING,this.jsonp_)kg(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(q.EMPTY)}}class PD extends ja{constructor(t){if(super({projection:tt("EPSG:3857"),state:"loading",wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection}),this.preemptive_=t.preemptive!==void 0?t.preemptive:!0,this.tileUrlFunction_=tO,this.template_=void 0,this.jsonp_=t.jsonp||!1,t.url)if(this.jsonp_)kg(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(t,e,n,s){if(this.tileGrid){const r=this.tileGrid.getZForResolution(e,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(t,r);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,n,s)}else s===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(t){const e=tt("EPSG:4326"),n=this.getProjection();let s;if(t.bounds!==void 0){const c=Hs(e,n);s=Gr(t.bounds,c)}const r=qn(n),o=t.minzoom||0,a=t.maxzoom||22,l=Js({extent:r,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=t.template;const h=t.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=Lg(h,l),t.attribution){const c=s!==void 0?s:r;this.setAttributions(function(u){return Qt(c,u.extent)?[t.attribution]:null})}this.setState("ready")}getTile(t,e,n,s,r){const o=un(t,e,n);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,r),h=this.tileUrlFunction_(l,s,r),c=new ID(a,h!==void 0?q.IDLE:q.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,c),c}useTile(t,e,n){const s=un(t,e,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const AD=PD;function LD(i,t){const e=new eg(32),n=i.getExtent();return function(s,r){e.expireCache(),n&&(s=we(n,s));const o=i.getZForResolution(r),a=[];return i.forEachTileCoord(s,o,l=>{const h=l.toString();if(!e.containsKey(h)){const c=t(l);e.set(h,c)}a.push(e.get(h))}),a}}const OD=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:T5,CartoDB:R5,Cluster:I5,DataTile:fg,GeoTIFF:Ag,Google:N5,IIIF:j5,Image:vs,ImageArcGISRest:U5,ImageCanvas:W5,ImageMapGuide:$5,ImageStatic:Qy,ImageWMS:Y5,OGCMapTile:iD,OGCVectorTile:sD,OSM:oD,Raster:_D,Source:oo,StadiaMaps:SD,Tile:ja,TileArcGISRest:MD,TileDebug:CD,TileImage:Ai,TileJSON:e1,TileWMS:r1,UTFGrid:AD,UrlTile:Ng,Vector:jh,VectorTile:Kh,WMTS:o1,XYZ:qs,Zoomify:D5,createArcGISRestLoader:K1,createMapGuideLoader:Q1,createStaticLoader:Ky,createWMSLoader:s1,sourcesFromTileGrid:LD},Symbol.toStringTag,{value:"Module"}));class FD extends Ai{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,tilePixelRatio:t.tilePixelRatio,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection,wrapX:t.wrapX}),this.version_=t.version!==void 0?t==null?void 0:t.version:"1.0.0",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,fetch(t.url).then(e=>e.text()).then(e=>new window.DOMParser().parseFromString(e,"application/xml")).then(e=>{this.handleCapabilitiesResponse(e,t)})}handleCapabilitiesResponse(t,e){const n=new jd().read(t),s=a1(n,e);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Vr(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Gn(t,n):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,r);let l=t;return e=="KVP"?l=Gn(l,a):l=l.replace(/\{(\w+?)\}/g,function(h,c){return a[c]}),l}}}window.eoxMapAdvancedOlSources={...OD,WMTSCapabilities:FD};const ND={__name:"EodashMap",setup(i){var a;const t=hx(dx),e={class:"fill-height fill-width overflow-none",center:[15,48],layers:[{type:"Tile",source:{type:"OSM"}}]};Es&&Es.value&&Es.value.length===3&&(e.center=[(a=Es.value)==null?void 0:a[0],Es.value[1]],e.zoom=Es.value[2]);const n=()=>jn(()=>import("./eox-map-BJ9SIixs.C3ovk8H8.js"),[]),s=l=>{const h=l.map,[c,u]=(h==null?void 0:h.getView().getCenter())??[0,0],g=h==null?void 0:h.getView().getZoom();!Number.isNaN(c)&&!Number.isNaN(u)&&!Number.isNaN(g)&&(Es.value=[c,u,g])},r=(l,h)=>{var u;(u=l==null?void 0:l.map)==null||u.on("moveend",s);const{selectedStac:c}=gx(h);fx([c,px],async([g,f])=>{if(g){const p=Ml(`./${g.id}/collection.json`,t.stacEndpoint),_=Ml(g.links[1].href,p),x=new Dx(_);f?l.layers=await x.createLayersJson(new Date(f)):l.layers=await x.createLayersJson()}},{immediate:!0})},o=(l,h)=>{var c;(c=l==null?void 0:l.map)==null||c.un("moveend",s)};return(l,h)=>(cx(),ux(_x,{link:n,"tag-name":"eox-map",properties:e,"on-mounted":r,"on-unmounted":o}))}},JD=Object.freeze(Object.defineProperty({__proto__:null,default:ND},Symbol.toStringTag,{value:"Module"}));export{KD as D,JD as E,QD as G,eo as V};

var Yu=Object.defineProperty,Eh=i=>{throw TypeError(i)},ju=(i,t,e)=>t in i?Yu(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Et=(i,t,e)=>ju(i,typeof t!="symbol"?t+"":t,e),qs=(i,t,e)=>t.has(i)||Eh("Cannot "+e),dt=(i,t,e)=>(qs(i,t,"read from private field"),e?e.call(i):t.get(i)),lt=(i,t,e)=>t.has(i)?Eh("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),Fn=(i,t,e,r)=>(qs(i,t,"write to private field"),t.set(i,e),e),Ot=(i,t,e)=>(qs(i,t,"access private method"),e);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const bn=globalThis,Ks=bn.ShadowRoot&&(bn.ShadyCSS===void 0||bn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,bh=Symbol(),Za=new WeakMap;let Zu=class{constructor(i,t,e){if(this._$cssResult$=!0,e!==bh)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=i,this.t=t}get styleSheet(){let i=this.o;const t=this.t;if(Ks&&i===void 0){const e=t!==void 0&&t.length===1;e&&(i=Za.get(t)),i===void 0&&((this.o=i=new CSSStyleSheet).replaceSync(this.cssText),e&&Za.set(t,i))}return i}toString(){return this.cssText}};const qu=i=>new Zu(typeof i=="string"?i:i+"",void 0,bh),Ku=(i,t)=>{if(Ks)i.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const r=document.createElement("style"),n=bn.litNonce;n!==void 0&&r.setAttribute("nonce",n),r.textContent=e.cssText,i.appendChild(r)}},qa=Ks?i=>i:i=>i instanceof CSSStyleSheet?(t=>{let e="";for(const r of t.cssRules)e+=r.cssText;return qu(e)})(i):i;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Ju,defineProperty:Qu,getOwnPropertyDescriptor:td,getOwnPropertyNames:ed,getOwnPropertySymbols:id,getPrototypeOf:rd}=Object,qi=globalThis,Ka=qi.trustedTypes,nd=Ka?Ka.emptyScript:"",Do=qi.reactiveElementPolyfillSupport,Ar=(i,t)=>i,gs={toAttribute(i,t){switch(t){case Boolean:i=i?nd:null;break;case Object:case Array:i=i==null?i:JSON.stringify(i)}return i},fromAttribute(i,t){let e=i;switch(t){case Boolean:e=i!==null;break;case Number:e=i===null?null:Number(i);break;case Object:case Array:try{e=JSON.parse(i)}catch{e=null}}return e}},Sh=(i,t)=>!Ju(i,t),Ja={attribute:!0,type:String,converter:gs,reflect:!1,hasChanged:Sh};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),qi.litPropertyMetadata??(qi.litPropertyMetadata=new WeakMap);class Li extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Ja){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const r=Symbol(),n=this.getPropertyDescriptor(t,r,e);n!==void 0&&Qu(this.prototype,t,n)}}static getPropertyDescriptor(t,e,r){const{get:n,set:o}=td(this.prototype,t)??{get(){return this[e]},set(s){this[e]=s}};return{get(){return n==null?void 0:n.call(this)},set(s){const a=n==null?void 0:n.call(this);o.call(this,s),this.requestUpdate(t,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Ja}static _$Ei(){if(this.hasOwnProperty(Ar("elementProperties")))return;const t=rd(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Ar("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ar("properties"))){const e=this.properties,r=[...ed(e),...id(e)];for(const n of r)this.createProperty(n,e[n])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[r,n]of e)this.elementProperties.set(r,n)}this._$Eh=new Map;for(const[e,r]of this.elementProperties){const n=this._$Eu(e,r);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const r=new Set(t.flat(1/0).reverse());for(const n of r)e.unshift(qa(n))}else t!==void 0&&e.push(qa(t));return e}static _$Eu(t,e){const r=e.attribute;return r===!1?void 0:typeof r=="string"?r:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const r of e.keys())this.hasOwnProperty(r)&&(t.set(r,this[r]),delete this[r]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Ku(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var r;return(r=e.hostConnected)==null?void 0:r.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var r;return(r=e.hostDisconnected)==null?void 0:r.call(e)})}attributeChangedCallback(t,e,r){this._$AK(t,r)}_$EC(t,e){var r;const n=this.constructor.elementProperties.get(t),o=this.constructor._$Eu(t,n);if(o!==void 0&&n.reflect===!0){const s=(((r=n.converter)==null?void 0:r.toAttribute)!==void 0?n.converter:gs).toAttribute(e,n.type);this._$Em=t,s==null?this.removeAttribute(o):this.setAttribute(o,s),this._$Em=null}}_$AK(t,e){var r;const n=this.constructor,o=n._$Eh.get(t);if(o!==void 0&&this._$Em!==o){const s=n.getPropertyOptions(o),a=typeof s.converter=="function"?{fromAttribute:s.converter}:((r=s.converter)==null?void 0:r.fromAttribute)!==void 0?s.converter:gs;this._$Em=o,this[o]=a.fromAttribute(e,s.type),this._$Em=null}}requestUpdate(t,e,r){if(t!==void 0){if(r??(r=this.constructor.getPropertyOptions(t)),!(r.hasChanged??Sh)(this[t],e))return;this.P(t,e,r)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,r){this._$AL.has(t)||this._$AL.set(t,e),r.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[o,s]of this._$Ep)this[o]=s;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[o,s]of n)s.wrapped!==!0||this._$AL.has(o)||this[o]===void 0||this.P(o,this[o],s)}let e=!1;const r=this._$AL;try{e=this.shouldUpdate(r),e?(this.willUpdate(r),(t=this._$EO)==null||t.forEach(n=>{var o;return(o=n.hostUpdate)==null?void 0:o.call(n)}),this.update(r)):this._$EU()}catch(n){throw e=!1,this._$EU(),n}e&&this._$AE(r)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(r=>{var n;return(n=r.hostUpdated)==null?void 0:n.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}Li.elementStyles=[],Li.shadowRootOptions={mode:"open"},Li[Ar("elementProperties")]=new Map,Li[Ar("finalized")]=new Map,Do==null||Do({ReactiveElement:Li}),(qi.reactiveElementVersions??(qi.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Un=globalThis,Bn=Un.trustedTypes,Qa=Bn?Bn.createPolicy("lit-html",{createHTML:i=>i}):void 0,Js="$lit$",Le=`lit$${(Math.random()+"").slice(9)}$`,Qs="?"+Le,od=`<${Qs}>`,xi=document,kr=()=>xi.createComment(""),Nr=i=>i===null||typeof i!="object"&&typeof i!="function",wh=Array.isArray,Th=i=>wh(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",Po=`[ 	
\f\r]`,ur=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tl=/-->/g,el=/>/g,oi=RegExp(`>|${Po}(?:([^\\s"'>=/]+)(${Po}*=${Po}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),il=/'/g,rl=/"/g,Rh=/^(?:script|style|textarea|title)$/i,sd=i=>(t,...e)=>({_$litType$:i,strings:t,values:e}),Z=sd(1),re=Symbol.for("lit-noChange"),ot=Symbol.for("lit-nothing"),nl=new WeakMap,di=xi.createTreeWalker(xi,129);function Ch(i,t){if(!Array.isArray(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return Qa!==void 0?Qa.createHTML(t):t}const Ah=(i,t)=>{const e=i.length-1,r=[];let n,o=t===2?"<svg>":"",s=ur;for(let a=0;a<e;a++){const l=i[a];let h,c,u=-1,d=0;for(;d<l.length&&(s.lastIndex=d,c=s.exec(l),c!==null);)d=s.lastIndex,s===ur?c[1]==="!--"?s=tl:c[1]!==void 0?s=el:c[2]!==void 0?(Rh.test(c[2])&&(n=RegExp("</"+c[2],"g")),s=oi):c[3]!==void 0&&(s=oi):s===oi?c[0]===">"?(s=n??ur,u=-1):c[1]===void 0?u=-2:(u=s.lastIndex-c[2].length,h=c[1],s=c[3]===void 0?oi:c[3]==='"'?rl:il):s===rl||s===il?s=oi:s===tl||s===el?s=ur:(s=oi,n=void 0);const g=s===oi&&i[a+1].startsWith("/>")?" ":"";o+=s===ur?l+od:u>=0?(r.push(h),l.slice(0,u)+Js+l.slice(u)+Le+g):l+Le+(u===-2?a:g)}return[Ch(i,o+(i[e]||"<?>")+(t===2?"</svg>":"")),r]};class Fr{constructor({strings:t,_$litType$:e},r){let n;this.parts=[];let o=0,s=0;const a=t.length-1,l=this.parts,[h,c]=Ah(t,e);if(this.el=Fr.createElement(h,r),di.currentNode=this.el.content,e===2){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(n=di.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const u of n.getAttributeNames())if(u.endsWith(Js)){const d=c[s++],g=n.getAttribute(u).split(Le),f=/([.?@])?(.*)/.exec(d);l.push({type:1,index:o,name:f[2],strings:g,ctor:f[1]==="."?Mh:f[1]==="?"?Lh:f[1]==="@"?Oh:Kr}),n.removeAttribute(u)}else u.startsWith(Le)&&(l.push({type:6,index:o}),n.removeAttribute(u));if(Rh.test(n.tagName)){const u=n.textContent.split(Le),d=u.length-1;if(d>0){n.textContent=Bn?Bn.emptyScript:"";for(let g=0;g<d;g++)n.append(u[g],kr()),di.nextNode(),l.push({type:2,index:++o});n.append(u[d],kr())}}}else if(n.nodeType===8)if(n.data===Qs)l.push({type:2,index:o});else{let u=-1;for(;(u=n.data.indexOf(Le,u+1))!==-1;)l.push({type:7,index:o}),u+=Le.length-1}o++}}static createElement(t,e){const r=xi.createElement("template");return r.innerHTML=t,r}}function vi(i,t,e=i,r){var n,o;if(t===re)return t;let s=r!==void 0?(n=e._$Co)==null?void 0:n[r]:e._$Cl;const a=Nr(t)?void 0:t._$litDirective$;return(s==null?void 0:s.constructor)!==a&&((o=s==null?void 0:s._$AO)==null||o.call(s,!1),a===void 0?s=void 0:(s=new a(i),s._$AT(i,e,r)),r!==void 0?(e._$Co??(e._$Co=[]))[r]=s:e._$Cl=s),s!==void 0&&(t=vi(i,s._$AS(i,t.values),s,r)),t}class Ih{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:r}=this._$AD,n=((t==null?void 0:t.creationScope)??xi).importNode(e,!0);di.currentNode=n;let o=di.nextNode(),s=0,a=0,l=r[0];for(;l!==void 0;){if(s===l.index){let h;l.type===2?h=new rr(o,o.nextSibling,this,t):l.type===1?h=new l.ctor(o,l.name,l.strings,this,t):l.type===6&&(h=new Dh(o,this,t)),this._$AV.push(h),l=r[++a]}s!==(l==null?void 0:l.index)&&(o=di.nextNode(),s++)}return di.currentNode=xi,n}p(t){let e=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(t,r,e),e+=r.strings.length-2):r._$AI(t[e])),e++}}class rr{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,r,n){this.type=2,this._$AH=ot,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=r,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=vi(this,t,e),Nr(t)?t===ot||t==null||t===""?(this._$AH!==ot&&this._$AR(),this._$AH=ot):t!==this._$AH&&t!==re&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Th(t)?this.k(t):this._(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}_(t){this._$AH!==ot&&Nr(this._$AH)?this._$AA.nextSibling.data=t:this.T(xi.createTextNode(t)),this._$AH=t}$(t){var e;const{values:r,_$litType$:n}=t,o=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=Fr.createElement(Ch(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===o)this._$AH.p(r);else{const s=new Ih(o,this),a=s.u(this.options);s.p(r),this.T(a),this._$AH=s}}_$AC(t){let e=nl.get(t.strings);return e===void 0&&nl.set(t.strings,e=new Fr(t)),e}k(t){wh(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let r,n=0;for(const o of t)n===e.length?e.push(r=new rr(this.S(kr()),this.S(kr()),this,this.options)):r=e[n],r._$AI(o),n++;n<e.length&&(this._$AR(r&&r._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Kr{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,r,n,o){this.type=1,this._$AH=ot,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=o,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=ot}_$AI(t,e=this,r,n){const o=this.strings;let s=!1;if(o===void 0)t=vi(this,t,e,0),s=!Nr(t)||t!==this._$AH&&t!==re,s&&(this._$AH=t);else{const a=t;let l,h;for(t=o[0],l=0;l<o.length-1;l++)h=vi(this,a[r+l],e,l),h===re&&(h=this._$AH[l]),s||(s=!Nr(h)||h!==this._$AH[l]),h===ot?t=ot:t!==ot&&(t+=(h??"")+o[l+1]),this._$AH[l]=h}s&&!n&&this.j(t)}j(t){t===ot?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Mh extends Kr{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ot?void 0:t}}class Lh extends Kr{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ot)}}class Oh extends Kr{constructor(t,e,r,n,o){super(t,e,r,n,o),this.type=5}_$AI(t,e=this){if((t=vi(this,t,e,0)??ot)===re)return;const r=this._$AH,n=t===ot&&r!==ot||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==ot&&(r===ot||n);n&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class Dh{constructor(t,e,r){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(t){vi(this,t)}}const ad={P:Js,A:Le,C:Qs,M:1,L:Ah,R:Ih,D:Th,V:vi,I:rr,H:Kr,N:Lh,U:Oh,B:Mh,F:Dh},$o=Un.litHtmlPolyfillSupport;$o==null||$o(Fr,rr),(Un.litHtmlVersions??(Un.litHtmlVersions=[])).push("3.1.2");const ld=(i,t,e)=>{const r=(e==null?void 0:e.renderBefore)??t;let n=r._$litPart$;if(n===void 0){const o=(e==null?void 0:e.renderBefore)??null;r._$litPart$=n=new rr(t.insertBefore(kr(),o),o,void 0,e??{})}return n._$AI(i),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let qt=class extends Li{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var i;const t=super.createRenderRoot();return(i=this.renderOptions).renderBefore??(i.renderBefore=t.firstChild),t}update(i){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(i),this._$Do=ld(t,this.renderRoot,this.renderOptions)}connectedCallback(){var i;super.connectedCallback(),(i=this._$Do)==null||i.setConnected(!0)}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this._$Do)==null||i.setConnected(!1)}render(){return re}};var ol;qt._$litElement$=!0,qt.finalized=!0,(ol=globalThis.litElementHydrateSupport)==null||ol.call(globalThis,{LitElement:qt});const ko=globalThis.litElementPolyfillSupport;ko==null||ko({LitElement:qt});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ne(i,t,e){return i?t(i):e==null?void 0:e(i)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ye={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},ta=i=>(...t)=>({_$litDirective$:i,values:t});class ea{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,r){this._$Ct=t,this._$AM=e,this._$Ci=r}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:hd}=ad,cd=i=>i.strings===void 0,sl=()=>document.createComment(""),dr=(i,t,e)=>{var r;const n=i._$AA.parentNode,o=t===void 0?i._$AB:t._$AA;if(e===void 0){const s=n.insertBefore(sl(),o),a=n.insertBefore(sl(),o);e=new hd(s,a,i,i.options)}else{const s=e._$AB.nextSibling,a=e._$AM,l=a!==i;if(l){let h;(r=e._$AQ)==null||r.call(e,i),e._$AM=i,e._$AP!==void 0&&(h=i._$AU)!==a._$AU&&e._$AP(h)}if(s!==o||l){let h=e._$AA;for(;h!==s;){const c=h.nextSibling;n.insertBefore(h,o),h=c}}}return e},si=(i,t,e=i)=>(i._$AI(t,e),i),ud={},Ph=(i,t=ud)=>i._$AH=t,dd=i=>i._$AH,No=i=>{var t;(t=i._$AP)==null||t.call(i,!1,!0);let e=i._$AA;const r=i._$AB.nextSibling;for(;e!==r;){const n=e.nextSibling;e.remove(),e=n}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const al=(i,t,e)=>{const r=new Map;for(let n=t;n<=e;n++)r.set(i[n],n);return r},gd=ta(class extends ea{constructor(i){if(super(i),i.type!==Ye.CHILD)throw Error("repeat() can only be used in text expressions")}dt(i,t,e){let r;e===void 0?e=t:t!==void 0&&(r=t);const n=[],o=[];let s=0;for(const a of i)n[s]=r?r(a,s):s,o[s]=e(a,s),s++;return{values:o,keys:n}}render(i,t,e){return this.dt(i,t,e).values}update(i,[t,e,r]){const n=dd(i),{values:o,keys:s}=this.dt(t,e,r);if(!Array.isArray(n))return this.ut=s,o;const a=this.ut??(this.ut=[]),l=[];let h,c,u=0,d=n.length-1,g=0,f=o.length-1;for(;u<=d&&g<=f;)if(n[u]===null)u++;else if(n[d]===null)d--;else if(a[u]===s[g])l[g]=si(n[u],o[g]),u++,g++;else if(a[d]===s[f])l[f]=si(n[d],o[f]),d--,f--;else if(a[u]===s[f])l[f]=si(n[u],o[f]),dr(i,l[f+1],n[u]),u++,f--;else if(a[d]===s[g])l[g]=si(n[d],o[g]),dr(i,n[u],n[d]),d--,g++;else if(h===void 0&&(h=al(s,g,f),c=al(a,u,d)),h.has(a[u]))if(h.has(a[d])){const p=c.get(s[g]),m=p!==void 0?n[p]:null;if(m===null){const y=dr(i,n[u]);si(y,o[g]),l[g]=y}else l[g]=si(m,o[g]),dr(i,n[u],m),n[p]=null;g++}else No(n[d]),d--;else No(n[u]),u++;for(;g<=f;){const p=dr(i,l[f+1]);si(p,o[g]),l[g++]=p}for(;u<=d;){const p=n[u++];p!==null&&No(p)}return this.ut=s,Ph(i,l),re}});/**
 * wms-capabilities @0.6.0
 * @description WMS service Capabilities > JSON, based on openlayers 
 * @license BSD-2-Clause
 * @preserve
 */var j=i=>i!==void 0,$h=(i,t,e)=>t in i?i[t]:i[t]=e;const Ur={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};class fd{constructor(t){this._parser=new t}toDocument(t){return this._parser.parseFromString(t,"application/xml")}getAllTextContent(t,e){return ao(t,e).join("")}}function ao(i,t){return kh(i,t,[]).join("")}function kh(i,t,e){if(i.nodeType===Ur.CDATA_SECTION||i.nodeType===Ur.TEXT)t?e.push(String(i.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(i.nodeValue);else{var r;for(r=i.firstChild;r;r=r.nextSibling)kh(r,t,e)}return e}function pd(i,t,e,r){for(var n=md(t);n;n=_d(n)){var o=n.namespaceURI||null,s=i[o];if(j(s)){var a=s[n.localName];j(a)&&a.call(r,n,e)}}}function md(i){let t=i.firstElementChild||i.firstChild;for(;t&&t.nodeType!==Ur.ELEMENT;)t=t.nextSibling;return t}function _d(i){let t=i.nextElementSibling||i.nextSibling;for(;t&&t.nodeType!==Ur.ELEMENT;)t=t.nextSibling;return t}function It(i,t,e){return yd(i,t,e)}function yd(i,t,e){var r=j(e)?e:{},n,o;for(n=0,o=i.length;n<o;++n)r[i[n]]=t;return r}function Nh(i,t){return function(e,r){var n=i.call(j(t)?t:this,e,r);if(j(n)){var o=r[r.length-1];o.push(n)}}}function Tt(i,t,e,r,n){return r.push(i),pd(t,e,r,n),r.pop()}function D(i,t,e){return function(r,n){let o=i.call(j(e)?e:this,r,n);if(j(o)){var s=n[n.length-1],a=j(t)?t:r.localName;s[a]=o}}}function Ut(i,t,e){return function(r,n){var o=i.call(j(e)?e:this,r,n);if(j(o)){var s=n[n.length-1],a=j(t)?t:r.localName,l=$h(s,a,[]);l.push(o)}}}const xd=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function vd(i){return i.replace(xd,"")}function _i(i){const t=/^\s*(true|1)|(false|0)\s*$/.exec(i);if(t)return j(t[1])||!1}function Ui(i){return Oe(ao(i,!1))}function Oe(i){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(i);if(t)return parseFloat(t[1])}function Fo(i){return Gn(ao(i,!1))}function Gn(i){const t=/^\s*(\d+)\s*$/.exec(i);if(t)return parseInt(t[1],10)}function Q(i){return vd(ao(i,!1))}const Ed="http://www.w3.org/1999/xlink";function ia(i){return i.getAttributeNS(Ed,"href")}function bd(i,t){return Tt({},Zd,i,t)}function Fh(i){return[Oe(i.getAttribute("minx")),Oe(i.getAttribute("miny")),Oe(i.getAttribute("maxx")),Oe(i.getAttribute("maxy"))]}function Sd(i,t){const e=Fh(i),r=[Oe(i.getAttribute("resx")),Oe(i.getAttribute("resy"))];return{crs:i.getAttribute("CRS")||i.getAttribute("SRS"),extent:e,res:r}}function wd(i,t){const e=Fh(i);if(!(!j(e[0])||!j(e[1])||!j(e[2])||!j(e[3])))return e}function Td(i,t){const e=parseFloat(i.getAttribute("min")),r=parseFloat(i.getAttribute("max"));return{min:e,max:r}}function Rd(i,t){const e=Tt({},qd,i,t);if(!j(e))return;const r=e.westBoundLongitude,n=e.southBoundLatitude,o=e.eastBoundLongitude,s=e.northBoundLatitude;if(!(!j(r)||!j(n)||!j(o)||!j(s)))return[r,n,o,s]}function Cd(i,t){return Tt({},Wd,i,t)}function Ad(i,t){return Tt({},Hd,i,t)}function Id(i,t){return Tt({},zd,i,t)}function Md(i,t){return Tt({},Vd,i,t)}function Ld(i,t){return Tt({},Yd,i,t)}function Od(i,t){return Tt([],jd,i,t)}function Dd(i,t){const e=_i(i.getAttribute("queryable"));return Tt({queryable:j(e)?e:!1},Gh,i,t)}function Pd(i,t){var e=t[t.length-1];const r=Tt({},Gh,i,t);if(!j(r))return;let n=_i(i.getAttribute("queryable"));j(n)||(n=e.queryable),r.queryable=j(n)?n:!1;let o=Gn(i.getAttribute("cascaded"));j(o)||(o=e.cascaded),r.cascaded=o;let s=_i(i.getAttribute("opaque"));j(s)||(s=e.opaque),r.opaque=j(s)?s:!1;let a=_i(i.getAttribute("noSubsets"));j(a)||(a=e.noSubsets),r.noSubsets=j(a)?a:!1;let l=Oe(i.getAttribute("fixedWidth"));j(l)||(l=e.fixedWidth),r.fixedWidth=l;let h=Oe(i.getAttribute("fixedHeight"));j(h)||(h=e.fixedHeight),r.fixedHeight=h;const c=["Style","CRS","AuthorityURL"];for(let d=0,g=c.length;d<g;d++){const f=c[d],p=e[f];if(j(p)){let m=$h(r,f,[]);m=m.concat(p),r[f]=m}}const u=["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"];for(let d=0,g=u.length;d<g;d++){const f=u[d],p=r[f];if(!j(p)){const m=e[f];r[f]=m}}return r}function $d(i,t){return{name:i.getAttribute("name"),units:i.getAttribute("units"),unitSymbol:i.getAttribute("unitSymbol"),default:i.getAttribute("default"),multipleValues:_i(i.getAttribute("multipleValues")),nearestValue:_i(i.getAttribute("nearestValue")),current:_i(i.getAttribute("current")),values:Q(i)}}function Ne(i,t){return Tt({},ig,i,t)}function kd(i,t){return Tt({},Kd,i,t)}function Nd(i,t){return Tt({},Qd,i,t)}function Fd(i,t){return Tt({},tg,i,t)}function Uo(i,t){return Tt({},Jd,i,t)}function Uh(i,t){var e=Ne(i,t);if(j(e)){const r=[Gn(i.getAttribute("width")),Gn(i.getAttribute("height"))];return e.size=r,e}}function Ud(i,t){var e=Ne(i,t);if(j(e))return e.name=i.getAttribute("name"),e}function Bd(i,t){var e=Ne(i,t);if(j(e))return e.type=i.getAttribute("type"),e}function Gd(i,t){return Tt({},eg,i,t)}function Bh(i,t){return Tt([],rg,i,t)}const Mt=[null,"http://www.opengis.net/wms"],Xd=It(Mt,{Service:D(Ad),Capability:D(Cd)}),Wd=It(Mt,{Request:D(kd),Exception:D(Od),Layer:D(Dd)}),Hd=It(Mt,{Name:D(Q),Title:D(Q),Abstract:D(Q),KeywordList:D(Bh),OnlineResource:D(ia),ContactInformation:D(Id),Fees:D(Q),AccessConstraints:D(Q),LayerLimit:D(Fo),MaxWidth:D(Fo),MaxHeight:D(Fo)}),zd=It(Mt,{ContactPersonPrimary:D(Md),ContactPosition:D(Q),ContactAddress:D(Ld),ContactVoiceTelephone:D(Q),ContactFacsimileTelephone:D(Q),ContactElectronicMailAddress:D(Q)}),Vd=It(Mt,{ContactPerson:D(Q),ContactOrganization:D(Q)}),Yd=It(Mt,{AddressType:D(Q),Address:D(Q),City:D(Q),StateOrProvince:D(Q),PostCode:D(Q),Country:D(Q)}),jd=It(Mt,{Format:Nh(Q)}),Gh=It(Mt,{Name:D(Q),Title:D(Q),Abstract:D(Q),KeywordList:D(Bh),CRS:Ut(Q),SRS:Ut(Q),EX_GeographicBoundingBox:D(Rd),LatLonBoundingBox:D(wd),BoundingBox:Ut(Sd),Dimension:Ut($d),Attribution:D(bd),AuthorityURL:Ut(Ud),Identifier:Ut(Q),MetadataURL:Ut(Bd),DataURL:Ut(Ne),FeatureListURL:Ut(Ne),Style:Ut(Gd),MinScaleDenominator:D(Ui),MaxScaleDenominator:D(Ui),ScaleHint:D(Td),Layer:Ut(Pd)}),Zd=It(Mt,{Title:D(Q),OnlineResource:D(ia),LogoURL:D(Uh)}),qd=It(Mt,{westBoundLongitude:D(Ui),eastBoundLongitude:D(Ui),southBoundLatitude:D(Ui),northBoundLatitude:D(Ui)}),Kd=It(Mt,{GetCapabilities:D(Uo),GetMap:D(Uo),GetFeatureInfo:D(Uo)}),Jd=It(Mt,{Format:Ut(Q),DCPType:Ut(Nd)}),Qd=It(Mt,{HTTP:D(Fd)}),tg=It(Mt,{Get:D(Ne),Post:D(Ne)}),eg=It(Mt,{Name:D(Q),Title:D(Q),Abstract:D(Q),LegendURL:Ut(Uh),StyleSheetURL:D(Ne),StyleURL:D(Ne)}),ig=It(Mt,{Format:D(Q),OnlineResource:D(ia)}),rg=It(Mt,{Keyword:Nh(Q)});class ng{constructor(t,e){!e&&typeof window<"u"&&(e=window.DOMParser),this.version=void 0,this._parser=new fd(e),this._data=t}data(t){return this._data=t,this}toJSON(t){return t=t||this._data,this.parse(t)}parse(t){return this.readFromDocument(this._parser.toDocument(t))}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Ur.ELEMENT)return this.readFromNode(e);return null}readFromNode(t){return this.version=t.getAttribute("version"),Tt({version:this.version},Xd,t,[])||null}}async function og(i){let t=new URL(i),e=t.searchParams;e.set("SERVICE","WMS"),e.set("REQUEST","GetCapabilities");let r=t.toString();const n=await fetch(r);if(n.ok){const o=await n.text();return new ng(o).toJSON()}else throw new Error(`Error: ${n.status}`)}function ra(i){const t=/\b(?:wms|ows)\b/i,e=/{(?:z|x|y-?)}\/{(?:z|x|y-?)}\/{(?:z|x|y-?)}/i;return t.test(i)?"TileWMS":e.test(i)?"XYZ":!1}function sg(i){const t=/^(?:(?:https?|ftp):\/\/|\/\/)?(?:localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|(?:\w+[\w-]*\.)+\w+)(?::\d+)?(?:\/\S*)?$/.test(i),e=ra(i);return!!(i&&t&&e)}function Xh(i){return i.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": ').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/\s*(\{|}|\[|\]|,)\s*/g,"$1").replaceAll('": //',"://")}function ag(i){try{return JSON.parse(Xh(i)),!!i}catch{return!1}}function lg(i,t){const e=new URL(i).searchParams;Object.entries(t).forEach(([o,s])=>{typeof s=="object"&&!Array.isArray(s)&&s!==null?Object.keys(s).forEach(a=>{e.set(a,s[a])}):e.set(o,s)});const r=i.split("?")[0],n=e.toString();return`${r}?${n}`}/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ll(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),e.push.apply(e,r)}return e}function ve(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ll(Object(e),!0).forEach(function(r){hg(i,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):ll(Object(e)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(e,r))})}return i}function Sn(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sn=function(t){return typeof t}:Sn=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sn(i)}function hg(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function Fe(){return Fe=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r])}return i},Fe.apply(this,arguments)}function cg(i,t){if(i==null)return{};var e={},r=Object.keys(i),n,o;for(o=0;o<r.length;o++)n=r[o],!(t.indexOf(n)>=0)&&(e[n]=i[n]);return e}function ug(i,t){if(i==null)return{};var e=cg(i,t),r,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(e[r]=i[r])}return e}var dg="1.15.2";function De(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var Ue=De(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Jr=De(/Edge/i),hl=De(/firefox/i),Ir=De(/safari/i)&&!De(/chrome/i)&&!De(/android/i),Wh=De(/iP(ad|od|hone)/i),Hh=De(/chrome/i)&&De(/android/i),zh={capture:!1,passive:!1};function rt(i,t,e){i.addEventListener(t,e,!Ue&&zh)}function K(i,t,e){i.removeEventListener(t,e,!Ue&&zh)}function Xn(i,t){if(t){if(t[0]===">"&&(t=t.substring(1)),i)try{if(i.matches)return i.matches(t);if(i.msMatchesSelector)return i.msMatchesSelector(t);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(t)}catch{return!1}return!1}}function gg(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function ce(i,t,e,r){if(i){e=e||document;do{if(t!=null&&(t[0]===">"?i.parentNode===e&&Xn(i,t):Xn(i,t))||r&&i===e)return i;if(i===e)break}while(i=gg(i))}return null}var cl=/\s+/g;function Wt(i,t,e){if(i&&t)if(i.classList)i.classList[e?"add":"remove"](t);else{var r=(" "+i.className+" ").replace(cl," ").replace(" "+t+" "," ");i.className=(r+(e?" "+t:"")).replace(cl," ")}}function U(i,t,e){var r=i&&i.style;if(r){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(e=i.currentStyle),t===void 0?e:e[t];!(t in r)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),r[t]=e+(typeof e=="string"?"":"px")}}function Vi(i,t){var e="";if(typeof i=="string")e=i;else do{var r=U(i,"transform");r&&r!=="none"&&(e=r+" "+e)}while(!t&&(i=i.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function Vh(i,t,e){if(i){var r=i.getElementsByTagName(t),n=0,o=r.length;if(e)for(;n<o;n++)e(r[n],n);return r}return[]}function ye(){var i=document.scrollingElement;return i||document.documentElement}function _t(i,t,e,r,n){if(!(!i.getBoundingClientRect&&i!==window)){var o,s,a,l,h,c,u;if(i!==window&&i.parentNode&&i!==ye()?(o=i.getBoundingClientRect(),s=o.top,a=o.left,l=o.bottom,h=o.right,c=o.height,u=o.width):(s=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||e)&&i!==window&&(n=n||i.parentNode,!Ue))do if(n&&n.getBoundingClientRect&&(U(n,"transform")!=="none"||e&&U(n,"position")!=="static")){var d=n.getBoundingClientRect();s-=d.top+parseInt(U(n,"border-top-width")),a-=d.left+parseInt(U(n,"border-left-width")),l=s+o.height,h=a+o.width;break}while(n=n.parentNode);if(r&&i!==window){var g=Vi(n||i),f=g&&g.a,p=g&&g.d;g&&(s/=p,a/=f,u/=f,c/=p,l=s+c,h=a+u)}return{top:s,left:a,bottom:l,right:h,width:u,height:c}}}function ul(i,t,e){for(var r=qe(i,!0),n=_t(i)[t];r;){var o=_t(r)[e],s=void 0;if(s=n>=o,!s)return r;if(r===ye())break;r=qe(r,!1)}return!1}function Ki(i,t,e,r){for(var n=0,o=0,s=i.children;o<s.length;){if(s[o].style.display!=="none"&&s[o]!==B.ghost&&(r||s[o]!==B.dragged)&&ce(s[o],e.draggable,i,!1)){if(n===t)return s[o];n++}o++}return null}function na(i,t){for(var e=i.lastElementChild;e&&(e===B.ghost||U(e,"display")==="none"||t&&!Xn(e,t));)e=e.previousElementSibling;return e||null}function ee(i,t){var e=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==B.clone&&(!t||Xn(i,t))&&e++;return e}function dl(i){var t=0,e=0,r=ye();if(i)do{var n=Vi(i),o=n.a,s=n.d;t+=i.scrollLeft*o,e+=i.scrollTop*s}while(i!==r&&(i=i.parentNode));return[t,e]}function fg(i,t){for(var e in i)if(i.hasOwnProperty(e)){for(var r in t)if(t.hasOwnProperty(r)&&t[r]===i[e][r])return Number(e)}return-1}function qe(i,t){if(!i||!i.getBoundingClientRect)return ye();var e=i,r=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=U(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return ye();if(r||t)return e;r=!0}}while(e=e.parentNode);return ye()}function pg(i,t){if(i&&t)for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}function Bo(i,t){return Math.round(i.top)===Math.round(t.top)&&Math.round(i.left)===Math.round(t.left)&&Math.round(i.height)===Math.round(t.height)&&Math.round(i.width)===Math.round(t.width)}var Mr;function Yh(i,t){return function(){if(!Mr){var e=arguments,r=this;e.length===1?i.call(r,e[0]):i.apply(r,e),Mr=setTimeout(function(){Mr=void 0},t)}}}function mg(){clearTimeout(Mr),Mr=void 0}function jh(i,t,e){i.scrollLeft+=t,i.scrollTop+=e}function Zh(i){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(i).cloneNode(!0):e?e(i).clone(!0)[0]:i.cloneNode(!0)}function qh(i,t,e){var r={};return Array.from(i.children).forEach(function(n){var o,s,a,l;if(!(!ce(n,t.draggable,i,!1)||n.animated||n===e)){var h=_t(n);r.left=Math.min((o=r.left)!==null&&o!==void 0?o:1/0,h.left),r.top=Math.min((s=r.top)!==null&&s!==void 0?s:1/0,h.top),r.right=Math.max((a=r.right)!==null&&a!==void 0?a:-1/0,h.right),r.bottom=Math.max((l=r.bottom)!==null&&l!==void 0?l:-1/0,h.bottom)}}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var Vt="Sortable"+new Date().getTime();function _g(){var i=[],t;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var e=[].slice.call(this.el.children);e.forEach(function(r){if(!(U(r,"display")==="none"||r===B.ghost)){i.push({target:r,rect:_t(r)});var n=ve({},i[i.length-1].rect);if(r.thisAnimationDuration){var o=Vi(r,!0);o&&(n.top-=o.f,n.left-=o.e)}r.fromRect=n}})}},addAnimationState:function(e){i.push(e)},removeAnimationState:function(e){i.splice(fg(i,{target:e}),1)},animateAll:function(e){var r=this;if(!this.options.animation){clearTimeout(t),typeof e=="function"&&e();return}var n=!1,o=0;i.forEach(function(s){var a=0,l=s.target,h=l.fromRect,c=_t(l),u=l.prevFromRect,d=l.prevToRect,g=s.rect,f=Vi(l,!0);f&&(c.top-=f.f,c.left-=f.e),l.toRect=c,l.thisAnimationDuration&&Bo(u,c)&&!Bo(h,c)&&(g.top-c.top)/(g.left-c.left)===(h.top-c.top)/(h.left-c.left)&&(a=xg(g,u,d,r.options)),Bo(c,h)||(l.prevFromRect=h,l.prevToRect=c,a||(a=r.options.animation),r.animate(l,g,c,a)),a&&(n=!0,o=Math.max(o,a),clearTimeout(l.animationResetTimer),l.animationResetTimer=setTimeout(function(){l.animationTime=0,l.prevFromRect=null,l.fromRect=null,l.prevToRect=null,l.thisAnimationDuration=null},a),l.thisAnimationDuration=a)}),clearTimeout(t),n?t=setTimeout(function(){typeof e=="function"&&e()},o):typeof e=="function"&&e(),i=[]},animate:function(e,r,n,o){if(o){U(e,"transition",""),U(e,"transform","");var s=Vi(this.el),a=s&&s.a,l=s&&s.d,h=(r.left-n.left)/(a||1),c=(r.top-n.top)/(l||1);e.animatingX=!!h,e.animatingY=!!c,U(e,"transform","translate3d("+h+"px,"+c+"px,0)"),this.forRepaintDummy=yg(e),U(e,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),U(e,"transform","translate3d(0,0,0)"),typeof e.animated=="number"&&clearTimeout(e.animated),e.animated=setTimeout(function(){U(e,"transition",""),U(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},o)}}}}function yg(i){return i.offsetWidth}function xg(i,t,e,r){return Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*r.animation}var wi=[],Go={initializeByDefault:!0},Qr={mount:function(i){for(var t in Go)Go.hasOwnProperty(t)&&!(t in i)&&(i[t]=Go[t]);wi.forEach(function(e){if(e.pluginName===i.pluginName)throw"Sortable: Cannot mount plugin ".concat(i.pluginName," more than once")}),wi.push(i)},pluginEvent:function(i,t,e){var r=this;this.eventCanceled=!1,e.cancel=function(){r.eventCanceled=!0};var n=i+"Global";wi.forEach(function(o){t[o.pluginName]&&(t[o.pluginName][n]&&t[o.pluginName][n](ve({sortable:t},e)),t.options[o.pluginName]&&t[o.pluginName][i]&&t[o.pluginName][i](ve({sortable:t},e)))})},initializePlugins:function(i,t,e,r){wi.forEach(function(s){var a=s.pluginName;if(!(!i.options[a]&&!s.initializeByDefault)){var l=new s(i,t,i.options);l.sortable=i,l.options=i.options,i[a]=l,Fe(e,l.defaults)}});for(var n in i.options)if(i.options.hasOwnProperty(n)){var o=this.modifyOption(i,n,i.options[n]);typeof o<"u"&&(i.options[n]=o)}},getEventProperties:function(i,t){var e={};return wi.forEach(function(r){typeof r.eventProperties=="function"&&Fe(e,r.eventProperties.call(t[r.pluginName],i))}),e},modifyOption:function(i,t,e){var r;return wi.forEach(function(n){i[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[t]=="function"&&(r=n.optionListeners[t].call(i[n.pluginName],e))}),r}};function vg(i){var t=i.sortable,e=i.rootEl,r=i.name,n=i.targetEl,o=i.cloneEl,s=i.toEl,a=i.fromEl,l=i.oldIndex,h=i.newIndex,c=i.oldDraggableIndex,u=i.newDraggableIndex,d=i.originalEvent,g=i.putSortable,f=i.extraEventProperties;if(t=t||e&&e[Vt],!!t){var p,m=t.options,y="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Ue&&!Jr?p=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(r,!0,!0)),p.to=s||e,p.from=a||e,p.item=n||e,p.clone=o,p.oldIndex=l,p.newIndex=h,p.oldDraggableIndex=c,p.newDraggableIndex=u,p.originalEvent=d,p.pullMode=g?g.lastPutMode:void 0;var _=ve(ve({},f),Qr.getEventProperties(r,t));for(var x in _)p[x]=_[x];e&&e.dispatchEvent(p),m[y]&&m[y].call(t,p)}}var Eg=["evt"],Ft=function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=e.evt,n=ug(e,Eg);Qr.pluginEvent.bind(B)(i,t,ve({dragEl:C,parentEl:ft,ghostEl:W,rootEl:ct,nextEl:ci,lastDownEl:wn,cloneEl:ut,cloneHidden:Ze,dragStarted:_r,putSortable:Rt,activeSortable:B.active,originalEvent:r,oldIndex:Bi,oldDraggableIndex:Lr,newIndex:Ht,newDraggableIndex:je,hideGhostForTarget:tc,unhideGhostForTarget:ec,cloneNowHidden:function(){Ze=!0},cloneNowShown:function(){Ze=!1},dispatchSortableEvent:function(o){Nt({sortable:t,name:o,originalEvent:r})}},n))};function Nt(i){vg(ve({putSortable:Rt,cloneEl:ut,targetEl:C,rootEl:ct,oldIndex:Bi,oldDraggableIndex:Lr,newIndex:Ht,newDraggableIndex:je},i))}var C,ft,W,ct,ci,wn,ut,Ze,Bi,Ht,Lr,je,hn,Rt,Oi=!1,Wn=!1,Hn=[],ai,ae,Xo,Wo,gl,fl,_r,Ti,Or,Dr=!1,cn=!1,Tn,Lt,Ho=[],fs=!1,zn=[],lo=typeof document<"u",un=Wh,pl=Jr||Ue?"cssFloat":"float",bg=lo&&!Hh&&!Wh&&"draggable"in document.createElement("div"),Kh=function(){if(lo){if(Ue)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Jh=function(i,t){var e=U(i),r=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),n=Ki(i,0,t),o=Ki(i,1,t),s=n&&U(n),a=o&&U(o),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+_t(n).width,h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+_t(o).width;if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&s.float&&s.float!=="none"){var c=s.float==="left"?"left":"right";return o&&(a.clear==="both"||a.clear===c)?"vertical":"horizontal"}return n&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||l>=r&&e[pl]==="none"||o&&e[pl]==="none"&&l+h>r)?"vertical":"horizontal"},Sg=function(i,t,e){var r=e?i.left:i.top,n=e?i.right:i.bottom,o=e?i.width:i.height,s=e?t.left:t.top,a=e?t.right:t.bottom,l=e?t.width:t.height;return r===s||n===a||r+o/2===s+l/2},wg=function(i,t){var e;return Hn.some(function(r){var n=r[Vt].options.emptyInsertThreshold;if(!(!n||na(r))){var o=_t(r),s=i>=o.left-n&&i<=o.right+n,a=t>=o.top-n&&t<=o.bottom+n;if(s&&a)return e=r}}),e},Qh=function(i){function t(n,o){return function(s,a,l,h){var c=s.options.group.name&&a.options.group.name&&s.options.group.name===a.options.group.name;if(n==null&&(o||c))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return t(n(s,a,l,h),o)(s,a,l,h);var u=(o?s:a).options.group.name;return n===!0||typeof n=="string"&&n===u||n.join&&n.indexOf(u)>-1}}var e={},r=i.group;(!r||Sn(r)!="object")&&(r={name:r}),e.name=r.name,e.checkPull=t(r.pull,!0),e.checkPut=t(r.put),e.revertClone=r.revertClone,i.group=e},tc=function(){!Kh&&W&&U(W,"display","none")},ec=function(){!Kh&&W&&U(W,"display","")};lo&&!Hh&&document.addEventListener("click",function(i){if(Wn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),Wn=!1,!1},!0);var li=function(i){if(C){i=i.touches?i.touches[0]:i;var t=wg(i.clientX,i.clientY);if(t){var e={};for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);e.target=e.rootEl=t,e.preventDefault=void 0,e.stopPropagation=void 0,t[Vt]._onDragOver(e)}}},Tg=function(i){C&&C.parentNode[Vt]._isOutsideThisEl(i.target)};function B(i,t){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=t=Fe({},t),i[Vt]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Jh(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,s){o.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:B.supportPointer!==!1&&"PointerEvent"in window&&!Ir,emptyInsertThreshold:5};Qr.initializePlugins(this,i,e);for(var r in e)!(r in t)&&(t[r]=e[r]);Qh(t);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=t.forceFallback?!1:bg,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?rt(i,"pointerdown",this._onTapStart):(rt(i,"mousedown",this._onTapStart),rt(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(rt(i,"dragover",this),rt(i,"dragenter",this)),Hn.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),Fe(this,_g())}B.prototype={constructor:B,_isOutsideThisEl:function(i){!this.el.contains(i)&&i!==this.el&&(Ti=null)},_getDirection:function(i,t){return typeof this.options.direction=="function"?this.options.direction.call(this,i,t,C):this.options.direction},_onTapStart:function(i){if(i.cancelable){var t=this,e=this.el,r=this.options,n=r.preventOnFilter,o=i.type,s=i.touches&&i.touches[0]||i.pointerType&&i.pointerType==="touch"&&i,a=(s||i).target,l=i.target.shadowRoot&&(i.path&&i.path[0]||i.composedPath&&i.composedPath()[0])||a,h=r.filter;if(Dg(e),!C&&!(/mousedown|pointerdown/.test(o)&&i.button!==0||r.disabled)&&!l.isContentEditable&&!(!this.nativeDraggable&&Ir&&a&&a.tagName.toUpperCase()==="SELECT")&&(a=ce(a,r.draggable,e,!1),!(a&&a.animated)&&wn!==a)){if(Bi=ee(a),Lr=ee(a,r.draggable),typeof h=="function"){if(h.call(this,i,a,this)){Nt({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:e,fromEl:e}),Ft("filter",t,{evt:i}),n&&i.cancelable&&i.preventDefault();return}}else if(h&&(h=h.split(",").some(function(c){if(c=ce(l,c.trim(),e,!1),c)return Nt({sortable:t,rootEl:c,name:"filter",targetEl:a,fromEl:e,toEl:e}),Ft("filter",t,{evt:i}),!0}),h)){n&&i.cancelable&&i.preventDefault();return}r.handle&&!ce(l,r.handle,e,!1)||this._prepareDragStart(i,s,a)}}},_prepareDragStart:function(i,t,e){var r=this,n=r.el,o=r.options,s=n.ownerDocument,a;if(e&&!C&&e.parentNode===n){var l=_t(e);if(ct=n,C=e,ft=C.parentNode,ci=C.nextSibling,wn=e,hn=o.group,B.dragged=C,ai={target:C,clientX:(t||i).clientX,clientY:(t||i).clientY},gl=ai.clientX-l.left,fl=ai.clientY-l.top,this._lastX=(t||i).clientX,this._lastY=(t||i).clientY,C.style["will-change"]="all",a=function(){if(Ft("delayEnded",r,{evt:i}),B.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!hl&&r.nativeDraggable&&(C.draggable=!0),r._triggerDragStart(i,t),Nt({sortable:r,name:"choose",originalEvent:i}),Wt(C,o.chosenClass,!0)},o.ignore.split(",").forEach(function(h){Vh(C,h.trim(),zo)}),rt(s,"dragover",li),rt(s,"mousemove",li),rt(s,"touchmove",li),rt(s,"mouseup",r._onDrop),rt(s,"touchend",r._onDrop),rt(s,"touchcancel",r._onDrop),hl&&this.nativeDraggable&&(this.options.touchStartThreshold=4,C.draggable=!0),Ft("delayStart",this,{evt:i}),o.delay&&(!o.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Jr||Ue))){if(B.eventCanceled){this._onDrop();return}rt(s,"mouseup",r._disableDelayedDrag),rt(s,"touchend",r._disableDelayedDrag),rt(s,"touchcancel",r._disableDelayedDrag),rt(s,"mousemove",r._delayedDragTouchMoveHandler),rt(s,"touchmove",r._delayedDragTouchMoveHandler),o.supportPointer&&rt(s,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(a,o.delay)}else a()}},_delayedDragTouchMoveHandler:function(i){var t=i.touches?i.touches[0]:i;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){C&&zo(C),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var i=this.el.ownerDocument;K(i,"mouseup",this._disableDelayedDrag),K(i,"touchend",this._disableDelayedDrag),K(i,"touchcancel",this._disableDelayedDrag),K(i,"mousemove",this._delayedDragTouchMoveHandler),K(i,"touchmove",this._delayedDragTouchMoveHandler),K(i,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(i,t){t=t||i.pointerType=="touch"&&i,!this.nativeDraggable||t?this.options.supportPointer?rt(document,"pointermove",this._onTouchMove):t?rt(document,"touchmove",this._onTouchMove):rt(document,"mousemove",this._onTouchMove):(rt(C,"dragend",this),rt(ct,"dragstart",this._onDragStart));try{document.selection?Rn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(i,t){if(Oi=!1,ct&&C){Ft("dragStarted",this,{evt:t}),this.nativeDraggable&&rt(document,"dragover",Tg);var e=this.options;!i&&Wt(C,e.dragClass,!1),Wt(C,e.ghostClass,!0),B.active=this,i&&this._appendGhost(),Nt({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ae){this._lastX=ae.clientX,this._lastY=ae.clientY,tc();for(var i=document.elementFromPoint(ae.clientX,ae.clientY),t=i;i&&i.shadowRoot&&(i=i.shadowRoot.elementFromPoint(ae.clientX,ae.clientY),i!==t);)t=i;if(C.parentNode[Vt]._isOutsideThisEl(i),t)do{if(t[Vt]){var e=void 0;if(e=t[Vt]._onDragOver({clientX:ae.clientX,clientY:ae.clientY,target:i,rootEl:t}),e&&!this.options.dragoverBubble)break}i=t}while(t=t.parentNode);ec()}},_onTouchMove:function(i){if(ai){var t=this.options,e=t.fallbackTolerance,r=t.fallbackOffset,n=i.touches?i.touches[0]:i,o=W&&Vi(W,!0),s=W&&o&&o.a,a=W&&o&&o.d,l=un&&Lt&&dl(Lt),h=(n.clientX-ai.clientX+r.x)/(s||1)+(l?l[0]-Ho[0]:0)/(s||1),c=(n.clientY-ai.clientY+r.y)/(a||1)+(l?l[1]-Ho[1]:0)/(a||1);if(!B.active&&!Oi){if(e&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<e)return;this._onDragStart(i,!0)}if(W){o?(o.e+=h-(Xo||0),o.f+=c-(Wo||0)):o={a:1,b:0,c:0,d:1,e:h,f:c};var u="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");U(W,"webkitTransform",u),U(W,"mozTransform",u),U(W,"msTransform",u),U(W,"transform",u),Xo=h,Wo=c,ae=n}i.cancelable&&i.preventDefault()}},_appendGhost:function(){if(!W){var i=this.options.fallbackOnBody?document.body:ct,t=_t(C,!0,un,!0,i),e=this.options;if(un){for(Lt=i;U(Lt,"position")==="static"&&U(Lt,"transform")==="none"&&Lt!==document;)Lt=Lt.parentNode;Lt!==document.body&&Lt!==document.documentElement?(Lt===document&&(Lt=ye()),t.top+=Lt.scrollTop,t.left+=Lt.scrollLeft):Lt=ye(),Ho=dl(Lt)}W=C.cloneNode(!0),Wt(W,e.ghostClass,!1),Wt(W,e.fallbackClass,!0),Wt(W,e.dragClass,!0),U(W,"transition",""),U(W,"transform",""),U(W,"box-sizing","border-box"),U(W,"margin",0),U(W,"top",t.top),U(W,"left",t.left),U(W,"width",t.width),U(W,"height",t.height),U(W,"opacity","0.8"),U(W,"position",un?"absolute":"fixed"),U(W,"zIndex","100000"),U(W,"pointerEvents","none"),B.ghost=W,i.appendChild(W),U(W,"transform-origin",gl/parseInt(W.style.width)*100+"% "+fl/parseInt(W.style.height)*100+"%")}},_onDragStart:function(i,t){var e=this,r=i.dataTransfer,n=e.options;if(Ft("dragStart",this,{evt:i}),B.eventCanceled){this._onDrop();return}Ft("setupClone",this),B.eventCanceled||(ut=Zh(C),ut.removeAttribute("id"),ut.draggable=!1,ut.style["will-change"]="",this._hideClone(),Wt(ut,this.options.chosenClass,!1),B.clone=ut),e.cloneId=Rn(function(){Ft("clone",e),!B.eventCanceled&&(e.options.removeCloneOnHide||ct.insertBefore(ut,C),e._hideClone(),Nt({sortable:e,name:"clone"}))}),!t&&Wt(C,n.dragClass,!0),t?(Wn=!0,e._loopId=setInterval(e._emulateDragOver,50)):(K(document,"mouseup",e._onDrop),K(document,"touchend",e._onDrop),K(document,"touchcancel",e._onDrop),r&&(r.effectAllowed="move",n.setData&&n.setData.call(e,r,C)),rt(document,"drop",e),U(C,"transform","translateZ(0)")),Oi=!0,e._dragStartId=Rn(e._dragStarted.bind(e,t,i)),rt(document,"selectstart",e),_r=!0,Ir&&U(document.body,"user-select","none")},_onDragOver:function(i){var t=this.el,e=i.target,r,n,o,s=this.options,a=s.group,l=B.active,h=hn===a,c=s.sort,u=Rt||l,d,g=this,f=!1;if(fs)return;function p(F,at){Ft(F,g,ve({evt:i,isOwner:h,axis:d?"vertical":"horizontal",revert:o,dragRect:r,targetRect:n,canSort:c,fromSortable:u,target:e,completed:y,onMove:function(tt,q){return dn(ct,t,C,r,tt,_t(tt),i,q)},changed:_},at))}function m(){p("dragOverAnimationCapture"),g.captureAnimationState(),g!==u&&u.captureAnimationState()}function y(F){return p("dragOverCompleted",{insertion:F}),F&&(h?l._hideClone():l._showClone(g),g!==u&&(Wt(C,Rt?Rt.options.ghostClass:l.options.ghostClass,!1),Wt(C,s.ghostClass,!0)),Rt!==g&&g!==B.active?Rt=g:g===B.active&&Rt&&(Rt=null),u===g&&(g._ignoreWhileAnimating=e),g.animateAll(function(){p("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==u&&(u.animateAll(),u._ignoreWhileAnimating=null)),(e===C&&!C.animated||e===t&&!e.animated)&&(Ti=null),!s.dragoverBubble&&!i.rootEl&&e!==document&&(C.parentNode[Vt]._isOutsideThisEl(i.target),!F&&li(i)),!s.dragoverBubble&&i.stopPropagation&&i.stopPropagation(),f=!0}function _(){Ht=ee(C),je=ee(C,s.draggable),Nt({sortable:g,name:"change",toEl:t,newIndex:Ht,newDraggableIndex:je,originalEvent:i})}if(i.preventDefault!==void 0&&i.cancelable&&i.preventDefault(),e=ce(e,s.draggable,t,!0),p("dragOver"),B.eventCanceled)return f;if(C.contains(i.target)||e.animated&&e.animatingX&&e.animatingY||g._ignoreWhileAnimating===e)return y(!1);if(Wn=!1,l&&!s.disabled&&(h?c||(o=ft!==ct):Rt===this||(this.lastPutMode=hn.checkPull(this,l,C,i))&&a.checkPut(this,l,C,i))){if(d=this._getDirection(i,e)==="vertical",r=_t(C),p("dragOverValid"),B.eventCanceled)return f;if(o)return ft=ct,m(),this._hideClone(),p("revert"),B.eventCanceled||(ci?ct.insertBefore(C,ci):ct.appendChild(C)),y(!0);var x=na(t,s.draggable);if(!x||Ig(i,d,this)&&!x.animated){if(x===C)return y(!1);if(x&&t===i.target&&(e=x),e&&(n=_t(e)),dn(ct,t,C,r,e,n,i,!!e)!==!1)return m(),x&&x.nextSibling?t.insertBefore(C,x.nextSibling):t.appendChild(C),ft=t,_(),y(!0)}else if(x&&Ag(i,d,this)){var E=Ki(t,0,s,!0);if(E===C)return y(!1);if(e=E,n=_t(e),dn(ct,t,C,r,e,n,i,!1)!==!1)return m(),t.insertBefore(C,E),ft=t,_(),y(!0)}else if(e.parentNode===t){n=_t(e);var v=0,T,w=C.parentNode!==t,S=!Sg(C.animated&&C.toRect||r,e.animated&&e.toRect||n,d),R=d?"top":"left",O=ul(e,"top","top")||ul(C,"top","top"),$=O?O.scrollTop:void 0;Ti!==e&&(T=n[R],Dr=!1,cn=!S&&s.invertSwap||w),v=Mg(i,e,n,d,S?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,cn,Ti===e);var M;if(v!==0){var X=ee(C);do X-=v,M=ft.children[X];while(M&&(U(M,"display")==="none"||M===W))}if(v===0||M===e)return y(!1);Ti=e,Or=v;var L=e.nextElementSibling,P=!1;P=v===1;var I=dn(ct,t,C,r,e,n,i,P);if(I!==!1)return(I===1||I===-1)&&(P=I===1),fs=!0,setTimeout(Cg,30),m(),P&&!L?t.appendChild(C):e.parentNode.insertBefore(C,P?L:e),O&&jh(O,0,$-O.scrollTop),ft=C.parentNode,T!==void 0&&!cn&&(Tn=Math.abs(T-_t(e)[R])),_(),y(!0)}if(t.contains(C))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){K(document,"mousemove",this._onTouchMove),K(document,"touchmove",this._onTouchMove),K(document,"pointermove",this._onTouchMove),K(document,"dragover",li),K(document,"mousemove",li),K(document,"touchmove",li)},_offUpEvents:function(){var i=this.el.ownerDocument;K(i,"mouseup",this._onDrop),K(i,"touchend",this._onDrop),K(i,"pointerup",this._onDrop),K(i,"touchcancel",this._onDrop),K(document,"selectstart",this)},_onDrop:function(i){var t=this.el,e=this.options;if(Ht=ee(C),je=ee(C,e.draggable),Ft("drop",this,{evt:i}),ft=C&&C.parentNode,Ht=ee(C),je=ee(C,e.draggable),B.eventCanceled){this._nulling();return}Oi=!1,cn=!1,Dr=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ps(this.cloneId),ps(this._dragStartId),this.nativeDraggable&&(K(document,"drop",this),K(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ir&&U(document.body,"user-select",""),U(C,"transform",""),i&&(_r&&(i.cancelable&&i.preventDefault(),!e.dropBubble&&i.stopPropagation()),W&&W.parentNode&&W.parentNode.removeChild(W),(ct===ft||Rt&&Rt.lastPutMode!=="clone")&&ut&&ut.parentNode&&ut.parentNode.removeChild(ut),C&&(this.nativeDraggable&&K(C,"dragend",this),zo(C),C.style["will-change"]="",_r&&!Oi&&Wt(C,Rt?Rt.options.ghostClass:this.options.ghostClass,!1),Wt(C,this.options.chosenClass,!1),Nt({sortable:this,name:"unchoose",toEl:ft,newIndex:null,newDraggableIndex:null,originalEvent:i}),ct!==ft?(Ht>=0&&(Nt({rootEl:ft,name:"add",toEl:ft,fromEl:ct,originalEvent:i}),Nt({sortable:this,name:"remove",toEl:ft,originalEvent:i}),Nt({rootEl:ft,name:"sort",toEl:ft,fromEl:ct,originalEvent:i}),Nt({sortable:this,name:"sort",toEl:ft,originalEvent:i})),Rt&&Rt.save()):Ht!==Bi&&Ht>=0&&(Nt({sortable:this,name:"update",toEl:ft,originalEvent:i}),Nt({sortable:this,name:"sort",toEl:ft,originalEvent:i})),B.active&&((Ht==null||Ht===-1)&&(Ht=Bi,je=Lr),Nt({sortable:this,name:"end",toEl:ft,originalEvent:i}),this.save()))),this._nulling()},_nulling:function(){Ft("nulling",this),ct=C=ft=W=ci=ut=wn=Ze=ai=ae=_r=Ht=je=Bi=Lr=Ti=Or=Rt=hn=B.dragged=B.ghost=B.clone=B.active=null,zn.forEach(function(i){i.checked=!0}),zn.length=Xo=Wo=0},handleEvent:function(i){switch(i.type){case"drop":case"dragend":this._onDrop(i);break;case"dragenter":case"dragover":C&&(this._onDragOver(i),Rg(i));break;case"selectstart":i.preventDefault();break}},toArray:function(){for(var i=[],t,e=this.el.children,r=0,n=e.length,o=this.options;r<n;r++)t=e[r],ce(t,o.draggable,this.el,!1)&&i.push(t.getAttribute(o.dataIdAttr)||Og(t));return i},sort:function(i,t){var e={},r=this.el;this.toArray().forEach(function(n,o){var s=r.children[o];ce(s,this.options.draggable,r,!1)&&(e[n]=s)},this),t&&this.captureAnimationState(),i.forEach(function(n){e[n]&&(r.removeChild(e[n]),r.appendChild(e[n]))}),t&&this.animateAll()},save:function(){var i=this.options.store;i&&i.set&&i.set(this)},closest:function(i,t){return ce(i,t||this.options.draggable,this.el,!1)},option:function(i,t){var e=this.options;if(t===void 0)return e[i];var r=Qr.modifyOption(this,i,t);typeof r<"u"?e[i]=r:e[i]=t,i==="group"&&Qh(e)},destroy:function(){Ft("destroy",this);var i=this.el;i[Vt]=null,K(i,"mousedown",this._onTapStart),K(i,"touchstart",this._onTapStart),K(i,"pointerdown",this._onTapStart),this.nativeDraggable&&(K(i,"dragover",this),K(i,"dragenter",this)),Array.prototype.forEach.call(i.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Hn.splice(Hn.indexOf(this.el),1),this.el=i=null},_hideClone:function(){if(!Ze){if(Ft("hideClone",this),B.eventCanceled)return;U(ut,"display","none"),this.options.removeCloneOnHide&&ut.parentNode&&ut.parentNode.removeChild(ut),Ze=!0}},_showClone:function(i){if(i.lastPutMode!=="clone"){this._hideClone();return}if(Ze){if(Ft("showClone",this),B.eventCanceled)return;C.parentNode==ct&&!this.options.group.revertClone?ct.insertBefore(ut,C):ci?ct.insertBefore(ut,ci):ct.appendChild(ut),this.options.group.revertClone&&this.animate(C,ut),U(ut,"display",""),Ze=!1}}};function Rg(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function dn(i,t,e,r,n,o,s,a){var l,h=i[Vt],c=h.options.onMove,u;return window.CustomEvent&&!Ue&&!Jr?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=i,l.dragged=e,l.draggedRect=r,l.related=n||t,l.relatedRect=o||_t(t),l.willInsertAfter=a,l.originalEvent=s,i.dispatchEvent(l),c&&(u=c.call(h,l,s)),u}function zo(i){i.draggable=!1}function Cg(){fs=!1}function Ag(i,t,e){var r=_t(Ki(e.el,0,e.options,!0)),n=qh(e.el,e.options,W),o=10;return t?i.clientX<n.left-o||i.clientY<r.top&&i.clientX<r.right:i.clientY<n.top-o||i.clientY<r.bottom&&i.clientX<r.left}function Ig(i,t,e){var r=_t(na(e.el,e.options.draggable)),n=qh(e.el,e.options,W),o=10;return t?i.clientX>n.right+o||i.clientY>r.bottom&&i.clientX>r.left:i.clientY>n.bottom+o||i.clientX>r.right&&i.clientY>r.top}function Mg(i,t,e,r,n,o,s,a){var l=r?i.clientY:i.clientX,h=r?e.height:e.width,c=r?e.top:e.left,u=r?e.bottom:e.right,d=!1;if(!s){if(a&&Tn<h*n){if(!Dr&&(Or===1?l>c+h*o/2:l<u-h*o/2)&&(Dr=!0),Dr)d=!0;else if(Or===1?l<c+Tn:l>u-Tn)return-Or}else if(l>c+h*(1-n)/2&&l<u-h*(1-n)/2)return Lg(t)}return d=d||s,d&&(l<c+h*o/2||l>u-h*o/2)?l>c+h/2?1:-1:0}function Lg(i){return ee(C)<ee(i)?1:-1}function Og(i){for(var t=i.tagName+i.className+i.src+i.href+i.textContent,e=t.length,r=0;e--;)r+=t.charCodeAt(e);return r.toString(36)}function Dg(i){zn.length=0;for(var t=i.getElementsByTagName("input"),e=t.length;e--;){var r=t[e];r.checked&&zn.push(r)}}function Rn(i){return setTimeout(i,0)}function ps(i){return clearTimeout(i)}lo&&rt(document,"touchmove",function(i){(B.active||Oi)&&i.cancelable&&i.preventDefault()});B.utils={on:rt,off:K,css:U,find:Vh,is:function(i,t){return!!ce(i,t,i,!1)},extend:pg,throttle:Yh,closest:ce,toggleClass:Wt,clone:Zh,index:ee,nextTick:Rn,cancelNextTick:ps,detectDirection:Jh,getChild:Ki};B.get=function(i){return i[Vt]};B.mount=function(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(B.utils=ve(ve({},B.utils),r.utils)),Qr.mount(r)})};B.create=function(i,t){return new B(i,t)};B.version=dg;var mt=[],yr,ms,_s=!1,Vo,Yo,Vn,xr;function Pg(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return i.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?rt(document,"dragover",this._handleAutoScroll):this.options.supportPointer?rt(document,"pointermove",this._handleFallbackAutoScroll):e.touches?rt(document,"touchmove",this._handleFallbackAutoScroll):rt(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;!this.options.dragOverBubble&&!e.rootEl&&this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?K(document,"dragover",this._handleAutoScroll):(K(document,"pointermove",this._handleFallbackAutoScroll),K(document,"touchmove",this._handleFallbackAutoScroll),K(document,"mousemove",this._handleFallbackAutoScroll)),ml(),Cn(),mg()},nulling:function(){Vn=ms=yr=_s=xr=Vo=Yo=null,mt.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var r=this,n=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,s=document.elementFromPoint(n,o);if(Vn=t,e||this.options.forceAutoScrollFallback||Jr||Ue||Ir){jo(t,this.options,s,e);var a=qe(s,!0);_s&&(!xr||n!==Vo||o!==Yo)&&(xr&&ml(),xr=setInterval(function(){var l=qe(document.elementFromPoint(n,o),!0);l!==a&&(a=l,Cn()),jo(t,r.options,l,e)},10),Vo=n,Yo=o)}else{if(!this.options.bubbleScroll||qe(s,!0)===ye()){Cn();return}jo(t,this.options,qe(s,!1),!1)}}},Fe(i,{pluginName:"scroll",initializeByDefault:!0})}function Cn(){mt.forEach(function(i){clearInterval(i.pid)}),mt=[]}function ml(){clearInterval(xr)}var jo=Yh(function(i,t,e,r){if(t.scroll){var n=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,s=t.scrollSensitivity,a=t.scrollSpeed,l=ye(),h=!1,c;ms!==e&&(ms=e,Cn(),yr=t.scroll,c=t.scrollFn,yr===!0&&(yr=qe(e,!0)));var u=0,d=yr;do{var g=d,f=_t(g),p=f.top,m=f.bottom,y=f.left,_=f.right,x=f.width,E=f.height,v=void 0,T=void 0,w=g.scrollWidth,S=g.scrollHeight,R=U(g),O=g.scrollLeft,$=g.scrollTop;g===l?(v=x<w&&(R.overflowX==="auto"||R.overflowX==="scroll"||R.overflowX==="visible"),T=E<S&&(R.overflowY==="auto"||R.overflowY==="scroll"||R.overflowY==="visible")):(v=x<w&&(R.overflowX==="auto"||R.overflowX==="scroll"),T=E<S&&(R.overflowY==="auto"||R.overflowY==="scroll"));var M=v&&(Math.abs(_-n)<=s&&O+x<w)-(Math.abs(y-n)<=s&&!!O),X=T&&(Math.abs(m-o)<=s&&$+E<S)-(Math.abs(p-o)<=s&&!!$);if(!mt[u])for(var L=0;L<=u;L++)mt[L]||(mt[L]={});(mt[u].vx!=M||mt[u].vy!=X||mt[u].el!==g)&&(mt[u].el=g,mt[u].vx=M,mt[u].vy=X,clearInterval(mt[u].pid),(M!=0||X!=0)&&(h=!0,mt[u].pid=setInterval((function(){r&&this.layer===0&&B.active._onTouchMove(Vn);var P=mt[this.layer].vy?mt[this.layer].vy*a:0,I=mt[this.layer].vx?mt[this.layer].vx*a:0;typeof c=="function"&&c.call(B.dragged.parentNode[Vt],I,P,i,Vn,mt[this.layer].el)!=="continue"||jh(mt[this.layer].el,I,P)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&d!==l&&(d=qe(d,!1)));_s=h}},30),ic=function(i){var t=i.originalEvent,e=i.putSortable,r=i.dragEl,n=i.activeSortable,o=i.dispatchSortableEvent,s=i.hideGhostForTarget,a=i.unhideGhostForTarget;if(t){var l=e||n;s();var h=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(h.clientX,h.clientY);a(),l&&!l.el.contains(c)&&(o("spill"),this.onSpill({dragEl:r,putSortable:e}))}};function oa(){}oa.prototype={startIndex:null,dragStart:function(i){var t=i.oldDraggableIndex;this.startIndex=t},onSpill:function(i){var t=i.dragEl,e=i.putSortable;this.sortable.captureAnimationState(),e&&e.captureAnimationState();var r=Ki(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),e&&e.animateAll()},drop:ic};Fe(oa,{pluginName:"revertOnSpill"});function sa(){}sa.prototype={onSpill:function(i){var t=i.dragEl,e=i.putSortable,r=e||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:ic};Fe(sa,{pluginName:"removeOnSpill"});B.mount(new Pg);B.mount(sa,oa);const $g=i=>{const t=i.item;let e=Array.prototype.slice.call(t.parentNode.childNodes);return e=e.filter(r=>r.nodeType!=Node.ELEMENT_NODE||!r.classList.contains("sortable-fallback")),e},kg=(i,t,e,r,n,o)=>{const s=i.item.parentNode;for(const f of e)s.appendChild(f);if(i.oldIndex==i.newIndex)return;const a=r.getArray(),l=i.item.querySelector("eox-layercontrol-layer").layer.get(n),h=a.find(f=>f.get(n)===l),c=o.dataset.layer,u=a.find(f=>f.get(n)==c);let d,g;for(d=0;d<a.length;d++)if(a[d]==h){r.removeAt(d);break}for(g=0;g<a.length;g++)if(a[g]===u){d>g?r.insertAt(g,h):r.insertAt(g+1,h);break}t.requestUpdate()};function Ng(i,t,e,r){let n=[],o=null;i._sortable=B.create(i,{handle:".drag-handle",filter:".drag-handle.disabled",swapThreshold:.5,animation:150,easing:"cubic-bezier(1, 0, 0, 1)",onStart:s=>n=$g(s),onMove:s=>{o=s.related},onEnd:s=>kg(s,r,n,t,e,o)})}function Fg(i,t,e,r){const n=i.getArray();let o=!1;n.forEach(s=>{const a=s.ol_uid;s.get(t)||(s.set(t,a),o=!0),s.get(e)||(s.set(e,`layer ${a}`),o=!0),o&&r.requestUpdate()})}function aa(i,t,e){let r=[];const n=(o,s,a)=>{r=[...r,...o.filter(h=>h.get(s)===a)];const l=o.filter(h=>h.getLayers);return l.length>0&&l.forEach(h=>n(h.getLayers().getArray(),s,a)),r};return n(i,t,e),r}function Ug(i,t,e){if(!i||!t)return!1;if(!rc(i,e))return!0;const r=i.get("minZoom"),n=i.get("maxZoom"),o=t.getView().getZoom();return o>r&&o<n}function rc(i,t){const e=i.get("minZoom"),r=i.get("maxZoom");return!!(t&&(e!==-1/0||r!==1/0))}function Bg(i,t){var e,r,n;return!i||!t?void 0:i.getLayers?"group":(n=(e=t.getInteractions().getArray().filter(o=>o.freehand_!==void 0).map(o=>o.source_))==null?void 0:e.ol_uid)!=null&&n.includes(i.getSource?(r=i.getSource())==null?void 0:r.ol_uid:void 0)?"draw":i.declutter_!==void 0?"vector":"raster"}class la{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Gg={PROPERTYCHANGE:"propertychange"};class nc{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Yi(i,t){return i>t?1:i<t?-1:0}function Xg(i,t){return i<t?1:i>t?-1:0}function oc(i,t,e){if(i[0]<=t)return 0;const r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let n=1;n<r;++n){const o=i[n];if(o===t)return n;if(o<t)return e(t,i[n-1],o)>0?n-1:n}return r-1}if(e>0){for(let n=1;n<r;++n)if(i[n]<t)return n-1;return r-1}if(e<0){for(let n=1;n<r;++n)if(i[n]<=t)return n;return r-1}for(let n=1;n<r;++n){if(i[n]==t)return n;if(i[n]<t)return i[n-1]-t<t-i[n]?n-1:n}return r-1}function Wg(i,t,e){for(;t<e;){const r=i[t];i[t]=i[e],i[e]=r,++t,--e}}function Hg(i,t){const e=Array.isArray(t)?t:[t],r=e.length;for(let n=0;n<r;n++)i[i.length]=e[n]}function nr(i,t){const e=i.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function ys(){}function zg(i){let t=!1,e,r,n;return function(){const o=Array.prototype.slice.call(arguments);return(!t||this!==n||!nr(o,r))&&(t=!0,n=this,r=o,e=i.apply(this,arguments)),e}}function ho(i){for(const t in i)delete i[t]}function ha(i){let t;for(t in i)return!1;return!t}class co extends nc{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(!n)return;const o=e?new la(t):t;o.target||(o.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});r in s||(s[r]=0,a[r]=0),++s[r];let l;for(let h=0,c=n.length;h<c;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(o):l=n[h].call(this,o),l===!1||o.propagationStopped){l=!1;break}if(--s[r]===0){let h=a[r];for(delete a[r];h--;)this.removeEventListener(r,ys);delete s[r]}return l}disposeInternal(){this.listeners_&&ho(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const r=this.listeners_[t];if(!r)return;const n=r.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=ys,++this.pendingRemovals_[t]):(r.splice(n,1),r.length===0&&delete this.listeners_[t]))}}const bt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Qe(i,t,e,r,n){if(r&&r!==i&&(e=e.bind(r)),n){const s=e;e=function(){i.removeEventListener(t,e),s.apply(this,arguments)}}const o={target:i,type:t,listener:e};return i.addEventListener(t,e),o}function Yn(i,t,e,r){return Qe(i,t,e,r,!0)}function xe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ho(i))}class tn extends co{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(bt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const r=t.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=Qe(this,t[o],e);return n}return Qe(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){const n=t.length;r=new Array(n);for(let o=0;o<n;++o)r[o]=Yn(this,t[o],e)}else r=Yn(this,t,e);return e.ol_key=r,r}unInternal(t,e){const r=e.ol_key;if(r)Vg(r);else if(Array.isArray(t))for(let n=0,o=t.length;n<o;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}tn.prototype.on;tn.prototype.once;tn.prototype.un;function Vg(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)xe(i[t]);else xe(i)}function nt(){throw new Error("Unimplemented abstract method.")}let Yg=0;function $t(i){return i.ol_uid||(i.ol_uid=String(++Yg))}class _l extends la{constructor(t,e,r){super(t),this.key=e,this.oldValue=r}}class uo extends tn{constructor(t){super(),this.on,this.once,this.un,$t(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new _l(r,t,e)),r=Gg.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new _l(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){const n=this.values_||(this.values_={});if(r)n[t]=e;else{const o=n[t];n[t]=e,o!==e&&this.notify(t,o)}}setProperties(t,e){for(const r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const r=this.values_[t];delete this.values_[t],ha(this.values_)&&(this.values_=null),e||this.notify(t,r)}}}const it={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Ct(i,t){if(!i)throw new Error(t)}function yt(i,t,e){return Math.min(Math.max(i,t),e)}function jg(i,t,e,r,n,o){const s=n-e,a=o-r;if(s!==0||a!==0){const l=((i-e)*s+(t-r)*a)/(s*s+a*a);l>1?(e=n,r=o):l>0&&(e+=s*l,r+=a*l)}return ji(i,t,e,r)}function ji(i,t,e,r){const n=e-i,o=r-t;return n*n+o*o}function Zg(i){const t=i.length;for(let r=0;r<t;r++){let n=r,o=Math.abs(i[r][r]);for(let a=r+1;a<t;a++){const l=Math.abs(i[a][r]);l>o&&(o=l,n=a)}if(o===0)return null;const s=i[n];i[n]=i[r],i[r]=s;for(let a=r+1;a<t;a++){const l=-i[a][r]/i[r][r];for(let h=r;h<t+1;h++)r==h?i[a][h]=0:i[a][h]+=l*i[r][h]}}const e=new Array(t);for(let r=t-1;r>=0;r--){e[r]=i[r][t]/i[r][r];for(let n=r-1;n>=0;n--)i[n][t]-=i[n][r]*e[r]}return e}function An(i){return i*Math.PI/180}function Pr(i,t){const e=i%t;return e*t<0?e+t:e}function ue(i,t,e){return i+e*(t-i)}function qg(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}class Kg extends uo{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[it.OPACITY]=t.opacity!==void 0?t.opacity:1,Ct(typeof e[it.OPACITY]=="number","Layer opacity must be a number"),e[it.VISIBLE]=t.visible!==void 0?t.visible:!0,e[it.Z_INDEX]=t.zIndex,e[it.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[it.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[it.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[it.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return e.opacity=yt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=r===void 0&&!e.managed?1/0:r,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return nt()}getLayerStatesArray(t){return nt()}getExtent(){return this.get(it.EXTENT)}getMaxResolution(){return this.get(it.MAX_RESOLUTION)}getMinResolution(){return this.get(it.MIN_RESOLUTION)}getMinZoom(){return this.get(it.MIN_ZOOM)}getMaxZoom(){return this.get(it.MAX_ZOOM)}getOpacity(){return this.get(it.OPACITY)}getSourceState(){return nt()}getVisible(){return this.get(it.VISIBLE)}getZIndex(){return this.get(it.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(it.EXTENT,t)}setMaxResolution(t){this.set(it.MAX_RESOLUTION,t)}setMinResolution(t){this.set(it.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(it.MAX_ZOOM,t)}setMinZoom(t){this.set(it.MIN_ZOOM,t)}setOpacity(t){Ct(typeof t=="number","Layer opacity must be a number"),this.set(it.OPACITY,t)}setVisible(t){this.set(it.VISIBLE,t)}setZIndex(t){this.set(it.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const zt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ie={ANIMATING:0,INTERACTING:1},le={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Jg=256,sc={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ac{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||sc[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const en=6378137,Gi=Math.PI*en,Qg=[-Gi,-Gi,Gi,Gi],tf=[-180,-85,180,85],gn=en*Math.log(Math.tan(Math.PI/2));class Ri extends ac{constructor(t){super({code:t,units:"m",extent:Qg,global:!0,worldExtent:tf,getPointResolution:function(e,r){return e/Math.cosh(r[1]/en)}})}}const yl=[new Ri("EPSG:3857"),new Ri("EPSG:102100"),new Ri("EPSG:102113"),new Ri("EPSG:900913"),new Ri("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ri("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ef(i,t,e){const r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let n=0;n<r;n+=e){t[n]=Gi*i[n]/180;let o=en*Math.log(Math.tan(Math.PI*(+i[n+1]+90)/360));o>gn?o=gn:o<-gn&&(o=-gn),t[n+1]=o}return t}function rf(i,t,e){const r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let n=0;n<r;n+=e)t[n]=180*i[n]/Gi,t[n+1]=360*Math.atan(Math.exp(i[n+1]/en))/Math.PI-90;return t}const nf=6378137,xl=[-180,-90,180,90],of=Math.PI*nf/180;class hi extends ac{constructor(t,e){super({code:t,units:"degrees",extent:xl,axisOrientation:e,global:!0,metersPerUnit:of,worldExtent:xl})}}const vl=[new hi("CRS:84"),new hi("EPSG:4326","neu"),new hi("urn:ogc:def:crs:OGC:1.3:CRS84"),new hi("urn:ogc:def:crs:OGC:2:84"),new hi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new hi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new hi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let xs={};function sf(i){return xs[i]||xs[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function af(i,t){xs[i]=t}let Zi={};function jn(i,t,e){const r=i.getCode(),n=t.getCode();r in Zi||(Zi[r]={}),Zi[r][n]=e}function lf(i,t){let e;return i in Zi&&t in Zi[i]&&(e=Zi[i][t]),e}const St={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function vs(i){const t=Ee();for(let e=0,r=i.length;e<r;++e)$r(t,i[e]);return t}function ca(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function hf(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function lc(i,t,e){let r,n;return t<i[0]?r=i[0]-t:i[2]<t?r=t-i[2]:r=0,e<i[1]?n=i[1]-e:i[3]<e?n=e-i[3]:n=0,r*r+n*n}function Ji(i,t){return hc(i,t[0],t[1])}function vr(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function hc(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Es(i,t){const e=i[0],r=i[1],n=i[2],o=i[3],s=t[0],a=t[1];let l=St.UNKNOWN;return s<e?l=l|St.LEFT:s>n&&(l=l|St.RIGHT),a<r?l=l|St.BELOW:a>o&&(l=l|St.ABOVE),l===St.UNKNOWN&&(l=St.INTERSECTING),l}function Ee(){return[1/0,1/0,-1/0,-1/0]}function Br(i,t,e,r,n){return n?(n[0]=i,n[1]=t,n[2]=e,n[3]=r,n):[i,t,e,r]}function ua(i){return Br(1/0,1/0,-1/0,-1/0,i)}function cf(i,t){const e=i[0],r=i[1];return Br(e,r,e,r,t)}function uf(i,t,e,r,n){const o=ua(n);return cc(o,i,t,e,r)}function df(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function $r(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function cc(i,t,e,r,n){for(;e<r;e+=n)gf(i,t[e],t[e+1]);return i}function gf(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function uc(i,t){let e;return e=t(da(i)),e||(e=t(ga(i)),e)||(e=t(fa(i)),e)||(e=t(go(i)),e)?e:!1}function Gr(i){let t=0;return fo(i)||(t=st(i)*Yt(i)),t}function da(i){return[i[0],i[1]]}function ga(i){return[i[2],i[1]]}function Qi(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function ff(i,t,e,r,n){const[o,s,a,l,h,c,u,d]=pf(i,t,e,r);return Br(Math.min(o,a,h,u),Math.min(s,l,c,d),Math.max(o,a,h,u),Math.max(s,l,c,d),n)}function pf(i,t,e,r){const n=t*r[0]/2,o=t*r[1]/2,s=Math.cos(e),a=Math.sin(e),l=n*s,h=n*a,c=o*s,u=o*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function Yt(i){return i[3]-i[1]}function me(i,t,e){const r=e||Ee();return jt(i,t)?(i[0]>t[0]?r[0]=i[0]:r[0]=t[0],i[1]>t[1]?r[1]=i[1]:r[1]=t[1],i[2]<t[2]?r[2]=i[2]:r[2]=t[2],i[3]<t[3]?r[3]=i[3]:r[3]=t[3]):ua(r),r}function go(i){return[i[0],i[3]]}function fa(i){return[i[2],i[3]]}function st(i){return i[2]-i[0]}function jt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function fo(i){return i[2]<i[0]||i[3]<i[1]}function mf(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function _f(i,t,e){let r=!1;const n=Es(i,t),o=Es(i,e);if(n===St.INTERSECTING||o===St.INTERSECTING)r=!0;else{const s=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],d=e[0],g=e[1],f=(g-u)/(d-c);let p,m;o&St.ABOVE&&!(n&St.ABOVE)&&(p=d-(g-h)/f,r=p>=s&&p<=l),!r&&o&St.RIGHT&&!(n&St.RIGHT)&&(m=g-(d-l)*f,r=m>=a&&m<=h),!r&&o&St.BELOW&&!(n&St.BELOW)&&(p=d-(g-a)/f,r=p>=s&&p<=l),!r&&o&St.LEFT&&!(n&St.LEFT)&&(m=g-(d-s)*f,r=m>=a&&m<=h)}return r}function dc(i,t){const e=t.getExtent(),r=Qi(i);if(t.canWrapX()&&(r[0]<e[0]||r[0]>=e[2])){const n=st(e),o=Math.floor((r[0]-e[0])/n)*n;i[0]-=o,i[2]-=o}return i}function gc(i,t,e){if(t.canWrapX()){const r=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[r[0],i[1],r[2],i[3]]];dc(i,t);const n=st(r);if(st(i)>n&&!e)return[[r[0],i[1],r[2],i[3]]];if(i[0]<r[0])return[[i[0]+n,i[1],r[2],i[3]],[r[0],i[1],i[2],i[3]]];if(i[2]>r[2])return[[i[0],i[1],r[2],i[3]],[r[0],i[1],i[2]-n,i[3]]]}return[i]}function yf(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function Zn(i,t){let e=!0;for(let r=i.length-1;r>=0;--r)if(i[r]!=t[r]){e=!1;break}return e}function xf(i,t){const e=Math.cos(t),r=Math.sin(t),n=i[0]*e-i[1]*r,o=i[1]*e+i[0]*r;return i[0]=n,i[1]=o,i}function vf(i,t){if(t.canWrapX()){const e=st(t.getExtent()),r=Ef(i,t,e);r&&(i[0]-=r*e)}return i}function Ef(i,t,e){const r=t.getExtent();let n=0;return t.canWrapX()&&(i[0]<r[0]||i[0]>r[2])&&(e=e||st(r),n=Math.floor((i[0]-r[0])/e)),n}const bf=63710088e-1;function El(i,t,e){e=e||bf;const r=An(i[1]),n=An(t[1]),o=(n-r)/2,s=An(t[0]-i[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(r)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Sf(...i){console.warn(...i)}let bs=!0;function wf(i){bs=!1}function fc(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function pc(i,t){if(t!==void 0&&i!==t){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];i=t}return i}function Tf(i){af(i.getCode(),i),jn(i,i,fc)}function Rf(i){i.forEach(Tf)}function Ei(i){return typeof i=="string"?sf(i):i||null}function bl(i,t,e,r){i=Ei(i);let n;const o=i.getPointResolutionFunc();if(o)n=o(t,e);else{const s=i.getUnits();if(s=="degrees"&&!r||r=="degrees")n=t;else{const a=mc(i,Ei("EPSG:4326"));if(a===pc&&s!=="degrees")n=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=El(h.slice(0,2),h.slice(2,4)),u=El(h.slice(4,6),h.slice(6,8));n=(c+u)/2}const l=i.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Sl(i){Rf(i),i.forEach(function(t){i.forEach(function(e){t!==e&&jn(t,e,fc)})})}function Cf(i,t,e,r){i.forEach(function(n){t.forEach(function(o){jn(n,o,e),jn(o,n,r)})})}function pa(i,t){return i?typeof i=="string"?Ei(i):i:Ei(t)}function mc(i,t){const e=i.getCode(),r=t.getCode();let n=lf(e,r);return n||(n=pc),n}function qn(i,t){const e=Ei(i),r=Ei(t);return mc(e,r)}function Af(i,t,e){return qn(t,e)(i,void 0,i.length)}function wl(i,t){return i}function Ge(i,t){return bs&&!Zn(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(bs=!1,Sf("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function _c(i,t){return i}function gi(i,t){return i}function If(){Sl(yl),Sl(vl),Cf(vl,yl,ef,rf)}If();function Tl(i,t,e){return function(r,n,o,s,a){if(!r)return;if(!n&&!t)return r;const l=t?0:o[0]*n,h=t?0:o[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,p=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>p&&(f=(p+f)/2,p=f);let m=yt(r[0],d,g),y=yt(r[1],f,p);if(s&&e&&n){const _=30*n;m+=-_*Math.log(1+Math.max(0,d-r[0])/_)+_*Math.log(1+Math.max(0,r[0]-g)/_),y+=-_*Math.log(1+Math.max(0,f-r[1])/_)+_*Math.log(1+Math.max(0,r[1]-p)/_)}return[m,y]}}function Mf(i){return i}function ma(i,t,e,r){const n=st(t)/e[0],o=Yt(t)/e[1];return r?Math.min(i,Math.max(n,o)):Math.min(i,Math.min(n,o))}function _a(i,t,e){let r=Math.min(i,t);const n=50;return r*=Math.log(1+n*Math.max(0,i/t-1))/n+1,e&&(r=Math.max(r,e),r/=Math.log(1+n*Math.max(0,e/i-1))/n+1),yt(r,e/2,t*2)}function Lf(i,t,e,r){return t=t!==void 0?t:!0,function(n,o,s,a){if(n!==void 0){const l=i[0],h=i[i.length-1],c=e?ma(l,e,s,r):l;if(a)return t?_a(n,c,h):yt(n,h,c);const u=Math.min(c,n),d=Math.floor(oc(i,u,o));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function Of(i,t,e,r,n,o){return r=r!==void 0?r:!0,e=e!==void 0?e:0,function(s,a,l,h){if(s!==void 0){const c=n?ma(t,n,l,o):t;if(h)return r?_a(s,c,e):yt(s,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,s),p=Math.floor(Math.log(t/f)/Math.log(i)+g),m=Math.max(d,p),y=t/Math.pow(i,m);return yt(y,e,c)}}}function Rl(i,t,e,r,n){return e=e!==void 0?e:!0,function(o,s,a,l){if(o!==void 0){const h=r?ma(i,r,a,n):i;return!e||!l?yt(o,t,h):_a(o,h,t)}}}function Df(i){if(i!==void 0)return 0}function Cl(i){if(i!==void 0)return i}function Pf(i){const t=2*Math.PI/i;return function(e,r){if(r)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function $f(i){const t=An(5);return function(e,r){return r||e===void 0?e:Math.abs(e)<=t?0:e}}function yc(i){return Math.pow(i,3)}function kf(i){return 1-yc(1-i)}function Nf(i){return 3*i*i-2*i*i*i}const ya=new Array(6);function oe(){return[1,0,0,1,0,0]}function Ff(i){return po(i,1,0,0,1,0,0)}function xa(i,t){const e=i[0],r=i[1],n=i[2],o=i[3],s=i[4],a=i[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],g=t[5];return i[0]=e*l+n*h,i[1]=r*l+o*h,i[2]=e*c+n*u,i[3]=r*c+o*u,i[4]=e*d+n*g+s,i[5]=r*d+o*g+a,i}function po(i,t,e,r,n,o,s){return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i[4]=o,i[5]=s,i}function Uf(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function Bt(i,t){const e=t[0],r=t[1];return t[0]=i[0]*e+i[2]*r+i[4],t[1]=i[1]*e+i[3]*r+i[5],t}function Bf(i,t){const e=Math.cos(t),r=Math.sin(t);return xa(i,po(ya,e,r,-r,e,0,0))}function Al(i,t,e){return xa(i,po(ya,t,0,0,e,0,0))}function Gf(i,t,e){return xa(i,po(ya,1,0,0,1,t,e))}function ti(i,t,e,r,n,o,s,a){const l=Math.sin(o),h=Math.cos(o);return i[0]=r*h,i[1]=n*l,i[2]=-r*l,i[3]=n*h,i[4]=s*r*h-a*r*l+t,i[5]=s*n*l+a*n*h+e,i}function Xf(i,t){const e=Wf(t);Ct(e!==0,"Transformation matrix cannot be inverted");const r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return i[0]=s/e,i[1]=-n/e,i[2]=-o/e,i[3]=r/e,i[4]=(o*l-s*a)/e,i[5]=-(r*l-n*a)/e,i}function Wf(i){return i[0]*i[3]-i[1]*i[2]}const Il=[1e6,1e6,1e6,1e6,2,2];function Hf(i){return"matrix("+i.map((t,e)=>Math.round(t*Il[e])/Il[e]).join(", ")+")"}function yi(i,t,e,r,n,o){o=o||[];let s=0;for(let a=t;a<e;a+=r){const l=i[a],h=i[a+1];o[s++]=n[0]*l+n[2]*h+n[4],o[s++]=n[1]*l+n[3]*h+n[5]}return o&&o.length!=s&&(o.length=s),o}function xc(i,t,e,r,n,o,s){s=s||[];const a=Math.cos(n),l=Math.sin(n),h=o[0],c=o[1];let u=0;for(let d=t;d<e;d+=r){const g=i[d]-h,f=i[d+1]-c;s[u++]=h+g*a-f*l,s[u++]=c+g*l+f*a;for(let p=d+2;p<d+r;++p)s[u++]=i[p]}return s&&s.length!=u&&(s.length=u),s}function zf(i,t,e,r,n,o,s,a){a=a||[];const l=s[0],h=s[1];let c=0;for(let u=t;u<e;u+=r){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+n*d,a[c++]=h+o*g;for(let f=u+2;f<u+r;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function Vf(i,t,e,r,n,o,s){s=s||[];let a=0;for(let l=t;l<e;l+=r){s[a++]=i[l]+n,s[a++]=i[l+1]+o;for(let h=l+2;h<l+r;++h)s[a++]=i[h]}return s&&s.length!=a&&(s.length=a),s}const Ml=oe();class Yf extends uo{constructor(){super(),this.extent_=Ee(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=zg((t,e,r)=>{if(!r)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return nt()}closestPointXY(t,e,r,n){return nt()}containsXY(t,e){const r=this.getClosestPoint([t,e]);return r[0]===t&&r[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return nt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&ua(e),this.extentRevision_=this.getRevision()}return mf(this.extent_,t)}rotate(t,e){nt()}scale(t,e,r){nt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return nt()}getType(){return nt()}applyTransform(t){nt()}intersectsExtent(t){return nt()}translate(t,e){nt()}transform(t,e){const r=Ei(t),n=r.getUnits()=="tile-pixels"?function(o,s,a){const l=r.getExtent(),h=r.getWorldExtent(),c=Yt(h)/Yt(l);return ti(Ml,h[0],h[3],c,-c,0,0,0),yi(o,0,o.length,a,Ml,s),qn(r,e)(o,s,a)}:qn(r,e);return this.applyTransform(n),this}}class va extends Yf{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return uf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return nt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Ll(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){nt()}setLayout(t,e,r){let n;if(t)n=Ll(t);else{for(let o=0;o<r;++o){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}n=e.length,t=jf(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const r=this.getFlatCoordinates();if(r){const n=this.getStride();xc(r,0,r.length,n,t,e,r),this.changed()}}scale(t,e,r){e===void 0&&(e=t),r||(r=Qi(this.getExtent()));const n=this.getFlatCoordinates();if(n){const o=this.getStride();zf(n,0,n.length,o,t,e,r,n),this.changed()}}translate(t,e){const r=this.getFlatCoordinates();if(r){const n=this.getStride();Vf(r,0,r.length,n,t,e,r),this.changed()}}}function jf(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Ll(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Zf(i,t,e){const r=i.getFlatCoordinates();if(!r)return null;const n=i.getStride();return yi(r,0,r.length,n,t,e)}function Ol(i,t,e,r,n,o,s){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((n-a)*h+(o-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let g=0;g<r;++g)s[g]=ue(i[t+g],i[e+g],d);s.length=r;return}else u=t}for(let d=0;d<r;++d)s[d]=i[u+d];s.length=r}function vc(i,t,e,r,n){let o=i[t],s=i[t+1];for(t+=r;t<e;t+=r){const a=i[t],l=i[t+1],h=ji(o,s,a,l);h>n&&(n=h),o=a,s=l}return n}function qf(i,t,e,r,n){for(let o=0,s=e.length;o<s;++o){const a=e[o];n=vc(i,t,a,r,n),t=a}return n}function Ec(i,t,e,r,n,o,s,a,l,h,c){if(t==e)return h;let u,d;if(n===0){if(d=ji(s,a,i[t],i[t+1]),d<h){for(u=0;u<r;++u)l[u]=i[t+u];return l.length=r,d}return h}c=c||[NaN,NaN];let g=t+r;for(;g<e;)if(Ol(i,g-r,g,r,s,a,c),d=ji(s,a,c[0],c[1]),d<h){for(h=d,u=0;u<r;++u)l[u]=c[u];l.length=r,g+=r}else g+=r*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(Ol(i,e-r,t,r,s,a,c),d=ji(s,a,c[0],c[1]),d<h){for(h=d,u=0;u<r;++u)l[u]=c[u];l.length=r}return h}function Kf(i,t,e,r,n,o,s,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=Ec(i,t,g,r,n,o,s,a,l,h,c),t=g}return h}function Jf(i,t,e,r){for(let n=0,o=e.length;n<o;++n)i[t++]=e[n];return t}function bc(i,t,e,r){for(let n=0,o=e.length;n<o;++n){const s=e[n];for(let a=0;a<r;++a)i[t++]=s[a]}return t}function Qf(i,t,e,r,n){n=n||[];let o=0;for(let s=0,a=e.length;s<a;++s){const l=bc(i,t,e[s],r);n[o++]=l,t=l}return n.length=o,n}function tp(i,t,e,r,n,o,s){const a=(e-t)/r;if(a<3){for(;t<e;t+=r)o[s++]=i[t],o[s++]=i[t+1];return s}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-r];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],p=i[d+1],m=i[u],y=i[u+1];for(let _=d+r;_<u;_+=r){const x=i[_],E=i[_+1],v=jg(x,E,f,p,m,y);v>g&&(c=_,g=v)}g>n&&(l[(c-t)/r]=1,d+r<c&&h.push(d,c),c+r<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(o[s++]=i[t+u*r],o[s++]=i[t+u*r+1]);return s}function ui(i,t){return t*Math.round(i/t)}function ep(i,t,e,r,n,o,s){if(t==e)return s;let a=ui(i[t],n),l=ui(i[t+1],n);t+=r,o[s++]=a,o[s++]=l;let h,c;do if(h=ui(i[t],n),c=ui(i[t+1],n),t+=r,t==e)return o[s++]=h,o[s++]=c,s;while(h==a&&c==l);for(;t<e;){const u=ui(i[t],n),d=ui(i[t+1],n);if(t+=r,u==h&&d==c)continue;const g=h-a,f=c-l,p=u-a,m=d-l;if(g*m==f*p&&(g<0&&p<g||g==p||g>0&&p>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}o[s++]=h,o[s++]=c,a=h,l=c,h=u,c=d}return o[s++]=h,o[s++]=c,s}function ip(i,t,e,r,n,o,s,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];s=ep(i,t,c,r,n,o,s),a.push(s),t=c}return s}function Xi(i,t,e,r,n){n=n!==void 0?n:[];let o=0;for(let s=t;s<e;s+=r)n[o++]=i.slice(s,s+r);return n.length=o,n}function Kn(i,t,e,r,n){n=n!==void 0?n:[];let o=0;for(let s=0,a=e.length;s<a;++s){const l=e[s];n[o++]=Xi(i,t,l,r,n[o]),t=l}return n.length=o,n}function Dl(i,t,e,r,n){n=n!==void 0?n:[];let o=0;for(let s=0,a=e.length;s<a;++s){const l=e[s];n[o++]=l.length===1&&l[0]===t?[]:Kn(i,t,l,r,n[o]),t=l[l.length-1]}return n.length=o,n}function Sc(i,t,e,r){let n=0;const o=i[e-r],s=i[e-r+1];let a=0,l=0;for(;t<e;t+=r){const h=i[t]-o,c=i[t+1]-s;n+=l*h-a*c,a=h,l=c}return n/2}function rp(i,t,e,r){let n=0;for(let o=0,s=e.length;o<s;++o){const a=e[o];n+=Sc(i,t,a,r),t=a}return n}class Xr extends va{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Xr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,r,n){return n<lc(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(vc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ec(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))}getArea(){return Sc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Xi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=tp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Xr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=bc(this.flatCoordinates,0,t,this.stride),this.changed()}}class Ea extends va{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Ea(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,n){const o=this.flatCoordinates,s=ji(t,e,o[0],o[1]);if(s<n){const a=this.stride;for(let l=0;l<a;++l)r[l]=o[l];return r.length=a,s}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return cf(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return hc(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,t,this.stride),this.changed()}}function np(i,t,e,r,n){return!uc(n,function(o){return!fi(i,t,e,r,o[0],o[1])})}function fi(i,t,e,r,n,o){let s=0,a=i[e-r],l=i[e-r+1];for(;t<e;t+=r){const h=i[t],c=i[t+1];l<=o?c>o&&(h-a)*(o-l)-(n-a)*(c-l)>0&&s++:c<=o&&(h-a)*(o-l)-(n-a)*(c-l)<0&&s--,a=h,l=c}return s!==0}function wc(i,t,e,r,n,o){if(e.length===0||!fi(i,t,e[0],r,n,o))return!1;for(let s=1,a=e.length;s<a;++s)if(fi(i,e[s-1],e[s],r,n,o))return!1;return!0}function op(i,t,e,r,n,o,s){let a,l,h,c,u,d,g;const f=n[o+1],p=[];for(let _=0,x=e.length;_<x;++_){const E=e[_];for(c=i[E-r],d=i[E-r+1],a=t;a<E;a+=r)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,p.push(h)),c=u,d=g}let m=NaN,y=-1/0;for(p.sort(Yi),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const _=Math.abs(u-c);_>y&&(h=(c+u)/2,wc(i,t,e,r,h,f)&&(m=h,y=_)),c=u}return isNaN(m)&&(m=n[o]),s?(s.push(m,f,y),s):[m,f,y]}function sp(i,t,e,r,n){let o;for(t+=r;t<e;t+=r)if(o=n(i.slice(t-r,t),i.slice(t,t+r)),o)return o;return!1}function Tc(i,t,e,r,n){const o=cc(Ee(),i,t,e,r);return jt(n,o)?vr(n,o)||o[0]>=n[0]&&o[2]<=n[2]||o[1]>=n[1]&&o[3]<=n[3]?!0:sp(i,t,e,r,function(s,a){return _f(n,s,a)}):!1}function ap(i,t,e,r,n){return!!(Tc(i,t,e,r,n)||fi(i,t,e,r,n[0],n[1])||fi(i,t,e,r,n[0],n[3])||fi(i,t,e,r,n[2],n[1])||fi(i,t,e,r,n[2],n[3]))}function lp(i,t,e,r,n){if(!ap(i,t,e[0],r,n))return!1;if(e.length===1)return!0;for(let o=1,s=e.length;o<s;++o)if(np(i,e[o-1],e[o],r,n)&&!Tc(i,e[o-1],e[o],r,n))return!1;return!0}function hp(i,t,e,r){for(;t<e-r;){for(let n=0;n<r;++n){const o=i[t+n];i[t+n]=i[e-r+n],i[e-r+n]=o}t+=r,e-=r}}function Rc(i,t,e,r){let n=0,o=i[e-r],s=i[e-r+1];for(;t<e;t+=r){const a=i[t],l=i[t+1];n+=(a-o)*(l+s),o=a,s=l}return n===0?void 0:n>0}function cp(i,t,e,r,n){n=n!==void 0?n:!1;for(let o=0,s=e.length;o<s;++o){const a=e[o],l=Rc(i,t,a,r);if(o===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}function Pl(i,t,e,r,n){n=n!==void 0?n:!1;for(let o=0,s=e.length;o<s;++o){const a=e[o],l=Rc(i,t,a,r);(o===0?n&&l||!n&&!l:n&&!l||!n&&l)&&hp(i,t,a,r),t=a}return t}class Jn extends va{constructor(t,e,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&r?(this.setFlatCoordinates(e,t),this.ends_=r):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Hg(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Jn(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,n){return n<lc(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(qf(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Kf(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))}containsXY(t,e){return wc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return rp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Pl(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Kn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Qi(this.getExtent());this.flatInteriorPoint_=op(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ea(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Xr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[];let o=0;for(let s=0,a=r.length;s<a;++s){const l=r[s],h=new Xr(e.slice(o,l),t);n.push(h),o=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;cp(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Pl(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=ip(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new Jn(e,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return lp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=Qf(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}function $l(i){if(fo(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],r=i[2],n=i[3],o=[t,e,t,n,r,n,r,e,t,e];return new Jn(o,"XY",[o.length])}const Zo=0;class kl extends uo{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=pa(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&wf(),t.center&&(t.center=Ge(t.center,this.projection_)),t.extent&&(t.extent=gi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in le)delete e[a];this.setProperties(e,!0);const r=dp(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;const n=up(t),o=r.constraint,s=gp(t);this.constraints_={center:n,resolution:o,rotation:s},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const r=this.getCenterInternal();if(r){const n=t||[0,0,0,0];e=e||[0,0,0,0];const o=this.getResolution(),s=o/2*(n[3]-e[3]+e[1]-n[1]),a=o/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([r[0]+s,r[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let r=0;r<e.length;++r){let n=arguments[r];n.center&&(n=Object.assign({},n),n.center=Ge(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ge(n.anchor,this.getProjection())),e[r]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,r;e>1&&typeof arguments[e-1]=="function"&&(r=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const c=arguments[n];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(n===e){r&&fn(r,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<e;++n){const c=arguments[n],u={start:o,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||Nf,callback:r};if(c.center&&(u.sourceCenter=s,u.targetCenter=c.center.slice(),s=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Pr(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}fp(u)?u.complete=!0:o+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(ie.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ie.ANIMATING]>0}getInteracting(){return this.hints_[ie.INTERACTING]>0}cancelAnimations(){this.setHint(ie.ANIMATING,-this.hints_[ie.ANIMATING]);let t;for(let e=0,r=this.animations_.length;e<r;++e){const n=this.animations_[e];if(n[0].callback&&fn(n[0].callback,!1),!t)for(let o=0,s=n.length;o<s;++o){const a=n[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let r=this.animations_.length-1;r>=0;--r){const n=this.animations_[r];let o=!0;for(let s=0,a=n.length;s<a;++s){const l=n[s];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):o=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),y=g+u*(p-g);this.targetCenter_=[m,y]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Pr(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(o){this.animations_[r]=null,this.setHint(ie.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const s=n[0].callback;s&&fn(s,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let r;const n=this.getCenterInternal();return n!==void 0&&(r=[n[0]-e[0],n[1]-e[1]],xf(r,t-this.getRotation()),yf(r,e)),r}calculateCenterZoom(t,e){let r;const n=this.getCenterInternal(),o=this.getResolution();if(n!==void 0&&o!==void 0){const s=e[0]-t*(e[0]-n[0])/o,a=e[1]-t*(e[1]-n[1])/o;r=[s,a]}return r}getViewportSize_(t){const e=this.viewportSize_;if(t){const r=e[0],n=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&wl(t,this.getProjection())}getCenterInternal(){return this.get(le.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return _c(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Ct(e,"The view center is not defined");const r=this.getResolution();Ct(r!==void 0,"The view resolution is not defined");const n=this.getRotation();return Ct(n!==void 0,"The view rotation is not defined"),ff(e,r,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(le.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(gi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const r=st(t)/e[0],n=Yt(t)/e[1];return Math.max(r,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,n=Math.log(e/r)/Math.log(t);return function(o){return e/Math.pow(t,o*n)}}getRotation(){return this.get(le.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,o=Math.log(r/n)/e;return function(s){return Math.log(r/s)/e/o}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),r=this.getRotation();let n=this.getCenterInternal();const o=this.padding_;if(o){const s=this.getViewportSizeMinusPadding_();n=qo(n,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],e,r)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,r,n;if(this.resolutions_){const o=oc(this.resolutions_,t,1);e=o,r=this.resolutions_[o],o==this.resolutions_.length-1?n=2:n=r/this.resolutions_[o+1]}else r=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(r/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=yt(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(r,yt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let r;if(Ct(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Ct(!fo(t),"Cannot fit empty extent provided as `geometry`");const n=gi(t,this.getProjection());r=$l(n)}else if(t.getType()==="Circle"){const n=gi(t.getExtent(),this.getProjection());r=$l(n),r.rotate(this.getRotation(),Qi(n))}else r=t;this.fitInternal(r,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),r=Math.cos(e),n=Math.sin(-e),o=t.getFlatCoordinates(),s=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=o.length;u<d;u+=s){const g=o[u]*r-o[u+1]*n,f=o[u]*n+o[u+1]*r;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let r=e.size;r||(r=this.getViewportSizeMinusPadding_());const n=e.padding!==void 0?e.padding:[0,0,0,0],o=e.nearest!==void 0?e.nearest:!1;let s;e.minResolution!==void 0?s=e.minResolution:e.maxZoom!==void 0?s=this.getResolutionForZoom(e.maxZoom):s=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);l=isNaN(l)?s:Math.max(l,s),l=this.getConstrainedResolution(l,o?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Qi(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,p=this.getConstrainedCenter([g,f],l),m=e.callback?e.callback:ys;e.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),fn(m,!0))}centerOn(t,e,r){this.centerOnInternal(Ge(t,this.getProjection()),e,r)}centerOnInternal(t,e,r){this.setCenterInternal(qo(t,e,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,r,n){let o;const s=this.padding_;if(s&&t){const a=this.getViewportSizeMinusPadding_(-r),l=qo(t,n,[a[0]/2+s[3],a[1]/2+s[0]],e,r);o=[t[0]-l[0],t[1]-l[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=wl(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ge(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,n,r);e&&(this.targetCenter_=this.calculateCenterZoom(o,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ge(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Ge(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const r=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,r),o=this.getViewportSize_(n),s=this.constraints_.resolution(this.targetResolution_,0,o,r),a=this.constraints_.center(this.targetCenter_,s,o,r,this.calculateCenterShift(this.targetCenter_,s,n,o));this.get(le.ROTATION)!==n&&this.set(le.ROTATION,n),this.get(le.RESOLUTION)!==s&&(this.set(le.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(le.CENTER)||!Zn(this.get(le.CENTER),a))&&this.set(le.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,r){t=t!==void 0?t:200;const n=e||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),a=this.constraints_.resolution(this.targetResolution_,n,s),l=this.constraints_.center(this.targetCenter_,a,s,!1,this.calculateCenterShift(this.targetCenter_,a,o,s));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==o||!this.getCenterInternal()||!Zn(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:a,duration:t,easing:kf,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ie.INTERACTING,1)}endInteraction(t,e,r){r=r&&Ge(r,this.getProjection()),this.endInteractionInternal(t,e,r)}endInteractionInternal(t,e,r){this.getInteracting()&&(this.setHint(ie.INTERACTING,-1),this.resolveConstraints(t,e,r))}getConstrainedCenter(t,e){const r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)}getConstrainedZoom(t,e){const r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))}getConstrainedResolution(t,e){e=e||0;const r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)}}function fn(i,t){setTimeout(function(){i(t)},0)}function up(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Tl(i.extent,i.constrainOnlyCenter,e)}const t=pa(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Tl(e,!1,!1)}return Mf}function dp(i){let t,e,r,n=i.minZoom!==void 0?i.minZoom:Zo,o=i.maxZoom!==void 0?i.maxZoom:28;const s=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=pa(i.projection,"EPSG:3857"),u=c.getExtent();let d=i.constrainOnlyCenter,g=i.extent;if(!a&&!g&&c.isGlobal()&&(d=!1,g=u),i.resolutions!==void 0){const f=i.resolutions;e=f[n],r=f[o]!==void 0?f[o]:f[f.length-1],i.constrainResolution?t=Lf(f,l,!d&&g,h):t=Rl(e,r,l,!d&&g,h)}else{const f=(u?Math.max(st(u),Yt(u)):360*sc.degrees/c.getMetersPerUnit())/Jg/Math.pow(2,Zo),p=f/Math.pow(2,28-Zo);e=i.maxResolution,e!==void 0?n=0:e=f/Math.pow(s,n),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=e/Math.pow(s,o):r=f/Math.pow(s,o):r=p),o=n+Math.floor(Math.log(e/r)/Math.log(s)),r=e/Math.pow(s,o-n),i.constrainResolution?t=Of(s,e,r,l,!d&&g,h):t=Rl(e,r,l,!d&&g,h)}return{constraint:t,maxResolution:e,minResolution:r,minZoom:n,zoomFactor:s}}function gp(i){if(i.enableRotation===void 0||i.enableRotation){const t=i.constrainRotation;return t===void 0||t===!0?$f():t===!1?Cl:typeof t=="number"?Pf(t):Cl}return Df}function fp(i){return!(i.sourceCenter&&i.targetCenter&&!Zn(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function qo(i,t,e,r,n){const o=Math.cos(-n);let s=Math.sin(-n),a=i[0]*o-i[1]*s,l=i[1]*o+i[0]*s;a+=(t[0]/2-e[0])*r,l+=(e[1]-t[1]/2)*r,s=-s;const h=a*o-l*s,c=l*o+a*s;return[h,c]}class Cc extends Kg{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(it.SOURCE,this.handleSourcePropertyChange_);const r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(it.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(xe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=Qe(t,bt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof kl?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&r&&(e.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let n;e.layerStatesArray?n=e.layerStatesArray.find(s=>s.layer===this):n=this.getLayerState();const o=this.getExtent();return pp(n,e.viewState)&&(!o||jt(o,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const r=this.getSource();if(r&&(e=r.getAttributions()),!e)return[];const n=t instanceof kl?t.getViewStateAndExtent():t;let o=e(n);return Array.isArray(o)||(o=[o]),o}render(t,e){const r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(it.MAP,t)}getMapInternal(){return this.get(it.MAP)}setMap(t){this.mapPrecomposeKey_&&(xe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(xe(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Qe(t,zt.PRECOMPOSE,function(e){const r=e.frameState.layerStatesArray,n=this.getLayerState(!1);Ct(!r.some(function(o){return o.layer===n.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(n)},this),this.mapRenderKey_=Qe(this,bt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(it.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function pp(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const r=t.zoom;return r>i.minZoom&&r<=i.maxZoom}const pn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class mp extends Cc{constructor(t){t=t||{};const e=Object.assign({},t),r=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=r,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(pn.PRELOAD)}setPreload(t){this.set(pn.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(pn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(pn.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const Ac=.5,k={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ba extends co{constructor(t,e,r){super(),r=r||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(bt.CHANGE)}release(){this.state===k.ERROR&&this.setState(k.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==k.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){nt()}getAlpha(t,e){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=e,this.transitionStarts_[t]=r;else if(r===-1)return 1;const n=e-r+1e3/60;return n>=this.transition_?1:yc(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const ei=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";ei.includes("firefox");const _p=ei.includes("safari")&&!ei.includes("chrom"),yp=_p&&(ei.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ei));ei.includes("webkit")&&ei.includes("edge");ei.includes("macintosh");const Ic=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Mc=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function pt(i,t,e,r){let n;return e&&e.length?n=e.shift():Ic?n=new OffscreenCanvas(i||300,t||300):n=document.createElement("canvas"),i&&(n.width=i),t&&(n.height=t),n.getContext("2d",r)}let Ko;function Qn(){return Ko||(Ko=pt(1,1)),Ko}function tr(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function to(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Ss(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const xp=new Error("disposed");let Ci=null;function vp(i){Ci||(Ci=pt(i.width,i.height,void 0,{willReadFrequently:!0}));const t=Ci.canvas,e=i.width;t.width!==e&&(t.width=e);const r=i.height;return t.height!==r&&(t.height=r),Ci.clearRect(0,0,e,r),Ci.drawImage(i,0,0),Ci.getImageData(0,0,e,r).data}const Ep=[256,256];class Lc extends ba{constructor(t){const e=k.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=to(this.data_);return t?[t.width,t.height]:Ep}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==k.IDLE&&this.state!==k.ERROR)return;this.state=k.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=k.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=k.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(xp),this.controller_=null),super.disposeInternal()}}const bp=10,Nl=.25;class Oc{constructor(t,e,r,n,o,s){this.sourceProj_=t,this.targetProj_=e;let a={};const l=qn(this.targetProj_,this.sourceProj_);this.transformInv_=function(_){const x=_[0]+"/"+_[1];return a[x]||(a[x]=l(_)),a[x]},this.maxSourceExtent_=n,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&st(n)>=st(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?st(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?st(this.targetProj_.getExtent()):null;const h=go(r),c=fa(r),u=ga(r),d=da(r),g=this.transformInv_(h),f=this.transformInv_(c),p=this.transformInv_(u),m=this.transformInv_(d),y=bp+(s?Math.max(0,Math.ceil(Math.log2(Gr(r)/(s*s*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,p,m,y),this.wrapsXInSource_){let _=1/0;this.triangles_.forEach(function(x,E,v){_=Math.min(_,x.source[0][0],x.source[1][0],x.source[2][0])}),this.triangles_.forEach(x=>{if(Math.max(x.source[0][0],x.source[1][0],x.source[2][0])-_>this.sourceWorldWidth_/2){const E=[[x.source[0][0],x.source[0][1]],[x.source[1][0],x.source[1][1]],[x.source[2][0],x.source[2][1]]];E[0][0]-_>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-_>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-_>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const v=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-v<this.sourceWorldWidth_/2&&(x.source=E)}})}a={}}addTriangle_(t,e,r,n,o,s){this.triangles_.push({source:[n,o,s],target:[t,e,r]})}addQuad_(t,e,r,n,o,s,a,l,h){const c=vs([o,s,a,l]),u=this.sourceWorldWidth_?st(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=vs([t,e,r,n]);f=st(m)/this.targetWorldWidth_>Nl||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Nl||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!jt(c,this.maxSourceExtent_))return;let p=0;if(!f&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(p=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(h>0){if(!f){const m=[(t[0]+r[0])/2,(t[1]+r[1])/2],y=this.transformInv_(m);let _;g?_=(Pr(o[0],d)+Pr(a[0],d))/2-Pr(y[0],d):_=(o[0]+a[0])/2-y[0];const x=(o[1]+a[1])/2-y[1];f=_*_+x*x>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){const m=[(e[0]+r[0])/2,(e[1]+r[1])/2],y=this.transformInv_(m),_=[(n[0]+t[0])/2,(n[1]+t[1])/2],x=this.transformInv_(_);this.addQuad_(t,e,m,_,o,s,y,x,h-1),this.addQuad_(_,m,r,n,x,y,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],y=this.transformInv_(m),_=[(r[0]+n[0])/2,(r[1]+n[1])/2],x=this.transformInv_(_);this.addQuad_(t,m,_,n,o,y,x,l,h-1),this.addQuad_(m,e,r,_,y,s,a,x,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}p&11||this.addTriangle_(t,r,n,o,a,l),p&14||this.addTriangle_(t,r,e,o,a,s),p&&(p&13||this.addTriangle_(e,n,t,s,l,o),p&7||this.addTriangle_(e,n,r,s,l,a))}calculateSourceExtent(){const t=Ee();return this.triangles_.forEach(function(e,r,n){const o=e.source;$r(t,o[0]),$r(t,o[1]),$r(t,o[2])}),t}getTriangles(){return this.triangles_}}let Jo;const Pe=[];function Fl(i,t,e,r,n){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(r,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,r)+1,Math.max(e,n)),i.restore()}function Qo(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function Sp(){if(Jo===void 0){const i=pt(6,6,Pe);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Fl(i,4,5,4,0),Fl(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Jo=Qo(t,0)||Qo(t,4)||Qo(t,8),tr(i),Pe.push(i.canvas)}return Jo}function Ul(i,t,e,r){const n=Af(e,t,i);let o=bl(t,r,e);const s=t.getMetersPerUnit();s!==void 0&&(o*=s);const a=i.getMetersPerUnit();a!==void 0&&(o/=a);const l=i.getExtent();if(!l||Ji(l,n)){const h=bl(i,o,n)/o;isFinite(h)&&h>0&&(o/=h)}return o}function Dc(i,t,e,r){const n=Qi(e);let o=Ul(i,t,n,r);return(!isFinite(o)||o<=0)&&uc(e,function(s){return o=Ul(i,t,s,r),isFinite(o)&&o>0}),o}function Pc(i,t,e,r,n,o,s,a,l,h,c,u,d,g){const f=pt(Math.round(e*i),Math.round(e*t),Pe);if(u||(f.imageSmoothingEnabled=!1),l.length===0)return f.canvas;f.scale(e,e);function p(v){return Math.round(v*e)/e}f.globalCompositeOperation="lighter";const m=Ee();l.forEach(function(v,T,w){df(m,v.extent)});let y;const _=e/r,x=(u?1:1+Math.pow(2,-24))/_;if(!d||l.length!==1||h!==0){if(y=pt(Math.round(st(m)*_),Math.round(Yt(m)*_),Pe),u||(y.imageSmoothingEnabled=!1),n&&g){const v=(n[0]-m[0])*_,T=-(n[3]-m[3])*_,w=st(n)*_,S=Yt(n)*_;y.rect(v,T,w,S),y.clip()}l.forEach(function(v,T,w){if(v.image.width>0&&v.image.height>0){if(v.clipExtent){y.save();const M=(v.clipExtent[0]-m[0])*_,X=-(v.clipExtent[3]-m[3])*_,L=st(v.clipExtent)*_,P=Yt(v.clipExtent)*_;y.rect(u?M:Math.round(M),u?X:Math.round(X),u?L:Math.round(M+L)-Math.round(M),u?P:Math.round(X+P)-Math.round(X)),y.clip()}const S=(v.extent[0]-m[0])*_,R=-(v.extent[3]-m[3])*_,O=st(v.extent)*_,$=Yt(v.extent)*_;y.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,u?S:Math.round(S),u?R:Math.round(R),u?O:Math.round(S+O)-Math.round(S),u?$:Math.round(R+$)-Math.round(R)),v.clipExtent&&y.restore()}})}const E=go(s);return a.getTriangles().forEach(function(v,T,w){const S=v.source,R=v.target;let O=S[0][0],$=S[0][1],M=S[1][0],X=S[1][1],L=S[2][0],P=S[2][1];const I=p((R[0][0]-E[0])/o),F=p(-(R[0][1]-E[1])/o),at=p((R[1][0]-E[0])/o),tt=p(-(R[1][1]-E[1])/o),q=p((R[2][0]-E[0])/o),ht=p(-(R[2][1]-E[1])/o),xt=O,Se=$;O=0,$=0,M-=xt,X-=Se,L-=xt,P-=Se;const A=[[M,X,0,0,at-I],[L,P,0,0,q-I],[0,0,M,X,tt-F],[0,0,L,P,ht-F]],Kt=Zg(A);if(!Kt)return;if(f.save(),f.beginPath(),Sp()||!u){f.moveTo(at,tt);const se=4,ri=I-at,or=F-tt;for(let ge=0;ge<se;ge++)f.lineTo(at+p((ge+1)*ri/se),tt+p(ge*or/(se-1))),ge!=se-1&&f.lineTo(at+p((ge+1)*ri/se),tt+p((ge+1)*or/(se-1)));f.lineTo(q,ht)}else f.moveTo(at,tt),f.lineTo(I,F),f.lineTo(q,ht);f.clip(),f.transform(Kt[0],Kt[2],Kt[1],Kt[3],I,F),f.translate(m[0]-xt,m[3]-Se);let we;if(y)we=y.canvas,f.scale(x,-x);else{const se=l[0],ri=se.extent;we=se.image,f.scale(st(ri)/we.width,-Yt(ri)/we.height)}f.drawImage(we,0,0),f.restore()}),y&&(tr(y),Pe.push(y.canvas)),c&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,a.getTriangles().forEach(function(v,T,w){const S=v.target,R=(S[0][0]-E[0])/o,O=-(S[0][1]-E[1])/o,$=(S[1][0]-E[0])/o,M=-(S[1][1]-E[1])/o,X=(S[2][0]-E[0])/o,L=-(S[2][1]-E[1])/o;f.beginPath(),f.moveTo($,M),f.lineTo(R,O),f.lineTo(X,L),f.closePath(),f.stroke()}),f.restore()),f.canvas}class $c extends Lc{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,r=e.getExtent(),n=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?n?me(r,n):r:n;const o=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),s=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=s?me(o,s):o;if(Gr(l)===0){this.state=k.EMPTY;return}r&&(a?a=me(a,r):a=r);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=t.targetProj,u=Dc(e,c,l,h);if(!isFinite(u)||u<=0){this.state=k.EMPTY;return}const d=t.errorThreshold!==void 0?t.errorThreshold:Ac;if(this.triangulation_=new Oc(e,c,l,a,u*d,h),this.triangulation_.getTriangles().length===0){this.state=k.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let g=this.triangulation_.calculateSourceExtent();if(a&&(e.canWrapX()?(g[1]=yt(g[1],a[1],a[3]),g[3]=yt(g[3],a[1],a[3])):g=me(g,a)),!Gr(g))this.state=k.EMPTY;else{let f=0,p=0;e.canWrapX()&&(f=st(r),p=Math.floor((g[0]-r[0])/f)),gc(g.slice(),e,!0).forEach(m=>{const y=this.sourceTileGrid_.getTileRangeForExtentAndZ(m,this.sourceZ_),_=t.getTileFunction;for(let x=y.minX;x<=y.maxX;x++)for(let E=y.minY;E<=y.maxY;E++){const v=_(this.sourceZ_,x,E,this.pixelRatio_);if(v){const T=p*f;this.sourceTiles_.push({tile:v,offset:T})}}++p}),this.sourceTiles_.length===0&&(this.state=k.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(f=>{var p;const m=f.tile;if(!m||m.getState()!==k.LOADED)return;const y=m.getSize(),_=this.gutter_;let x;const E=Ss(m.getData());E?x=E:(e=!0,x=vp(to(m.getData())));const v=[y[0]+2*_,y[1]+2*_],T=x instanceof Float32Array,w=v[0]*v[1],S=T?Float32Array:Uint8ClampedArray,R=new S(x.buffer),O=S.BYTES_PER_ELEMENT,$=O*R.length/w,M=R.byteLength/v[1],X=Math.floor(M/O/v[0]),L=w*X;let P=R;if(R.length!==L){P=new S(L);let at=0,tt=0;const q=v[0]*X;for(let ht=0;ht<v[1];++ht){for(let xt=0;xt<q;++xt)P[at++]=R[tt+xt];tt+=M/O}}const I=this.sourceTileGrid_.getTileCoordExtent(m.tileCoord);I[0]+=f.offset,I[2]+=f.offset;const F=(p=this.clipExtent_)==null?void 0:p.slice();F&&(F[0]+=f.offset,F[2]+=f.offset),t.push({extent:I,clipExtent:F,data:new Uint8ClampedArray(P.buffer),dataType:S,bytesPerPixel:$,pixelSize:v})}),this.sourceTiles_.length=0,t.length===0){this.state=k.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),o=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],a=this.targetTileGrid_.getResolution(r),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let c,u;const d=t[0].bytesPerPixel,g=Math.ceil(d/3);for(let f=g-1;f>=0;--f){const p=[];for(let v=0,T=t.length;v<T;++v){const w=t[v],S=w.data,R=w.pixelSize,O=R[0],$=R[1],M=pt(O,$,Pe),X=M.createImageData(O,$),L=X.data;let P=f*3;for(let I=0,F=L.length;I<F;I+=4)L[I]=S[P],L[I+1]=S[P+1],L[I+2]=S[P+2],L[I+3]=255,P+=d;M.putImageData(X,0,0),p.push({extent:w.extent,clipExtent:w.clipExtent,image:M.canvas})}const m=Pc(o,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),a,h,this.triangulation_,p,this.gutter_,!1,!1,!1);for(let v=0,T=p.length;v<T;++v){const w=p[v].image.getContext("2d");tr(w),Pe.push(w.canvas)}const y=m.getContext("2d"),_=y.getImageData(0,0,m.width,m.height);tr(y),Pe.push(m),c||(u=new Uint8ClampedArray(d*_.width*_.height),c=new t[0].dataType(u.buffer));const x=_.data;let E=f*3;for(let v=0,T=x.length;v<T;v+=4)x[v+3]===255?(u[E]=x[v],u[E+1]=x[v+1],u[E+2]=x[v+2]):(u[E]=0,u[E+1]=0,u[E+2]=0),E+=d}if(e){const f=pt(o,s),p=new ImageData(c,o);f.putImageData(p,0,0),this.reprojData_=f.canvas}else this.reprojData_=c;this.reprojSize_=[Math.round(o*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=k.LOADED,this.changed()}load(){if(this.state!==k.IDLE&&this.state!==k.ERROR)return;this.state=k.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r!==k.IDLE&&r!==k.LOADING)return;t++;const n=Qe(e,bt.CHANGE,function(){const o=e.getState();(o==k.LOADED||o==k.ERROR||o==k.EMPTY)&&(xe(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==k.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}}class Sa extends ba{constructor(t,e,r,n,o,s,a,l,h,c,u,d){super(o,k.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const g=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const m=f?me(g,f):g;if(Gr(m)===0){this.state=k.EMPTY;return}const y=t.getExtent();y&&(p?p=me(p,y):p=y);const _=n.getResolution(this.wrappedTileCoord_[0]),x=Dc(t,r,m,_);if(!isFinite(x)||x<=0){this.state=k.EMPTY;return}const E=c!==void 0?c:Ac;if(this.triangulation_=new Oc(t,r,m,p,x*E,_),this.triangulation_.getTriangles().length===0){this.state=k.EMPTY;return}this.sourceZ_=e.getZForResolution(x);let v=this.triangulation_.calculateSourceExtent();if(p&&(t.canWrapX()?(v[1]=yt(v[1],p[1],p[3]),v[3]=yt(v[3],p[1],p[3])):v=me(v,p)),!Gr(v))this.state=k.EMPTY;else{let T=0,w=0;t.canWrapX()&&(T=st(y),w=Math.floor((v[0]-y[0])/T)),gc(v.slice(),t,!0).forEach(S=>{const R=e.getTileRangeForExtentAndZ(S,this.sourceZ_);for(let O=R.minX;O<=R.maxX;O++)for(let $=R.minY;$<=R.maxY;$++){const M=h(this.sourceZ_,O,$,a);if(M){const X=w*T;this.sourceTiles_.push({tile:M,offset:X})}}++w}),this.sourceTiles_.length===0&&(this.state=k.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var r;const n=e.tile;if(n&&n.getState()==k.LOADED){const o=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);o[0]+=e.offset,o[2]+=e.offset;const s=(r=this.clipExtent_)==null?void 0:r.slice();s&&(s[0]+=e.offset,s[2]+=e.offset),t.push({extent:o,clipExtent:s,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=k.ERROR;else{const e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n=typeof r=="number"?r:r[0],o=typeof r=="number"?r:r[1],s=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Pc(n,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=k.LOADED}this.changed()}load(){if(this.state==k.IDLE){this.state=k.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const r=e.getState();if(r==k.IDLE||r==k.LOADING){t++;const n=Qe(e,bt.CHANGE,function(o){const s=e.getState();(s==k.LOADED||s==k.ERROR||s==k.EMPTY)&&(xe(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},r,n){e.getState()==k.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(tr(this.canvas_.getContext("2d")),Pe.push(this.canvas_),this.canvas_=null),super.release()}}const Y={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function wp(i,t,e){const r=i;let n=!0,o=!1,s=!1;const a=[Yn(r,bt.LOAD,function(){s=!0,o||t()})];return r.src&&Mc?(o=!0,r.decode().then(function(){n&&t()}).catch(function(l){n&&(s?t():e())})):a.push(Yn(r,bt.ERROR,e)),function(){n=!1,a.forEach(xe)}}function Tp(i,t){return new Promise((e,r)=>{function n(){s(),e(i)}function o(){s(),r(new Error("Image load error"))}function s(){i.removeEventListener("load",n),i.removeEventListener("error",o)}i.addEventListener("load",n),i.addEventListener("error",o)})}function Rp(i,t){return t&&(i.src=t),i.src&&Mc?new Promise((e,r)=>i.decode().then(()=>e(i)).catch(n=>i.complete&&i.width?e(i):r(n))):Tp(i)}class kc extends ba{constructor(t,e,r,n,o,s){super(t,e,s),this.crossOrigin_=n,this.src_=r,this.key=r,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=k.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=k.ERROR,this.unlistenImage_(),this.image_=Cp(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=k.LOADED:this.state=k.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==k.ERROR&&(this.state=k.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==k.IDLE&&(this.state=k.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=wp(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Cp(){const i=pt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class Ap extends co{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(bt.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===k.LOADED,this.loaded)this.uploadTile();else{if(t instanceof kc){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(bt.CHANGE,this.handleTileChange_)}}uploadTile(){nt()}setReady(){this.ready=!0,this.dispatchEvent(bt.CHANGE)}handleTileChange_(){this.tile.getState()===k.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(bt.CHANGE,this.handleTileChange_)}}const wa=34962,Ta=34963,Ip=35040,Ra=35044,Mp=35048,Lp=5121,Op=5123,Dp=5125,Nc=5126,Bl=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Pp(i,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!yp},t);const e=Bl.length;for(let r=0;r<e;++r)try{const n=i.getContext(Bl[r],t);if(n)return n}catch{}return null}const $p={STATIC_DRAW:Ra,STREAM_DRAW:Ip,DYNAMIC_DRAW:Mp};class Fc{constructor(t,e){this.array_=null,this.type_=t,Ct(t===wa||t===Ta,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:$p.STATIC_DRAW}ofSize(t){return this.array_=new(ts(this.type_))(t),this}fromArray(t){return this.array_=ts(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(ts(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function ts(i){switch(i){case wa:return Float32Array;case Ta:return Uint32Array;default:return Float32Array}}function be(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}function Uc(i,t,e){const r=e?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r)}function kp(i,t,e,r){Uc(i,t,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}function Gl(i,t,e,r,n,o){const s=i.getGL();let a,l;e instanceof Float32Array?(a=s.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=s.UNSIGNED_BYTE,l=!0),Uc(s,t,o&&l);const h=e.byteLength/r[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(n){case 1:{u=s.LUMINANCE;break}case 2:{u=s.LUMINANCE_ALPHA;break}case 3:{u=s.RGB;break}case 4:{u=s.RGBA;break}default:throw new Error(`Unsupported number of bands: ${n}`)}const d=s.getParameter(s.UNPACK_ALIGNMENT);s.pixelStorei(s.UNPACK_ALIGNMENT,c),s.texImage2D(s.TEXTURE_2D,0,u,r[0],r[1],0,u,a,e),s.pixelStorei(s.UNPACK_ALIGNMENT,d)}let Di=null;function Np(){Di=pt(1,1,void 0,{willReadFrequently:!0})}class Fp extends Ap{constructor(t){super(t),this.textures=[],this.renderSize_=be(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new Fc(wa,Ra);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),r=this.tile;this.textures.length=0;let n;r instanceof kc||r instanceof Sa?n=r.getImage():n=r.getData();const o=to(n);if(o){const _=e.createTexture();this.textures.push(_),this.bandCount=4,kp(e,_,o,r.interpolate),this.setReady();return}n=Ss(n);const s=r.getSize(),a=[s[0]+2*this.gutter_,s[1]+2*this.gutter_],l=n instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=n.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const _=e.createTexture();this.textures.push(_),Gl(t,_,n,a,this.bandCount,r.interpolate),this.setReady();return}const f=new Array(g);for(let _=0;_<g;++_){const x=e.createTexture();this.textures.push(x);const E=_<g-1?4:(this.bandCount-1)%4+1;f[_]=new c(h*E)}let p=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let x=0;x<y;++x){const E=n[m+x],v=Math.floor(p/this.bandCount),T=x%this.bandCount,w=Math.floor(T/4),S=f[w],R=S.length/h,O=T%4;S[v*R+O]=E,++p}m+=d/u}for(let _=0;_<g;++_){const x=this.textures[_],E=f[_],v=E.length/h;Gl(t,x,E,a,v,r.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(bt.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,r){const n=this.gutter_,o=this.renderSize_[0],s=this.renderSize_[1];Di||Np(),Di.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*n,c=l-2*n,u=n+Math.floor(h*(e/o)),d=n+Math.floor(c*(r/s));let g;try{Di.drawImage(t,u,d,1,1,0,0,1,1),g=Di.getImageData(0,0,1,1).data}catch{return Di=null,null}return g}getArrayPixelData_(t,e,r,n){const o=this.gutter_,s=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*o,u=h+2*o,d=o+Math.floor(l*(r/s)),g=o+Math.floor(h*(n/a));if(t instanceof DataView){const p=t.byteLength/(c*u),m=p*(g*c+d),y=t.buffer.slice(m,m+p);return new DataView(y)}const f=this.bandCount*(g*c+d);return t.slice(f,f+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Lc){const r=this.tile.getData(),n=Ss(r);if(n){const o=this.tile.getSize();return this.getArrayPixelData_(n,o,t,e)}return this.getImagePixelData_(to(r),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class Up{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const r=this.entries_[t];return Ct(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){const e=this.entries_[t];return Ct(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.key_;return t}getValues(){const t=new Array(this.count_);let e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Ct(!(t in this.entries_),"Tried to set a value for a key that is used already");const r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}}class Bp{constructor(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}const Gp=5;class Bc extends tn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null,this.staleKeys_=new Array,this.maxStaleKeys=Gp}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return nt()}getData(t){return null}prepareFrame(t){return nt()}renderFrame(t,e){return nt()}forEachFeatureAtCoordinate(t,e,r,n,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===Y.LOADED||e.getState()===Y.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Y.LOADED&&e!=Y.ERROR&&t.addEventListener(bt.CHANGE,this.boundHandleImageChange_),e==Y.IDLE&&(t.load(),e=t.getState()),e==Y.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class In extends la{constructor(t,e,r,n){super(t),this.inversePixelTransform=e,this.frameState=r,this.context=n}}const mn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Xp=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Wp=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Xl{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t.vertexShader||Xp),e.compileShader(r);const n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t.fragmentShader||Wp),e.compileShader(n),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,r),e.attachShader(this.renderTargetProgram_,n),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const o=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(s=>{this.uniforms_.push({value:t.uniforms[s],location:e.getUniformLocation(this.renderTargetProgram_,s)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),r=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const n=0,o=e.RGBA,s=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,n,o,r[0],r[1],s,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r[0],r[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,r,n){const o=this.getGL(),s=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,e?e.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!e){const l=$t(o.canvas);if(!t.renderTargets[l]){const h=o.getContextAttributes();h&&h.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),o.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),r&&r(o,t),o.drawArrays(o.TRIANGLES,0,6),n&&n(o,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let r,n=1;this.uniforms_.forEach(function(o){if(r=typeof o.value=="function"?o.value(t):o.value,r instanceof HTMLCanvasElement||r instanceof ImageData)o.texture||(o.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${n}`]),e.bindTexture(e.TEXTURE_2D,o.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,r.width,r.height,0,e.UNSIGNED_BYTE,new Uint8Array(r.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.uniform1i(o.location,n++);else if(Array.isArray(r))switch(r.length){case 2:e.uniform2f(o.location,r[0],r[1]);return;case 3:e.uniform3f(o.location,r[0],r[1],r[2]);return;case 4:e.uniform4f(o.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&e.uniform1f(o.location,r)})}}function Gc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xc(i,t){return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}const Xe={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Er={UNSIGNED_BYTE:Lp,UNSIGNED_SHORT:Op,UNSIGNED_INT:Dp,FLOAT:Nc},eo={};function Wl(i){return"shared/"+i}let Hl=0;function Hp(){const i="unique/"+Hl;return Hl+=1,i}function zp(i){let t=eo[i];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:Pp(e)},eo[i]=t}return t.users+=1,t.context}function Vp(i){const t=eo[i];if(!t||(t.users-=1,t.users>0))return;const e=t.context,r=e.getExtension("WEBGL_lose_context");r&&r.loseContext();const n=e.canvas;n.width=1,n.height=1,delete eo[i]}class Yp extends nc{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Wl(t.canvasCacheKey):Hp(),this.gl_=zp(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(mn.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(mn.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=oe(),this.offsetScaleMatrix_=oe(),this.tmpMat4_=Gc(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(r=>new Xl({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new Xl({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Wl(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,r=$t(t);let n=this.bufferCache_[r];if(!n){const o=e.createBuffer();n={buffer:t,webGlBuffer:o},this.bufferCache_[r]=n}e.bindBuffer(t.getType(),n.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,r=$t(t),n=this.bufferCache_[r];n&&!e.isContextLost()&&e.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(mn.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(mn.RESTORED,this.boundHandleWebGLContextRestored_),Vp(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,r){const n=this.gl_,o=this.getCanvas(),s=t.size,a=t.pixelRatio;(o.width!==s[0]*a||o.height!==s[1]*a)&&(o.width=s[0]*a,o.height=s[1]*a,o.style.width=s[0]+"px",o.style.height=s[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,e?n.ZERO:n.ONE_MINUS_SRC_ALPHA),r?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindTexture(t,e,r){const n=this.gl_;n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,t),n.uniform1i(this.getUniformLocation(r),e)}prepareDrawToRenderTarget(t,e,r,n){const o=this.gl_,s=e.getSize();o.bindFramebuffer(o.FRAMEBUFFER,e.getFramebuffer()),o.bindRenderbuffer(o.RENDERBUFFER,e.getDepthbuffer()),o.viewport(0,0,s[0],s[1]),o.bindTexture(o.TEXTURE_2D,e.getTexture()),o.clearColor(0,0,0,0),o.depthRange(0,1),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,r?o.ZERO:o.ONE_MINUS_SRC_ALPHA),n?(o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL)):o.disable(o.DEPTH_TEST)}drawElements(t,e){const r=this.gl_;this.getExtension("OES_element_index_uint");const n=r.UNSIGNED_INT,o=4,s=e-t,a=t*o;r.drawElements(r.TRIANGLES,s,n,a)}finalizeDraw(t,e,r){for(let n=0,o=this.postProcessPasses_.length;n<o;n++)n===o-1?this.postProcessPasses_[n].apply(t,null,e,r):this.postProcessPasses_[n].apply(t,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,r=t.viewState.rotation,n=t.pixelRatio;this.setUniformFloatValue(Xe.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Xe.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Xe.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Xe.PIXEL_RATIO,n),this.setUniformFloatVec2(Xe.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Xe.ROTATION,r)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Xe.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Xe.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let r,n=0;this.uniforms_.forEach(o=>{if(r=typeof o.value=="function"?o.value(t):o.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!o.texture?(o.prevValue=void 0,o.texture=r):o.texture||(o.prevValue=void 0,o.texture=e.createTexture()),this.bindTexture(o.texture,n,o.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const s=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&s&&o.prevValue!==r&&(o.prevValue=r,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)),n++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(o.name,Xc(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:e.uniform2f(this.getUniformLocation(o.name),r[0],r[1]);return;case 3:e.uniform3f(this.getUniformLocation(o.name),r[0],r[1],r[2]);return;case 4:e.uniform4f(this.getUniformLocation(o.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&e.uniform1f(this.getUniformLocation(o.name),r)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const r=this.gl_,n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}getProgram(t,e){const r=this.gl_,n=this.compileShader(t,r.FRAGMENT_SHADER),o=this.compileShader(e,r.VERTEX_SHADER),s=r.createProgram();if(r.attachShader(s,n),r.attachShader(s,o),r.linkProgram(s),!r.getShaderParameter(n,r.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${r.getShaderInfoLog(n)}`;throw new Error(a)}if(r.deleteShader(n),!r.getShaderParameter(o,r.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${r.getShaderInfoLog(o)}`;throw new Error(a)}if(r.deleteShader(o),!r.getProgramParameter(s,r.LINK_STATUS)){const a=`GL program linking failed: ${r.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(t){const e=$t(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=$t(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const r=t.size,n=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return ti(e,0,0,2/(o*r[0]),2/(o*r[1]),-n,-s[0],-s[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,r,n,o){const s=this.getAttributeLocation(t);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,e,r,!1,n,o))}enableAttributes(t){const e=jp(t);let r=0;for(let n=0;n<t.length;n++){const o=t[n];this.enableAttributeArray_(o.name,o.size,o.type||Nc,e,r),r+=o.size*Wc(o.type)}}handleWebGLContextLost(t){ho(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,r){const n=this.gl_;r=r||n.createTexture();const o=0,s=n.RGBA,a=0,l=n.RGBA,h=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,r),e?n.texImage2D(n.TEXTURE_2D,o,s,l,h,e):n.texImage2D(n.TEXTURE_2D,o,s,t[0],t[1],a,l,h,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),r}}function jp(i){let t=0;for(let e=0;e<i.length;e++){const r=i[e];t+=r.size*Wc(r.type)}return t}function Wc(i){switch(i){case Er.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Er.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Er.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Er.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Ca extends Bc{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=oe(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(it.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const r=this.getLayer();if(r.hasListener(zt.PRECOMPOSE)){const n=new In(zt.PRECOMPOSE,void 0,e,t);r.dispatchEvent(n)}}dispatchPostComposeEvent(t,e){const r=this.getLayer();if(r.hasListener(zt.POSTCOMPOSE)){const n=new In(zt.POSTCOMPOSE,void 0,e,t);r.dispatchEvent(n)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,r=-1,n;for(let s=0,a=t.layerStatesArray.length;s<a;s++){const l=t.layerStatesArray[s].layer,h=l.getRenderer();if(!(h instanceof Ca)){e=!0;continue}const c=l.getClassName();if((e||c!==n)&&(r+=1,e=!1),n=c,h===this)break}const o="map/"+t.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(o)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Yp({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:o}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,r){const n=this.getLayer();if(n.hasListener(t)){ti(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const o=new In(t,this.inversePixelTransform_,r,e);n.dispatchEvent(o)}}preRender(t,e){this.dispatchRenderEvent_(zt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(zt.POSTRENDER,t,e)}}function zl(i,t,e,r){return r!==void 0?(r[0]=i,r[1]=t,r[2]=e,r):[i,t,e]}function Zp(i,t,e){return i+"/"+t+"/"+e}function Pi(i){return Zp(i[0],i[1],i[2])}const qp={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},Kp={};function Vl(i){return 1/(i+2)}function Jp(){return{tileIds:new Set,representationsByZ:{}}}function Yl(i,t){return i.tileIds.has($t(t))}function jl(i,t,e){const r=i.representationsByZ;e in r||(r[e]=new Set),r[e].add(t),i.tileIds.add($t(t.tile))}function es(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=me(t,gi(e.extent,i.viewState.projection)));const r=e.layer.getRenderSource();if(!r.getWrapX()){const n=r.getTileGridForProjection(i.viewState.projection).getExtent();n&&(t=me(t,n))}return t}function ws(i,t){return`${i.getKey()},${Pi(t)}`}class Qp extends Ca{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=oe(),this.tempMat4=Gc(),this.tempTileRange_=new Bp(0,0,0,0),this.tempTileCoord_=zl(0,0,0),this.tempSize_=[0,0];const r=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new Up(r),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||fo(es(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return nt()}enqueueTiles(t,e,r,n,o){const s=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(s.projection),c=l.getGutterForProjection(s.projection),u=$t(l);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),p=Math.max(r-o,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=r;m>=p;--m){const y=h.getTileRangeForExtentAndZ(e,m,this.tempTileRange_),_=h.getResolution(m);for(let x=y.minX;x<=y.maxX;++x)for(let E=y.minY;E<=y.maxY;++E){const v=zl(m,x,E,this.tempTileCoord_),T=ws(l,v);let w,S;if(g.containsKey(T)&&(w=g.get(T),S=w.tile),(!w||w.tile.key!==l.getKey())&&(S=l.getTile(m,x,E,t.pixelRatio,s.projection),!S)||Yl(n,S))continue;w?w.setTile(S):(w=this.createTileRepresentation({tile:S,grid:h,helper:this.helper,gutter:c}),g.set(T,w)),jl(n,w,m);const R=S.getKey();d[R]=!0,S.getState()===k.IDLE&&(t.tileQueue.isKeyQueued(R)||t.tileQueue.enqueue([S,u,h.getTileCoordCenter(v),_]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,r,n,o,s,a,l,h,c,u){}renderTileMask(t,e,r,n){}drawTile_(t,e,r,n,o,s,a){if(!e.ready)return;const l=e.tile.tileCoord,h=Pi(l),c=h in s?s[h]:1,u=a.getResolution(r),d=be(a.getTileSize(r),this.tempSize_),g=a.getOrigin(r),f=a.getTileCoordExtent(l),p=c<1?-1:Vl(r);c<1&&(t.animate=!0);const m=t.viewState,y=m.center[0],_=m.center[1],x=d[0]+2*n,E=d[1]+2*n,v=x/E,T=(y-g[0])/(d[0]*u),w=(g[1]-_)/(d[1]*u),S=m.resolution/u,R=l[1],O=l[2];Ff(this.tileTransform_),Al(this.tileTransform_,2/(t.size[0]*S/x),-2/(t.size[1]*S/x)),Bf(this.tileTransform_,m.rotation),Al(this.tileTransform_,1,1/v),Gf(this.tileTransform_,(d[0]*(R-T)-n)/x,(d[1]*(O-w)-n)/E),this.renderTile(e,this.tileTransform_,t,o,u,d,g,f,p,n,c)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const r=t.viewState,n=this.getLayer(),o=n.getRenderSource(),s=o.getTileGridForProjection(r.projection),a=o.getGutterForProjection(r.projection),l=es(t,t.extent),h=s.getZForResolution(r.resolution,o.zDirection),c=Jp(),u=n.getPreload();if(t.nextExtent){const v=s.getZForResolution(r.nextResolution,o.zDirection),T=es(t,t.nextExtent);this.enqueueTiles(t,T,v,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const d={},g=$t(this),f=t.time;let p=!1;const m=c.representationsByZ;if(h in m)for(const v of m[h]){const T=v.tile;if((T instanceof Sa||T instanceof $c)&&T.getState()===k.EMPTY)continue;const w=T.tileCoord;if(v.ready){const R=T.getAlpha(g,f);if(R===1){T.endTransition(g);continue}p=!0;const O=Pi(w);d[O]=R}if(this.renderComplete=!1,this.findAltTiles_(s,w,h+1,c))continue;const S=s.getMinZoom();for(let R=h-1;R>=S&&!this.findAltTiles_(s,w,R,c);--R);}const y=Object.keys(m).map(Number).sort(Xg);if(this.beforeTilesMaskRender(t))for(let v=0,T=y.length;v<T;++v){const w=y[v];for(const S of m[w]){const R=S.tile.tileCoord;if(Pi(R)in d)continue;const O=s.getTileCoordExtent(R);this.renderTileMask(S,w,O,Vl(w))}}this.beforeTilesRender(t,p);for(let v=0,T=y.length;v<T;++v){const w=y[v];for(const S of m[w]){const R=S.tile.tileCoord;Pi(R)in d||this.drawTile_(t,S,w,a,l,d,s)}}if(h in m)for(const v of m[h]){const T=v.tile.tileCoord;Pi(T)in d&&this.drawTile_(t,v,h,a,l,d,s)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const _=this.helper.getCanvas(),x=this.tileRepresentationCache;for(;x.canExpireCache();)x.pop().dispose();const E=function(v,T){o.expireCache(T.viewState.projection,Kp)};return t.postRenderFunctions.push(E),this.postRender(e,t),_}findAltTiles_(t,e,r,n){const o=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!o)return!1;let s=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=o.minX;h<=o.maxX;++h)for(let c=o.minY;c<=o.maxY;++c){const u=ws(l,[r,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!Yl(n,g.tile)&&(jl(n,g,r),d=!0)}d||(s=!1)}return s}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const H={...qp,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Mn={TEXTURE_COORD:"a_textureCoord"},t0=[{name:Mn.TEXTURE_COORD,size:2,type:Er.FLOAT}];class e0 extends Qp{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new Fc(Ta,Ra),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){if(super.reset(t),this.helper){const e=this.helper.getGL();for(const r of this.paletteTextures_)r.delete(e)}this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const t=this.helper.getGL();for(const e of this.paletteTextures_)e.delete(t)}super.removeHelper()}createTileRepresentation(t){return new Fp(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,r,n,o,s,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(t0);let g=0;for(;g<t.textures.length;){const v=`${H.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,v),++g}for(let v=0;v<this.paletteTextures_.length;++v){const T=this.paletteTextures_[v],w=T.getTexture(d);this.helper.bindTexture(w,g,T.name),++g}const f=r.viewState,p=s[0]+2*c,m=s[1]+2*c,y=t.tile.tileCoord,_=y[1],x=y[2];this.helper.setUniformMatrixValue(H.TILE_TRANSFORM,Xc(this.tempMat4,e)),this.helper.setUniformFloatValue(H.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(H.DEPTH,h);let E=n;c>0&&(E=l,me(E,n,E)),this.helper.setUniformFloatVec4(H.RENDER_EXTENT,E),this.helper.setUniformFloatValue(H.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(H.ZOOM,f.zoom),this.helper.setUniformFloatValue(H.TEXTURE_PIXEL_WIDTH,p),this.helper.setUniformFloatValue(H.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(H.TEXTURE_RESOLUTION,o),this.helper.setUniformFloatValue(H.TEXTURE_ORIGIN_X,a[0]+_*s[0]*o-c*o),this.helper.setUniformFloatValue(H.TEXTURE_ORIGIN_Y,a[1]-x*s[1]*o+c*o),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const r=this.getLayer(),n=Bt(e.pixelToCoordinateTransform,t.slice()),o=e.viewState,s=r.getExtent();if(s&&!Ji(gi(s,o.projection),n))return null;const a=r.getSources(vs([n]),o.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(o.projection),h.getWrapX())break;const d=c.getExtent();if(!d||Ji(d,n))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let d=c.getZForResolution(o.resolution);d>=c.getMinZoom();--d){const g=c.getTileCoordForCoordAndZ(n,d),f=ws(h,g);if(!u.containsKey(f))continue;const p=u.get(f),m=p.tile;if((m instanceof Sa||m instanceof $c)&&m.getState()===k.EMPTY)return null;if(!p.loaded)continue;const y=c.getOrigin(d),_=be(c.getTileSize(d)),x=c.getResolution(d),E=(n[0]-y[0])/x-g[1]*_[0],v=(y[1]-n[1])/x-g[2]*_[1];return p.getPixelData(E,v)}return null}disposeInternal(){const t=this.helper;if(t){const e=t.getGL();for(const r of this.paletteTextures_)r.delete(e);this.paletteTextures_.length=0,e.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}const Wr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var At={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};At.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};At.max=At.whitepoint[2].D65;At.rgb=function(i,t){t=t||At.whitepoint[2].E;var e=i[0]/t[0],r=i[1]/t[1],n=i[2]/t[2],o,s,a;return o=e*3.240969941904521+r*-1.537383177570093+n*-.498610760293,s=e*-.96924363628087+r*1.87596750150772+n*.041555057407175,a=e*.055630079696993+r*-.20397695888897+n*1.056971514242878,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,o=Math.min(Math.max(0,o),1),s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),[o*255,s*255,a*255]};Wr.xyz=function(i,t){var e=i[0]/255,r=i[1]/255,n=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var o=e*.41239079926595+r*.35758433938387+n*.18048078840183,s=e*.21263900587151+r*.71516867876775+n*.072192315360733,a=e*.019330818715591+r*.11919477979462+n*.95053215224966;return t=t||At.whitepoint[2].E,[o*t[0],s*t[1],a*t[2]]};const Aa={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var r,n,o,s,a,l,h,c,u,d,g,f,p;if(o=i[0],s=i[1],a=i[2],o===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=At.whitepoint[e][t][0],d=At.whitepoint[e][t][1],g=At.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),p=9*d/(u+15*d+3*g),r=s/(13*o)+f||0,n=a/(13*o)+p||0,h=o>8?d*Math.pow((o+16)/116,3):d*o*m,l=h*9*r/(4*n)||0,c=h*(12-3*r-20*n)/(4*n)||0,[l,h,c]}};At.luv=function(i,t,e){var r,n,o,s,a,l,h,c,u,d,g,f,p,m=.008856451679035631,y=903.2962962962961;t=t||"D65",e=e||2,u=At.whitepoint[e][t][0],d=At.whitepoint[e][t][1],g=At.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),p=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],r=4*l/(l+15*h+3*c)||0,n=9*h/(l+15*h+3*c)||0;var _=h/d;return o=_<=m?y*_:116*Math.pow(_,1/3)-16,s=13*o*(r-f),a=13*o*(n-p),[o,s,a]};var Hc={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],r=i[2],n,o,s;return s=r/360*2*Math.PI,n=e*Math.cos(s),o=e*Math.sin(s),[t,n,o]},xyz:function(i){return Aa.xyz(Hc.luv(i))}};Aa.lchuv=function(i){var t=i[0],e=i[1],r=i[2],n=Math.sqrt(e*e+r*r),o=Math.atan2(r,e),s=o*360/2/Math.PI;return s<0&&(s+=360),[t,n,s]};At.lchuv=function(i){return Aa.lchuv(At.luv(i))};var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var i0={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const Zl=zc(i0);var ql={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function r0(i){var t,e,r,n=[],o=1,s;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Zl[i])n=Zl[i].slice(),s="rgb";else if(i==="transparent")o=0,s="rgb",n=[0,0,0];else if(i[0]==="#"){var a=i.slice(1),l=a.length,h=l<=4;o=1,h?(n=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(o=parseInt(a[3]+a[3],16)/255)):(n=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(o=parseInt(a[6]+a[7],16)/255)),n[0]||(n[0]=0),n[1]||(n[1]=0),n[2]||(n[2]=0),s="rgb"}else if(r=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var c=r[1];s=c.replace(/a$/,"");var u=s==="cmyk"?4:s==="gray"?1:3;n=r[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=n.shift()),n=n.map(function(d,g){if(d[d.length-1]==="%")return d=parseFloat(d)/100,g===3?d:s==="rgb"?d*255:s[0]==="h"||s[0]==="l"&&!g?d*100:s==="lab"?d*125:s==="lch"?g<2?d*150:d*360:s[0]==="o"&&!g?d:s==="oklab"?d*.4:s==="oklch"?g<2?d*.4:d*360:d;if(s[g]==="h"||g===2&&s[s.length-1]==="h"){if(ql[d]!==void 0)return ql[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),o=n.length>u?n.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(n=i.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),s=((e=(t=i.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:s,values:n,alpha:o}}const is={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,r=i[2]/100,n,o,s,a,l,h=0;if(e===0)return l=r*255,[l,l,l];for(o=r<.5?r*(1+e):r+e-r*e,n=2*r-o,a=[0,0,0];h<3;)s=t+1/3*-(h-1),s<0?s++:s>1&&s--,l=6*s<1?n+(o-n)*6*s:2*s<1?o:3*s<2?n+(o-n)*(2/3-s)*6:n,a[h++]=l*255;return a}};Wr.hsl=function(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,n=Math.min(t,e,r),o=Math.max(t,e,r),s=o-n,a,l,h;return o===n?a=0:t===o?a=(e-r)/s:e===o?a=2+(r-t)/s:r===o&&(a=4+(t-e)/s),a=Math.min(a*60,360),a<0&&(a+=360),h=(n+o)/2,o===n?l=0:h<=.5?l=s/(o+n):l=s/(2-o-n),[a,l*100,h*100]};function n0(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=r0(i);if(!e.space)return[];const r=e.space[0]==="h"?is.min:Wr.min,n=e.space[0]==="h"?is.max:Wr.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],r[0]),n[0]),t[1]=Math.min(Math.max(e.values[1],r[1]),n[1]),t[2]=Math.min(Math.max(e.values[2],r[2]),n[2]),e.space[0]==="h"&&(t=is.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function o0(i){return typeof i=="string"?i:Ma(i)}const s0=1024,gr={};let rs=0;function a0(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Kl(i){const t=At.lchuv(Wr.xyz(i));return t[3]=i[3],t}function l0(i){const t=At.rgb(Hc.xyz(i));return t[3]=i[3],t}function Ia(i){if(gr.hasOwnProperty(i))return gr[i];if(rs>=s0){let e=0;for(const r in gr)e++&3||(delete gr[r],--rs)}const t=n0(i);if(t.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('failed to parse "'+i+'" as color');return Vc(t),gr[i]=t,++rs,t}function bi(i){return Array.isArray(i)?i:Ia(i)}function Vc(i){return i[0]=yt(i[0]+.5|0,0,255),i[1]=yt(i[1]+.5|0,0,255),i[2]=yt(i[2]+.5|0,0,255),i[3]=yt(i[3],0,1),i}function Ma(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let r=i[2];r!=(r|0)&&(r=r+.5|0);const n=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+r+","+n+")"}let Si=0;const Dt=1<<Si++,z=1<<Si++,Pt=1<<Si++,Zt=1<<Si++,ii=1<<Si++,Wi=1<<Si++,yn=Math.pow(2,Si)-1,La={[Dt]:"boolean",[z]:"number",[Pt]:"string",[Zt]:"color",[ii]:"number[]",[Wi]:"size"},h0=Object.keys(La).map(Number).sort(Yi);function c0(i){return i in La}function Hi(i){const t=[];for(const e of h0)br(i,e)&&t.push(La[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function br(i,t){return(i&t)===t}function We(i,t){return i===t}class vt{constructor(t,e){if(!c0(t))throw new Error(`literal expressions must have a specific type, got ${Hi(t)}`);this.type=t,this.value=e}}class Yc{constructor(t,e,...r){this.type=t,this.operator=e,this.args=r}}function Oa(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1}}function wt(i,t,e){switch(typeof i){case"boolean":{if(We(t,Pt))return new vt(Pt,i?"true":"false");if(!br(t,Dt))throw new Error(`got a boolean, but expected ${Hi(t)}`);return new vt(Dt,i)}case"number":{if(We(t,Wi))return new vt(Wi,be(i));if(We(t,Dt))return new vt(Dt,!!i);if(We(t,Pt))return new vt(Pt,i.toString());if(!br(t,z))throw new Error(`got a number, but expected ${Hi(t)}`);return new vt(z,i)}case"string":{if(We(t,Zt))return new vt(Zt,Ia(i));if(We(t,Dt))return new vt(Dt,!!i);if(!br(t,Pt))throw new Error(`got a string, but expected ${Hi(t)}`);return new vt(Pt,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return b0(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("expected an array of numbers");if(We(t,Wi)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new vt(Wi,i)}if(We(t,Zt)){if(i.length===3)return new vt(Zt,[...i,1]);if(i.length===4)return new vt(Zt,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!br(t,ii))throw new Error(`got an array of numbers, but expected ${Hi(t)}`);return new vt(ii,i)}const b={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},u0={[b.Get]:G(V(1,1/0),d0),[b.Var]:G(V(1,1),g0),[b.Id]:G(f0,fr),[b.Concat]:G(V(2,1/0),et(Pt)),[b.GeometryType]:G(p0,fr),[b.Resolution]:G(fr),[b.Zoom]:G(fr),[b.Time]:G(fr),[b.Any]:G(V(2,1/0),et(Dt)),[b.All]:G(V(2,1/0),et(Dt)),[b.Not]:G(V(1,1),et(Dt)),[b.Equal]:G(V(2,2),et(yn)),[b.NotEqual]:G(V(2,2),et(yn)),[b.GreaterThan]:G(V(2,2),et(z)),[b.GreaterThanOrEqualTo]:G(V(2,2),et(z)),[b.LessThan]:G(V(2,2),et(z)),[b.LessThanOrEqualTo]:G(V(2,2),et(z)),[b.Multiply]:G(V(2,1/0),Jl),[b.Coalesce]:G(V(2,1/0),Jl),[b.Divide]:G(V(2,2),et(z)),[b.Add]:G(V(2,1/0),et(z)),[b.Subtract]:G(V(2,2),et(z)),[b.Clamp]:G(V(3,3),et(z)),[b.Mod]:G(V(2,2),et(z)),[b.Pow]:G(V(2,2),et(z)),[b.Abs]:G(V(1,1),et(z)),[b.Floor]:G(V(1,1),et(z)),[b.Ceil]:G(V(1,1),et(z)),[b.Round]:G(V(1,1),et(z)),[b.Sin]:G(V(1,1),et(z)),[b.Cos]:G(V(1,1),et(z)),[b.Atan]:G(V(1,2),et(z)),[b.Sqrt]:G(V(1,1),et(z)),[b.Match]:G(V(4,1/0),Ql,_0),[b.Between]:G(V(3,3),et(z)),[b.Interpolate]:G(V(6,1/0),Ql,y0),[b.Case]:G(V(3,1/0),m0,x0),[b.In]:G(V(2,2),v0),[b.Number]:G(V(1,1/0),et(yn)),[b.String]:G(V(1,1/0),et(yn)),[b.Array]:G(V(1,1/0),et(z)),[b.Color]:G(V(1,4),et(z)),[b.Band]:G(V(1,3),et(z)),[b.Palette]:G(V(2,2),E0),[b.ToString]:G(V(1,1),et(Dt|z|Pt|Zt))};function d0(i,t,e){const r=i.length-1,n=new Array(r);for(let o=0;o<r;++o){const s=i[o+1];switch(typeof s){case"number":{n[o]=new vt(z,s);break}case"string":{n[o]=new vt(Pt,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&e.properties.add(String(s))}return n}function g0(i,t,e){const r=i[1];if(typeof r!="string")throw new Error("expected a string argument for var operation");return e.variables.add(r),[new vt(Pt,r)]}function f0(i,t,e){e.featureId=!0}function p0(i,t,e){e.geometryType=!0}function fr(i,t,e){const r=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${r} operation`);return[]}function V(i,t){return function(e,r,n){const o=e[0],s=e.length-1;if(i===t){if(s!==i){const a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${o}, got ${s}`)}}else if(s<i||s>t){const a=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${a} arguments for ${o}, got ${s}`)}}}function Jl(i,t,e){const r=i.length-1,n=new Array(r);for(let o=0;o<r;++o){const s=wt(i[o+1],t,e);n[o]=s}return n}function et(i){return function(t,e,r){const n=t.length-1,o=new Array(n);for(let s=0;s<n;++s){const a=wt(t[s+1],i,r);o[s]=a}return o}}function m0(i,t,e){const r=i[0],n=i.length-1;if(n%2===0)throw new Error(`expected an odd number of arguments for ${r}, got ${n} instead`)}function Ql(i,t,e){const r=i[0],n=i.length-1;if(n%2===1)throw new Error(`expected an even number of arguments for operation ${r}, got ${n} instead`)}function _0(i,t,e){const r=i.length-1,n=Pt|z|Dt,o=wt(i[1],n,e),s=wt(i[i.length-1],t,e),a=new Array(r-2);for(let l=0;l<r-2;l+=2){try{const h=wt(i[l+2],o.type,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=wt(i[l+3],s.type,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[o,...a,s]}function y0(i,t,e){const r=i[1];let n;switch(r[0]){case"linear":n=1;break;case"exponential":const l=r[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);n=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(r)}`)}const o=new vt(z,n);let s;try{s=wt(i[2],z,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{const h=wt(i[l+3],z,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=wt(i[l+4],t,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[o,s,...a]}function x0(i,t,e){const r=wt(i[i.length-1],t,e),n=new Array(i.length-1);for(let o=0;o<n.length-1;o+=2){try{const s=wt(i[o+1],Dt,e);n[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{const s=wt(i[o+2],r.type,e);n[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return n[n.length-1]=r,n}function v0(i,t,e){let r=i[2];if(!Array.isArray(r))throw new Error('the second argument for the "in" operator must be an array');let n;if(typeof r[0]=="string"){if(r[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(r[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');r=r[1],n=Pt}else n=z;const o=new Array(r.length);for(let s=0;s<o.length;s++)try{const a=wt(r[s],n,e);o[s]=a}catch(a){throw new Error(`failed to parse haystack item ${s} for "in" expression: ${a.message}`)}return[wt(i[1],n,e),...o]}function E0(i,t,e){let r;try{r=wt(i[1],z,e)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}const n=i[2];if(!Array.isArray(n))throw new Error("the second argument of palette must be an array");const o=new Array(n.length);for(let s=0;s<o.length;s++){let a;try{a=wt(n[s],Zt,e)}catch(l){throw new Error(`failed to parse color at index ${s} in palette expression: ${l.message}`)}if(!(a instanceof vt))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=a}return[r,...o]}function G(...i){return function(t,e,r){const n=t[0];let o;for(let s=0;s<i.length;s++){const a=i[s](t,e,r);if(s==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new Yc(e,n,...o)}}function b0(i,t,e){const r=i[0],n=u0[r];if(!n)throw new Error(`unknown operator: ${r}`);return n(i,t,e)}function Da(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Da(i.getGeometries()[0]);default:return""}}class S0{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}}function w0(i,t){return`operator_${i}_${Object.keys(t.functions).length}`}function mo(i){const t=i.toString();return t.includes(".")?t:t+".0"}function Pa(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(mo).join(", ")})`}function T0(i){const t=bi(i),e=t.length>3?t[3]:1;return Pa([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}function R0(i){const t=be(i);return Pa(t)}const ns={};let C0=0;function jc(i){return i in ns||(ns[i]=C0++),ns[i]}function A0(i){return mo(jc(i))}function Zc(i){return"u_var_"+i}function I0(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const os="getBandValue",qc="u_paletteTextures";function M0(i,t,e,r){const n=wt(i,t,e);return $a(n,t,r)}function J(i){return(t,e,r)=>{const n=e.args.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=$a(e.args[s],r,t);return i(o,t)}}const L0={[b.Get]:(i,t)=>{const e=t.args[0].value;return e in i.properties||(i.properties[e]={name:e,type:t.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+e},[b.GeometryType]:(i,t,e)=>{const r="geometryType";return r in i.properties||(i.properties[r]={name:r,type:Pt,evaluator:n=>Da(n.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+r},[b.Var]:(i,t)=>{const e=t.args[0].value;return e in i.variables||(i.variables[e]={name:e,type:t.type}),Zc(e)},[b.Resolution]:()=>"u_resolution",[b.Zoom]:()=>"u_zoom",[b.Time]:()=>"u_time",[b.Any]:J(i=>`(${i.join(" || ")})`),[b.All]:J(i=>`(${i.join(" && ")})`),[b.Not]:J(([i])=>`(!${i})`),[b.Equal]:J(([i,t])=>`(${i} == ${t})`),[b.NotEqual]:J(([i,t])=>`(${i} != ${t})`),[b.GreaterThan]:J(([i,t])=>`(${i} > ${t})`),[b.GreaterThanOrEqualTo]:J(([i,t])=>`(${i} >= ${t})`),[b.LessThan]:J(([i,t])=>`(${i} < ${t})`),[b.LessThanOrEqualTo]:J(([i,t])=>`(${i} <= ${t})`),[b.Multiply]:J(i=>`(${i.join(" * ")})`),[b.Divide]:J(([i,t])=>`(${i} / ${t})`),[b.Add]:J(i=>`(${i.join(" + ")})`),[b.Subtract]:J(([i,t])=>`(${i} - ${t})`),[b.Clamp]:J(([i,t,e])=>`clamp(${i}, ${t}, ${e})`),[b.Mod]:J(([i,t])=>`mod(${i}, ${t})`),[b.Pow]:J(([i,t])=>`pow(${i}, ${t})`),[b.Abs]:J(([i])=>`abs(${i})`),[b.Floor]:J(([i])=>`floor(${i})`),[b.Ceil]:J(([i])=>`ceil(${i})`),[b.Round]:J(([i])=>`floor(${i} + 0.5)`),[b.Sin]:J(([i])=>`sin(${i})`),[b.Cos]:J(([i])=>`cos(${i})`),[b.Atan]:J(([i,t])=>t!==void 0?`atan(${i}, ${t})`:`atan(${i})`),[b.Sqrt]:J(([i])=>`sqrt(${i})`),[b.Match]:J(i=>{const t=i[0],e=i[i.length-1];let r=null;for(let n=i.length-3;n>=1;n-=2){const o=i[n],s=i[n+1];r=`(${t} == ${o} ? ${s} : ${r||e})`}return r}),[b.Between]:J(([i,t,e])=>`(${i} >= ${t} && ${i} <= ${e})`),[b.Interpolate]:J(([i,t,...e])=>{let r="";for(let n=0;n<e.length-2;n+=2){const o=e[n],s=r||e[n+1],a=e[n+2],l=e[n+3];let h;i===mo(1)?h=`(${t} - ${o}) / (${a} - ${o})`:h=`(pow(${i}, (${t} - ${o})) - 1.0) / (pow(${i}, (${a} - ${o})) - 1.0)`,r=`mix(${s}, ${l}, clamp(${h}, 0.0, 1.0))`}return r}),[b.Case]:J(i=>{const t=i[i.length-1];let e=null;for(let r=i.length-3;r>=0;r-=2){const n=i[r],o=i[r+1];e=`(${n} ? ${o} : ${e||t})`}return e}),[b.In]:J(([i,...t],e)=>{const r=w0("in",e),n=[];for(let o=0;o<t.length;o+=1)n.push(`  if (inputValue == ${t[o]}) { return true; }`);return e.functions[r]=`bool ${r}(float inputValue) {
${n.join(`
`)}
  return false;
}`,`${r}(${i})`}),[b.Array]:J(i=>`vec${i.length}(${i.join(", ")})`),[b.Color]:J(i=>{if(i.length===1)return`vec4(vec3(${i[0]} / 255.0), 1.0)`;if(i.length===2)return`(${i[1]} * vec4(vec3(${i[0]} / 255.0), 1.0))`;const t=i.slice(0,3).map(e=>`${e} / 255.0`);return i.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${i[3]} * vec4(${t.join(", ")}, 1.0))`}),[b.Band]:J(([i,t,e],r)=>{if(!(os in r.functions)){let n="";const o=r.bandCount||1;for(let s=0;s<o;s++){const a=Math.floor(s/4);let l=s%4;s===o-1&&l===1&&(l=3);const h=`${H.TILE_TEXTURE_ARRAY}[${a}]`;n+=`  if (band == ${s+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[os]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${H.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${H.TEXTURE_PIXEL_HEIGHT};
${n}
}`}return`${os}(${i}, ${t??"0.0"}, ${e??"0.0"})`}),[b.Palette]:(i,t)=>{const[e,...r]=t.args,n=r.length,o=new Uint8Array(n*4);for(let h=0;h<r.length;h++){const c=r[h].value,u=bi(c),d=h*4;o[d]=u[0],o[d+1]=u[1],o[d+2]=u[2],o[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const s=`${qc}[${i.paletteTextures.length}]`,a=new S0(s,o);i.paletteTextures.push(a);const l=$a(e,z,i);return`texture2D(${s}, vec2((${l} + 0.5) / ${n}.0, 0.5))`}};function $a(i,t,e){if(i instanceof Yc){const r=L0[i.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return r(e,i,t)}if((i.type&z)>0)return mo(i.value);if((i.type&Dt)>0)return i.value.toString();if((i.type&Pt)>0)return A0(i.value.toString());if((i.type&Zt)>0)return T0(i.value);if((i.type&ii)>0)return Pa(i.value);if((i.type&Wi)>0)return R0(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${Hi(t)})`)}function Ai(i,t,e){const r=Oa();return M0(t,e,r,i)}function th(i,t){const e=`
    attribute vec2 ${Mn.TEXTURE_COORD};
    uniform mat4 ${H.TILE_TRANSFORM};
    uniform float ${H.TEXTURE_PIXEL_WIDTH};
    uniform float ${H.TEXTURE_PIXEL_HEIGHT};
    uniform float ${H.TEXTURE_RESOLUTION};
    uniform float ${H.TEXTURE_ORIGIN_X};
    uniform float ${H.TEXTURE_ORIGIN_Y};
    uniform float ${H.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Mn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${H.TEXTURE_ORIGIN_X} + ${H.TEXTURE_RESOLUTION} * ${H.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${H.TEXTURE_ORIGIN_Y} - ${H.TEXTURE_RESOLUTION} * ${H.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${H.TILE_TRANSFORM} * vec4(${Mn.TEXTURE_COORD}, ${H.DEPTH}, 1.0);
    }
  `,r={...I0(),inFragmentShader:!0,bandCount:t,style:i},n=[];if(i.color!==void 0){const u=Ai(r,i.color,Zt);n.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Ai(r,i.contrast,z);n.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Ai(r,i.exposure,z);n.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Ai(r,i.saturation,z);n.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Ai(r,i.gamma,z);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Ai(r,i.brightness,z);n.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const o={},s=Object.keys(r.variables).length;if(s>1&&!i.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let u=0;u<s;++u){const d=r.variables[Object.keys(r.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=Zc(d.name);o[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=jc(f)),f!==void 0?f:-9999999}}const a=Object.keys(o).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${H.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${qc}[${r.paletteTextures.length}];`);const h=Object.keys(r.functions).map(function(u){return r.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${H.RENDER_EXTENT};
    uniform float ${H.TRANSITION_ALPHA};
    uniform float ${H.TEXTURE_PIXEL_WIDTH};
    uniform float ${H.TEXTURE_PIXEL_HEIGHT};
    uniform float ${H.RESOLUTION};
    uniform float ${H.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${H.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${H.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${H.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${H.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${H.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${H.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:o,paletteTextures:r.paletteTextures}}class _o extends mp{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.styleVariables_=this.style_.variables||{},this.addChangeListener(it.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=th(this.style_,this.getSourceBandCount_());return new e0(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.getCacheSize(),paletteTextures:t.paletteTextures})}renderSources(t,e){const r=this.getRenderer();let n;for(let o=0,s=e.length;o<s;++o)this.renderedSource_=e[o],r.prepareFrame(t)&&(n=r.renderFrame(t));return n}render(t,e){this.rendered=!0;const r=t.viewState,n=this.getSources(t.extent,r.resolution);let o=!0;for(let a=0,l=n.length;a<l;++a){const h=n[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}o=o&&c=="ready"}const s=this.renderSources(t,n);if(this.getRenderer().renderComplete&&o)return this.renderedResolution_=r.resolution,s;if(this.renderedResolution_>.5*r.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!n.includes(l));if(a.length>0)return this.renderSources(t,a)}return s}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=th(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}_o.prototype.dispose;function Kc(i,t){var e;let r={};for(const n in i){const o=i[n].type;if(o&&o!=="object")r[n]=o==="number"?Number(t[n]):t[n];else if(typeof i[n]=="object"&&(e=i[n])!=null&&e.properties){const s=Kc(i[n].properties,t);Object.keys(s).length>0&&(r[n]=s)}}return r}function O0(i,t){var e,r,n,o,s;if(!t)return null;let a={},l=i.get("type")==="WebGLTile"||i instanceof _o?(e=i.style_)==null?void 0:e.variables:(r=t.style)==null?void 0:r.variables;if((t.type==="style"||t.style)&&l)a=l;else if((o=(n=i.getSource())==null?void 0:n.getTileUrlFunction)!=null&&o.call(n)){const c=new URL(i.getSource().getTileUrlFunction()([0,0,0]));a=Object.fromEntries(c.searchParams.entries())}else return null;const h=Kc(((s=t.schema)==null?void 0:s.properties)||t.schema,a);return Object.keys(h).length?h:null}const D0=(i,t)=>i==null?void 0:i.filter(e=>["remove","sort"].filter(r=>t!=null&&t.get("layerControlDisable")?r!=="sort":!0).includes(e)),P0=(i,t)=>i==null?void 0:i.filter(e=>{let r=!0;return["remove","sort"].includes(e)&&(r=!1),e==="info"&&(r=t.get("description")),e==="config"&&(r=t.get("layerConfig")),r}),$0=(i,t)=>Z`
  <button slot="${i}-icon" class="icon">${t?i:ot}</button>
`,k0=i=>Z`
  <button
    class="remove-icon icon"
    @click=${()=>{const{layer:t}=i;t==null||t.set("layerControlOptional",!0),t==null||t.setVisible(!1),i.dispatchEvent(new CustomEvent("changed",{detail:t,bubbles:!0}))}}
  >
    ${i.unstyled?"x":ot}
  </button>
`,N0=i=>Z`
  <span class="button sort-icon icon drag-handle">
    ${i?"═":ot}
  </span>
`,Jc=i=>{var t;const e=["layerControlHide","layerControlOptional"];return(t=i==null?void 0:i.getArray())==null?void 0:t.filter(r=>e.every(n=>!r.get(n)))};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qc=ta(class extends ea{constructor(i){if(super(i),i.type!==Ye.PROPERTY&&i.type!==Ye.ATTRIBUTE&&i.type!==Ye.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!cd(i))throw Error("`live` bindings can only contain a single expression")}render(i){return i}update(i,[t]){if(t===re||t===ot)return t;const e=i.element,r=i.name;if(i.type===Ye.PROPERTY){if(t===e[r])return re}else if(i.type===Ye.BOOLEAN_ATTRIBUTE){if(!!t===e.hasAttribute(r))return re}else if(i.type===Ye.ATTRIBUTE&&e.getAttribute(r)===t+"")return re;return Ph(i),t}});/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Ts extends ea{constructor(t){if(super(t),this.it=ot,t.type!==Ye.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===ot||t==null)return this._t=void 0,this.it=t;if(t===re)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}}Ts.directiveName="unsafeHTML",Ts.resultType=1;const F0=ta(Ts);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Ln(i,t){if(i!==void 0){let e=0;for(const r of i)yield t(r,e++)}}const U0=(i,t,e)=>{let r=t;return e.layer.getSource().getTileUrlFunction()&&(r||(r=e.layer.getSource().getTileUrlFunction()),e.layer.getSource().setTileUrlFunction((...n)=>lg(r(...n),i)),e.layer.getSource().setKey(new Date)),r};function B0(i,t,e,r,n){tu(i,t,e||0,r||i.length-1,n||G0)}function tu(i,t,e,r,n){for(;r>e;){if(r-e>600){var o=r-e+1,s=t-e+1,a=Math.log(o),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1),c=Math.max(e,Math.floor(t-s*l/o+h)),u=Math.min(r,Math.floor(t+(o-s)*l/o+h));tu(i,t,c,u,n)}var d=i[t],g=e,f=r;for(pr(i,e,t),n(i[r],d)>0&&pr(i,e,r);g<f;){for(pr(i,g,f),g++,f--;n(i[g],d)<0;)g++;for(;n(i[f],d)>0;)f--}n(i[e],d)===0?pr(i,e,f):(f++,pr(i,f,r)),f<=t&&(e=f+1),t<=f&&(r=f-1)}}function pr(i,t,e){var r=i[t];i[t]=i[e],i[e]=r}function G0(i,t){return i<t?-1:i>t?1:0}class X0{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!vn(t,e))return r;const n=this.toBBox,o=[];for(;e;){for(let s=0;s<e.children.length;s++){const a=e.children[s],l=e.leaf?n(a):a;vn(t,l)&&(e.leaf?r.push(a):as(t,l)?this._all(a,r):o.push(a))}e=o.pop()}return r}collides(t){let e=this.data;if(!vn(t,e))return!1;const r=[];for(;e;){for(let n=0;n<e.children.length;n++){const o=e.children[n],s=e.leaf?this.toBBox(o):o;if(vn(t,s)){if(e.leaf||as(t,s))return!0;r.push(o)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=$i([]),this}remove(t,e){if(!t)return this;let r=this.data;const n=this.toBBox(t),o=[],s=[];let a,l,h;for(;r||o.length;){if(r||(r=o.pop(),l=o[o.length-1],a=s.pop(),h=!0),r.leaf){const c=W0(t,r.children,e);if(c!==-1)return r.children.splice(c,1),o.push(r),this._condense(o),this}!h&&!r.leaf&&as(r,n)?(o.push(r),s.push(a),a=0,l=r,r=r.children[0]):l?(a++,r=l.children[a],h=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,n){const o=r-e+1;let s=this._maxEntries,a;if(o<=s)return a=$i(t.slice(e,r+1)),Ii(a,this.toBBox),a;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),a=$i([]),a.leaf=!1,a.height=n;const l=Math.ceil(o/s),h=l*Math.ceil(Math.sqrt(s));eh(t,e,r,h,this.compareMinX);for(let c=e;c<=r;c+=h){const u=Math.min(c+h-1,r);eh(t,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const g=Math.min(d+l-1,u);a.children.push(this._build(t,d,g,n-1))}}return Ii(a,this.toBBox),a}_chooseSubtree(t,e,r,n){for(;n.push(e),!(e.leaf||n.length-1===r);){let o=1/0,s=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=ss(h),u=V0(t,h)-c;u<s?(s=u,o=c<o?c:o,a=h):u===s&&c<o&&(o=c,a=h)}e=a||e.children[0]}return e}_insert(t,e,r){const n=r?t:this.toBBox(t),o=[],s=this._chooseSubtree(n,this.data,e,o);for(s.children.push(t),wr(s,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)}_split(t,e){const r=t[e],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);const s=this._chooseSplitIndex(r,o,n),a=$i(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,Ii(r,this.toBBox),Ii(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)}_splitRoot(t,e){this.data=$i([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ii(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let n,o=1/0,s=1/0;for(let a=e;a<=r-e;a++){const l=Sr(t,0,a,this.toBBox),h=Sr(t,a,r,this.toBBox),c=Y0(l,h),u=ss(l)+ss(h);c<o?(o=c,n=a,s=u<s?u:s):c===o&&u<s&&(s=u,n=a)}return n||r-e}_chooseSplitAxis(t,e,r){const n=t.leaf?this.compareMinX:H0,o=t.leaf?this.compareMinY:z0,s=this._allDistMargin(t,e,r,n),a=this._allDistMargin(t,e,r,o);s<a&&t.children.sort(n)}_allDistMargin(t,e,r,n){t.children.sort(n);const o=this.toBBox,s=Sr(t,0,e,o),a=Sr(t,r-e,r,o);let l=xn(s)+xn(a);for(let h=e;h<r-e;h++){const c=t.children[h];wr(s,t.leaf?o(c):c),l+=xn(s)}for(let h=r-e-1;h>=e;h--){const c=t.children[h];wr(a,t.leaf?o(c):c),l+=xn(a)}return l}_adjustParentBBoxes(t,e,r){for(let n=r;n>=0;n--)wr(e[n],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():Ii(t[e],this.toBBox)}}function W0(i,t,e){if(!e)return t.indexOf(i);for(let r=0;r<t.length;r++)if(e(i,t[r]))return r;return-1}function Ii(i,t){Sr(i,0,i.children.length,t,i)}function Sr(i,t,e,r,n){n||(n=$i(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let o=t;o<e;o++){const s=i.children[o];wr(n,i.leaf?r(s):s)}return n}function wr(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function H0(i,t){return i.minX-t.minX}function z0(i,t){return i.minY-t.minY}function ss(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function xn(i){return i.maxX-i.minX+(i.maxY-i.minY)}function V0(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function Y0(i,t){const e=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),n=Math.min(i.maxX,t.maxX),o=Math.min(i.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,o-r)}function as(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function vn(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function $i(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eh(i,t,e,r,n){const o=[t,e];for(;o.length;){if(e=o.pop(),t=o.pop(),e-t<=r)continue;const s=t+Math.ceil((e-t)/r/2)*r;B0(i,s,t,e,n),o.push(t,s,s,e)}}class yo{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=be(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new yo({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return nt()}getImage(t){return nt()}getHitDetectionImage(){return nt()}getPixelRatio(t){return 1}getImageState(){return nt()}getImageSize(){return nt()}getOrigin(){return nt()}getSize(){return nt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=be(t)}listenImageChange(t){nt()}load(){nt()}unlistenImageChange(t){nt()}ready(){return Promise.resolve()}}class j0{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const r=this.cache_[e];!(t++&3)&&!r.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,r){const n=ls(t,e,r);return n in this.cache_?this.cache_[n]:null}getPattern(t,e,r){const n=ls(t,e,r);return n in this.patternCache_?this.patternCache_[n]:null}set(t,e,r,n,o){const s=ls(t,e,r),a=s in this.cache_;this.cache_[s]=n,o&&(n.getImageState()===Y.IDLE&&n.load(),n.getImageState()===Y.LOADING?n.ready().then(()=>{this.patternCache_[s]=Qn().createPattern(n.getImage(1),"repeat")}):this.patternCache_[s]=Qn().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function ls(i,t,e){const r=e?bi(e):"null";return t+":"+i+":"+r}const Ke=new j0;let mr=null;class Z0 extends co{constructor(t,e,r,n,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=o,this.imageState_=n===void 0?Y.IDLE:n,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Y.LOADED){mr||(mr=pt(1,1,void 0,{willReadFrequently:!0})),mr.drawImage(this.image_,0,0);try{mr.getImageData(0,0,1,1),this.tainted_=!1}catch{mr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(bt.CHANGE)}handleImageError_(){this.imageState_=Y.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Y.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],r=pt(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Y.IDLE){this.image_||this.initializeImage_(),this.imageState_=Y.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Rp(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Y.LOADED)return;const e=this.image_,r=document.createElement("canvas");r.width=Math.ceil(e.width*t),r.height=Math.ceil(e.height*t);const n=r.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=o0(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===Y.LOADED||this.imageState_===Y.ERROR?t():this.addEventListener(bt.CHANGE,function e(){(this.imageState_===Y.LOADED||this.imageState_===Y.ERROR)&&(this.removeEventListener(bt.CHANGE,e),t())})})),this.ready_}}function ka(i,t,e,r,n,o){let s=t===void 0?void 0:Ke.get(t,e,n);return s||(s=new Z0(i,i&&"src"in i?i.src||void 0:t,e,r,n),Ke.set(t,e,n,s,o)),o&&s&&!Ke.getPattern(t,e,n)&&Ke.set(t,e,n,s,o),s}function _e(i){return i?Array.isArray(i)?Ma(i):typeof i=="object"&&"src"in i?q0(i):i:null}function q0(i){if(!i.offset||!i.size)return Ke.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Ke.getPattern(t,void 0,i.color);if(e)return e;const r=Ke.get(i.src,"anonymous",null);if(r.getImageState()!==Y.LOADED)return null;const n=pt(i.size[0],i.size[1]);return n.drawImage(r.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),ka(n.canvas,t,void 0,Y.LOADED,i.color,!0),Ke.getPattern(t,void 0,i.color)}const K0=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),ih=["style","variant","weight","size","lineHeight","family"],eu=function(i){const t=i.match(K0);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let r=0,n=ih.length;r<n;++r){const o=t[r+1];o!==void 0&&(e[ih[r]]=o)}return e.families=e.family.split(/,\s?/),e},iu="10px sans-serif",Gt="#000",er="round",$e=[],ke=0,ir="round",Hr=10,zr="#000",Vr="center",io="middle",pi=[0,0,0,0],Yr=1,He=new uo;let ki=null,Rs;const Cs={},J0=function(){const i="32px ",t=["monospace","serif"],e=t.length,r="wmytzilWMYTZIL@#/&?$%10";let n,o;function s(l,h,c){let u=!0;for(let d=0;d<e;++d){const g=t[d];if(o=ro(l+" "+h+" "+i+g,r),c!=g){const f=ro(l+" "+h+" "+i+c+","+g,r);u=u&&f!=o}}return!!u}function a(){let l=!0;const h=He.getKeys();for(let c=0,u=h.length;c<u;++c){const d=h[c];He.get(d)<100&&(s.apply(this,d.split(`
`))?(ho(Cs),ki=null,Rs=void 0,He.set(d,100)):(He.set(d,He.get(d)+1,!0),l=!1))}l&&(clearInterval(n),n=void 0)}return function(l){const h=eu(l);if(!h)return;const c=h.families;for(let u=0,d=c.length;u<d;++u){const g=c[u],f=h.style+`
`+h.weight+`
`+g;He.get(f)===void 0&&(He.set(f,100,!0),s(h.style,h.weight,g)||(He.set(f,0,!0),n===void 0&&(n=setInterval(a,32))))}}}(),Q0=function(){let i;return function(t){let e=Cs[t];if(e==null){if(Ic){const r=eu(t),n=ru(t,"Žg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);Cs[t]=e}return e}}();function ru(i,t){return ki||(ki=pt(1,1)),i!=Rs&&(ki.font=i,Rs=ki.font),ki.measureText(t)}function ro(i,t){return ru(i,t).width}function rh(i,t,e){if(t in e)return e[t];const r=t.split(`
`).reduce((n,o)=>Math.max(n,ro(i,o)),0);return e[t]=r,r}function tm(i,t){const e=[],r=[],n=[];let o=0,s=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){o=Math.max(o,s),n.push(s),s=0,a+=l,l=0;continue}const d=t[h+1]||i.font,g=ro(d,u);e.push(g),s+=g;const f=Q0(d);r.push(f),l=Math.max(l,f)}return{width:o,height:a,widths:e,heights:r,lineWidths:n}}function em(i,t,e,r,n,o,s,a,l,h,c){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),r.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),im(r,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(r,n,o,s,a,0,0,s,a)):i.drawImage(r,n,o,s,a,l,h,s*c[0],a*c[1]),i.restore()}function im(i,t){const e=i.contextInstructions;for(let r=0,n=e.length;r<n;r+=2)Array.isArray(e[r+1])?t[e[r]].apply(t,e[r+1]):t[e[r]]=e[r+1]}class xo extends yo{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Y.LOADING:Y.LOADED,this.imageState_===Y.LOADING&&this.ready().then(()=>this.imageState_=Y.LOADED),this.render()}clone(){const t=this.getScale(),e=new xo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-e[0]/r[0],t[1]/2+e[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const r=this.renderOptions_,n=pt(r.size*t,r.size*t);this.draw_(r,n,t),e=n.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,r){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius_,o=this.radius2_===void 0?n:this.radius2_;if(n<o){const E=n;n=o,o=E}const s=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/s,l=o*Math.sin(a),h=Math.sqrt(o*o-l*l),c=n-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=r)return d*e;const g=e/2/d,f=e/2*(c/u),p=Math.sqrt((n+g)*(n+g)+f*f)-n;if(this.radius2_===void 0||t==="bevel")return p*2;const m=n*Math.sin(a),y=Math.sqrt(n*n-m*m),_=o-y,x=Math.sqrt(m*m+_*_)/m;if(x<=r){const E=x*e/2-o-n;return 2*Math.max(p,E)}return p*2}createRenderOptions(){let t=er,e=ir,r=0,n=null,o=0,s,a=0;this.stroke_&&(s=_e(this.stroke_.getColor()??zr),a=this.stroke_.getWidth()??Yr,n=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??ir,t=this.stroke_.getLineCap()??er,r=this.stroke_.getMiterLimit()??Hr);const l=this.calculateLineJoinSize_(e,a,r),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:s,strokeWidth:a,size:c,lineCap:t,lineDash:n,lineDashOffset:o,lineJoin:e,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=Gt),e.fillStyle=_e(n),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let r=this.fill_.getColor(),n=0;typeof r=="string"&&(r=bi(r)),r===null?n=1:Array.isArray(r)&&(n=r.length===4?r[3]:1),n===0&&(e=pt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const r=this.radius_;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{const n=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(e*=2);const o=this.angle_-Math.PI/2,s=2*Math.PI/e;for(let a=0;a<e;a++){const l=o+a*s,h=a%2===0?r:n;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Gt,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class vo extends xo{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new vo({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class rn{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new rn({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=ka(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===Y.IDLE&&e.load(),e.getImageState()===Y.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Eo{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Eo({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class bo{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=nh,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new bo({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=nh,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function rm(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Ct(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let hs=null;function nu(i,t){if(!hs){const e=new rn({color:"rgba(255,255,255,0.4)"}),r=new Eo({color:"#3399CC",width:1.25});hs=[new bo({image:new vo({fill:e,stroke:r,radius:5}),fill:e,stroke:r})]}return hs}function nh(i){return i.getGeometry()}const On=bo;function oh(i,t,e,r){return e!==void 0&&r!==void 0?[e/i,r/t]:e!==void 0?e/i:r!==void 0?r/t:1}class So extends yo{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:r,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const s=t.img!==void 0?t.img:null;let a=t.src;Ct(!(a!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&s&&(a=s.src||$t(s)),Ct(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Ct(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=Y.IDLE:s!==void 0&&("complete"in s?s.complete?l=s.src?Y.LOADED:Y.IDLE:l=Y.LOADING:l=Y.LOADED),this.color_=t.color!==void 0?bi(t.color):null,this.iconImage_=ka(s,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(oh(g[0],g[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(oh(h,c,t.width,t.height))}}clone(){let t,e,r;return this.initialOptions_?(e=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new So({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),r=this.getScaleArray();return[t[0]-e[0]/r[0],t[1]+e[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==Y.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==Y.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(bt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(bt.CHANGE,t)}ready(){return this.iconImage_.ready()}}const nm="#333";class Na{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=be(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new rn({color:nm}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Na({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=be(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function ou(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Be(i,t,e){const r=wt(i,t,e);return de(r)}function de(i,t){if(i instanceof vt){if(i.type===Zt&&typeof i.value=="string"){const r=Ia(i.value);return function(){return r}}return function(){return i.value}}const e=i.operator;switch(e){case b.Number:case b.String:case b.Coalesce:return om(i);case b.Get:case b.Var:return sm(i);case b.Id:return r=>r.featureId;case b.GeometryType:return r=>r.geometryType;case b.Concat:{const r=i.args.map(n=>de(n));return n=>"".concat(...r.map(o=>o(n).toString()))}case b.Resolution:return r=>r.resolution;case b.Any:case b.All:case b.Between:case b.In:case b.Not:return lm(i);case b.Equal:case b.NotEqual:case b.LessThan:case b.LessThanOrEqualTo:case b.GreaterThan:case b.GreaterThanOrEqualTo:return am(i);case b.Multiply:case b.Divide:case b.Add:case b.Subtract:case b.Clamp:case b.Mod:case b.Pow:case b.Abs:case b.Floor:case b.Ceil:case b.Round:case b.Sin:case b.Cos:case b.Atan:case b.Sqrt:return hm(i);case b.Case:return cm(i);case b.Match:return um(i);case b.Interpolate:return dm(i);case b.ToString:return gm(i);default:throw new Error(`Unsupported operator ${e}`)}}function om(i,t){const e=i.operator,r=i.args.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=de(i.args[o]);switch(e){case b.Coalesce:return o=>{for(let s=0;s<r;++s){const a=n[s](o);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case b.Number:case b.String:return o=>{for(let s=0;s<r;++s){const a=n[s](o);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function sm(i,t){const e=i.args[0].value;switch(i.operator){case b.Get:return r=>{const n=i.args;let o=r.properties[e];for(let s=1,a=n.length;s<a;++s){const l=n[s].value;o=o[l]}return o};case b.Var:return r=>r.variables[e];default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function am(i,t){const e=i.operator,r=de(i.args[0]),n=de(i.args[1]);switch(e){case b.Equal:return o=>r(o)===n(o);case b.NotEqual:return o=>r(o)!==n(o);case b.LessThan:return o=>r(o)<n(o);case b.LessThanOrEqualTo:return o=>r(o)<=n(o);case b.GreaterThan:return o=>r(o)>n(o);case b.GreaterThanOrEqualTo:return o=>r(o)>=n(o);default:throw new Error(`Unsupported comparison operator ${e}`)}}function lm(i,t){const e=i.operator,r=i.args.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=de(i.args[o]);switch(e){case b.Any:return o=>{for(let s=0;s<r;++s)if(n[s](o))return!0;return!1};case b.All:return o=>{for(let s=0;s<r;++s)if(!n[s](o))return!1;return!0};case b.Between:return o=>{const s=n[0](o),a=n[1](o),l=n[2](o);return s>=a&&s<=l};case b.In:return o=>{const s=n[0](o);for(let a=1;a<r;++a)if(s===n[a](o))return!0;return!1};case b.Not:return o=>!n[0](o);default:throw new Error(`Unsupported logical operator ${e}`)}}function hm(i,t){const e=i.operator,r=i.args.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=de(i.args[o]);switch(e){case b.Multiply:return o=>{let s=1;for(let a=0;a<r;++a)s*=n[a](o);return s};case b.Divide:return o=>n[0](o)/n[1](o);case b.Add:return o=>{let s=0;for(let a=0;a<r;++a)s+=n[a](o);return s};case b.Subtract:return o=>n[0](o)-n[1](o);case b.Clamp:return o=>{const s=n[0](o),a=n[1](o);if(s<a)return a;const l=n[2](o);return s>l?l:s};case b.Mod:return o=>n[0](o)%n[1](o);case b.Pow:return o=>Math.pow(n[0](o),n[1](o));case b.Abs:return o=>Math.abs(n[0](o));case b.Floor:return o=>Math.floor(n[0](o));case b.Ceil:return o=>Math.ceil(n[0](o));case b.Round:return o=>Math.round(n[0](o));case b.Sin:return o=>Math.sin(n[0](o));case b.Cos:return o=>Math.cos(n[0](o));case b.Atan:return r===2?o=>Math.atan2(n[0](o),n[1](o)):o=>Math.atan(n[0](o));case b.Sqrt:return o=>Math.sqrt(n[0](o));default:throw new Error(`Unsupported numeric operator ${e}`)}}function cm(i,t){const e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=de(i.args[n]);return n=>{for(let o=0;o<e-1;o+=2)if(r[o](n))return r[o+1](n);return r[e-1](n)}}function um(i,t){const e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=de(i.args[n]);return n=>{const o=r[0](n);for(let s=1;s<e;s+=2)if(o===r[s](n))return r[s+1](n);return r[e-1](n)}}function dm(i,t){const e=i.args.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=de(i.args[n]);return n=>{const o=r[0](n),s=r[1](n);let a,l;for(let h=2;h<e;h+=2){const c=r[h](n);let u=r[h+1](n);const d=Array.isArray(u);if(d&&(u=a0(u)),c>=s)return h===2?u:d?fm(o,s,a,l,c,u):Tr(o,s,a,l,c,u);a=c,l=u}return l}}function gm(i,t){const e=i.operator,r=i.args.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=de(i.args[o]);switch(e){case b.ToString:return o=>{const s=n[0](o);return i.args[0].type===Zt?Ma(s):s.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Tr(i,t,e,r,n,o){const s=n-e;if(s===0)return r;const a=t-e,l=i===1?a/s:(Math.pow(i,a)-1)/(Math.pow(i,s)-1);return r+l*(o-r)}function fm(i,t,e,r,n,o){if(n-e===0)return r;const s=Kl(r),a=Kl(o);let l=a[2]-s[2];l>180?l-=360:l<-180&&(l+=360);const h=[Tr(i,t,e,s[0],n,a[0]),Tr(i,t,e,s[1],n,a[1]),s[2]+Tr(i,t,e,0,n,l),Tr(i,t,e,r[3],n,o[3])];return Vc(l0(h))}function pm(i){return!0}function mm(i){const t=Oa(),e=_m(i,t),r=ou();return function(n,o){if(r.properties=n.getPropertiesInternal(),r.resolution=o,t.featureId){const s=n.getId();s!==void 0?r.featureId=s:r.featureId=null}return t.geometryType&&(r.geometryType=Da(n.getGeometry())),e(r)}}function sh(i){const t=Oa(),e=i.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=As(i[s],t);const n=ou(),o=new Array(e);return function(s,a){if(n.properties=s.getPropertiesInternal(),n.resolution=a,t.featureId){const h=s.getId();h!==void 0?n.featureId=h:n.featureId=null}let l=0;for(let h=0;h<e;++h){const c=r[h](n);c&&(o[l]=c,l+=1)}return o.length=l,o}}function _m(i,t){const e=i.length,r=new Array(e);for(let n=0;n<e;++n){const o=i[n],s="filter"in o?Be(o.filter,Dt,t):pm;let a;if(Array.isArray(o.style)){const l=o.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=As(o.style[h],t)}else a=[As(o.style,t)];r[n]={filter:s,styles:a}}return function(n){const o=[];let s=!1;for(let a=0;a<e;++a){const l=r[a].filter;if(l(n)&&!(i[a].else&&s)){s=!0;for(const h of r[a].styles){const c=h(n);c&&o.push(c)}}}return o}}function As(i,t){const e=jr(i,"",t),r=Zr(i,"",t),n=ym(i,t),o=xm(i,t),s=Xt(i,"z-index",t);if(!e&&!r&&!n&&!o&&!ha(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new On;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(r){const c=r(l);c&&(h=!1),a.setStroke(c)}if(n){const c=n(l);c&&(h=!1),a.setText(c)}if(o){const c=o(l);c&&(h=!1),a.setImage(c)}return s&&a.setZIndex(s(l)),h?null:a}}function jr(i,t,e){let r;if(t+"fill-pattern-src"in i)r=Sm(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return o=>null;r=Fa(i,t+"fill-color",e)}if(!r)return null;const n=new rn;return function(o){const s=r(o);return s==="none"?null:(n.setColor(s),n)}}function Zr(i,t,e){const r=Xt(i,t+"stroke-width",e),n=Fa(i,t+"stroke-color",e);if(!r&&!n)return null;const o=Me(i,t+"stroke-line-cap",e),s=Me(i,t+"stroke-line-join",e),a=su(i,t+"stroke-line-dash",e),l=Xt(i,t+"stroke-line-dash-offset",e),h=Xt(i,t+"stroke-miter-limit",e),c=new Eo;return function(u){if(n){const d=n(u);if(d==="none")return null;c.setColor(d)}if(r&&c.setWidth(r(u)),o){const d=o(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(s){const d=s(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function ym(i,t){const e="text-",r=Me(i,e+"value",t);if(!r)return null;const n=jr(i,e,t),o=jr(i,e+"background-",t),s=Zr(i,e,t),a=Zr(i,e+"background-",t),l=Me(i,e+"font",t),h=Xt(i,e+"max-angle",t),c=Xt(i,e+"offset-x",t),u=Xt(i,e+"offset-y",t),d=qr(i,e+"overflow",t),g=Me(i,e+"placement",t),f=Xt(i,e+"repeat",t),p=wo(i,e+"scale",t),m=qr(i,e+"rotate-with-view",t),y=Xt(i,e+"rotation",t),_=Me(i,e+"align",t),x=Me(i,e+"justify",t),E=Me(i,e+"baseline",t),v=su(i,e+"padding",t),T=To(i,e+"declutter-mode"),w=new Na({declutterMode:T});return function(S){if(w.setText(r(S)),n&&w.setFill(n(S)),o&&w.setBackgroundFill(o(S)),s&&w.setStroke(s(S)),a&&w.setBackgroundStroke(a(S)),l&&w.setFont(l(S)),h&&w.setMaxAngle(h(S)),c&&w.setOffsetX(c(S)),u&&w.setOffsetY(u(S)),d&&w.setOverflow(d(S)),g){const R=g(S);if(R!=="point"&&R!=="line")throw new Error("Expected point or line for text-placement");w.setPlacement(R)}if(f&&w.setRepeat(f(S)),p&&w.setScale(p(S)),m&&w.setRotateWithView(m(S)),y&&w.setRotation(y(S)),_){const R=_(S);if(R!=="left"&&R!=="center"&&R!=="right"&&R!=="end"&&R!=="start")throw new Error("Expected left, right, center, start, or end for text-align");w.setTextAlign(R)}if(x){const R=x(S);if(R!=="left"&&R!=="right"&&R!=="center")throw new Error("Expected left, right, or center for text-justify");w.setJustify(R)}if(E){const R=E(S);if(R!=="bottom"&&R!=="top"&&R!=="middle"&&R!=="alphabetic"&&R!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");w.setTextBaseline(R)}return v&&w.setPadding(v(S)),w}}function xm(i,t){return"icon-src"in i?vm(i,t):"shape-points"in i?Em(i,t):"circle-radius"in i?bm(i,t):null}function vm(i,t){const e="icon-",r=e+"src",n=au(i[r],r),o=no(i,e+"anchor",t),s=wo(i,e+"scale",t),a=Xt(i,e+"opacity",t),l=no(i,e+"displacement",t),h=Xt(i,e+"rotation",t),c=qr(i,e+"rotate-with-view",t),u=lh(i,e+"anchor-origin"),d=hh(i,e+"anchor-x-units"),g=hh(i,e+"anchor-y-units"),f=Cm(i,e+"color"),p=Tm(i,e+"cross-origin"),m=Rm(i,e+"offset"),y=lh(i,e+"offset-origin"),_=oo(i,e+"width"),x=oo(i,e+"height"),E=wm(i,e+"size"),v=To(i,e+"declutter-mode"),T=new So({src:n,anchorOrigin:u,anchorXUnits:d,anchorYUnits:g,color:f,crossOrigin:p,offset:m,offsetOrigin:y,height:x,width:_,size:E,declutterMode:v});return function(w){return a&&T.setOpacity(a(w)),l&&T.setDisplacement(l(w)),h&&T.setRotation(h(w)),c&&T.setRotateWithView(c(w)),s&&T.setScale(s(w)),o&&T.setAnchor(o(w)),T}}function Em(i,t){const e="shape-",r=e+"points",n=e+"radius",o=Is(i[r],r),s=Is(i[n],n),a=jr(i,e,t),l=Zr(i,e,t),h=wo(i,e+"scale",t),c=no(i,e+"displacement",t),u=Xt(i,e+"rotation",t),d=qr(i,e+"rotate-with-view",t),g=oo(i,e+"radius2"),f=oo(i,e+"angle"),p=To(i,e+"declutter-mode"),m=new xo({points:o,radius:s,radius2:g,angle:f,declutterMode:p});return function(y){return a&&m.setFill(a(y)),l&&m.setStroke(l(y)),c&&m.setDisplacement(c(y)),u&&m.setRotation(u(y)),d&&m.setRotateWithView(d(y)),h&&m.setScale(h(y)),m}}function bm(i,t){const e="circle-",r=jr(i,e,t),n=Zr(i,e,t),o=Xt(i,e+"radius",t),s=wo(i,e+"scale",t),a=no(i,e+"displacement",t),l=Xt(i,e+"rotation",t),h=qr(i,e+"rotate-with-view",t),c=To(i,e+"declutter-mode"),u=new vo({radius:5,declutterMode:c});return function(d){return o&&u.setRadius(o(d)),r&&u.setFill(r(d)),n&&u.setStroke(n(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),s&&u.setScale(s(d)),u}}function Xt(i,t,e){if(!(t in i))return;const r=Be(i[t],z,e);return function(n){return Is(r(n),t)}}function Me(i,t,e){if(!(t in i))return null;const r=Be(i[t],Pt,e);return function(n){return au(r(n),t)}}function Sm(i,t,e){const r=Me(i,t+"pattern-src",e),n=ah(i,t+"pattern-offset",e),o=ah(i,t+"pattern-size",e),s=Fa(i,t+"color",e);return function(a){return{src:r(a),offset:n&&n(a),size:o&&o(a),color:s&&s(a)}}}function qr(i,t,e){if(!(t in i))return null;const r=Be(i[t],Dt,e);return function(n){const o=r(n);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function Fa(i,t,e){if(!(t in i))return null;const r=Be(i[t],Zt,e);return function(n){return lu(r(n),t)}}function su(i,t,e){if(!(t in i))return null;const r=Be(i[t],ii,e);return function(n){return nn(r(n),t)}}function no(i,t,e){if(!(t in i))return null;const r=Be(i[t],ii,e);return function(n){const o=nn(r(n),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function ah(i,t,e){if(!(t in i))return null;const r=Be(i[t],ii,e);return function(n){return hu(r(n),t)}}function wo(i,t,e){if(!(t in i))return null;const r=Be(i[t],ii|z,e);return function(n){return Am(r(n),t)}}function oo(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function wm(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return be(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Tm(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function lh(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function hh(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Rm(i,t){const e=i[t];if(e!==void 0)return nn(e,t)}function To(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Cm(i,t){const e=i[t];if(e!==void 0)return lu(e,t)}function nn(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let r=0;r<e;++r)if(typeof i[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function au(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function Is(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function lu(i,t){if(typeof i=="string")return i;const e=nn(i,t),r=e.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function hu(i,t){const e=nn(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Am(i,t){return typeof i=="number"?i:hu(i,t)}const ch={RENDER_ORDER:"renderOrder"};class Im extends Cc{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(ch.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new X0(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(ch.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?nu:t;const e=Mm(t);this.styleFunction_=t===null?void 0:rm(e),this.changed()}}function Mm(i){if(i===void 0)return nu;if(!i)return null;if(typeof i=="function"||i instanceof On)return i;if(!Array.isArray(i))return sh([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof On){const r=new Array(t);for(let n=0;n<t;++n){const o=i[n];if(!(o instanceof On))throw new Error("Expected a list of style instances");r[n]=o}return r}if("style"in e){const r=new Array(t);for(let n=0;n<t;++n){const o=i[n];if(!("style"in o))throw new Error("Expected a list of rules with a style property");r[n]=o}return mm(r)}return sh(i)}const N={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},En=[N.FILL],Je=[N.STROKE],mi=[N.BEGIN_PATH],uh=[N.CLOSE_PATH];class cu{drawCustom(t,e,r,n,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,r){}drawFeature(t,e,r){}drawGeometryCollection(t,e,r){}drawLineString(t,e,r){}drawMultiLineString(t,e,r){}drawMultiPoint(t,e,r){}drawMultiPolygon(t,e,r){}drawPoint(t,e,r){}drawPolygon(t,e,r){}drawText(t,e,r){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class on extends cu{constructor(t,e,r,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(r){return r*e})}appendFlatPointCoordinates(t,e){const r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,o=this.coordinates;let s=o.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],Ji(r,n)&&(o[s++]=n[0],o[s++]=n[1]);return s}appendFlatLineCoordinates(t,e,r,n,o,s){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();s&&(e+=n);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let g=!0,f,p,m;for(f=e+n;f<r;f+=n)d[0]=t[f],d[1]=t[f+1],m=Es(h,d),m!==p?(g&&(a[l++]=c,a[l++]=u,g=!1),a[l++]=d[0],a[l++]=d[1]):m===St.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],g=!1):g=!0,c=d[0],u=d[1],p=m;return(o&&g||f===e+n)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,r,n,o){for(let s=0,a=r.length;s<a;++s){const l=r[s],h=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);o.push(h),e=l}return e}drawCustom(t,e,r,n,o){this.beginGeometry(t,e,o);const s=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,g;switch(s){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const f=t.getEndss();g=0;for(let p=0,m=f.length;p<m;++p){const y=[];g=this.drawCustomCoordinates_(h,g,f[p],a,y),d.push(y)}this.instructions.push([N.CUSTOM,l,d,t,r,Dl,o]),this.hitDetectionInstructions.push([N.CUSTOM,l,d,t,n||r,Dl,o]);break;case"Polygon":case"MultiLineString":u=[],h=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([N.CUSTOM,l,u,t,r,Kn,o]),this.hitDetectionInstructions.push([N.CUSTOM,l,u,t,n||r,Kn,o]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([N.CUSTOM,l,c,t,r,Xi,o]),this.hitDetectionInstructions.push([N.CUSTOM,l,c,t,n||r,Xi,o]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([N.CUSTOM,l,c,t,r,Xi,o]),this.hitDetectionInstructions.push([N.CUSTOM,l,c,t,n||r,Xi,o]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([N.CUSTOM,l,c,t,r,void 0,o]),this.hitDetectionInstructions.push([N.CUSTOM,l,c,t,n||r,void 0,o]);break}this.endGeometry(e)}beginGeometry(t,e,r){this.beginGeometryInstruction1_=[N.BEGIN_GEOMETRY,e,0,t,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[N.BEGIN_GEOMETRY,e,0,t,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const r=t.length;let n,o,s=-1;for(e=0;e<r;++e)n=t[e],o=n[0],o==N.END_GEOMETRY?s=e:o==N.BEGIN_GEOMETRY&&(n[2]=e,Wg(this.hitDetectionInstructions,s,e),s=-1)}setFillStrokeStyle(t,e){const r=this.state;if(t){const n=t.getColor();r.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,r.fillStyle=_e(n||Gt)}else r.fillStyle=void 0;if(e){const n=e.getColor();r.strokeStyle=_e(n||zr);const o=e.getLineCap();r.lineCap=o!==void 0?o:er;const s=e.getLineDash();r.lineDash=s?s.slice():$e;const a=e.getLineDashOffset();r.lineDashOffset=a||ke;const l=e.getLineJoin();r.lineJoin=l!==void 0?l:ir;const h=e.getWidth();r.lineWidth=h!==void 0?h:Yr;const c=e.getMiterLimit();r.miterLimit=c!==void 0?c:Hr,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0}createFill(t){const e=t.fillStyle,r=[N.SET_FILL_STYLE,e];return typeof e!="string"&&r.push(t.fillPatternScale),r}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[N.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const r=t.fillStyle;(typeof r!="string"||t.currentFillStyle!=r)&&(r!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)}updateStrokeStyle(t,e){const r=t.strokeStyle,n=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||o!=t.currentLineDash&&!nr(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(r!==void 0&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[N.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=hf(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ca(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Lm extends on{constructor(t,e,r,n){super(t,e,r,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,r){if(!this.image_||this.maxExtent&&!Ji(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,r);const n=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,a=this.appendFlatPointCoordinates(n,o);this.instructions.push([N.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([N.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,r){if(!this.image_)return;this.beginGeometry(t,e,r);const n=t.getFlatCoordinates(),o=[];for(let l=0,h=n.length;l<h;l+=t.getStride())(!this.maxExtent||Ji(this.maxExtent,n.slice(l,l+2)))&&o.push(n[l],n[l+1]);const s=this.coordinates.length,a=this.appendFlatPointCoordinates(o,2);this.instructions.push([N.DRAW_IMAGE,s,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([N.DRAW_IMAGE,s,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const r=t.getAnchor(),n=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Om=Lm;class Dm extends on{constructor(t,e,r,n){super(t,e,r,n)}drawFlatCoordinates_(t,e,r,n){const o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,e,r,n,!1,!1),a=[N.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}drawLineString(t,e,r){const n=this.state,o=n.strokeStyle,s=n.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([N.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,$e,ke],mi);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Je),this.endGeometry(e)}drawMultiLineString(t,e,r){const n=this.state,o=n.strokeStyle,s=n.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([N.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,$e,ke],mi);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(Je),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Je),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Je),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(mi)}}const Pm=Dm;class $m extends on{constructor(t,e,r,n){super(t,e,r,n)}drawFlatCoordinatess_(t,e,r,n){const o=this.state,s=o.fillStyle!==void 0,a=o.strokeStyle!==void 0,l=r.length;this.instructions.push(mi),this.hitDetectionInstructions.push(mi);for(let h=0;h<l;++h){const c=r[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,n,!0,!a),g=[N.MOVE_TO_LINE_TO,u,d];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(uh),this.hitDetectionInstructions.push(uh)),e=c}return s&&(this.instructions.push(En),this.hitDetectionInstructions.push(En)),a&&(this.instructions.push(Je),this.hitDetectionInstructions.push(Je)),e}drawCircle(t,e,r){const n=this.state,o=n.fillStyle,s=n.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_FILL_STYLE,Gt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,$e,ke]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[N.CIRCLE,h];this.instructions.push(mi,c),this.hitDetectionInstructions.push(mi,c),n.fillStyle!==void 0&&(this.instructions.push(En),this.hitDetectionInstructions.push(En)),n.strokeStyle!==void 0&&(this.instructions.push(Je),this.hitDetectionInstructions.push(Je)),this.endGeometry(e)}drawPolygon(t,e,r){const n=this.state,o=n.fillStyle,s=n.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_FILL_STYLE,Gt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,$e,ke]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,r){const n=this.state,o=n.fillStyle,s=n.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_FILL_STYLE,Gt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([N.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,$e,ke]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let r=0,n=e.length;r<n;++r)e[r]=ui(e[r],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const dh=$m;function km(i,t,e,r,n){const o=[];let s=e,a=0,l=t.slice(e,2);for(;a<i&&s+n<r;){const[h,c]=l.slice(-2),u=t[s+n],d=t[s+n+1],g=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=g,a>=i){const f=(i-a+g)/g,p=ue(h,u,f),m=ue(c,d,f);l.push(p,m),o.push(l),l=[p,m],a==i&&(s+=n),a=0}else if(a<i)l.push(t[s+n],t[s+n+1]),s+=n;else{const f=g-a,p=ue(h,u,f/g),m=ue(c,d,f/g);l.push(p,m),o.push(l),l=[p,m],a=0,s+=n}}return a>0&&o.push(l),o}function Nm(i,t,e,r,n){let o=e,s=e,a=0,l=0,h=e,c,u,d,g,f,p,m,y,_,x;for(u=e;u<r;u+=n){const E=t[u],v=t[u+1];f!==void 0&&(_=E-f,x=v-p,g=Math.sqrt(_*_+x*x),m!==void 0&&(l+=d,c=Math.acos((m*_+y*x)/(d*g)),c>i&&(l>a&&(a=l,o=h,s=u),l=0,h=u-n)),d=g,m=_,y=x),f=E,p=v}return l+=g,l>a?[h,u]:[o,s]}const so={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Fm extends on{constructor(t,e,r,n){super(t,e,r,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Gt]={fillStyle:Gt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,r){const n=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!n&&!o)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(s.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!jt(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=t.getEndss();d=[];for(let y=0,_=m.length;y<_;++y)d.push(m[y][0])}this.beginGeometry(t,e,r);const g=s.repeat,f=g?void 0:s.textAlign;let p=0;for(let m=0,y=d.length;m<y;++m){let _;g?_=km(g*this.resolution,c,p,d[m],u):_=[c.slice(p,d[m])];for(let x=0,E=_.length;x<E;++x){const v=_[x];let T=0,w=v.length;if(f==null){const R=Nm(s.maxAngle,v,0,v.length,2);T=R[0],w=R[1]}for(let R=T;R<w;R+=u)a.push(v[R],v[R+1]);const S=a.length;p=d[m],this.drawChars_(l,S),l=S}}this.endGeometry(e)}else{let d=s.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),s.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const _=t.getFlatInteriorPoints();c=[];for(let x=0,E=_.length;x<E;x+=3)s.overflow||d.push(_[x+2]/this.resolution),c.push(_[x],_[x+1]);if(c.length===0)return;u=2;break}const g=this.appendFlatPointCoordinates(c,u);if(g===l)return;if(d&&(g-l)/2!==c.length/u){let _=l/2;d=d.filter((x,E)=>{const v=a[(_+E)*2]===c[E*u]&&a[(_+E)*2+1]===c[E*u+1];return v||--_,v})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&this.updateFillStyle(this.state,this.createFill),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,r);let f=s.padding;if(f!=pi&&(s.scale[0]<0||s.scale[1]<0)){let _=s.padding[0],x=s.padding[1],E=s.padding[2],v=s.padding[3];s.scale[0]<0&&(x=-x,v=-v),s.scale[1]<0&&(_=-_,E=-E),f=[_,x,E,v]}const p=this.pixelRatio;this.instructions.push([N.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,f==pi?pi:f.map(function(_){return _*p}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const m=1/p,y=this.state.fillStyle;s.backgroundFill&&(this.state.fillStyle=Gt,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([N.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,f,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Gt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),s.backgroundFill&&(this.state.fillStyle=y,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:e.font,textAlign:e.textAlign||Vr,justify:e.justify,textBaseline:e.textBaseline||io,scale:e.scale});const s=this.fillKey_;r&&(s in this.fillStates||(this.fillStates[s]={fillStyle:r.fillStyle}))}drawChars_(t,e){const r=this.textStrokeState_,n=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=so[n.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([N.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,l,c,o,d*l,u,s,1,this.declutterMode_]),this.hitDetectionInstructions.push([N.DRAW_CHARS,t,e,h,n.overflow,a&&Gt,n.maxAngle,l,c,o,d*l,u,s,1/l,this.declutterMode_])}setTextStyle(t,e){let r,n,o;if(!t)this.text_="";else{const s=t.getFill();s?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=_e(s.getColor()||Gt)):(n=null,this.textFillState_=n);const a=t.getStroke();if(!a)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const f=a.getLineDash(),p=a.getLineDashOffset(),m=a.getWidth(),y=a.getMiterLimit();o.lineCap=a.getLineCap()||er,o.lineDash=f?f.slice():$e,o.lineDashOffset=p===void 0?ke:p,o.lineJoin=a.getLineJoin()||ir,o.lineWidth=m===void 0?Yr:m,o.miterLimit=y===void 0?Hr:y,o.strokeStyle=_e(a.getColor()||zr)}r=this.textState_;const l=t.getFont()||iu;J0(l);const h=t.getScaleArray();r.overflow=t.getOverflow(),r.font=l,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.repeat=t.getRepeat(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||io,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||pi,r.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=g===void 0?0:g,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:$t(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+$t(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Um={Circle:dh,Default:on,Image:Om,LineString:Pm,Polygon:dh,Text:Fm};class Bm{constructor(t,e,r,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const r=this.buildersByZIndex_[e];for(const n in r){const o=r[n].finish();t[e][n]=o}}return t}getBuilder(t,e){const r=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[r];n===void 0&&(n={},this.buildersByZIndex_[r]=n);let o=n[e];if(o===void 0){const s=Um[e];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=o}return o}}class uu{constructor(){Et(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Qn(),{get:(t,e)=>{if(typeof Qn()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,r)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,r),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let r=0,n=e.length;r<n;++r){const o=e[r];if(typeof o=="function"){o(t);continue}const s=e[++r];if(typeof t[o]=="function")t[o](...s);else{if(typeof s=="function"){t[o]=s(t);continue}t[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const gh=[];let Ni=null;function Gm(){Ni=pt(1,1,void 0,{willReadFrequently:!0})}class Xm extends Bc{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=oe(),this.pixelTransform=oe(),this.inversePixelTransform=oe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,r){Ni||Gm(),Ni.clearRect(0,0,1,1);let n;try{Ni.drawImage(t,e,r,1,1,0,0,1,1),n=Ni.getImageData(0,0,1,1).data}catch{return Ni=null,null}return n}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,r){const n=this.getLayer().getClassName();let o,s;if(t&&t.className===n&&(!r||t&&t.style.backgroundColor&&nr(bi(t.style.backgroundColor),bi(r)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(s=a.getContext("2d"))}if(s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=n;let a=o.style;a.position="absolute",a.width="100%",a.height="100%",s=pt();const l=s.canvas;o.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,e,r){const n=go(r),o=fa(r),s=ga(r),a=da(r);Bt(e.coordinateToPixelTransform,n),Bt(e.coordinateToPixelTransform,o),Bt(e.coordinateToPixelTransform,s),Bt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Bt(l,n),Bt(l,o),Bt(l,s),Bt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){const r=t.extent,n=t.viewState.resolution,o=t.viewState.rotation,s=t.pixelRatio,a=Math.round(st(r)/n*s),l=Math.round(Yt(r)/n*s);ti(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,o,-a/2,-l/2),Xf(this.inversePixelTransform,this.pixelTransform);const h=Hf(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,r){const n=this.getLayer();if(n.hasListener(t)){const o=new In(t,this.inversePixelTransform,r,e);n.dispatchEvent(o)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(zt.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(zt.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new uu),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(zt.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(zt.POSTRENDER,this.context,t))}getRenderTransform(t,e,r,n,o,s,a){const l=o/2,h=s/2,c=n/e,u=-c,d=-t[0]+a,g=-t[1];return ti(this.tempTransform,l,h,c,u,-r,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Wm(i,t,e,r,n,o,s,a,l,h,c,u){let d=i[t],g=i[t+1],f=0,p=0,m=0,y=0;function _(){f=d,p=g,t+=r,d=i[t],g=i[t+1],y+=m,m=Math.sqrt((d-f)*(d-f)+(g-p)*(g-p))}do _();while(t<e-r&&y+m<o);let x=m===0?0:(o-y)/m;const E=ue(f,d,x),v=ue(p,g,x),T=t-r,w=y,S=o+a*l(h,n,c);for(;t<e-r&&y+m<S;)_();x=m===0?0:(S-y)/m;const R=ue(f,d,x),O=ue(p,g,x);let $;if(u){const I=[E,v,R,O];xc(I,0,4,2,u,I,I),$=I[0]>I[2]}else $=E>R;const M=Math.PI,X=[],L=T+r===t;t=T,m=0,y=w,d=i[t],g=i[t+1];let P;if(L){_(),P=Math.atan2(g-p,d-f),$&&(P+=P>0?-M:M);const I=(R+E)/2,F=(O+v)/2;return X[0]=[I,F,(S-o)/2,P,n],X}n=n.replace(/\n/g," ");for(let I=0,F=n.length;I<F;){_();let at=Math.atan2(g-p,d-f);if($&&(at+=at>0?-M:M),P!==void 0){let A=at-P;if(A+=A>M?-2*M:A<-M?2*M:0,Math.abs(A)>s)return null}P=at;const tt=I;let q=0;for(;I<F;++I){const A=$?F-I-1:I,Kt=a*l(h,n[A],c);if(t+r<e&&y+m<o+q+Kt/2)break;q+=Kt}if(I===tt)continue;const ht=$?n.substring(F-tt,F-I):n.substring(tt,I);x=m===0?0:(o+q/2-y)/m;const xt=ue(f,d,x),Se=ue(p,g,x);X.push([xt,Se,q/2,at,ht]),o+=q}return X}function Hm(i,t,e,r){let n=i[t],o=i[t+1],s=0;for(let a=t+r;a<e;a+=r){const l=i[a],h=i[a+1];s+=Math.sqrt((l-n)*(l-n)+(h-o)*(h-o)),n=l,o=h}return s}const Mi=Ee(),ze=[],Ae=[],Ie=[],Ve=[];function fh(i){return i[3].declutterBox}const ph=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function cs(i,t){return t==="start"?t=ph.test(i)?"right":"left":t==="end"&&(t=ph.test(i)?"left":"right"),so[t]}function zm(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}class Vm{constructor(t,e,r,n,o){this.overlaps=r,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=oe(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new uu:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,r,n){const o=t+e+r+n;if(this.labels_[o])return this.labels_[o];const s=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?so[l.justify]:cs(Array.isArray(t)?t[0]:t,l.textAlign||Vr),d=n&&s.lineWidth?s.lineWidth:0,g=Array.isArray(t)?t:String(t).split(`
`).reduce(zm,[]),{width:f,height:p,widths:m,heights:y,lineWidths:_}=tm(l,g),x=f+d,E=[],v=(x+2)*c[0],T=(p+d)*c[1],w={width:v<0?Math.floor(v):Math.ceil(v),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:E};(c[0]!=1||c[1]!=1)&&E.push("scale",c),n&&(E.push("strokeStyle",s.strokeStyle),E.push("lineWidth",d),E.push("lineCap",s.lineCap),E.push("lineJoin",s.lineJoin),E.push("miterLimit",s.miterLimit),E.push("setLineDash",[s.lineDash]),E.push("lineDashOffset",s.lineDashOffset)),r&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const S=.5-u;let R=u*x+S*d;const O=[],$=[];let M=0,X=0,L=0,P=0,I;for(let F=0,at=g.length;F<at;F+=2){const tt=g[F];if(tt===`
`){X+=M,M=0,R=u*x+S*d,++P;continue}const q=g[F+1]||l.font;q!==I&&(n&&O.push("font",q),r&&$.push("font",q),I=q),M=Math.max(M,y[L]);const ht=[tt,R+S*m[L]+u*(m[L]-_[P]),.5*(d+M)+X];R+=m[L],n&&O.push("strokeText",ht),r&&$.push("fillText",ht),++L}return Array.prototype.push.apply(E,O),Array.prototype.push.apply(E,$),this.labels_[o]=w,w}replayTextBackground_(t,e,r,n,o,s,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,o),t.lineTo.apply(t,e),s&&(this.alignAndScaleFill_=s[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,r,n,o,s,a,l,h,c,u,d,g,f,p,m){a*=d[0],l*=d[1];let y=r-a,_=n-l;const x=o+h>t?t-h:o,E=s+c>e?e-c:s,v=f[3]+x*d[0]+f[1],T=f[0]+E*d[1]+f[2],w=y-f[3],S=_-f[0];(p||u!==0)&&(ze[0]=w,Ve[0]=w,ze[1]=S,Ae[1]=S,Ae[0]=w+v,Ie[0]=Ae[0],Ie[1]=S+T,Ve[1]=Ie[1]);let R;return u!==0?(R=ti(oe(),r,n,1,1,u,-r,-n),Bt(R,ze),Bt(R,Ae),Bt(R,Ie),Bt(R,Ve),Br(Math.min(ze[0],Ae[0],Ie[0],Ve[0]),Math.min(ze[1],Ae[1],Ie[1],Ve[1]),Math.max(ze[0],Ae[0],Ie[0],Ve[0]),Math.max(ze[1],Ae[1],Ie[1],Ve[1]),Mi)):Br(Math.min(w,w+v),Math.min(S,S+T),Math.max(w,w+v),Math.max(S,S+T),Mi),g&&(y=Math.round(y),_=Math.round(_)),{drawImageX:y,drawImageY:_,drawImageW:x,drawImageH:E,originX:h,originY:c,declutterBox:{minX:Mi[0],minY:Mi[1],maxX:Mi[2],maxY:Mi[3],value:m},canvasTransform:R,scale:d}}replayImageOrLabel_(t,e,r,n,o,s,a){const l=!!(s||a),h=n.declutterBox,c=a?a[2]*n.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,ze,Ae,Ie,Ve,s,a),em(t,n.canvasTransform,o,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const r=Bt(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(r[0]%n,r[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,r,n){const o=this.textStates[e],s=this.createLabel(t,e,n,r),a=this.strokeStates[r],l=this.pixelRatio,h=cs(Array.isArray(t)?t[0]:t,o.textAlign||Vr),c=so[o.textBaseline||io],u=a&&a.lineWidth?a.lineWidth:0,d=s.width/l-2*o.scale[0],g=h*d+2*(.5-h)*u,f=c*s.height/l+2*(.5-c)*u;return{label:s,anchorX:g,anchorY:f}}execute_(t,e,r,n,o,s,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&nr(r,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=yi(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),Uf(this.renderedTransform_,r));let u=0;const d=n.length;let g=0,f,p,m,y,_,x,E,v,T,w,S,R,O,$=0,M=0,X=null,L=null;const P=this.coordinateCache_,I=this.viewRotation_,F=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,at={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:I},tt=this.instructions!=n||this.overlaps?0:200;let q,ht,xt,Se;for(;u<d;){const A=n[u];switch(A[0]){case N.BEGIN_GEOMETRY:q=A[1],Se=A[3],q.getGeometry()?a!==void 0&&!jt(a,Se.getExtent())?u=A[2]+1:++u:u=A[2],h&&(h.zIndex=A[4]);break;case N.BEGIN_PATH:$>tt&&(this.fill_(t),$=0),M>tt&&(t.stroke(),M=0),!$&&!M&&(t.beginPath(),_=NaN,x=NaN),++u;break;case N.CIRCLE:g=A[1];const Kt=c[g],we=c[g+1],se=c[g+2],ri=c[g+3],or=se-Kt,ge=ri-we,Ua=Math.sqrt(or*or+ge*ge);t.moveTo(Kt+Ua,we),t.arc(Kt,we,Ua,0,2*Math.PI,!0),++u;break;case N.CLOSE_PATH:t.closePath(),++u;break;case N.CUSTOM:g=A[1],f=A[2];const Nu=A[3],Fu=A[4],Ba=A[5];at.geometry=Nu,at.feature=q,u in P||(P[u]=[]);const sr=P[u];Ba?Ba(c,g,f,2,sr):(sr[0]=c[g],sr[1]=c[g+1],sr.length=2),h&&(h.zIndex=A[6]),Fu(sr,at),++u;break;case N.DRAW_IMAGE:g=A[1],f=A[2],T=A[3],p=A[4],m=A[5];let Ro=A[6];const Uu=A[7],Bu=A[8],Gu=A[9],Ga=A[10];let Co=A[11];const Xu=A[12];let sn=A[13];y=A[14]||"declutter";const ar=A[15];if(!T&&A.length>=20){w=A[19],S=A[20],R=A[21],O=A[22];const Jt=this.drawLabelWithPointPlacement_(w,S,R,O);T=Jt.label,A[3]=T;const ni=A[23];p=(Jt.anchorX-ni)*this.pixelRatio,A[4]=p;const Qt=A[24];m=(Jt.anchorY-Qt)*this.pixelRatio,A[5]=m,Ro=T.height,A[6]=Ro,sn=T.width,A[13]=sn}let Ao;A.length>25&&(Ao=A[25]);let Io,an,ln;A.length>17?(Io=A[16],an=A[17],ln=A[18]):(Io=pi,an=!1,ln=!1),Ga&&F?Co+=I:!Ga&&!F&&(Co-=I);let Wu=0;for(;g<f;g+=2){if(Ao&&Ao[Wu++]<sn/this.pixelRatio)continue;const Jt=this.calculateImageOrLabelDimensions_(T.width,T.height,c[g],c[g+1],sn,Ro,p,m,Bu,Gu,Co,Xu,o,Io,an||ln,q),ni=[t,e,T,Jt,Uu,an?X:null,ln?L:null];if(l){let Qt,fe,te;if(ar){const gt=f-g;if(!ar[gt]){ar[gt]={args:ni,declutterMode:y};continue}const kt=ar[gt];Qt=kt.args,fe=kt.declutterMode,delete ar[gt],te=fh(Qt)}let Te,Re;if(Qt&&(fe!=="declutter"||!l.collides(te))&&(Te=!0),(y!=="declutter"||!l.collides(Jt.declutterBox))&&(Re=!0),fe==="declutter"&&y==="declutter"){const gt=Te&&Re;Te=gt,Re=gt}Te&&(fe!=="none"&&l.insert(te),this.replayImageOrLabel_.apply(this,Qt)),Re&&(y!=="none"&&l.insert(Jt.declutterBox),this.replayImageOrLabel_.apply(this,ni))}else this.replayImageOrLabel_.apply(this,ni)}++u;break;case N.DRAW_CHARS:const Xa=A[1],Wa=A[2],Mo=A[3],Hu=A[4];O=A[5];const zu=A[6],Ha=A[7],za=A[8];R=A[9];const Lo=A[10];w=A[11],S=A[12];const Va=[A[13],A[13]];y=A[14]||"declutter";const Oo=this.textStates[S],lr=Oo.font,hr=[Oo.scale[0]*Ha,Oo.scale[1]*Ha];let cr;lr in this.widths_?cr=this.widths_[lr]:(cr={},this.widths_[lr]=cr);const Ya=Hm(c,Xa,Wa,2),ja=Math.abs(hr[0])*rh(lr,w,cr);if(Hu||ja<=Ya){const Jt=this.textStates[S].textAlign,ni=(Ya-ja)*cs(w,Jt),Qt=Wm(c,Xa,Wa,2,w,ni,zu,Math.abs(hr[0]),rh,lr,cr,F?0:this.viewRotation_);t:if(Qt){const fe=[];let te,Te,Re,gt,kt;if(R)for(te=0,Te=Qt.length;te<Te;++te){kt=Qt[te],Re=kt[4],gt=this.createLabel(Re,S,"",R),p=kt[2]+(hr[0]<0?-Lo:Lo),m=Mo*gt.height+(.5-Mo)*2*Lo*hr[1]/hr[0]-za;const Ce=this.calculateImageOrLabelDimensions_(gt.width,gt.height,kt[0],kt[1],gt.width,gt.height,p,m,0,0,kt[3],Va,!1,pi,!1,q);if(l&&y==="declutter"&&l.collides(Ce.declutterBox))break t;fe.push([t,e,gt,Ce,1,null,null])}if(O)for(te=0,Te=Qt.length;te<Te;++te){kt=Qt[te],Re=kt[4],gt=this.createLabel(Re,S,O,""),p=kt[2],m=Mo*gt.height-za;const Ce=this.calculateImageOrLabelDimensions_(gt.width,gt.height,kt[0],kt[1],gt.width,gt.height,p,m,0,0,kt[3],Va,!1,pi,!1,q);if(l&&y==="declutter"&&l.collides(Ce.declutterBox))break t;fe.push([t,e,gt,Ce,1,null,null])}l&&y!=="none"&&l.load(fe.map(fh));for(let Ce=0,Vu=fe.length;Ce<Vu;++Ce)this.replayImageOrLabel_.apply(this,fe[Ce])}}++u;break;case N.END_GEOMETRY:if(s!==void 0){q=A[1];const Jt=s(q,Se,y);if(Jt)return Jt}++u;break;case N.FILL:tt?$++:this.fill_(t),++u;break;case N.MOVE_TO_LINE_TO:for(g=A[1],f=A[2],ht=c[g],xt=c[g+1],t.moveTo(ht,xt),_=ht+.5|0,x=xt+.5|0,g+=2;g<f;g+=2)ht=c[g],xt=c[g+1],E=ht+.5|0,v=xt+.5|0,(g==f-2||E!==_||v!==x)&&(t.lineTo(ht,xt),_=E,x=v);++u;break;case N.SET_FILL_STYLE:X=A,this.alignAndScaleFill_=A[2],$&&(this.fill_(t),$=0,M&&(t.stroke(),M=0)),t.fillStyle=A[1],++u;break;case N.SET_STROKE_STYLE:L=A,M&&(t.stroke(),M=0),this.setStrokeStyle_(t,A),++u;break;case N.STROKE:tt?M++:t.stroke(),++u;break;default:++u;break}}$&&this.fill_(t),M&&t.stroke()}execute(t,e,r,n,o,s){this.viewRotation_=n,this.execute_(t,e,r,this.instructions,o,void 0,void 0,s)}executeHitDetection(t,e,r,n,o){return this.viewRotation_=r,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,o)}}const zi=["Polygon","Circle","LineString","Image","Text","Default"],du=["Image","Text"],Ym=zi.filter(i=>!du.includes(i));class jm{constructor(t,e,r,n,o,s,a){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=e,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=oe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,a)}clip(t,e){const r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()}createExecutors_(t,e){for(const r in t){let n=this.executorsByZIndex_[r];n===void 0&&(n={},this.executorsByZIndex_[r]=n);const o=t[r];for(const s in o){const a=o[s];n[s]=new Vm(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const r=this.executorsByZIndex_[e];for(let n=0,o=t.length;n<o;++n)if(t[n]in r)return!0}return!1}forEachFeatureAtCoordinate(t,e,r,n,o,s){n=Math.round(n);const a=n*2+1,l=ti(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=pt(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Ee(),$r(u,t),ca(u,e*(this.renderBuffer_+n),u));const d=Zm(n);let g;function f(v,T,w){const S=c.getImageData(0,0,a,a).data;for(let R=0,O=d.length;R<O;R++)if(S[d[R]]>0){if(!s||w==="none"||g!=="Image"&&g!=="Text"||s.includes(v)){const $=(d[R]-3)/4,M=n-$%a,X=n-($/a|0),L=o(v,T,M*M+X*X);if(L)return L}c.clearRect(0,0,a,a);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(Yi);let m,y,_,x,E;for(m=p.length-1;m>=0;--m){const v=p[m].toString();for(_=this.executorsByZIndex_[v],y=zi.length-1;y>=0;--y)if(g=zi[y],x=_[g],x!==void 0&&(E=x.executeHitDetection(c,l,r,f,u),E))return E}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const r=e[0],n=e[1],o=e[2],s=e[3],a=[r,n,r,s,o,s,o,n];return yi(a,0,8,2,t,a),a}isEmpty(){return ha(this.executorsByZIndex_)}execute(t,e,r,n,o,s,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(Yi),s=s||zi;const h=zi.length;let c,u,d,g,f;for(a&&l.reverse(),c=0,u=l.length;c<u;++c){const p=l[c].toString();for(f=this.executorsByZIndex_[p],d=0,g=s.length;d<g;++d){const m=s[d],y=f[m];if(y!==void 0){const _=a===null?void 0:y.getZIndexContext(),x=_?_.getContext():t,E=this.maxExtent_&&m!=="Image"&&m!=="Text";if(E&&(x.save(),this.clip(x,r)),!_||m==="Text"||m==="Image"?y.execute(x,e,r,n,o,a):_.pushFunction(v=>y.execute(v,e,r,n,o,a)),E&&x.restore(),_){_.offset();const v=l[c]*h+d;this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Yi);for(let r=0,n=e.length;r<n;++r)t[e[r]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),t[e[r]].length=0}}const us={};function Zm(i){if(us[i]!==void 0)return us[i];const t=i*2+1,e=i*i,r=new Array(e+1);for(let o=0;o<=i;++o)for(let s=0;s<=i;++s){const a=o*o+s*s;if(a>e)break;let l=r[a];l||(l=[],r[a]=l),l.push(((i+o)*t+(i+s))*4+3),o>0&&l.push(((i-o)*t+(i+s))*4+3),s>0&&(l.push(((i+o)*t+(i-s))*4+3),o>0&&l.push(((i-o)*t+(i-s))*4+3))}const n=[];for(let o=0,s=r.length;o<s;++o)r[o]&&n.push(...r[o]);return us[i]=n,n}class qm extends cu{constructor(t,e,r,n,o,s,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=r,this.transform_=n,this.transformRotation_=n?qg(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=oe()}drawImages_(t,e,r,n){if(!this.image_)return;const o=yi(t,e,r,n,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=o.length;c<u;c+=2){const d=o[c]-this.imageAnchorX_,g=o[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const f=d+this.imageAnchorX_,p=g+this.imageAnchorY_;ti(a,f,p,1,1,h,-f,-p),s.save(),s.transform.apply(s,a),s.translate(f,p),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}drawText_(t,e,r,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const o=yi(t,e,r,n,this.transform_,this.pixelCoordinates_),s=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){const l=o[e]+this.textOffsetX_,h=o[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(l-this.textOffsetX_,h-this.textOffsetY_),s.rotate(a),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,l,h),this.textFillState_&&s.fillText(this.text_,l,h))}}moveToLineTo_(t,e,r,n,o){const s=this.context_,a=yi(t,e,r,n,this.transform_,this.pixelCoordinates_);s.moveTo(a[0],a[1]);let l=a.length;o&&(l-=2);for(let h=2;h<l;h+=2)s.lineTo(a[h],a[h+1]);return o&&s.closePath(),r}drawRings_(t,e,r,n){for(let o=0,s=r.length;o<s;++o)e=this.moveToLineTo_(t,e,r[o],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!jt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Zf(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],o=Math.sqrt(r*r+n*n),s=this.context_;s.beginPath(),s.arc(e[0],e[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const r=e.getGeometryFunction()(t);r&&(this.setStyle(e),this.drawGeometry(r))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!jt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(jt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const r=this.context_,n=t.getFlatCoordinates();let o=0;const s=t.getEnds(),a=t.getStride();r.beginPath();for(let l=0,h=s.length;l<h;++l)o=this.moveToLineTo_(n,o,s[l],a,!1);r.stroke()}if(this.text_!==""){const r=t.getFlatMidpoints();this.drawText_(r,0,r.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!jt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!jt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,r=t.getOrientedFlatCoordinates();let n=0;const o=t.getEndss(),s=t.getStride();e.beginPath();for(let a=0,l=o.length;a<l;++a){const h=o[a];n=this.drawRings_(r,n,h,s)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,e.lineCap=t.lineCap),nr(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:Vr;r?(r.font!=t.font&&(r.font=t.font,e.font=t.font),r.textAlign!=n&&(r.textAlign=n,e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const r=t.getColor();this.fillState_={fillStyle:_e(r||Gt)}}if(!e)this.strokeState_=null;else{const r=e.getColor(),n=e.getLineCap(),o=e.getLineDash(),s=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=o||$e;this.strokeState_={lineCap:n!==void 0?n:er,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(s||ke)*this.pixelRatio_,lineJoin:a!==void 0?a:ir,lineWidth:(l!==void 0?l:Yr)*this.pixelRatio_,miterLimit:h!==void 0?h:Hr,strokeStyle:_e(r||zr)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const r=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*r,this.imageAnchorY_=n[1]*r,this.imageHeight_=e[1]*r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const s=t.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/r,s[1]*this.pixelRatio_/r],this.imageWidth_=e[0]*r}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:_e(g||Gt)}}const r=t.getStroke();if(!r)this.textStrokeState_=null;else{const g=r.getColor(),f=r.getLineCap(),p=r.getLineDash(),m=r.getLineDashOffset(),y=r.getLineJoin(),_=r.getWidth(),x=r.getMiterLimit();this.textStrokeState_={lineCap:f!==void 0?f:er,lineDash:p||$e,lineDashOffset:m||ke,lineJoin:y!==void 0?y:ir,lineWidth:_!==void 0?_:Yr,miterLimit:x!==void 0?x:Hr,strokeStyle:_e(g||zr)}}const n=t.getFont(),o=t.getOffsetX(),s=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:n!==void 0?n:iu,textAlign:u!==void 0?u:Vr,textBaseline:d!==void 0?d:io},this.text_=c!==void 0?Array.isArray(c)?c.reduce((g,f,p)=>g+=p%2?" ":f,""):c:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Km=qm,pe=.5;function Jm(i,t,e,r,n,o,s,a,l){const h=n,c=i[0]*pe,u=i[1]*pe,d=pt(c,u);d.imageSmoothingEnabled=!1;const g=d.canvas,f=new Km(d,pe,n,null,s,a,null),p=e.length,m=Math.floor((256*256*256-1)/p),y={};for(let x=1;x<=p;++x){const E=e[x-1],v=E.getStyleFunction()||r;if(!v)continue;let T=v(E,o);if(!T)continue;Array.isArray(T)||(T=[T]);const w=(x*m).toString(16).padStart(7,"#00000");for(let S=0,R=T.length;S<R;++S){const O=T[S],$=O.getGeometryFunction()(E);if(!$||!jt(h,$.getExtent()))continue;const M=O.clone(),X=M.getFill();X&&X.setColor(w);const L=M.getStroke();L&&(L.setColor(w),L.setLineDash(null)),M.setText(void 0);const P=O.getImage();if(P){const tt=P.getImageSize();if(!tt)continue;const q=pt(tt[0],tt[1],void 0,{alpha:!1}),ht=q.canvas;q.fillStyle=w,q.fillRect(0,0,ht.width,ht.height),M.setImage(new So({img:ht,anchor:P.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:P.getOrigin(),opacity:1,size:P.getSize(),scale:P.getScale(),rotation:P.getRotation(),rotateWithView:P.getRotateWithView()}))}const I=M.getZIndex()||0;let F=y[I];F||(F={},y[I]=F,F.Polygon=[],F.Circle=[],F.LineString=[],F.Point=[]);const at=$.getType();if(at==="GeometryCollection"){const tt=$.getGeometriesArrayRecursive();for(let q=0,ht=tt.length;q<ht;++q){const xt=tt[q];F[xt.getType().replace("Multi","")].push(xt,M)}}else F[at.replace("Multi","")].push($,M)}}const _=Object.keys(y).map(Number).sort(Yi);for(let x=0,E=_.length;x<E;++x){const v=y[_[x]];for(const T in v){const w=v[T];for(let S=0,R=w.length;S<R;S+=2){f.setStyle(w[S+1]);for(let O=0,$=t.length;O<$;++O)f.setTransform(t[O]),f.drawGeometry(w[S])}}}return d.getImageData(0,0,g.width,g.height)}function Qm(i,t,e){const r=[];if(e){const n=Math.floor(Math.round(i[0])*pe),o=Math.floor(Math.round(i[1])*pe),s=(yt(n,0,e.width-1)+yt(o,0,e.height-1)*e.width)*4,a=e.data[s],l=e.data[s+1],h=e.data[s+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&r.push(t[h/c-1])}return r}const t_=.5,gu={Point:l_,LineString:o_,Polygon:c_,MultiPoint:h_,MultiLineString:s_,MultiPolygon:a_,GeometryCollection:n_,Circle:i_};function e_(i,t){return parseInt($t(i),10)-parseInt($t(t),10)}function mh(i,t){const e=fu(i,t);return e*e}function fu(i,t){return t_*i/t}function i_(i,t,e,r,n){const o=e.getFill(),s=e.getStroke();if(o||s){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(o,s),l.drawCircle(t,r,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r)}}function _h(i,t,e,r,n,o,s,a){const l=[],h=e.getImage();if(h){let d=!0;const g=h.getImageState();g==Y.LOADED||g==Y.ERROR?d=!1:g==Y.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),r_(i,t,e,r,o,s,a),u}function r_(i,t,e,r,n,o,s){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(r,n);if(e.getRenderer())pu(i,l,e,t,s);else{const h=gu[l.getType()];h(i,l,e,t,s,o)}}function pu(i,t,e,r,n){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let s=0,a=o.length;s<a;++s)pu(i,o[s],e,r,n);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,r,e.getRenderer(),e.getHitDetectionRenderer(),n)}function n_(i,t,e,r,n,o){const s=t.getGeometriesArray();let a,l;for(a=0,l=s.length;a<l;++a){const h=gu[s[a].getType()];h(i,s[a],e,r,n,o)}}function o_(i,t,e,r,n){const o=e.getStroke();if(o){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,r,n)}const s=e.getText();if(s&&s.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,r,n)}}function s_(i,t,e,r,n){const o=e.getStroke();if(o){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,r,n)}const s=e.getText();if(s&&s.getText()){const a=i.getBuilder(e.getZIndex(),"Text");a.setTextStyle(s),a.drawText(t,r,n)}}function a_(i,t,e,r,n){const o=e.getFill(),s=e.getStroke();if(s||o){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawMultiPolygon(t,r,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,n)}}function l_(i,t,e,r,n,o){const s=e.getImage(),a=e.getText(),l=a&&a.getText(),h=o&&s&&l?{}:void 0;if(s){if(s.getImageState()!=Y.LOADED)return;const c=i.getBuilder(e.getZIndex(),"Image");c.setImageStyle(s,h),c.drawPoint(t,r,n)}if(l){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,r,n)}}function h_(i,t,e,r,n,o){const s=e.getImage(),a=s&&s.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=o&&a&&h?{}:void 0;if(a){if(s.getImageState()!=Y.LOADED)return;const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(s,c),u.drawMultiPoint(t,r,n)}if(h){const u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,r,n)}}function c_(i,t,e,r,n){const o=e.getFill(),s=e.getStroke();if(o||s){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(o,s),l.drawPolygon(t,r,n)}const a=e.getText();if(a&&a.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,r,n)}}class u_ extends Xm{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Ee(),this.wrappedRenderedExtent_=Ee(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,r){const n=e.extent,o=e.viewState,s=o.center,a=o.resolution,l=o.projection,h=o.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),g=e.pixelRatio,f=e.viewHints,p=!(f[ie.ANIMATING]||f[ie.INTERACTING]),m=this.context,y=Math.round(st(n)/a*g),_=Math.round(Yt(n)/a*g),x=u.getWrapX()&&l.canWrapX(),E=x?st(c):null,v=x?Math.ceil((n[2]-c[2])/E)+1:1;let T=x?Math.floor((n[0]-c[0])/E):0;do{let w=this.getRenderTransform(s,a,0,g,y,_,T*E);e.declutter&&(w=w.slice(0)),t.execute(m,[m.canvas.width,m.canvas.height],w,h,p,r===void 0?zi:r?du:Ym,r?d&&e.declutter[d]:void 0)}while(++T<v)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=pt(this.context.canvas.width,this.context.canvas.height,gh))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,tr(this.context),gh.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const r=t.layerStatesArray[t.layerIndex];this.opacity_=r.opacity;const n=t.viewState;this.prepareContainer(t,e);const o=this.context,s=this.replayGroup_;let a=s&&!s.isEmpty();if(!a&&!(this.getLayer().hasListener(zt.PRERENDER)||this.getLayer().hasListener(zt.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(o,t),n.projection,this.clipped_=!1,a&&r.extent&&this.clipping){const l=gi(r.extent);a=jt(l,t.extent),this.clipped_=a&&!vr(l,t.extent),this.clipped_&&this.clipUnrotated(o,t,l)}return a&&this.renderWorlds(s,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&o.restore(),this.postRender(o,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const r=this.frameState.size.slice(),n=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=r[0]*pe,d=r[1]*pe;c.push(this.getRenderTransform(n,o,s,pe,u,d,0).slice());const g=h.getSource(),f=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!vr(f,l)){let p=l[0];const m=st(f);let y=0,_;for(;p<f[0];)--y,_=m*y,c.push(this.getRenderTransform(n,o,s,pe,u,d,_).slice()),p+=m;for(y=0,p=l[2];p>f[2];)++y,_=m*y,c.push(this.getRenderTransform(n,o,s,pe,u,d,_).slice()),p-=m}this.hitDetectionImageData_=Jm(r,c,this.renderedFeatures_,h.getStyleFunction(),l,o,s,mh(o,this.renderedPixelRatio_))}e(Qm(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,r,n,o){if(!this.replayGroup_)return;const s=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(f,p,m){const y=$t(f),_=h[y];if(_){if(_!==!0&&m<_.distanceSq){if(m===0)return h[y]=!0,o.splice(o.lastIndexOf(_),1),n(f,l,p);_.geometry=p,_.distanceSq=m}}else{if(m===0)return h[y]=!0,n(f,l,p);o.push(h[y]={feature:f,layer:l,geometry:p,distanceSq:m,callback:n})}};let u;const d=[this.replayGroup_],g=this.getLayer().getDeclutter();return d.some(f=>u=f.forEachFeatureAtCoordinate(t,s,a,r,c,g&&e.declutter[g]?e.declutter[g].all().map(p=>p.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),r=e.getSource();if(!r)return!1;const n=t.viewHints[ie.ANIMATING],o=t.viewHints[ie.INTERACTING],s=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!s&&n||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,g=e.getRevision(),f=e.getRenderBuffer();let p=e.getRenderOrder();p===void 0&&(p=e_);const m=h.center.slice(),y=ca(l,f*u),_=y.slice(),x=[y.slice()],E=c.getExtent();if(r.getWrapX()&&c.canWrapX()&&!vr(E,t.extent)){const L=st(E),P=Math.max(st(y)/2,L);y[0]=E[0]-P,y[2]=E[2]+P,vf(m,c);const I=dc(x[0],c);I[0]<E[0]&&I[2]<E[2]?x.push([I[0]+L,I[1],I[2]+L,I[3]]):I[0]>E[0]&&I[2]>E[2]&&x.push([I[0]-L,I[1],I[2]-L,I[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&this.renderedFrameDeclutter_===!!t.declutter&&vr(this.wrappedRenderedExtent_,y))return nr(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const v=new Bm(fu(u,d),y,u,d);let T;for(let L=0,P=x.length;L<P;++L)r.loadFeatures(x[L],u,c);const w=mh(u,d);let S=!0;const R=(L,P)=>{let I;const F=L.getStyleFunction()||e.getStyleFunction();if(F&&(I=F(L,u)),I){const at=this.renderFeature(L,w,I,v,T,this.getLayer().getDeclutter(),P);S=S&&!at}},O=_c(y),$=r.getFeaturesInExtent(O);p&&$.sort(p);for(let L=0,P=$.length;L<P;++L)R($[L],L);this.renderedFeatures_=$,this.ready=S;const M=v.finish(),X=new jm(y,u,d,r.getOverlaps(),M,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=_,this.wrappedRenderedExtent_=y,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=X,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,r,n,o,s,a){if(!r)return!1;let l=!1;if(Array.isArray(r))for(let h=0,c=r.length;h<c;++h)l=_h(n,t,r[h],e,this.boundHandleStyleImageChange_,o,s,a)||l;else l=_h(n,t,r,e,this.boundHandleStyleImageChange_,o,s,a);return l}}class mu extends Im{constructor(t){super(t)}createRenderer(){return new u_(this)}}function d_(i,t,e){const r=t.get("type")==="WebGLTile"||t instanceof _o,n=t.get("type")==="Vector"||t instanceof mu,o=r?t.style_:e.style;let s=o==null?void 0:o.variables;if(s){const a=_u(i);if(o.variables={...s,...a},n){const l=g_(o);t.setStyle(l)}else r&&t.updateStyleVariables(a)}}const _u=i=>{const t={};for(const e in i)if(typeof i[e]=="object"&&i[e]!==null){const r=_u(i[e]);for(const n in r)t[n]=r==null?void 0:r[n]}else t[e]=i==null?void 0:i[e];return t};function g_(i){let t=i;if("variables"in i){let e=JSON.stringify(i);const{variables:r}=i;for(const n in r)typeof r[n]=="number"?e=e.replaceAll(`["var","${n}"]`,r[n]):e=e.replaceAll(`["var","${n}"]`,`"${r[n]}"`);t=JSON.parse(e)}return t}var f_="Expected a function",yh=NaN,p_="[object Symbol]",m_=/^\s+|\s+$/g,__=/^[-+]0x[0-9a-f]+$/i,y_=/^0b[01]+$/i,x_=/^0o[0-7]+$/i,v_=parseInt,E_=typeof _n=="object"&&_n&&_n.Object===Object&&_n,b_=typeof self=="object"&&self&&self.Object===Object&&self,S_=E_||b_||Function("return this")(),w_=Object.prototype,T_=w_.toString,R_=Math.max,C_=Math.min,ds=function(){return S_.Date.now()};function A_(i,t,e){var r,n,o,s,a,l,h=0,c=!1,u=!1,d=!0;if(typeof i!="function")throw new TypeError(f_);t=xh(t)||0,Ms(e)&&(c=!!e.leading,u="maxWait"in e,o=u?R_(xh(e.maxWait)||0,t):o,d="trailing"in e?!!e.trailing:d);function g(T){var w=r,S=n;return r=n=void 0,h=T,s=i.apply(S,w),s}function f(T){return h=T,a=setTimeout(y,t),c?g(T):s}function p(T){var w=T-l,S=T-h,R=t-w;return u?C_(R,o-S):R}function m(T){var w=T-l,S=T-h;return l===void 0||w>=t||w<0||u&&S>=o}function y(){var T=ds();if(m(T))return _(T);a=setTimeout(y,p(T))}function _(T){return a=void 0,d&&r?g(T):(r=n=void 0,s)}function x(){a!==void 0&&clearTimeout(a),h=0,r=l=n=a=void 0}function E(){return a===void 0?s:_(ds())}function v(){var T=ds(),w=m(T);if(r=arguments,n=this,l=T,w){if(a===void 0)return f(l);if(u)return a=setTimeout(y,t),g(l)}return a===void 0&&(a=setTimeout(y,t)),s}return v.cancel=x,v.flush=E,v}function Ms(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function I_(i){return!!i&&typeof i=="object"}function M_(i){return typeof i=="symbol"||I_(i)&&T_.call(i)==p_}function xh(i){if(typeof i=="number")return i;if(M_(i))return yh;if(Ms(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=Ms(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(m_,"");var e=y_.test(i);return e||x_.test(i)?v_(i.slice(2),e?2:8):__.test(i)?yh:+i}var L_=A_;const yu=zc(L_);var Rr,Dn,Pn,Ls,xu,Os,Ds;class vu extends qt{constructor(){super(),lt(this,Ls),lt(this,Rr,{}),lt(this,Dn,null),lt(this,Pn),lt(this,Os,""),lt(this,Ds,""),this.layer=null,this.unstyled=!1,this.noShadow=!1,this.layerConfig=null,this.debouncedDataChange=yu(Ot(this,Ls,xu),1e3,{leading:!0})}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){Fn(this,Dn,O0(this.layer,this.layerConfig)),customElements.get("eox-jsonform")||console.error("Please import @eox/jsonform in order to use layerconfig");const t={disable_edit_json:!0,disable_collapse:!0,disable_properties:!0};return Z`
      <style>
        ${dt(this,Os)}
        ${!this.unstyled&&dt(this,Ds)}
      </style>
      ${ne(this.layerConfig,()=>Z`
          <!-- Render a JSON form for layer configuration -->
          <eox-jsonform
            .schema=${this.layerConfig.schema}
            .value=${dt(this,Dn)}
            .options=${t}
            @change=${this.debouncedDataChange}
          ></eox-jsonform>
        `)}
    `}}Rr=new WeakMap,Dn=new WeakMap,Pn=new WeakMap,Ls=new WeakSet,xu=function(i){Fn(this,Rr,i.detail),this.layerConfig.type==="style"||this.layerConfig.style?["Vector","WebGLTile"].includes(this.layer.get("type"))||this.layer instanceof mu||this.layer instanceof _o?d_(dt(this,Rr),this.layer,this.layerConfig):console.error(`Layer type ${this.layer.get("type")} does not support styles configuration`):(Fn(this,Pn,U0(dt(this,Rr),dt(this,Pn),this)),this.requestUpdate())},Os=new WeakMap,Ds=new WeakMap,Et(vu,"properties",{layer:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean},layerConfig:{attribute:!1}});customElements.define("eox-layercontrol-layerconfig",vu);var $n,Ps,$s;class Eu extends qt{constructor(){super(),lt(this,$n,t=>this.selectedTab===t&&"highlighted"),lt(this,Ps,`
    .tabbed figure {
      margin: 0;
    }
    .tabbed nav {
      display: flex;
      justify-content: space-between;
    }
    .tabbed nav div {
      display: flex;
    }
    .tabbed .tab {
      display: none;
    }
    .tabbed .tab.highlighted {
      display: block;
    }
    .tabbed label.highlighted {
      background: lightgrey;
    }
  `),lt(this,$s,`
    .tabbed {
      font-size: small;
    }
    .tabbed label.highlighted {
      background: #00417011;
      pointer-events: none;
    }
    nav div label,
    nav div span {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    figure {
      background: #00417011;
      border-top: 1px solid #0041701a;
    }
  `),this.actions=[],this.selectedTab=0,this.tabs=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const t=this.tabs,e=this.actions,r=e.length+t.length>1;return Z`
      <style>
        ${dt(this,Ps)}
        ${!this.unstyled&&dt(this,$s)}
      </style>
      <div class="tabbed">
        <!-- Navigation for tabs and actions -->
        ${ne(r,()=>Z`
            <nav>
              <div>
                <!-- Labels for tabs -->
                ${Ln(t,(n,o)=>Z`
                      <label
                        class=${dt(this,$n).call(this,o)}
                        @click=${()=>this.selectedTab=o}
                      >
                        <!-- Customizable icon for each tab -->
                        <slot name=${`${n}-icon`}>${n}</slot>
                      </label>
                    `)}
              </div>
              <div>
                <!-- Icons for actions -->
                ${Ln(e,n=>Z`
                      <span>
                        <!-- Customizable icon for each action -->
                        <slot name=${`${n}-icon`}>${n}</slot>
                      </span>
                    `)}
              </div>
            </nav>
          `)}
        <figure>
          <!-- Content for each tab -->
          ${Ln(t,(n,o)=>Z`
              <div class="tab ${dt(this,$n).call(this,o)}">
                <!-- Content slot for each tab -->
                <slot name=${`${n}-content`}>${n}</slot>
              </div>
            `)}
        </figure>
      </div>
    `}}$n=new WeakMap,Ps=new WeakMap,$s=new WeakMap,Et(Eu,"properties",{actions:{attribute:!1},selectedTab:{state:!0},tabs:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-tabs",Eu);const O_=`
button,
.button {
  /* TODO: why does this only work here and not from :root? */
  --primary-color: #004170;
  --primary-color-hover: #004170CC;
  --error-color: #FF5252;

  display: inline-flex;
  position: relative;
  align-items: center;
  color: #fff;
  border-width: 0;
  outline: none;
  border-radius: 4px;
  padding: 16px;
  height: 36px;
  cursor: pointer;
  font-family: inherit;
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 1.25px;                           
  font-weight: 500;
  box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);
  transition-property: box-shadow, transform, opacity, background;
  transition-duration: 0.28s;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

button:hover:not([disabled]):not(.icon),
.button:hover:not([disabled]):not(.icon) {
  box-shadow: 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12);
  background: var(--primary-color-hover);
}

button, button:active,
.button, .button:active {
  background: var(--primary-color);
}

button[disabled],
.button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

button.block,
.button.block {
  display: block;
}

button.outline,
.button.outline {
  background: transparent;
  box-shadow: none;
  color: var(--primary-color);
  outline: 1px solid var(--primary-color);
}

button.outline:hover,
.button.outline:hover {
  background: transparent;
}

button.icon,
.button.icon {
  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  text-indent: -9999px;
}

button.icon-text,
.button.icon-text {
  text-indent: 26px;
}

button.icon-text.block,
.button.icon-text.block {
  text-indent: 20px;
}

button.icon:before, button.icon-text:before,
.button.icon:before, .button.icon-text:before {
  position: absolute;
  text-indent: 0;
  line-height: initial;
}

button.icon-text.block:before,
.button.icon-text.block:before {
  text-indent: -54px;
}

button.icon:before,
.button.icon:before {
  width: 24px;
  height: 24px;
  margin-right: 0;
}

button.icon-text:before,
.button.icon-text:before {
  width: 18px;
  height: 18px;
}

button.small,
.button.small {
  height: 28px;
  padding: 12.4px;
  font-size: .75rem;
}

button.smallest.icon, 
button.smallest.icon::before {
  height: 16px;
  width: 16px;
  padding: 0px;
}
`,D_=`
input[type=radio] {
  appearance: none;
  -webkit-appearance: none;
  margin: 0;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  align-items: center;
  width: 24px;
  height: 24px;
}

label span {
  font-size: small;
}

input[type=radio]:after {
  display: block;
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eradiobox-blank%3C/title%3E%3Cpath d='M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z' /%3E%3C/svg%3E");
  width: 20px;
  height: 20px;
  margin-right: 4px;
}
input[type=radio]:checked:after {
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eradiobox-marked%3C/title%3E%3Cpath d='M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z' /%3E%3C/svg%3E");

}
`,bu=`
input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  margin: 0;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  align-items: center;
  width: 24px;
  height: 24px;
}
input[type=checkbox]:after {
  display: block;
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckbox-blank-outline%3C/title%3E%3Cpath d='M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z' /%3E%3C/svg%3E");
  width: 20px;
  height: 20px;
  margin-right: 4px;
}
input[type=checkbox]:checked:after {
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckbox-marked%3C/title%3E%3Cpath d='M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z' /%3E%3C/svg%3E");

}
`,P_=`
input[type="range"] {
  -webkit-appearance: none;
  width: 90%;
  margin-left: 5%;
  height: 6px;
  border-radius: 5px;
  background: #d7dcdf;
  outline: none;
  padding: 0;
}
input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #2c3e50;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}
.range-slider {
  margin: 60px 0 0 0;
}
.range-slider {
  width: 100%;
}
input[type="range"]::-webkit-slider-thumb:hover {
  background: #00416F;
}
input[type="range"]:active::-webkit-slider-thumb {
  background: #00416F;
}
input[type="range"]::-moz-range-thumb {
  width: 15px;
  height: 15px;
  border: 0;
  border-radius: 50%;
  background: #2c3e50;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}
input[type="range"]::-moz-range-thumb:hover {
  background: #00416F;
}
input[type="range"]:active::-moz-range-thumb {
  background: #00416F;
}
input[type="range"]:focus::-webkit-slider-thumb {
  box-shadow: 0 0 0 3px #fff0, 0 0 0 6px #00416F00;
}
.range-slider__value {
  display: inline-block;
  position: relative;
  width: 60px;
  color: #fff;
  line-height: 20px;
  text-align: center;
  border-radius: 3px;
  background: #2c3e50;
  padding: 5px 10px;
  margin-left: 8px;
}
.range-slider__value:after {
  position: absolute;
  top: 8px;
  left: -7px;
  width: 0;
  height: 0;
  border-top: 7px solid transparent;
  border-right: 7px solid #2c3e50;
  border-bottom: 7px solid transparent;
  content: '';
}

input::-moz-focus-inner, input::-moz-focus-outer {
  border: 0;
}
`;var ks,Ns;class Su extends qt{constructor(){super(),Et(this,"_removeButton",()=>k0(this)),Et(this,"_sortButton",()=>N0(this.unstyled)),Et(this,"_button",t=>$0(t,this.unstyled)),lt(this,ks,""),lt(this,Ns,`
    ${O_}  
    ${D_}
    ${bu}
    ${P_}
    .drag-handle {
      cursor: n-resize;
    }
    .single-action-container,
    details.tools {
      position: relative;
    }
    eox-layercontrol-layer details summary::before {
      content: "";
    }
    details.tools[open] {
      /*border-top: 1px solid #0041703a;*/
    }
    .single-action {
      position: relative;
    }
    details.tools summary .icon {
      pointer-events: none;
    }
    .single-action,
    details.tools summary {
      position: absolute;
      right: 0;
      top: -24px;
      display: flex;
      border-radius: 4px;
      cursor: pointer;
    }
    .single-action .icon::before,
    details.tools summary .icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Edots-vertical%3C/title%3E%3Cpath d='M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z' /%3E%3C/svg%3E");
    }
    .single-action,
    details.tools summary,
    eox-layercontrol-tabs button.icon {
      transition: opacity .2s;
    }
    .single-action,
    details.tools summary {
      opacity: .5;
    }
    eox-layercontrol-tabs button.icon {
      opacity: .7;
    }
    .single-action:hover,
    details.tools summary:hover,
    eox-layercontrol-tabs button.icon:hover {
      opacity: 1;
    }
    .tools-placeholder,
    .single-action .icon,
    .single-action .icon::before,
    details.tools summary .icon,
    details.tools summary .icon::before {
      height: 16px;
      width: 16px;
    }
    eox-layercontrol-tabs button.icon,
    eox-layercontrol-tabs .button.icon {
      display: flex;
      justify-content: center;
    }
    eox-layercontrol-tabs button.icon::before,
    eox-layercontrol-tabs .button.icon::before {
      width: 16px;
      height: 16px;
    }
    details.tools summary .info-icon,
    button.icon[slot=info-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Einformation-outline%3C/title%3E%3Cpath d='M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z' /%3E%3C/svg%3E");
    }
    details.tools summary .opacity-icon,
    button.icon[slot=opacity-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eopacity%3C/title%3E%3Cpath d='M17.66,8L12,2.35L6.34,8C4.78,9.56 4,11.64 4,13.64C4,15.64 4.78,17.75 6.34,19.31C7.9,20.87 9.95,21.66 12,21.66C14.05,21.66 16.1,20.87 17.66,19.31C19.22,17.75 20,15.64 20,13.64C20,11.64 19.22,9.56 17.66,8M6,14C6,12 6.62,10.73 7.76,9.6L12,5.27L16.24,9.65C17.38,10.77 18,12 18,14H6Z' /%3E%3C/svg%3E");
    }
    details.tools summary .config-icon,
    button.icon[slot=config-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Etune%3C/title%3E%3Cpath d='M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z' /%3E%3C/svg%3E");
    }
    .single-action .remove-icon::before,
    [slot=remove-icon] button.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23ff0000' viewBox='0 0 24 24'%3E%3Ctitle%3Edelete-outline%3C/title%3E%3Cpath d='M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z' /%3E%3C/svg%3E");
    }
    .single-action .sort-icon::before,
    [slot=sort-icon] .button.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Edrag-horizontal-variant%3C/title%3E%3Cpath d='M21 11H3V9H21V11M21 13H3V15H21V13Z' /%3E%3C/svg%3E");
    }
    [slot=info-content],
    [slot=opacity-content] {
      padding: 12px 6px;
    }
  `),this.layer=null,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){var t;const e=D0(this.tools,this.layer),r=P0(this.tools,this.layer),n=this[`_${e==null?void 0:e[0]}Button`]?this[`_${e==null?void 0:e[0]}Button`]():ot,o=((t=this.tools)==null?void 0:t.length)===1?`${this.tools[0]}-icon`:"",s=e==null?void 0:e.length,a=r==null?void 0:r.length;return Z`
      <style>
        ${dt(this,ks)}
        ${!this.unstyled&&dt(this,Ns)}
      </style>
      ${ne(s+a>0,()=>Z`
          ${ne(s===1&&a===0,()=>Z`
              <div class="single-action-container">
                <div class="single-action">${n}</div>
              </div>
            `,()=>{var l;return Z`
              <details
                class="tools"
                open=${this.layer.get("layerControlToolsExpand")||ot}
              >
                <summary>
                  <button class="icon ${o}">Tools</button>
                </summary>
                <eox-layercontrol-tabs
                  .noShadow=${!1}
                  .actions=${e}
                  .tabs=${r}
                  .unstyled=${this.unstyled}
                >
                  <!-- Rendering tabs and content -->
                  ${Ln(r,h=>this._button(h))}

                  <div slot="info-content">
                    ${F0(this.layer.get("description"))}
                  </div>
                  <div slot="opacity-content">
                    <!-- Input for opacity -->
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.01"
                      value=${Qc((l=this.layer)==null?void 0:l.getOpacity())}
                      @input=${h=>this.layer.setOpacity(parseFloat(h.target.value))}
                    />
                  </div>
                  <div slot="config-content">
                    <!-- Layer configuration -->
                    ${ne(this.layer.get("layerConfig"),()=>Z`
                        <eox-layercontrol-layerconfig
                          slot="config-content"
                          .layer=${this.layer}
                          .noShadow=${!0}
                          .layerConfig=${this.layer.get("layerConfig")}
                          .unstyled=${this.unstyled}
                          @changed=${()=>this.requestUpdate()}
                        ></eox-layercontrol-layerconfig>
                      `)}
                  </div>
                  <div slot="remove-icon">${this._removeButton()}</div>
                  <div slot="sort-icon">${this._sortButton()}</div>
                </eox-layercontrol-tabs>
              </details>
            `})}
        `)}
    `}}ks=new WeakMap,Ns=new WeakMap,Et(Su,"properties",{layer:{attribute:!1},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-tools",Su);const $_=i=>{const t=()=>{const e=Ug(i.layer,i.map,i.showLayerZoomState);let r=!1;!e&&i.currLayerVisibilityBasedOnZoom?(i.currLayerVisibilityBasedOnZoom=!1,r=!0):e&&!i.currLayerVisibilityBasedOnZoom&&(i.currLayerVisibilityBasedOnZoom=!0,r=!0),r&&(i.requestUpdate(),i.dispatchEvent(new CustomEvent("change:resolution",{bubbles:!0})))};rc(i.layer,i.showLayerZoomState)&&(t(),i.map.getView().on("change:resolution",()=>t()))},k_=(i,t)=>{const e=t.layer;e.setVisible(i.target.checked),i.target.checked&&e.get("layerControlExclusive")&&t.closest(".layers > ul").querySelectorAll("eox-layercontrol-layer").forEach(r=>{var n;r.layer!==e&&(n=r.layer)!=null&&n.get("layerControlExclusive")&&(r.layer.setVisible(!1),r.requestUpdate())}),t.dispatchEvent(new CustomEvent("changed",{bubbles:!0,detail:e})),t.requestUpdate()};var Fi,kn,wu,Fs,Us;class Tu extends qt{constructor(){super(),lt(this,Fi),Et(this,"currLayerVisibilityBasedOnZoom",!0),lt(this,Fs,""),lt(this,Us,`
    ${bu}
    eox-layercontrol-layer {
      width: 100%;
    }
    .layer.zoom-state-invisible {
      background: #d2e2ee;
      opacity: 0.3;
    }
    .layer {
      width: 100%;
      align-items: center;
      justify-content: space-between;
      padding: 4px 0;
    }
    label, span {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    [data-type] .title::before {
      width: 20px;
      min-width: 20px;
      height: 20px;
      margin-right: 6px;
    }
    [data-type=group] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Efolder-outline%3C/title%3E%3Cpath d='M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z' /%3E%3C/svg%3E");
    }
    [data-type=group] > eox-layercontrol-layer-group > details[open] > summary > eox-layercontrol-layer > .layer > label > .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Efolder-open-outline%3C/title%3E%3Cpath d='M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z' /%3E%3C/svg%3E");
    }
    [data-type=raster] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckerboard%3C/title%3E%3Cpath d='M2 2V22H22V2H2M20 12H16V16H20V20H16V16H12V20H8V16H4V12H8V8H4V4H8V8H12V4H16V8H20V12M16 8V12H12V8H16M12 12V16H8V12H12Z' /%3E%3C/svg%3E");
    }
    [data-type=vector] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Eshape-outline%3C/title%3E%3Cpath d='M11,13.5V21.5H3V13.5H11M9,15.5H5V19.5H9V15.5M12,2L17.5,11H6.5L12,2M12,5.86L10.08,9H13.92L12,5.86M17.5,13C20,13 22,15 22,17.5C22,20 20,22 17.5,22C15,22 13,20 13,17.5C13,15 15,13 17.5,13M17.5,15A2.5,2.5 0 0,0 15,17.5A2.5,2.5 0 0,0 17.5,20A2.5,2.5 0 0,0 20,17.5A2.5,2.5 0 0,0 17.5,15Z' /%3E%3C/svg%3E");
    }
    [data-type=draw] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Evector-square-edit%3C/title%3E%3Cpath d='M22.7 14.4L21.7 15.4L19.6 13.3L20.6 12.3C20.8 12.1 21.2 12.1 21.4 12.3L22.7 13.6C22.9 13.8 22.9 14.1 22.7 14.4M13 19.9L19.1 13.8L21.2 15.9L15.1 22H13V19.9M11 19.9V19.1L11.6 18.5L12.1 18H8V16H6V8H8V6H16V8H18V12.1L19.1 11L19.3 10.8C19.5 10.6 19.8 10.4 20.1 10.3V8H22.1V2H16.1V4H8V2H2V8H4V16H2V22H8V20L11 19.9M18 4H20V6H18V4M4 4H6V6H4V4M6 20H4V18H6V20Z' /%3E%3C/svg%3E");
    }
  `),this.layer=null,this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}firstUpdated(){$_(this)}render(){var t;const e=this.layer.getVisible(),r=e?"visible":"",n=this.currLayerVisibilityBasedOnZoom?"":"zoom-state-invisible",o=Ot(this,Fi,kn).call(this,"layerControlDisable")?"disabled":"",s=Ot(this,Fi,kn).call(this,"layerControlExclusive")?"radio":"checkbox",a=((t=this.tools)==null?void 0:t.length)>0;return Z`
      <style>
        ${dt(this,Fs)}
        ${!this.unstyled&&dt(this,Us)}
      </style>
      ${ne(this.layer,()=>Z`
          <!-- Render the layer -->
          <div class="layer ${r} ${n}">
            <label class="drag-handle ${o}">
              <!-- Input element for layer visibility -->
              <input
                type=${s}
                .checked=${Qc(e)}
                @click=${Ot(this,Fi,wu)}
              />

              <!-- Layer title -->
              <span class="title">${Ot(this,Fi,kn).call(this,this.titleProperty)}</span>
              ${ne(a,()=>Z`<span class="tools-placeholder"></span>`)}
            </label>
          </div>

          <!-- Render layer tools -->
          <eox-layercontrol-layer-tools
            .noShadow=${!0}
            .layer=${this.layer}
            .tools=${this.tools}
            .unstyled=${this.unstyled}
          ></eox-layercontrol-layer-tools>
        `)}
    `}}Fi=new WeakSet,kn=function(i){var t;return(t=this.layer)==null?void 0:t.get(i)},wu=function(i){k_(i,this)},Fs=new WeakMap,Us=new WeakMap,Et(Tu,"properties",{layer:{attribute:!1},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer",Tu);var Bs,Gs;class Ru extends qt{constructor(){super(),lt(this,Bs,""),lt(this,Gs,`
    details summary {
      cursor: pointer;
      display: flex;
    }
    details summary { list-style-type: none; } /* Firefox */
    details summary::-webkit-details-marker { display: none; } /* Chrome */
    details summary::marker { display: none; }
    details summary::before {
      display: block;
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echevron-right%3C/title%3E%3Cpath d='M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z' /%3E%3C/svg%3E");
      font-size: 13px;
      width: 24px;
      height: 24px;
      margin: 4px 0;
      transform-origin: center;
      transition: transform 0.1s ease-in-out;
    }
    details[open] > summary:before {
      transform: rotate(90deg);
    }
    details[data-children-length="0"] summary::before {
      display: none;
    }
  `),this.group=null,this.idProperty="id",this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){var t,e;const r=!!((t=this.group)!=null&&t.get("layerControlExpand")),n=(e=Jc(this.group.getLayers()))==null?void 0:e.length;return Z`
      <style>
        ${dt(this,Bs)}
        ${!this.unstyled&&dt(this,Gs)}
      </style>
      ${ne(this.group,()=>Z`
          <!-- Render the details element with the layer control -->
          <details
            open=${r||ot}
            data-children-length=${n}
          >
            <summary>
              <!-- Render the layer control within the summary -->
              <eox-layercontrol-layer
                .noShadow=${!0}
                .layer=${this.group}
                .map=${this.map}
                .titleProperty=${this.titleProperty}
                .showLayerZoomState=${this.showLayerZoomState}
                .tools=${this.tools}
                .unstyled=${this.unstyled}
                @changed=${()=>this.requestUpdate()}
              ></eox-layercontrol-layer>
            </summary>

            <!-- Render the list of layers within the details -->
            <eox-layercontrol-layer-list
              .noShadow=${!0}
              .idProperty=${this.idProperty}
              .layers=${this.group.getLayers()}
              .map=${this.map}
              .titleProperty=${this.titleProperty}
              .showLayerZoomState=${this.showLayerZoomState}
              .tools=${this.tools}
              .unstyled=${this.unstyled}
              @changed=${()=>this.requestUpdate()}
            ></eox-layercontrol-layer-list>
          </details>
        `)}
    `}}Bs=new WeakMap,Gs=new WeakMap,Et(Ru,"properties",{group:{attribute:!1},idProperty:{attribute:"id-property"},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-group",Ru);const N_=i=>{const{layers:t,idProperty:e,titleProperty:r,renderRoot:n}=i,o=yu(()=>{i.requestUpdate(),i.dispatchEvent(new CustomEvent("changed",{bubbles:!0}))},50),s=()=>o();if(t&&(t.hasListener("change:length")&&(t==null||t.un("change:length",s)),t.on("change:length",s),t)){const a=n.querySelector("ul");Fg(t,e,r,i),Ng(a,t,e,i)}};var Xs,Ws;class Cu extends qt{constructor(){super(),lt(this,Xs,""),lt(this,Ws,`
    ul {
      padding: 0;
      margin: 0;
    }
    ul ul {
      padding-left: 48px;
    }
    li {
      list-style: none;
    }
    li {
      border-bottom: 1px solid #0041703a;
    }
    li:first-child {
      border-top: 1px solid #0041703a;
    }
    li:last-child {
      border: none;
    }
    li.sortable-chosen {
      background: #eeea;
    }
    li.sortable-drag {
      opacity: 0;
    }
    li.sortable-ghost {
    }
  `),this.idProperty="id",this.layers=null,this.map=null,this.tools=void 0,this.titleProperty="title",this.showLayerZoomState=!1,this.unstyled=!1,this.noShadow=!1}firstUpdated(){N_(this)}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const t=this.layers?Jc(this.layers).reverse():[];return Z`
      <style>
        ${dt(this,Xs)}
        ${!this.unstyled&&dt(this,Ws)}
      </style>
      <ul>
        ${ne(this.layers,()=>Z`
            ${gd(t,e=>e,e=>Z`
                <li
                  data-layer="${e.get(this.idProperty)}"
                  data-type="${Bg(e,this.map)}"
                >
                  ${e.getLayers?Z`
                          <eox-layercontrol-layer-group
                            .noShadow=${!0}
                            .group=${e}
                            .idProperty=${this.idProperty}
                            .map=${this.map}
                            .titleProperty=${this.titleProperty}
                            .showLayerZoomState=${this.showLayerZoomState}
                            .tools=${this.tools}
                            .unstyled=${this.unstyled}
                            @changed=${()=>this.requestUpdate()}
                          >
                          </eox-layercontrol-layer-group>
                        `:Z`
                          <eox-layercontrol-layer
                            .noShadow=${!0}
                            .layer=${e}
                            .map=${this.map}
                            .titleProperty=${this.titleProperty}
                            .showLayerZoomState=${this.showLayerZoomState}
                            .tools=${this.tools}
                            .unstyled=${this.unstyled}
                            @changed=${()=>this.requestUpdate()}
                          ></eox-layercontrol-layer>
                        `}
                </li>
              `)}
          `)}
      </ul>
    `}}Xs=new WeakMap,Ws=new WeakMap,Et(Cu,"properties",{idProperty:{attribute:"id-property"},layers:{attribute:!1},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-list",Cu);const F_=i=>{const t=i.querySelector("select[name=optional]"),e=t?t.value:null,r=aa(i.layers.getArray(),"layerControlOptional",!0).find(n=>(n.get(i.idProperty)||n.ol_uid)===e);r==null||r.set("layerControlOptional",!1),r==null||r.setVisible(!0),i.dispatchEvent(new CustomEvent("changed",{bubbles:!0})),i.renderRoot.parentNode.querySelectorAll("eox-layercontrol-layer-list").forEach(n=>n.requestUpdate()),i.requestUpdate()};var Hs,Au;class Iu extends qt{constructor(){super(),lt(this,Hs),this.idProperty="id",this.layers=null,this.titleProperty="title",this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const t=aa(this.layers.getArray(),"layerControlOptional",!0);return Z`
      <!-- Label for the dropdown -->
      <label for="optional">Optional layers</label>

      <!-- Dropdown select element -->
      <select name="optional" data-cy="optionalLayers">
        <!-- Default placeholder option -->
        <option disabled selected value>
          -- select an optional layer to add --
        </option>

        <!-- Mapping through filtered layers list to generate dropdown options -->
        ${t.map(e=>{const r=e.get(this.idProperty)||e.ol_uid,n=e.get(this.titleProperty),o=`layer ${e.get(this.idProperty)}`;return Z` <option value="${r}">${n||o}</option> `})}
      </select>

      <!-- Button to handle adding layers -->
      <button @click="${Ot(this,Hs,Au)}">add</button>
    `}}Hs=new WeakSet,Au=function(){F_(this)},Et(Iu,"properties",{idProperty:{attribute:"id-property"},layers:{attribute:!1},titleProperty:{attribute:"title-property",type:String},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-optional-list",Iu);const U_=(i,t)=>{t.jsonInput=i.target.value,t.requestUpdate()},vh=i=>{const t=JSON.parse(`{"data":${Xh(i.jsonInput)}}`);Array.isArray(t.data)?t.data.forEach(e=>{i.eoxMap.addOrUpdateLayer(e)}):i.eoxMap.addOrUpdateLayer(t.data),i.jsonInput=null,i.requestUpdate()},B_=(i,t)=>{t.urlInput=i.target.value,t.requestUpdate()};async function G_(i){const t=i.urlInput;if(i.wmsCapabilities=null,i.searchLoad=!0,i.requestUpdate(),!t)return!1;if(ra(t)==="XYZ")return{Name:t};try{const e=await og(t);i.wmsCapabilities=e}catch{}finally{i.searchLoad=!1,i.requestUpdate()}return!1}const X_=(i,t)=>{const{Name:e}=i,r=ra(t.urlInput)||"XYZ",n={type:"Tile",properties:{id:e,title:e},source:{type:r,url:t.urlInput,params:{LAYERS:e}}};t.jsonInput=JSON.stringify(n)},W_=(i,t)=>{t.open=i||null,t.urlInput=null,t.jsonInput=null,t.wmsCapabilities=null,t.requestUpdate()};var he,Mu,Lu,zs,Ou,Du,Nn,Vs,Ys;class Pu extends qt{constructor(){super(),lt(this,he),Et(this,"urlInput",null),Et(this,"jsonInput",null),Et(this,"open",null),Et(this,"searchLoad",!1),Et(this,"wmsCapabilities",null),lt(this,Vs,`
    .eox-add-layer-main .open {
      position: relative;
    }
    .eox-add-layer-main .close {
      display: none;
    }
  `),lt(this,Ys,`
    .eox-add {
      background: #f0f2f5;
      border-top: 1px solid #0041701a;
      padding: 0.5rem;
      font-size: small;
    }
    .eox-add-layer-col, .eox-add-layer-tab {
      display: flex;
      width: 100%;
    }
    .eox-add-layer-main .close {
      display: none;
    }
    .eox-add-layer-main .open {
      position: relative;
    }
    button.icon.add-icon {
      flex-grow: 1;
    }
    .eox-add-layer-tab li {
      border: 0 !important;
      font-size: smaller;
      padding: 0.2rem 0.7rem;
      background: #f0f2f5;
      border-radius: 4px 4px 0px 0px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }
    .eox-add-layer-tab li.active {
      background: #204270;
      color: white;
      font-weight: 700;
    }
    .relative {
      position: relative
    }
    .eox-add-layer-col.justify-end {
      justify-content: end;
    }
    .eox-add ul {
      max-height: 120px;
      overflow: scroll;
    }
    .eox-add ul li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.1rem 0.2rem;
    }
    button.icon {
      justify-content: end;
      transition: opacity .2s;
      opacity: .7;
    }
    button.icon:hover {
      opacity: 1;
    }
    button.icon.add-layer-icon::before {
      width: 16px;
      min-width: 16px;
      height: 16px;
    }
    button.icon.add-icon::before {
      width: 18px;
      min-width: 18px;
      height: 18px;
    }
    .add-icon.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath xmlns='http://www.w3.org/2000/svg' d='M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z' fill='%23004270'/%3E%3C/svg%3E");
    }
    .add-layer-icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Eplus-thick%3C/title%3E%3Cpath fill='%23004270' d='M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z' /%3E%3C/svg%3E");
    }
    .json-add-layer {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Eplus-thick%3C/title%3E%3Cpath fill='white' d='M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z' /%3E%3C/svg%3E");
    }
    .search-icon::after {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Emagnify%3C/title%3E%3Cpath d='M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z' fill='white' /%3E%3C/svg%3E");
    }
    .search-icon::after, .json-add-layer::before {
      width: 14px;
      min-width: 14px;
      height: 14px;
      display:flex
      margin-right: 6px;
      color: white;
    }
    .search-icon, .json-add-layer {
      padding: 4px 6px;
      height: 28px;
      border-radius: 0px 4px 4px 0px;
      box-shadow: none;
    }
    .json-add-layer {
      position: absolute;
      bottom: 16px;
      right: 14px;
      border-radius: 4px;
      height: 24px;
      padding: 4px;
    }
    input.add-url, textarea.add-layer-input {
      box-sizing: border-box !important;
      width: 100%;
      height: 28px;
      padding: 5px 7px !important;
      border: 1px solid #0004 !important;
      font-size: smaller;
      border-radius: 4px 0px 0px 4px;
    }
    textarea.add-layer-input {
      height: 90px;
      resize: none;
      border-radius: 4px;
    }
    .divider {
      margin: 1rem 0px;
      height: 1px;
      border-top: 1.5px solid #00417059;
      text-align: center;
      position: relative;
    }
    .divider span {
      position: relative;
      top: -.6em;
      padding: 0px 0.5rem;
      background: #f0f2f5;
      color: #00417059;
      font-weight: bold;
      display: inline-block;
    }
  `),this.eoxMap=null,this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const t=this.open?"open":"close",e=this.open==="url",r=this.open==="json",n=!sg(this.urlInput)||this.searchLoad?!0:ot;return Z`
      <style>
        ${dt(this,Vs)}
        ${!this.unstyled&&dt(this,Ys)}
      </style>
      <div class="eox-add-layer-main">
        <div class="eox-add-layer-col">
          <!-- Tabbed interface for URL and JSON -->
          <ul class="eox-add-layer-tab ${t}">
            <li
              @click=${()=>Ot(this,he,Nn).call(this,"url")}
              class="${e?"active":""}"
            >
              URL
            </li>
            <li
              @click=${()=>Ot(this,he,Nn).call(this,"json")}
              class="${r?"active":""}"
            >
              JSON
            </li>
          </ul>

          <!-- Button to toggle tabs -->
          <button
            class="add-icon icon"
            @click=${()=>Ot(this,he,Nn).call(this,this.open?null:"url")}
          >
            ${this.unstyled?"Add Layer":""}
          </button>
        </div>
        <div class="eox-add ${t}">
          ${e?Z`
              <!-- Input field for URL -->
              <div class="eox-add-layer-col">
                <input 
                  type="text" 
                  class="add-url" 
                  placeholder="Add URL (WMS/XYZ)" 
                  .value="${this.urlInput}" 
                  @input=${Ot(this,he,Mu)}
                >
                </input>
                <!-- Search button for URL -->
                <button 
                  class="search-icon" 
                  disabled=${n} 
                  @click=${Ot(this,he,Lu)}
                >
                  ${this.unstyled?"Search":""}
                </button>
              </div>

              <!-- Display layers for WMS capabilities -->
              ${this.wmsCapabilities?Z`<ul class="search-lists">
                      ${this.wmsCapabilities.Capability.Layer.Layer.map(o=>{const s=o.Name;return Z`
                            <li class="search-list">
                              ${s}
                              <!-- Button to add layer -->
                              <button
                                class="add-layer-icon icon"
                                @click=${()=>Ot(this,he,zs).call(this,o)}
                              >
                                ${this.unstyled?"+":""}
                              </button>
                            </li>
                          `})}
                    </ul>`:ot}
            `:Z`
                <!-- Textarea for JSON input -->
                <textarea
                  class="add-layer-input"
                  placeholder="Please put a valid eox-map layer JSON."
                  @input=${Ot(this,he,Du)}
                  .value=${this.jsonInput}
                ></textarea>

                <!-- Button to add JSON layer -->
                <button
                  class="add-layer-icon json-add-layer"
                  disabled=${ag(this.jsonInput)?ot:!0}
                  @click=${Ot(this,he,Ou)}
                >
                  ${this.unstyled?"Add JSON":""}
                </button>
              `}
        </div>
      </div>
    `}}he=new WeakSet,Mu=function(i){B_(i,this)},Lu=async function(){const i=await G_(this);i&&Ot(this,he,zs).call(this,i)},zs=function(i){X_(i,this),vh(this)},Ou=function(){vh(this)},Du=function(i){U_(i,this)},Nn=function(i){W_(i,this)},Vs=new WeakMap,Ys=new WeakMap,Et(Pu,"properties",{eoxMap:{attribute:!1,state:!0},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-add-layers",Pu);const H_=(i,t)=>{if(t.requestUpdate(),i.target.tagName==="EOX-LAYERCONTROL-LAYER-TOOLS"){const e=t.renderRoot.querySelector("eox-layercontrol-optional-list");e==null||e.requestUpdate()}},z_=i=>{const t=i.for,e=document.querySelector(t);return e&&e.map!==i.map&&(i.map=e.map),e};var Cr,js,$u,Zs;class ku extends qt{constructor(){super(),lt(this,js),lt(this,Cr),lt(this,Zs,"* { font-family: Roboto, sans-serif; }"),this.for="eox-map",this.idProperty="id",this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=["info","opacity","config","remove","sort"],this.addExternalLayers=!1,this.unstyled=!1,this.styleOverride=""}firstUpdated(){Fn(this,Cr,z_(this))}render(){var t,e,r;const n=(t=this.map)==null?void 0:t.getLayers().getArray(),o=n&&((e=aa(n,"layerControlOptional",!0))==null?void 0:e.length)>0;return Z`
      <style>
        ${!this.unstyled&&dt(this,Zs)}
        ${this.styleOverride}
      </style>

      <!-- Conditional rendering of add layers component -->
      ${ne(this.addExternalLayers&&((r=dt(this,Cr))==null?void 0:r.addOrUpdateLayer),()=>Z`
          <eox-layercontrol-add-layers
            .noShadow=${!0}
            .eoxMap=${dt(this,Cr)}
            .unstyled=${this.unstyled}
          ></eox-layercontrol-add-layers>
        `)}

      <!-- Conditional rendering of layer list component -->
      ${ne(this.map,()=>Z`
          <eox-layercontrol-layer-list
            .noShadow=${!0}
            class="layers"
            .idProperty=${this.idProperty}
            .layers=${this.map.getLayers()}
            .map=${this.map}
            .titleProperty=${this.titleProperty}
            .showLayerZoomState=${this.showLayerZoomState}
            .tools=${this.tools}
            .unstyled=${this.unstyled}
            @changed=${Ot(this,js,$u)}
          ></eox-layercontrol-layer-list>
        `)}

      <!-- Conditional rendering of optional list component -->
      ${ne(o,()=>Z`
          <eox-layercontrol-optional-list
            .noShadow=${!0}
            .idProperty=${this.idProperty}
            .layers=${this.map.getLayers()}
            .titleProperty=${this.titleProperty}
            @changed=${()=>this.requestUpdate()}
          ></eox-layercontrol-optional-list>
        `)}
    `}}Cr=new WeakMap,js=new WeakSet,$u=function(i){H_(i,this),this.dispatchEvent(new CustomEvent("layerchange",{detail:i.detail}))},Zs=new WeakMap,Et(ku,"properties",{for:{type:String},idProperty:{attribute:"id-property"},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},addExternalLayers:{attribute:!1},unstyled:{type:Boolean},styleOverride:{type:String}});customElements.define("eox-layercontrol",ku);export{ku as EOxLayerControl};
